# 系统闹钟 MCP 使用指南

## 概述

`@aether/alarm` 是 AetherLink 的内置系统闹钟 MCP 服务器，**调用系统原生闹钟应用**来设置闹钟，提供真正的闹钟功能（不是通知）。

## ⏰ 真正的闹钟 vs 通知

| 特性 | 系统闹钟 (本MCP) | 普通通知 |
|------|-----------------|---------|
| 静音模式 | ✅ 会响铃 | ❌ 不响 |
| 全屏界面 | ✅ 全屏提醒 | ❌ 只在通知栏 |
| 必须关闭 | ✅ 必须操作才能关闭 | ❌ 可忽略 |
| 贪睡功能 | ✅ 系统原生支持 | ❌ 没有 |
| 震动+铃声 | ✅ 完全支持 | 🟡 部分支持 |
| 系统管理 | ✅ 在系统闹钟中管理 | ❌ 应用内管理 |

## 功能特性

### 1. 设置闹钟 (`set_alarm`)
打开系统闹钟应用并设置闹钟，支持单次和重复模式。

**参数：**
- `title` (必填): 闹钟标题
- `time` (必填): 闹钟时间，ISO 8601格式，例如 `2025-11-08T07:00:00.000Z`
- `repeat` (可选): 重复模式
  - `none`: 不重复（默认）
  - `daily`: 每天重复
  - `weekday`: 工作日重复（周一到周五）
  - `weekend`: 周末重复（周六周日）
- `skipUi` (可选): 是否跳过系统UI直接设置，默认 `false` 会显示系统闹钟界面让用户确认

**返回示例：**
```json
{
  "success": true,
  "message": "成功打开系统闹钟",
  "alarm": {
    "title": "早晨闹钟",
    "time": "07:00",
    "repeat": "每天",
    "originalTime": "2025-11-08T23:00:00.000Z",
    "action": "已打开系统闹钟界面"
  }
}
```

### 2. 查看闹钟 (`show_alarms`)
打开系统闹钟应用，用户可以查看和管理所有闹钟。

**参数：** 无

**返回示例：**
```json
{
  "success": true,
  "message": "成功打开闹钟列表",
  "action": "已打开系统闹钟应用"
}
```

### 3. 设置倒计时 (`set_timer`)
打开系统倒计时功能。

**参数：**
- `seconds` (必填): 倒计时秒数
- `message` (可选): 倒计时描述，默认"倒计时"
- `skipUi` (可选): 是否跳过系统UI直接设置

**返回示例：**
```json
{
  "success": true,
  "message": "成功设置倒计时",
  "timer": {
    "duration": "30分钟",
    "seconds": 1800,
    "description": "煮饭倒计时",
    "action": "已打开系统倒计时界面"
  }
}
```

## 启用系统闹钟 MCP

1. 打开 AetherLink 应用
2. 进入 **设置** → **MCP 服务器设置**
3. 找到 **@aether/alarm** 并启用
4. 在对话中，AI 助手将能够帮您打开系统闹钟

## 使用示例

### 示例 1: 设置单次闹钟
**用户：** "明天早上7点提醒我起床"

AI 会调用 `set_alarm` 工具，打开系统闹钟应用，并预填好信息：
- 时间：07:00
- 标题：起床提醒
- 重复：不重复

用户可以在系统闹钟界面确认或调整，然后保存。

### 示例 2: 设置重复闹钟
**用户：** "每天早上6点半叫我起床"

AI 会设置每日重复闹钟，自动在系统闹钟中创建。

### 示例 3: 查看所有闹钟
**用户：** "我设置了哪些闹钟？" 或 "打开闹钟应用"

AI 会打开系统闹钟应用，用户可以看到所有闹钟。

### 示例 4: 设置倒计时
**用户：** "设置一个30分钟的倒计时，煮饭用"

AI 会打开系统倒计时功能。

### 示例 5: 工作日闹钟
**用户：** "每个工作日早上8点提醒我开会"

AI 会设置工作日重复闹钟（周一至周五）。

## 平台支持

### ✅ Android
完全支持！使用 `AlarmClock` Intent 调用系统闹钟应用：
- 设置闹钟
- 设置重复模式（每天/工作日/周末）
- 打开闹钟列表
- 设置倒计时

### ⚠️ iOS
iOS 由于系统限制，不允许第三方应用直接设置闹钟。本MCP在iOS上会：
- 引导用户手动打开系统时钟应用
- 提供时间和标题建议
- 用户需要手动完成设置

## 技术实现

### 架构

```
AlarmServer (TypeScript)
    ↓
SystemAlarmPlugin (TypeScript接口)
    ↓
SystemAlarmPlugin.java (Android原生)
    ↓
Android AlarmClock Intent
    ↓
系统闹钟应用
```

### 文件结构
```
src/shared/
├── plugins/
│   ├── SystemAlarmPlugin.ts         # TypeScript 接口
│   └── web/
│       └── SystemAlarmWeb.ts        # Web Mock 实现
├── services/mcp/
    └── servers/
        └── AlarmServer.ts           # MCP 服务器实现

android/app/src/main/java/com/llmhouse/app/
└── SystemAlarmPlugin.java           # Android 原生插件
```

## 优势

### ✅ 真正的闹钟功能
- 即使手机静音也会响铃
- 全屏闹钟界面
- 必须手动关闭
- 系统级可靠性

### ✅ 用户熟悉的界面
- 使用系统原生闹钟应用
- 用户已经习惯的操作方式
- 与其他闹钟统一管理

### ✅ 功能完整
- 贪睡功能
- 自定义铃声
- 渐进音量
- 重启后保持

### ✅ 无需额外权限
- 不需要申请特殊权限
- 利用系统已有功能
- 更安全可靠

## 常见问题

### Q: 为什么要调用系统闹钟而不是应用内闹钟？
A: 系统闹钟提供真正的闹钟功能：静音模式下也会响铃、全屏提醒、必须手动关闭。应用内通知只是普通通知，容易被忽略。

### Q: 可以静默设置闹钟吗（不显示系统界面）？
A: 可以。设置 `skipUi: true` 可以直接创建闹钟，但为了更好的用户体验，建议默认显示系统界面让用户确认。

### Q: 闹钟会在应用中显示吗？
A: 不会。闹钟是在系统闹钟应用中管理的，需要通过系统闹钟应用查看和修改。

### Q: iOS 支持如何？
A: iOS 不允许第三方应用直接设置系统闹钟。我们会打开系统时钟应用，引导用户手动设置。

### Q: 如何取消闹钟？
A: 通过系统闹钟应用管理。可以使用 `show_alarms` 工具打开系统闹钟列表，然后手动取消。

### Q: 支持哪些重复模式？
A: 支持：
- `none` - 不重复（单次闹钟）
- `daily` - 每天
- `weekday` - 工作日（周一至周五）
- `weekend` - 周末（周六、周日）

### Q: 可以设置自定义重复模式吗（例如只在周一、三、五）？
A: 当前版本不支持。用户可以在系统闹钟界面手动设置自定义重复模式。

## 与日历MCP的配合

系统闹钟MCP 和 日历MCP 可以完美配合：

### 场景：自动为日历事件设置闹钟
```
用户: "查看明天的日程，并为每个事件提前15分钟设置闹钟"
```

AI 会：
1. 用 `@aether/calendar` 查询明天的日历事件
2. 为每个事件计算提前15分钟的时间
3. 用 `@aether/alarm` 为每个时间设置系统闹钟

## 最佳实践

1. **让用户确认**：默认 `skipUi: false`，显示系统界面让用户确认
2. **清晰的标题**：使用描述性的闹钟标题
3. **合理的重复模式**：根据用户需求选择合适的重复模式
4. **配合日历使用**：将日历事件转化为闹钟提醒

## 开发模式

在浏览器开发环境中，插件会使用 Mock 实现：
- 模拟成功设置闹钟
- 在控制台输出操作日志
- 不会真正打开系统闹钟

实际功能需要在 Android 设备上运行。

## 未来计划

- [ ] 支持更灵活的自定义重复模式
- [ ] iOS 支持改进（利用 Shortcuts 等）
- [ ] 批量设置多个闹钟
- [ ] 与语音助手集成
- [ ] 智能闹钟建议

## 技术支持

如有问题，请访问：https://github.com/your-repo/AetherLink-app3/issues

---

**注意：** 本MCP调用的是**系统原生闹钟应用**，提供真正的闹钟功能，而不是应用内通知！🎯
