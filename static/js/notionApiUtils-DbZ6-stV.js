import{Ap as e,Mp as t,o as n}from"./index-hvLbsAjx.js";import{t as r}from"./esm-DlPY44W4.js";const i=e=>{if(t.isNativePlatform())return`https://api.notion.com${e}`;let n=`https://api.notion.com${e}`;return`http://localhost:8888/proxy?url=${encodeURIComponent(n)}`};var a=e=>{if(e!=null){if(typeof e==`string`)return e;if(typeof e==`object`&&e.constructor===Object)try{return JSON.stringify(e)}catch(e){throw console.warn(`[Notion API] JSON序列化失败:`,e),Error(`Failed to serialize request data: ${e}`)}if(Array.isArray(e))try{return JSON.stringify(e)}catch(e){throw console.warn(`[Notion API] JSON序列化失败:`,e),Error(`Failed to serialize request data: ${e}`)}try{return String(e)}catch(e){throw console.warn(`[Notion API] 数据序列化失败:`,e),Error(`Unable to serialize request data`)}}};const o=async(n,r)=>{let o=i(n),c={Authorization:`Bearer ${r.apiKey}`,"Notion-Version":`2022-06-28`,"Content-Type":`application/json`};if(t.isNativePlatform()){console.log(`[Notion API] 移动端使用 CorsBypass 插件:`,o);try{let t=await e.request({url:o,method:r.method,headers:c,data:a(r.body),timeout:3e4,responseType:`json`});if(t.status<200||t.status>=300){let e=typeof t.data==`object`?t.data:{};throw new s(e.message||`HTTP ${t.status}: ${t.statusText}`,t.status,e.code)}return t.data}catch(e){throw console.error(`[Notion API] CorsBypass 请求失败:`,e),e?.message?.includes(`timeout`)||e?.message?.includes(`network`)?new s(`网络连接超时，请检查网络设置`,0,`NETWORK_ERROR`):e}}let l=await fetch(o,{method:r.method,headers:c,body:a(r.body)});if(!l.ok){let e=await l.json().catch(()=>({}));throw new s(e.message||`HTTP ${l.status}: ${l.statusText}`,l.status,e.code)}return l.json()};var s=class extends Error{constructor(e,t,n){super(e),this.status=t,this.code=n,this.name=`NotionApiError`}getUserFriendlyMessage(){switch(this.status){case 0:return`网络连接失败，请检查网络设置`;case 401:return`API密钥无效，请检查配置`;case 404:return`数据库不存在，请检查数据库ID`;case 403:return`权限不足，请确保集成已连接到数据库`;case 429:return`请求过于频繁，请稍后重试`;case 500:return`Notion服务器错误，请稍后重试`;default:return this.message||`未知错误`}}};const c=async(e,i)=>{t.isNativePlatform()?await r.show({text:e,duration:`long`,position:`bottom`}):n&&n.success(e)},l=async e=>{let i=e instanceof s?e.getUserFriendlyMessage():e.message;t.isNativePlatform()?await r.show({text:`导出失败: ${i}`,duration:`long`,position:`bottom`}):n&&n.error(`导出失败: ${i}`)};export{c as i,o as n,l as r,s as t};