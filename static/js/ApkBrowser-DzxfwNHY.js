import{t as e}from"./file-code-B0j5RiLs.js";import{t}from"./file-text-BSjgZddV.js";import{t as n}from"./file-GY4o0CHl.js";import{t as r}from"./house-Cnizn3cu.js";import{t as i}from"./image-7oImefSY.js";import{Bu as a,Cd as o,Vu as s,Wu as c,_ as l,au as u,cu as d,eu as f,fd as p,hp as m,hu as h,m as g,n as _,nt as v,pp as y,qp as b,wd as x,xd as S,xp as C,zp as w,zu as T}from"./index-hvLbsAjx.js";var E=b(w(),1),D=b(C(),1),O=()=>{let b=y(),[C]=m(),w=C.get(`path`)||``,O=C.get(`name`)||`APK`,[k,A]=(0,E.useState)(!0),[j,M]=(0,E.useState)(`/`),[N,P]=(0,E.useState)([]),[F,I]=(0,E.useState)(0),[L,R]=(0,E.useState)(0);(0,E.useEffect)(()=>{w&&z(``)},[w]);let z=async e=>{A(!0);try{let t=await v.execute({action:`listApkDirectory`,params:{apkPath:w,directory:e}});t.success&&t.data&&(M(t.data.currentPath||`/`),P((t.data.items||[]).sort((e,t)=>e.isDirectory&&!t.isDirectory?-1:!e.isDirectory&&t.isDirectory?1:e.name.localeCompare(t.name))),I(t.data.folderCount||0),R(t.data.fileCount||0))}catch(e){console.error(`Failed to load APK directory:`,e)}finally{A(!1)}},B=(0,E.useCallback)(()=>{if(j===`/`)return b(-1),!0;{let e=j.split(`/`).filter(Boolean);return e.pop(),z(e.length>0?e.join(`/`)+`/`:``),!0}},[j,b]);_(B,[B]);let V=e=>{z(e)},H=async e=>{let t=e.name.toLowerCase();if(t.endsWith(`.dex`)){b(`/dex-editor?apkPath=${encodeURIComponent(w)}&dexPath=${encodeURIComponent(e.path)}&name=${encodeURIComponent(e.name)}`);return}if(t.endsWith(`.xml`)){try{A(!0);let t=await v.execute({action:`readApkFile`,params:{apkPath:w,filePath:e.path}});if(t.success&&t.data?.content){let n=await v.openXmlEditor({content:t.data.content,title:e.name,filePath:e.path,readOnly:!1});if(n.success&&n.modified&&n.content){let t=await v.execute({action:`writeApkFile`,params:{apkPath:w,filePath:e.path,content:n.content}});t.success?console.log(`[ApkBrowser] XML saved successfully:`,e.path):console.error(`[ApkBrowser] Failed to save XML:`,t.error)}}else console.error(`[ApkBrowser] Failed to read XML:`,t.error)}catch(e){console.error(`[ApkBrowser] Error opening XML editor:`,e)}finally{A(!1)}return}console.log(`File clicked:`,e.name)},U=e=>e===void 0||e<0?``:e===0?`0 B`:e<1024?`${e} B`:e<1024*1024?`${(e/1024).toFixed(1)}K`:`${(e/(1024*1024)).toFixed(2)}M`,W=e=>{if(!e||e<=0)return``;let t=new Date(e);return`${t.getFullYear().toString().slice(-2)}-${String(t.getMonth()+1).padStart(2,`0`)}-${String(t.getDate()).padStart(2,`0`)} ${String(t.getHours()).padStart(2,`0`)}:${String(t.getMinutes()).padStart(2,`0`)}`},G=(r,a)=>{let o=a.toLowerCase();return r===`folder`?(0,D.jsx)(f,{size:24,color:`#FFA726`}):o.endsWith(`.dex`)?(0,D.jsx)(d,{size:24,color:`#4CAF50`}):o===`androidmanifest.xml`?(0,D.jsx)(e,{size:24,color:`#2196F3`}):o.endsWith(`.xml`)?(0,D.jsx)(e,{size:24,color:`#03A9F4`}):o.endsWith(`.arsc`)?(0,D.jsx)(u,{size:24,color:`#9C27B0`}):o.endsWith(`.so`)?(0,D.jsx)(e,{size:24,color:`#F44336`}):o.endsWith(`.png`)||o.endsWith(`.jpg`)||o.endsWith(`.jpeg`)||o.endsWith(`.webp`)||o.endsWith(`.gif`)?(0,D.jsx)(i,{size:24,color:`#E91E63`}):o.endsWith(`.smali`)?(0,D.jsx)(t,{size:24,color:`#8BC34A`}):o.endsWith(`.bin`)||o.endsWith(`.dat`)?(0,D.jsx)(n,{size:24,color:`#607D8B`}):(0,D.jsx)(n,{size:24,color:`#757575`})},K=j.split(`/`).filter(Boolean);return(0,D.jsxs)(l,{children:[(0,D.jsx)(g,{title:O,onBackPress:B}),(0,D.jsxs)(p,{sx:{display:`flex`,alignItems:`center`,justifyContent:`space-between`,px:2,py:1,bgcolor:`action.hover`,borderBottom:1,borderColor:`divider`,overflow:`auto`,flexShrink:0},children:[(0,D.jsx)(o,{size:`small`,onClick:()=>z(``),sx:{mr:.5},children:(0,D.jsx)(r,{size:16})}),(0,D.jsx)(S,{variant:`body2`,sx:{cursor:`pointer`,"&:hover":{textDecoration:`underline`}},onClick:()=>z(``),children:O}),K.map((e,t)=>(0,D.jsxs)(E.Fragment,{children:[(0,D.jsx)(h,{size:16,style:{margin:`0 4px`,opacity:.5}}),(0,D.jsx)(S,{variant:`body2`,sx:{cursor:`pointer`,"&:hover":{textDecoration:`underline`},whiteSpace:`nowrap`},onClick:()=>{z(K.slice(0,t+1).join(`/`)+`/`)},children:e})]},t)),(0,D.jsx)(p,{sx:{flex:1}}),(0,D.jsxs)(S,{variant:`caption`,color:`text.secondary`,sx:{whiteSpace:`nowrap`},children:[F,`文件夹 `,L,`文件`]})]}),(0,D.jsx)(p,{sx:{flex:1,overflow:`auto`,pb:`var(--content-bottom-padding)`},children:k?(0,D.jsx)(p,{sx:{display:`flex`,justifyContent:`center`,alignItems:`center`,height:`100%`},children:(0,D.jsx)(x,{size:32})}):N.length===0?(0,D.jsx)(p,{sx:{display:`flex`,justifyContent:`center`,alignItems:`center`,height:`100%`},children:(0,D.jsx)(S,{color:`text.secondary`,children:`空目录`})}):(0,D.jsx)(c,{disablePadding:!0,children:N.map((e,t)=>(0,D.jsxs)(s,{onClick:()=>e.isDirectory?V(e.path):H(e),sx:{cursor:`pointer`,borderBottom:1,borderColor:`divider`,py:1.5,"&:hover":{bgcolor:`action.hover`},"&:active":{bgcolor:`action.selected`}},children:[(0,D.jsx)(a,{sx:{minWidth:44},children:G(e.type,e.name)}),(0,D.jsx)(T,{primary:(0,D.jsx)(S,{variant:`body1`,noWrap:!0,children:e.name}),secondary:(0,D.jsxs)(S,{variant:`caption`,color:`text.secondary`,children:[W(e.lastModified),` `,U(e.size)]})}),e.isDirectory&&(0,D.jsx)(h,{size:20,color:`#999`})]},t))})})]})};export{O as default};