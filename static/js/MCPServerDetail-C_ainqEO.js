import{t as e}from"./file-text-BSjgZddV.js";import{t}from"./play-CM6mFUlz.js";import{t as n}from"./plus-DCrdXXDc.js";import{$l as r,Ad as ee,Al as i,Au as te,Cd as a,Du as ne,Ed as o,Ep as re,Eu as s,Iu as c,Ju as ie,Ml as ae,Nu as l,Od as u,Ou as d,Ql as oe,Qu as se,Rl as f,Sd as ce,Tl as p,Vu as m,Wu as h,Zu as g,_,_u as v,au as y,bd as le,ci as ue,dd as b,et as x,fd as S,fp as de,kd as C,kp as fe,md as pe,mp as me,pp as he,qd as ge,qp as w,s as _e,vd as ve,wd as T,xd as E,xp as D,xu as ye,zl as be,zp as O,zu as k}from"./index-hvLbsAjx.js";var A=w(O(),1),j=w(D(),1),M=()=>{let{t:w}=ue(),D=he(),{serverId:O}=me(),M=de(),[N,P]=(0,A.useState)(null),[F,I]=(0,A.useState)([]),[L,R]=(0,A.useState)([]),[z,B]=(0,A.useState)([]),[V,H]=(0,A.useState)(!1),[U,W]=(0,A.useState)(!1),[G,K]=(0,A.useState)({open:!1,message:``,severity:`success`}),[q,J]=(0,A.useState)([]),[Y,X]=(0,A.useState)([]);(0,A.useEffect)(()=>{N?.headers&&J(Object.entries(N.headers).map(([e,t])=>({id:Math.random().toString(36).substring(7),key:e,value:t})))},[N?.id]),(0,A.useEffect)(()=>{N?.env&&X(Object.entries(N.env).map(([e,t])=>({id:Math.random().toString(36).substring(7),key:e,value:t})))},[N?.id]),(0,A.useEffect)(()=>{if(M.state?.server)P(M.state.server),Z(M.state.server);else if(O){let e=x.getServerById(O);e&&(P(e),Z(e))}},[O,M.state]);let Z=async e=>{if(e.isActive){H(!0);try{let[t,n,r]=await Promise.all([x.listTools(e),x.listPrompts(e),x.listResources(e)]);I(t),R(n),B(r)}catch(e){console.error(w(`settings.mcpServer.messages.loadDataFailed`),e)}finally{H(!1)}}},xe=()=>{D(`/settings/mcp-server`)},Se=async()=>{if(N)try{await x.updateServer(N),K({open:!0,message:w(`settings.mcpServer.messages.saveSuccess`),severity:`success`})}catch{K({open:!0,message:w(`settings.mcpServer.messages.saveFailed`),severity:`error`})}},Ce=async()=>{if(N){W(!0);try{let e=await x.testConnection(N);K({open:!0,message:w(e?`settings.mcpServer.messages.testSuccess`:`settings.mcpServer.messages.testFailed`),severity:e?`success`:`error`}),e&&N.isActive&&await Z(N)}catch{K({open:!0,message:w(`settings.mcpServer.messages.testFailed`),severity:`error`})}finally{W(!1)}}},we=async e=>{if(N)try{await x.toggleServer(N.id,e),P({...N,isActive:e}),e?await Z({...N,isActive:e}):(I([]),R([]),B([])),K({open:!0,message:w(e?`settings.mcpServer.messages.serverEnabled`:`settings.mcpServer.messages.serverDisabled`),severity:`success`})}catch{K({open:!0,message:w(`settings.mcpServer.messages.operationFailed`),severity:`error`})}},Q=fe()&&re(),Te=e=>{switch(e){case`sse`:case`streamableHttp`:case`httpStream`:return(0,j.jsx)(oe,{});case`stdio`:return(0,j.jsx)(ae,{});case`inMemory`:return(0,j.jsx)(y,{});default:return(0,j.jsx)(f,{})}},$=e=>{switch(e){case`sse`:return`#2196f3`;case`streamableHttp`:return`#00bcd4`;case`httpStream`:return`#9c27b0`;case`stdio`:return`#ff9800`;case`inMemory`:return`#4CAF50`;default:return`#9e9e9e`}};return N?(0,j.jsxs)(_,{children:[(0,j.jsx)(le,{position:`static`,elevation:0,sx:{bgcolor:`background.paper`,color:`text.primary`,borderBottom:1,borderColor:`divider`},children:(0,j.jsxs)(ne,{children:[(0,j.jsx)(a,{edge:`start`,onClick:xe,"aria-label":`back`,sx:{color:`primary.main`},children:(0,j.jsx)(ye,{})}),(0,j.jsx)(pe,{sx:{bgcolor:ge($(N.type),.1),color:$(N.type),mr:2,width:32,height:32},children:Te(N.type)}),(0,j.jsx)(E,{variant:`h6`,component:`div`,sx:{flexGrow:1,fontWeight:600},children:N.name}),(0,j.jsx)(b,{startIcon:U?(0,j.jsx)(T,{size:16}):(0,j.jsx)(t,{}),onClick:Ce,disabled:U,size:`small`,sx:{mr:1},children:w(`settings.mcpServer.detail.buttons.test`)}),(0,j.jsx)(b,{startIcon:(0,j.jsx)(be,{}),onClick:Se,variant:`contained`,size:`small`,children:w(`settings.mcpServer.detail.buttons.save`)})]})}),(0,j.jsxs)(S,{sx:{flexGrow:1,overflow:`auto`,px:2,py:2,pb:`var(--content-bottom-padding)`},children:[(0,j.jsxs)(ee,{sx:{p:3,mb:2},children:[(0,j.jsxs)(E,{variant:`h6`,gutterBottom:!0,sx:{display:`flex`,alignItems:`center`,gap:1},children:[(0,j.jsx)(f,{}),w(`settings.mcpServer.detail.basicInfo.title`)]}),(0,j.jsxs)(S,{sx:{display:`flex`,alignItems:`center`,mb:2},children:[(0,j.jsx)(g,{control:(0,j.jsx)(_e,{checked:N.isActive,onChange:e=>we(e.target.checked)}),label:w(`settings.mcpServer.detail.basicInfo.enableServer`)}),N.isActive&&(0,j.jsx)(ve,{label:w(`settings.mcpServer.status.active`),size:`small`,color:`success`,variant:`outlined`,sx:{ml:2}})]}),(0,j.jsx)(s,{fullWidth:!0,label:w(`settings.mcpServer.detail.basicInfo.serverName`),value:N.name,onChange:e=>P({...N,name:e.target.value}),sx:{mb:2}}),(0,j.jsxs)(se,{fullWidth:!0,sx:{mb:2},children:[(0,j.jsx)(ie,{children:w(`settings.mcpServer.detail.basicInfo.serverType`)}),(0,j.jsxs)(l,{value:N.type,label:w(`settings.mcpServer.detail.basicInfo.serverType`),onChange:e=>P({...N,type:e.target.value}),children:[(0,j.jsx)(c,{value:`sse`,children:w(`settings.mcpServer.detail.basicInfo.types.sse`)}),(0,j.jsx)(c,{value:`streamableHttp`,children:w(`settings.mcpServer.detail.basicInfo.types.streamableHttp`)}),(0,j.jsx)(c,{value:`inMemory`,children:w(`settings.mcpServer.detail.basicInfo.types.inMemory`)}),Q&&(0,j.jsx)(c,{value:`stdio`,children:w(`settings.mcpServer.detail.basicInfo.types.stdio`)||`标准输入/输出 (stdio)`})]})]}),(N.type===`sse`||N.type===`streamableHttp`||N.type===`httpStream`)&&(0,j.jsx)(s,{fullWidth:!0,label:w(`settings.mcpServer.detail.basicInfo.serverUrl`),value:N.baseUrl||``,onChange:e=>P({...N,baseUrl:e.target.value}),placeholder:w(`settings.mcpServer.detail.basicInfo.placeholders.url`),sx:{mb:2}}),N.type===`stdio`&&(0,j.jsxs)(j.Fragment,{children:[(0,j.jsx)(s,{fullWidth:!0,label:w(`settings.mcpServer.detail.basicInfo.command`)||`命令`,value:N.command||``,onChange:e=>P({...N,command:e.target.value}),placeholder:`npx, node, python, uvx...`,helperText:w(`settings.mcpServer.detail.basicInfo.commandHelp`)||`要执行的命令程序`,sx:{mb:2}}),(0,j.jsx)(s,{fullWidth:!0,label:w(`settings.mcpServer.detail.basicInfo.args`)||`命令参数`,value:(N.args||[]).join(` `),onChange:e=>P({...N,args:e.target.value.split(` `).filter(Boolean)}),placeholder:`C:\\path\\to\\script.js 或 -y @anthropic/mcp-server-fetch`,helperText:w(`settings.mcpServer.detail.basicInfo.argsHelp`)||`命令参数，用空格分隔`,sx:{mb:2}})]}),(0,j.jsx)(s,{fullWidth:!0,label:w(`settings.mcpServer.detail.basicInfo.description`),value:N.description||``,onChange:e=>P({...N,description:e.target.value}),multiline:!0,rows:2,sx:{mb:2}}),(0,j.jsx)(s,{fullWidth:!0,label:w(`settings.mcpServer.detail.basicInfo.timeout`),type:`number`,value:N.timeout||60,onChange:e=>P({...N,timeout:parseInt(e.target.value)||60}),inputProps:{min:1,max:300},sx:{mb:2}})]}),(0,j.jsxs)(C,{sx:{mb:2},children:[(0,j.jsx)(o,{expandIcon:(0,j.jsx)(v,{}),children:(0,j.jsxs)(E,{variant:`h6`,sx:{display:`flex`,alignItems:`center`,gap:1},children:[(0,j.jsx)(p,{}),w(`settings.mcpServer.detail.advanced.title`)]})}),(0,j.jsxs)(u,{children:[(0,j.jsx)(E,{variant:`subtitle2`,gutterBottom:!0,sx:{mt:1,mb:1,fontWeight:600},children:w(`settings.mcpServer.detail.advanced.headers`)}),(0,j.jsxs)(d,{spacing:1.5,sx:{mb:3},children:[q.map(e=>(0,j.jsxs)(d,{direction:{xs:`column`,sm:`row`},spacing:1,alignItems:{xs:`stretch`,sm:`center`},sx:{p:{xs:1.5,sm:0},bgcolor:{xs:`background.paper`,sm:`transparent`},borderRadius:{xs:1,sm:0},border:{xs:1,sm:0},borderColor:{xs:`divider`,sm:`transparent`}},children:[(0,j.jsx)(s,{size:`small`,label:w(`settings.mcpServer.detail.advanced.placeholders.headerKey`),placeholder:w(`settings.mcpServer.detail.advanced.placeholders.headerKey`),value:e.key,onChange:t=>{let n=q.map(n=>n.id===e.id?{...n,key:t.target.value}:n);J(n);let r={};n.forEach(e=>{e.key.trim()&&(r[e.key]=e.value)}),P({...N,headers:r})},sx:{flex:{xs:`auto`,sm:1}}}),(0,j.jsx)(s,{size:`small`,label:w(`settings.mcpServer.detail.advanced.placeholders.headerValue`),placeholder:w(`settings.mcpServer.detail.advanced.placeholders.headerValue`),value:e.value,onChange:t=>{let n=q.map(n=>n.id===e.id?{...n,value:t.target.value}:n);J(n);let r={};n.forEach(e=>{e.key.trim()&&(r[e.key]=e.value)}),P({...N,headers:r})},sx:{flex:{xs:`auto`,sm:2}}}),(0,j.jsx)(a,{size:`small`,color:`error`,onClick:()=>{let t=q.filter(t=>t.id!==e.id);J(t);let n={};t.forEach(e=>{e.key.trim()&&(n[e.key]=e.value)}),P({...N,headers:n})},sx:{alignSelf:{xs:`flex-end`,sm:`center`}},children:(0,j.jsx)(i,{size:18})})]},e.id)),(0,j.jsx)(b,{startIcon:(0,j.jsx)(n,{size:16}),onClick:()=>{J([...q,{id:Math.random().toString(36).substring(7),key:``,value:``}])},variant:`outlined`,size:`small`,sx:{alignSelf:`flex-start`},children:w(`settings.mcpServer.detail.advanced.addHeader`)})]}),(0,j.jsx)(E,{variant:`subtitle2`,gutterBottom:!0,sx:{mt:2,mb:1,fontWeight:600},children:w(`settings.mcpServer.detail.advanced.env`)}),(0,j.jsxs)(d,{spacing:1.5,sx:{mb:3},children:[Y.map(e=>(0,j.jsxs)(d,{direction:{xs:`column`,sm:`row`},spacing:1,alignItems:{xs:`stretch`,sm:`center`},sx:{p:{xs:1.5,sm:0},bgcolor:{xs:`background.paper`,sm:`transparent`},borderRadius:{xs:1,sm:0},border:{xs:1,sm:0},borderColor:{xs:`divider`,sm:`transparent`}},children:[(0,j.jsx)(s,{size:`small`,label:w(`settings.mcpServer.detail.advanced.placeholders.envKey`),placeholder:w(`settings.mcpServer.detail.advanced.placeholders.envKey`),value:e.key,onChange:t=>{let n=Y.map(n=>n.id===e.id?{...n,key:t.target.value}:n);X(n);let r={};n.forEach(e=>{e.key.trim()&&(r[e.key]=e.value)}),P({...N,env:r})},sx:{flex:{xs:`auto`,sm:1}}}),(0,j.jsx)(s,{size:`small`,label:w(`settings.mcpServer.detail.advanced.placeholders.envValue`),placeholder:w(`settings.mcpServer.detail.advanced.placeholders.envValue`),value:e.value,onChange:t=>{let n=Y.map(n=>n.id===e.id?{...n,value:t.target.value}:n);X(n);let r={};n.forEach(e=>{e.key.trim()&&(r[e.key]=e.value)}),P({...N,env:r})},sx:{flex:{xs:`auto`,sm:2}}}),(0,j.jsx)(a,{size:`small`,color:`error`,onClick:()=>{let t=Y.filter(t=>t.id!==e.id);X(t);let n={};t.forEach(e=>{e.key.trim()&&(n[e.key]=e.value)}),P({...N,env:n})},sx:{alignSelf:{xs:`flex-end`,sm:`center`}},children:(0,j.jsx)(i,{size:18})})]},e.id)),(0,j.jsx)(b,{startIcon:(0,j.jsx)(n,{size:16}),onClick:()=>{X([...Y,{id:Math.random().toString(36).substring(7),key:``,value:``}])},variant:`outlined`,size:`small`,sx:{alignSelf:`flex-start`},children:w(`settings.mcpServer.detail.advanced.addEnv`)})]}),N.type===`inMemory`&&(0,j.jsxs)(j.Fragment,{children:[(0,j.jsx)(E,{variant:`subtitle2`,gutterBottom:!0,sx:{mt:2,mb:1,fontWeight:600},children:w(`settings.mcpServer.detail.advanced.args`)}),(0,j.jsx)(s,{fullWidth:!0,value:(N.args||[]).join(`
`),onChange:e=>{let t=(e.target.value||``).split(`
`).filter(e=>e.trim());P({...N,args:t})},multiline:!0,rows:3,placeholder:w(`settings.mcpServer.detail.advanced.placeholders.args`),size:`small`})]})]})]}),N.isActive&&(0,j.jsxs)(C,{sx:{mb:2},children:[(0,j.jsx)(o,{expandIcon:(0,j.jsx)(v,{}),children:(0,j.jsxs)(E,{variant:`h6`,sx:{display:`flex`,alignItems:`center`,gap:1},children:[(0,j.jsx)(p,{}),w(`settings.mcpServer.detail.tools.title`),` (`,F.length,`)`]})}),(0,j.jsx)(u,{children:V?(0,j.jsx)(S,{sx:{display:`flex`,justifyContent:`center`,py:2},children:(0,j.jsx)(T,{})}):F.length===0?(0,j.jsx)(E,{color:`text.secondary`,sx:{textAlign:`center`,py:2},children:w(`settings.mcpServer.detail.tools.empty`)}):(0,j.jsx)(h,{children:F.map((e,t)=>(0,j.jsx)(m,{divider:!0,children:(0,j.jsx)(k,{primary:e.name,secondary:e.description||w(`settings.mcpServer.detail.tools.noDescription`)})},t))})})]}),N.isActive&&(0,j.jsxs)(C,{sx:{mb:2},children:[(0,j.jsx)(o,{expandIcon:(0,j.jsx)(v,{}),children:(0,j.jsxs)(E,{variant:`h6`,sx:{display:`flex`,alignItems:`center`,gap:1},children:[(0,j.jsx)(e,{}),w(`settings.mcpServer.detail.prompts.title`),` (`,L.length,`)`]})}),(0,j.jsx)(u,{children:V?(0,j.jsx)(S,{sx:{display:`flex`,justifyContent:`center`,py:2},children:(0,j.jsx)(T,{})}):L.length===0?(0,j.jsx)(E,{color:`text.secondary`,sx:{textAlign:`center`,py:2},children:w(`settings.mcpServer.detail.prompts.empty`)}):(0,j.jsx)(h,{children:L.map((e,t)=>(0,j.jsx)(m,{divider:!0,children:(0,j.jsx)(k,{primary:e.name,secondary:e.description||w(`settings.mcpServer.detail.prompts.noDescription`)})},t))})})]}),N.isActive&&(0,j.jsxs)(C,{sx:{mb:2},children:[(0,j.jsx)(o,{expandIcon:(0,j.jsx)(v,{}),children:(0,j.jsxs)(E,{variant:`h6`,sx:{display:`flex`,alignItems:`center`,gap:1},children:[(0,j.jsx)(r,{}),w(`settings.mcpServer.detail.resources.title`),` (`,z.length,`)`]})}),(0,j.jsx)(u,{children:V?(0,j.jsx)(S,{sx:{display:`flex`,justifyContent:`center`,py:2},children:(0,j.jsx)(T,{})}):z.length===0?(0,j.jsx)(E,{color:`text.secondary`,sx:{textAlign:`center`,py:2},children:w(`settings.mcpServer.detail.resources.empty`)}):(0,j.jsx)(h,{children:z.map((e,t)=>(0,j.jsx)(m,{divider:!0,children:(0,j.jsx)(k,{primary:e.name,secondary:(0,j.jsxs)(S,{children:[(0,j.jsx)(E,{variant:`body2`,color:`text.secondary`,children:e.description||w(`settings.mcpServer.detail.resources.noDescription`)}),(0,j.jsxs)(E,{variant:`caption`,color:`text.secondary`,children:[w(`settings.mcpServer.detail.resources.uri`),`: `,e.uri]})]}),secondaryTypographyProps:{component:`div`}})},t))})})]})]}),(0,j.jsx)(te,{open:G.open,autoHideDuration:3e3,onClose:()=>K({...G,open:!1}),children:(0,j.jsx)(ce,{severity:G.severity,onClose:()=>K({...G,open:!1}),children:G.message})})]}):(0,j.jsx)(S,{sx:{display:`flex`,justifyContent:`center`,alignItems:`center`,height:`100vh`},children:(0,j.jsx)(T,{})})};export{M as default};