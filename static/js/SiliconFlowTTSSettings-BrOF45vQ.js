import{Ad as e,Cd as t,Du as n,Ot as r,Sd as i,Zu as a,_ as o,bd as s,ci as c,dd as l,fd as u,ip as d,np as f,pp as p,qp as m,s as h,td as g,xd as _,xp as v,xu as y,zp as b}from"./index-hvLbsAjx.js";import"./SolidBridge-4JuNrAWl.js";import{t as x}from"./tts-v2-DDBlG3xK.js";import"./FullScreenSelectorSolid-D7sSYiET.js";import{r as S}from"./TTS-tegaWkfT.js";import{t as C}from"./TTSTestSection-BqHpnV2B.js";var w=m(b(),1),T=m(v(),1),E=()=>{let m=p(),{t:v}=c(),b=(0,w.useMemo)(()=>x.getInstance(),[]),E=(0,w.useRef)(null),D=(0,w.useRef)(null),O=(0,w.useRef)(null),[k,A]=(0,w.useState)({apiKey:``,showApiKey:!1,selectedModel:`FunAudioLLM/CosyVoice2-0.5B`,selectedVoice:`alex`,useStream:!1,speed:1,gain:0,maxTokens:1600}),[j,M]=(0,w.useState)({saveError:``,isTestPlaying:!1}),[N,P]=(0,w.useState)(``),[F,I]=(0,w.useState)(!0),[L,R]=(0,w.useState)(!1);(0,w.useEffect)(()=>{(async()=>{try{let e=await f(`siliconflow_api_key`)||``,t=await f(`tts_model`)||`FunAudioLLM/CosyVoice2-0.5B`,n=await f(`tts_voice`)||`alex`,r=await f(`siliconflow_tts_stream`)===`true`,i=await f(`enable_tts`)!==`false`,a=await f(`selected_tts_service`)||`siliconflow`,o=parseFloat(await f(`siliconflow_tts_speed`)||`1`),s=parseFloat(await f(`siliconflow_tts_gain`)||`0`),c=parseInt(await f(`siliconflow_tts_max_tokens`)||`1600`);A({apiKey:e,showApiKey:!1,selectedModel:t,selectedVoice:n,useStream:r,speed:o,gain:s,maxTokens:c}),I(i),R(a===`siliconflow`);let l=t===`fnlp/MOSS-TTSD-v0.5`||t===`IndexTeam/IndexTTS-2`;b.configureEngine(`siliconflow`,{enabled:!0,apiKey:e,model:t,voice:`${t}:${n}`,useStream:r,...l&&{speed:o,gain:s,maxTokens:c}}),P(v(`settings.voice.siliconflow.testText`))}catch(e){console.error(v(`settings.voice.common.loadingError`,{service:`SiliconFlow TTS`}),e)}})()},[b,v]);let z=(0,w.useCallback)(async()=>{try{return L&&!k.apiKey.trim()?(M(e=>({...e,saveError:v(`settings.voice.siliconflow.apiKeyRequired`)})),!1):(await d(`siliconflow_api_key`,k.apiKey),await d(`tts_model`,k.selectedModel),await d(`tts_voice`,k.selectedVoice),await d(`siliconflow_tts_stream`,k.useStream.toString()),await d(`enable_tts`,F.toString()),await d(`use_capacitor_tts`,`false`),await d(`siliconflow_tts_speed`,(k.speed??1).toString()),await d(`siliconflow_tts_gain`,(k.gain??0).toString()),await d(`siliconflow_tts_max_tokens`,(k.maxTokens??1600).toString()),L?(await d(`selected_tts_service`,`siliconflow`),await d(`use_siliconflow_tts`,`true`),await d(`use_openai_tts`,`false`),await d(`use_azure_tts`,`false`),await d(`use_capacitor_tts`,`false`),b.setActiveEngine(`siliconflow`)):(await d(`use_siliconflow_tts`,`false`),b.configureEngine(`siliconflow`,{enabled:!1})),M(e=>({...e,saveError:``})),!0)}catch(e){return console.error(v(`settings.voice.common.saveErrorText`,{service:`SiliconFlow TTS`}),e),M(e=>({...e,saveError:v(`settings.voice.common.saveError`)})),!1}},[k,F,L,b,v]),B=(0,w.useCallback)(async()=>{await z()&&setTimeout(()=>{m(`/settings/voice`)},0)},[z,m]),V=(0,w.useCallback)(e=>{R(e)},[]),H=(0,w.useCallback)(async()=>{if(j.isTestPlaying){b.stop(),D.current&&clearInterval(D.current),M(e=>({...e,isTestPlaying:!1}));return}if(!k.apiKey){M(e=>({...e,saveError:v(`settings.voice.common.apiKeyRequired`)}));return}M(e=>({...e,isTestPlaying:!0}));let e=k.selectedModel===`IndexTeam/IndexTTS-2`,t=k.selectedModel===`fnlp/MOSS-TTSD-v0.5`||e;if(b.configureEngine(`siliconflow`,{enabled:!0,apiKey:k.apiKey,model:k.selectedModel,voice:`${k.selectedModel}:${k.selectedVoice}`,useStream:k.useStream,...t&&{speed:k.speed??1,gain:k.gain??0,maxTokens:k.maxTokens??1600}}),b.setActiveEngine(`siliconflow`),!await b.speak(N)){M(e=>({...e,isTestPlaying:!1}));return}D.current=setInterval(()=>{b.isPlaying||(M(e=>({...e,isTestPlaying:!1})),D.current&&clearInterval(D.current))},100)},[k,N,b,j.isTestPlaying,v]),U=()=>{m(`/settings/voice`)};(0,w.useEffect)(()=>{let e=E.current,t=D.current,n=O.current;return()=>{e&&clearTimeout(e),t&&clearInterval(t),n&&clearTimeout(n),j.isTestPlaying&&b.stop()}},[j.isTestPlaying,b]);let W=r(`toolbar-bg`),G=r(`toolbar-border`),K=r(`toolbar-shadow`),q=r(`text-primary`),J=r(`border-default`),Y=r(`border-subtle`),X=r(`hover-bg`),Z=r(`bg-paper`),Q=r(`bg-default`),$=r(`primary`);return(0,T.jsxs)(o,{sx:{width:`100vw`,overflow:`hidden`,backgroundColor:Q},children:[(0,T.jsx)(s,{position:`static`,elevation:0,sx:{backgroundColor:W,color:q,borderBottom:`1px solid ${G}`,boxShadow:`0 18px 40px -24px ${K}`,backdropFilter:`blur(18px)`,WebkitBackdropFilter:`blur(18px)`,transition:`background-color 0.3s ease, box-shadow 0.3s ease, border-color 0.3s ease`},children:(0,T.jsxs)(n,{sx:{minHeight:{xs:56,sm:64},px:{xs:1.5,sm:2.5,md:4},gap:{xs:1,sm:1.5}},children:[(0,T.jsx)(t,{edge:`start`,onClick:U,"aria-label":v(`settings.voice.back`),size:`large`,sx:{color:$,mr:{xs:1,sm:2},borderRadius:2,border:`1px solid ${Y}`,transition:`all 0.2s ease`,"&:hover":{backgroundColor:X,transform:`translateY(-1px)`},"&:focus-visible":{outline:`2px solid ${$}`,outlineOffset:`2px`}},children:(0,T.jsx)(y,{size:20})}),(0,T.jsx)(_,{variant:`h6`,component:`div`,sx:{flexGrow:1,fontWeight:700,letterSpacing:`0.03em`,textTransform:`uppercase`},children:v(`settings.voice.siliconflow.title`)}),(0,T.jsx)(l,{onClick:B,variant:`contained`,sx:{borderRadius:2,px:{xs:2.5,sm:3},py:{xs:.9,sm:1},fontWeight:700},children:v(`settings.voice.common.save`)})]})}),(0,T.jsx)(u,{sx:{flex:1,overflow:`auto`,pt:2,pb:`var(--content-bottom-padding)`,px:{xs:1.5,sm:2.5,md:4},"&::-webkit-scrollbar":{width:`6px`},"&::-webkit-scrollbar-thumb":{backgroundColor:K,borderRadius:3,border:`1px solid ${Y}`}},children:(0,T.jsxs)(u,{sx:{maxWidth:960,mx:`auto`,width:`100%`},children:[j.saveError&&(0,T.jsx)(i,{severity:`error`,sx:{mb:{xs:1.5,sm:2},borderRadius:{xs:1,sm:2}},children:j.saveError}),(0,T.jsxs)(e,{elevation:0,sx:{p:{xs:2.5,sm:3},mb:{xs:2,sm:3},borderRadius:{xs:2,sm:2.5},border:`1px solid ${J}`,bgcolor:Z,boxShadow:`0 18px 40px -28px ${K}`},children:[(0,T.jsx)(_,{variant:`h6`,sx:{mb:3,fontWeight:600},children:v(`settings.voice.common.apiConfig`)}),(0,T.jsxs)(u,{sx:{mb:3},children:[(0,T.jsx)(a,{control:(0,T.jsx)(h,{checked:L,onChange:e=>V(e.target.checked)}),label:v(`settings.voice.common.enableService`,{name:v(`settings.voice.services.siliconflow.name`)})}),(0,T.jsx)(_,{variant:`body2`,color:`text.secondary`,sx:{mt:1,ml:4},children:v(`settings.voice.siliconflow.enableDesc`)})]}),(0,T.jsx)(g,{sx:{mb:3}}),(0,T.jsx)(S,{settings:k,onSettingsChange:A})]}),(0,T.jsx)(C,{testText:N,setTestText:P,handleTestTTS:H,isTestPlaying:j.isTestPlaying,enableTTS:F,selectedTTSService:`siliconflow`,openaiApiKey:``,azureApiKey:``,siliconFlowApiKey:k.apiKey})]})})]})};export{E as default};