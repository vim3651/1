import{Ad as e,Cd as t,Du as n,Eu as r,Iu as i,Ju as a,Nu as o,Ot as s,Qu as c,Sd as l,Zu as u,_ as d,bd as f,ci as p,dd as m,fd as h,ip as g,np as _,pp as v,qp as y,s as b,td as x,xd as S,xp as C,xu as w,zp as T}from"./index-hvLbsAjx.js";import{t as E}from"./tts-v2-DDBlG3xK.js";import{t as D}from"./TTSTestSection-BqHpnV2B.js";var O=y(T(),1);const k={Zephyr:`Bright - 明亮`,Puck:`Upbeat - 乐观`,Charon:`Informative - 信息丰富`,Kore:`Firm - 坚定`,Fenrir:`Excitable - 兴奋`,Leda:`Youthful - 年轻`,Orus:`Firm - 坚定`,Aoede:`Breezy - 轻松`,Callirrhoe:`Easy-going - 随和`,Autonoe:`Bright - 明亮`,Enceladus:`Breathy - 气息感`,Iapetus:`Clear - 清晰`,Umbriel:`Easy-going - 随和`,Algieba:`Smooth - 流畅`,Despina:`Smooth - 流畅`,Erinome:`Clear - 清晰`,Algenib:`Gravelly - 沙哑`,Rasalgethi:`Informative - 信息丰富`,Laomedeia:`Upbeat - 乐观`,Achernar:`Soft - 柔和`,Alnilam:`Firm - 坚定`,Schedar:`Even - 平稳`,Gacrux:`Mature - 成熟`,Pulcherrima:`Forward - 直接`,Achird:`Friendly - 友好`,Zubenelgenubi:`Casual - 随意`,Vindemiatrix:`Gentle - 温和`,Sadachbia:`Lively - 活泼`,Sadaltager:`Knowledgeable - 博学`,Sulafat:`Warm - 温暖`};var A=y(C(),1),j=()=>{let y=v(),{t:C}=p(),T=(0,O.useMemo)(()=>E.getInstance(),[]),j=(0,O.useRef)(null),M=(0,O.useRef)(null),N=(0,O.useRef)(null),[P,F]=(0,O.useState)({apiKey:``,showApiKey:!1,model:`gemini-2.5-flash-preview-tts`,voice:`Kore`,stylePrompt:``,useMultiSpeaker:!1,speakers:[{speaker:`Speaker1`,voiceName:`Kore`},{speaker:`Speaker2`,voiceName:`Puck`}]}),[I,L]=(0,O.useState)({isSaved:!1,saveError:``,isTestPlaying:!1}),[R,z]=(0,O.useState)(`你好，欢迎使用 Google Gemini TTS 服务！这是一个高质量的文本转语音系统。`),[B,V]=(0,O.useState)(!0),[H,U]=(0,O.useState)(!1);(0,O.useEffect)(()=>{(async()=>{try{let e=await _(`gemini_tts_api_key`)||``,t=await _(`gemini_tts_model`)||`gemini-2.5-flash-preview-tts`,n=await _(`gemini_tts_voice`)||`Kore`,r=await _(`gemini_tts_style_prompt`)||``,i=await _(`gemini_tts_multi_speaker`)===`true`,a=await _(`gemini_tts_speakers`)||[{speaker:`Speaker1`,voiceName:`Kore`},{speaker:`Speaker2`,voiceName:`Puck`}],o=await _(`enable_tts`)!==`false`,s=await _(`selected_tts_service`)||`siliconflow`;F({apiKey:e,showApiKey:!1,model:t,voice:n,stylePrompt:r,useMultiSpeaker:i,speakers:a}),V(o),U(s===`gemini`),T.configureEngine(`gemini`,{enabled:!0,apiKey:e,model:t,voice:n,stylePrompt:r,useMultiSpeaker:i,speakers:a})}catch(e){console.error(`加载 Gemini TTS 设置失败:`,e)}})()},[T,C]);let W=(0,O.useCallback)(e=>{U(e)},[]),G=(0,O.useCallback)(async()=>{try{await g(`gemini_tts_api_key`,P.apiKey),await g(`gemini_tts_model`,P.model),await g(`gemini_tts_voice`,P.voice),await g(`gemini_tts_style_prompt`,P.stylePrompt),await g(`gemini_tts_multi_speaker`,P.useMultiSpeaker.toString()),await g(`gemini_tts_speakers`,P.speakers),await g(`enable_tts`,B.toString()),await g(`use_capacitor_tts`,`false`),H&&(await g(`selected_tts_service`,`gemini`),await g(`use_gemini_tts`,`true`),await g(`use_openai_tts`,`false`),await g(`use_azure_tts`,`false`)),T.configureEngine(`gemini`,{enabled:!0,apiKey:P.apiKey,model:P.model,voice:P.voice,stylePrompt:P.stylePrompt,useMultiSpeaker:P.useMultiSpeaker,speakers:P.speakers}),H?(await g(`selected_tts_service`,`gemini`),await g(`use_gemini_tts`,`true`),await g(`use_openai_tts`,`false`),await g(`use_azure_tts`,`false`),await g(`use_capacitor_tts`,`false`),T.setActiveEngine(`gemini`)):(await g(`use_gemini_tts`,`false`),T.configureEngine(`gemini`,{enabled:!1})),L(e=>({...e,isSaved:!0,saveError:``})),setTimeout(()=>{y(`/settings/voice`)},500)}catch(e){console.error(`保存 Gemini TTS 设置失败:`,e),L(e=>({...e,isSaved:!1,saveError:C(`settings.voice.common.saveErrorText`,{service:`Gemini TTS`})}))}},[P,B,H,T,y,C]),K=(0,O.useCallback)(async()=>{if(I.isTestPlaying){T.stop(),M.current&&clearInterval(M.current),L(e=>({...e,isTestPlaying:!1}));return}if(!P.apiKey){L(e=>({...e,saveError:C(`settings.voice.common.apiKeyRequired`)}));return}if(L(e=>({...e,isTestPlaying:!0})),T.configureEngine(`gemini`,{enabled:!0,apiKey:P.apiKey,model:P.model,voice:P.voice,stylePrompt:P.stylePrompt,useMultiSpeaker:P.useMultiSpeaker,speakers:P.speakers}),T.setActiveEngine(`gemini`),!await T.speak(R)){L(e=>({...e,isTestPlaying:!1}));return}M.current=setInterval(()=>{T.isPlaying||(L(e=>({...e,isTestPlaying:!1})),M.current&&clearInterval(M.current))},100)},[P,R,T,I.isTestPlaying,C]),q=()=>{y(`/settings/voice`)};(0,O.useEffect)(()=>{let e=j.current,t=M.current,n=N.current;return()=>{e&&clearTimeout(e),t&&clearInterval(t),n&&clearTimeout(n),I.isTestPlaying&&T.stop()}},[I.isTestPlaying,T]);let J=`Zephyr.Puck.Charon.Kore.Fenrir.Leda.Orus.Aoede.Callirrhoe.Autonoe.Enceladus.Iapetus.Umbriel.Algieba.Despina.Erinome.Algenib.Rasalgethi.Laomedeia.Achernar.Alnilam.Schedar.Gacrux.Pulcherrima.Achird.Zubenelgenubi.Vindemiatrix.Sadachbia.Sadaltager.Sulafat`.split(`.`),Y=s(`toolbar-bg`),X=s(`toolbar-border`),Z=s(`toolbar-shadow`),ee=s(`text-primary`),te=s(`text-secondary`),ne=s(`border-default`),Q=s(`border-subtle`),re=s(`hover-bg`),ie=s(`bg-paper`),ae=s(`bg-default`),$=s(`primary`);return(0,A.jsxs)(d,{sx:{width:`100vw`,overflow:`hidden`,backgroundColor:ae},children:[(0,A.jsx)(f,{position:`static`,elevation:0,sx:{backgroundColor:Y,color:ee,borderBottom:`1px solid ${X}`,boxShadow:`0 18px 40px -24px ${Z}`,backdropFilter:`blur(18px)`,WebkitBackdropFilter:`blur(18px)`,transition:`background-color 0.3s ease, box-shadow 0.3s ease, border-color 0.3s ease`},children:(0,A.jsxs)(n,{sx:{minHeight:{xs:56,sm:64},px:{xs:1.5,sm:2.5,md:4},gap:{xs:1,sm:1.5}},children:[(0,A.jsx)(t,{edge:`start`,onClick:q,"aria-label":C(`settings.voice.back`),size:`large`,sx:{color:$,mr:{xs:1,sm:2},borderRadius:2,border:`1px solid ${Q}`,transition:`all 0.2s ease`,"&:hover":{backgroundColor:re,transform:`translateY(-1px)`},"&:focus-visible":{outline:`2px solid ${$}`,outlineOffset:`2px`}},children:(0,A.jsx)(w,{size:20})}),(0,A.jsx)(S,{variant:`h6`,component:`div`,sx:{flexGrow:1,fontWeight:700,letterSpacing:`0.03em`,textTransform:`uppercase`},children:`Google Gemini TTS`}),(0,A.jsx)(m,{onClick:G,variant:`contained`,sx:{borderRadius:2,px:{xs:2.5,sm:3},py:{xs:.9,sm:1},fontWeight:700},children:C(`settings.voice.common.save`)})]})}),(0,A.jsx)(h,{sx:{flex:1,overflow:`auto`,pt:2,pb:`var(--content-bottom-padding)`,px:{xs:1.5,sm:2.5,md:4},"&::-webkit-scrollbar":{width:`6px`},"&::-webkit-scrollbar-thumb":{backgroundColor:Z,borderRadius:3,border:`1px solid ${Q}`}},children:(0,A.jsxs)(h,{sx:{maxWidth:960,mx:`auto`,width:`100%`},children:[I.isSaved&&(0,A.jsx)(l,{severity:`success`,sx:{mb:{xs:1.5,sm:2},borderRadius:{xs:1,sm:2}},children:C(`settings.voice.common.saveSuccess`)}),I.saveError&&(0,A.jsx)(l,{severity:`error`,sx:{mb:{xs:1.5,sm:2},borderRadius:{xs:1,sm:2}},children:I.saveError}),(0,A.jsxs)(e,{elevation:0,sx:{p:{xs:2.5,sm:3},mb:{xs:2,sm:3},borderRadius:{xs:2,sm:2.5},border:`1px solid ${ne}`,bgcolor:ie,boxShadow:`0 18px 40px -28px ${Z}`},children:[(0,A.jsx)(S,{variant:`h6`,sx:{mb:3,fontWeight:600},children:C(`settings.voice.common.apiConfig`)}),(0,A.jsxs)(h,{sx:{mb:3},children:[(0,A.jsx)(u,{control:(0,A.jsx)(b,{checked:H,onChange:e=>W(e.target.checked)}),label:C(`settings.voice.common.enableService`,{name:`Gemini TTS`})}),(0,A.jsx)(S,{variant:`body2`,sx:{mt:1,ml:4,color:te},children:C(`settings.voice.gemini.enableDesc`)})]}),(0,A.jsx)(x,{sx:{mb:3}}),(0,A.jsx)(r,{fullWidth:!0,label:C(`settings.voice.gemini.apiKey`),type:P.showApiKey?`text`:`password`,value:P.apiKey,onChange:e=>F({...P,apiKey:e.target.value}),sx:{mb:2},helperText:C(`settings.voice.gemini.apiKeyHelp`)}),(0,A.jsx)(u,{control:(0,A.jsx)(b,{checked:P.showApiKey,onChange:e=>F({...P,showApiKey:e.target.checked})}),label:C(`settings.voice.common.showApiKey`),sx:{mb:3}}),(0,A.jsx)(x,{sx:{mb:3}}),(0,A.jsxs)(c,{fullWidth:!0,sx:{mb:2},children:[(0,A.jsx)(a,{children:C(`settings.voice.gemini.model`)}),(0,A.jsxs)(o,{value:P.model,label:C(`settings.voice.gemini.model`),onChange:e=>F({...P,model:e.target.value}),children:[(0,A.jsx)(i,{value:`gemini-2.5-flash-preview-tts`,children:C(`settings.voice.gemini.modelFlash`)}),(0,A.jsx)(i,{value:`gemini-2.5-pro-preview-tts`,children:C(`settings.voice.gemini.modelPro`)})]})]}),!P.useMultiSpeaker&&(0,A.jsxs)(c,{fullWidth:!0,sx:{mb:2},children:[(0,A.jsx)(a,{children:C(`settings.voice.gemini.voice`)}),(0,A.jsx)(o,{value:P.voice,label:C(`settings.voice.gemini.voice`),onChange:e=>F({...P,voice:e.target.value}),children:J.map(e=>(0,A.jsxs)(i,{value:e,children:[e,` - `,k[e]]},e))})]}),(0,A.jsx)(r,{fullWidth:!0,label:C(`settings.voice.gemini.stylePrompt`),value:P.stylePrompt,onChange:e=>F({...P,stylePrompt:e.target.value}),placeholder:C(`settings.voice.gemini.stylePromptPlaceholder`),helperText:C(`settings.voice.gemini.stylePromptHelp`),sx:{mb:3}}),(0,A.jsx)(x,{sx:{mb:3}}),(0,A.jsx)(S,{variant:`subtitle1`,sx:{mb:2,fontWeight:600},children:C(`settings.voice.gemini.multiSpeaker`)}),(0,A.jsx)(u,{control:(0,A.jsx)(b,{checked:P.useMultiSpeaker,onChange:e=>F({...P,useMultiSpeaker:e.target.checked})}),label:C(`settings.voice.gemini.enableMultiSpeaker`),sx:{mb:2}}),P.useMultiSpeaker&&(0,A.jsxs)(h,{sx:{mt:2},children:[P.speakers.map((e,t)=>(0,A.jsxs)(h,{sx:{mb:2,p:2,border:`1px solid`,borderColor:`divider`,borderRadius:1},children:[(0,A.jsx)(r,{fullWidth:!0,label:C(`settings.voice.gemini.speakerName`,{number:t+1}),value:e.speaker,onChange:e=>{let n=[...P.speakers];n[t].speaker=e.target.value,F({...P,speakers:n})},sx:{mb:2}}),(0,A.jsxs)(c,{fullWidth:!0,children:[(0,A.jsx)(a,{children:C(`settings.voice.gemini.voice`)}),(0,A.jsx)(o,{value:e.voiceName,label:C(`settings.voice.gemini.voice`),onChange:e=>{let n=[...P.speakers];n[t].voiceName=e.target.value,F({...P,speakers:n})},children:J.map(e=>(0,A.jsxs)(i,{value:e,children:[e,` - `,k[e]]},e))})]})]},t)),(0,A.jsx)(S,{variant:`caption`,color:`text.secondary`,children:C(`settings.voice.gemini.multiSpeakerExample`,{speaker1:P.speakers[0].speaker,speaker2:P.speakers[1].speaker})})]})]}),(0,A.jsx)(D,{testText:R,setTestText:z,handleTestTTS:K,isTestPlaying:I.isTestPlaying,enableTTS:B,selectedTTSService:`openai`,openaiApiKey:P.apiKey,azureApiKey:``,siliconFlowApiKey:``})]})})]})};export{j as default};