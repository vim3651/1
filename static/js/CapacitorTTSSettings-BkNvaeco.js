import{Ad as e,Cd as t,Du as n,Eu as r,Ot as i,Sd as a,Zu as o,_ as s,bd as c,ci as l,dd as u,fd as d,ip as f,ju as p,np as m,pp as h,qp as g,s as _,td as v,xd as y,xp as b,xu as x,zp as S}from"./index-hvLbsAjx.js";import{t as C}from"./tts-v2-DDBlG3xK.js";import{t as w}from"./TTSTestSection-BqHpnV2B.js";var T=g(S(),1),E=g(b(),1),D=()=>{let g=h(),{t:b}=l(),S=(0,T.useMemo)(()=>C.getInstance(),[]),[D,O]=(0,T.useState)({language:`zh-CN`,rate:1,pitch:1,volume:1}),k=i(`toolbar-bg`),A=i(`toolbar-border`),j=i(`toolbar-shadow`),M=i(`text-primary`),N=i(`border-default`),P=i(`border-subtle`),F=i(`hover-bg`),I=i(`bg-paper`),L=i(`bg-default`),R=i(`primary`),[z,B]=(0,T.useState)({saveError:``,isTestPlaying:!1}),[V,H]=(0,T.useState)(b(`settings.voice.capacitorTTS.testText`)),[U,W]=(0,T.useState)(!0),[G,K]=(0,T.useState)(!1);(0,T.useEffect)(()=>{(async()=>{try{let e=await m(`capacitor_tts_language`)||`zh-CN`,t=Number(await m(`capacitor_tts_rate`)||`1.0`),n=Number(await m(`capacitor_tts_pitch`)||`1.0`),r=Number(await m(`capacitor_tts_volume`)||`1.0`),i=await m(`enable_tts`)!==`false`,a=await m(`selected_tts_service`)||`siliconflow`;O({language:e,rate:t,pitch:n,volume:r}),W(i),K(a===`capacitor`),S.configureEngine(`capacitor`,{enabled:!0,language:e,rate:t,pitch:n,volume:r})}catch(e){console.error(`加载Capacitor TTS设置失败:`,e)}})()},[S,b]);let q=(0,T.useCallback)(async()=>{try{await f(`capacitor_tts_language`,D.language),await f(`capacitor_tts_rate`,D.rate.toString()),await f(`capacitor_tts_pitch`,D.pitch.toString()),await f(`capacitor_tts_volume`,D.volume.toString()),await f(`enable_tts`,U.toString()),G?(await f(`selected_tts_service`,`capacitor`),await f(`use_capacitor_tts`,`true`),await f(`use_openai_tts`,`false`),await f(`use_azure_tts`,`false`),S.configureEngine(`capacitor`,{enabled:!0,language:D.language,rate:D.rate,pitch:D.pitch,volume:D.volume}),S.setActiveEngine(`capacitor`)):(await f(`use_capacitor_tts`,`false`),S.configureEngine(`capacitor`,{enabled:!1})),g(`/settings/voice`)}catch(e){console.error(`保存Capacitor TTS设置失败:`,e),B(e=>({...e,saveError:b(`settings.voice.common.saveError`)}))}},[D,U,G,S,g,b]),J=(0,T.useCallback)(async()=>{if(z.isTestPlaying){S.stop(),B(e=>({...e,isTestPlaying:!1}));return}B(e=>({...e,isTestPlaying:!0})),S.configureEngine(`capacitor`,{enabled:!0,language:D.language,rate:D.rate,pitch:D.pitch,volume:D.volume}),S.setActiveEngine(`capacitor`),await S.speak(V)||B(e=>({...e,isTestPlaying:!1}));let e=()=>{S.isPlaying?setTimeout(e,100):B(e=>({...e,isTestPlaying:!1}))};setTimeout(e,100)},[D,V,S,z.isTestPlaying]);return(0,E.jsxs)(s,{sx:{backgroundColor:L,color:M},children:[(0,E.jsx)(c,{position:`static`,elevation:0,sx:{backgroundColor:k,color:M,borderBottom:`1px solid ${A}`,boxShadow:`0 18px 40px -24px ${j}`,backdropFilter:`blur(18px)`,WebkitBackdropFilter:`blur(18px)`,transition:`background-color 0.3s ease, box-shadow 0.3s ease, border-color 0.3s ease`},children:(0,E.jsxs)(n,{sx:{minHeight:{xs:56,sm:64},px:{xs:1.5,sm:2.5,md:4},gap:{xs:1,sm:1.5}},children:[(0,E.jsx)(t,{edge:`start`,onClick:()=>g(`/settings/voice`),sx:{mr:1.5,color:R,borderRadius:2,border:`1px solid ${P}`,transition:`all 0.2s ease`,"&:hover":{backgroundColor:F,transform:`translateY(-1px)`},"&:focus-visible":{outline:`2px solid ${R}`,outlineOffset:`2px`}},children:(0,E.jsx)(x,{})}),(0,E.jsx)(y,{variant:`h6`,sx:{flexGrow:1,fontWeight:700,letterSpacing:`0.03em`,textTransform:`uppercase`},children:b(`settings.voice.services.capacitorTTS.name`)}),(0,E.jsx)(u,{variant:`contained`,onClick:q,sx:{borderRadius:2,px:{xs:2.5,sm:3},py:{xs:.9,sm:1},fontWeight:700},children:b(`settings.voice.common.save`)})]})}),(0,E.jsx)(d,{sx:{flex:1,overflow:`auto`,pt:2,pb:`var(--content-bottom-padding)`,px:{xs:1.5,sm:2.5,md:4},"&::-webkit-scrollbar":{width:`6px`},"&::-webkit-scrollbar-thumb":{backgroundColor:j,borderRadius:3,border:`1px solid ${P}`}},children:(0,E.jsxs)(d,{sx:{maxWidth:960,mx:`auto`,width:`100%`},children:[z.saveError&&(0,E.jsx)(a,{severity:`error`,sx:{mb:2},onClose:()=>B(e=>({...e,saveError:``})),children:z.saveError}),(0,E.jsxs)(e,{sx:{p:{xs:2.5,sm:3},mb:{xs:2,sm:3},borderRadius:{xs:2,sm:2.5},border:`1px solid ${N}`,bgcolor:I,boxShadow:`0 18px 40px -28px ${j}`},children:[(0,E.jsx)(o,{control:(0,E.jsx)(_,{checked:G,onChange:e=>K(e.target.checked)}),label:b(`settings.voice.capacitorTTS.enableService`),sx:{mb:2}}),(0,E.jsx)(y,{variant:`body2`,sx:{mb:3,color:`text.secondary`},children:b(`settings.voice.capacitorTTS.enableDesc`)}),(0,E.jsx)(v,{sx:{my:3}}),(0,E.jsx)(r,{fullWidth:!0,label:b(`settings.voice.capacitorTTS.language`),value:D.language,onChange:e=>O(t=>({...t,language:e.target.value})),sx:{mb:3},helperText:b(`settings.voice.capacitorTTS.languageHelper`)}),(0,E.jsxs)(y,{gutterBottom:!0,children:[b(`settings.voice.capacitorTTS.rate`),`: `,D.rate.toFixed(1)]}),(0,E.jsx)(p,{value:D.rate,min:0,max:1,step:.1,onChange:(e,t)=>O(e=>({...e,rate:t})),sx:{mb:3}}),(0,E.jsxs)(y,{gutterBottom:!0,children:[b(`settings.voice.capacitorTTS.pitch`),`: `,D.pitch.toFixed(1)]}),(0,E.jsx)(p,{value:D.pitch,min:0,max:2,step:.1,onChange:(e,t)=>O(e=>({...e,pitch:t})),sx:{mb:3}}),(0,E.jsxs)(y,{gutterBottom:!0,children:[b(`settings.voice.capacitorTTS.volume`),`: `,D.volume.toFixed(1)]}),(0,E.jsx)(p,{value:D.volume,min:0,max:1,step:.1,onChange:(e,t)=>O(e=>({...e,volume:t}))})]}),(0,E.jsx)(w,{testText:V,setTestText:H,handleTestTTS:J,isTestPlaying:z.isTestPlaying,enableTTS:U,selectedTTSService:`capacitor`,openaiApiKey:``,azureApiKey:``,siliconFlowApiKey:``})]})})]})};export{D as default};