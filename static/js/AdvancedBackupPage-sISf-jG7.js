import{$d as e,$l as t,Ad as n,Au as r,Bl as i,Bu as a,Cd as o,Ct as s,Dl as c,Du as l,Gd as u,Hd as d,Qd as f,Sd as p,Vd as m,Vu as h,Wu as g,Xd as _,Yd as v,Zu as y,_ as b,au as x,bd as S,ci as C,d as w,dd as T,fd as E,gi as D,hi as O,md as k,mi as A,nf as j,pi as M,pp as N,qd as P,qp as F,rf as I,s as L,td as R,uu as z,wd as B,wt as V,xd as H,xp as U,xu as W,zd as G,zp as K,zu as q}from"./index-hvLbsAjx.js";var J=F(K()),Y=F(U()),X=j(),Z=_(`div`,{name:`MuiContainer`,slot:`Root`,overridesResolver:(e,t)=>{let{ownerState:n}=e;return[t.root,t[`maxWidth${I(String(n.maxWidth))}`],n.fixed&&t.fixed,n.disableGutters&&t.disableGutters]}}),Q=e=>v({props:e,name:`MuiContainer`,defaultTheme:X}),$=(e,t)=>{let n=e=>f(t,e),{classes:r,fixed:i,disableGutters:a,maxWidth:o}=e;return u({root:[`root`,o&&`maxWidth${I(String(o))}`,i&&`fixed`,a&&`disableGutters`]},n,r)};function ee(t={}){let{createStyledComponent:n=Z,useThemeProps:r=Q,componentName:i=`MuiContainer`}=t,a=n(({theme:e,ownerState:t})=>({width:`100%`,marginLeft:`auto`,boxSizing:`border-box`,marginRight:`auto`,...!t.disableGutters&&{paddingLeft:e.spacing(2),paddingRight:e.spacing(2),[e.breakpoints.up(`sm`)]:{paddingLeft:e.spacing(3),paddingRight:e.spacing(3)}}}),({theme:e,ownerState:t})=>t.fixed&&Object.keys(e.breakpoints.values).reduce((t,n)=>{let r=n,i=e.breakpoints.values[r];return i!==0&&(t[e.breakpoints.up(r)]={maxWidth:`${i}${e.breakpoints.unit}`}),t},{}),({theme:e,ownerState:t})=>({...t.maxWidth===`xs`&&{[e.breakpoints.up(`xs`)]:{maxWidth:Math.max(e.breakpoints.values.xs,444)}},...t.maxWidth&&t.maxWidth!==`xs`&&{[e.breakpoints.up(t.maxWidth)]:{maxWidth:`${e.breakpoints.values[t.maxWidth]}${e.breakpoints.unit}`}}}));return J.forwardRef(function(t,n){let o=r(t),{className:s,component:c=`div`,disableGutters:l=!1,fixed:u=!1,maxWidth:d=`lg`,classes:f,...p}=o,m={...o,component:c,disableGutters:l,fixed:u,maxWidth:d};return(0,Y.jsx)(a,{as:c,ownerState:m,className:e($(m,i).root,s),ref:n,...p})})}var te=ee({createStyledComponent:d(`div`,{name:`MuiContainer`,slot:`Root`,overridesResolver:(e,t)=>{let{ownerState:n}=e;return[t.root,t[`maxWidth${m(String(n.maxWidth))}`],n.fixed&&t.fixed,n.disableGutters&&t.disableGutters]}}),useThemeProps:e=>G({props:e,name:`MuiContainer`})}),ne=`AetherLink/backups`,re=()=>{let e=N(),{t:u}=C(),[d,f]=(0,J.useState)(!1),[m,_]=(0,J.useState)({open:!1,message:``,severity:`info`}),[v,j]=(0,J.useState)({includeChats:!0,includeAssistants:!0,includeSettings:!0,includeLocalStorage:!0,includeIndexedDB:!0}),F=()=>{e(`/settings/data`)},I=(e,t=`info`)=>{_({open:!0,message:e,severity:t})},U=()=>{_({...m,open:!1})},G=async e=>{try{return await navigator.clipboard.writeText(e),!0}catch(t){console.error(`复制到剪贴板失败:`,t);try{let t=document.createElement(`textarea`);t.value=e,t.style.position=`fixed`,t.style.opacity=`0`,document.body.appendChild(t),t.select();let n=document.execCommand(`copy`);return document.body.removeChild(t),n}catch(e){return console.error(`备用剪贴板方法也失败:`,e),!1}}},K=e=>t=>{j({...v,[e]:t.target.checked})},X=async()=>{try{f(!0);let e={timestamp:Date.now(),appInfo:{version:`1.0.0`,name:`AetherLink`,backupVersion:3}};if(v.includeChats&&(e.topics=await V()),v.includeAssistants&&(e.assistants=await s()),v.includeSettings){let t=localStorage.getItem(`settings`);e.settings=t?JSON.parse(t):{}}if(v.includeLocalStorage){let t={};for(let e=0;e<localStorage.length;e++){let n=localStorage.key(e);if(n&&n!==`settings`&&!n.startsWith(`aetherlink-migration`)&&n!==`idb-migration-done`)try{let e=localStorage.getItem(n);if(e)try{t[n]=JSON.parse(e)}catch{t[n]=e}}catch(e){console.error(`读取localStorage项 "${n}" 失败:`,e)}}e.localStorage=t}e.backupSettings={location:localStorage.getItem(`backup-location`)||ne,storageType:localStorage.getItem(`backup-storage-type`)||`documents`};let t=new Date().toISOString().replace(/[:.]/g,`-`),n=[];v.includeChats&&n.push(`Chats`),v.includeAssistants&&n.push(`Assistants`),v.includeSettings&&n.push(`Settings`),v.includeLocalStorage&&n.push(`LocalStorage`);let r=`AetherLink_FullBackup_${n.join(`_`)}_${t}.json`,i=JSON.stringify(e,null,2),a=r;await A.writeFile({path:a,data:i,directory:O.Cache,encoding:D.UTF8});let o=await A.getUri({path:a,directory:O.Cache});if(o&&o.uri)try{await M.share({title:u(`dataSettings.messages.backupCreated`),text:u(`dataSettings.advancedBackup.fullBackup.description`),url:o.uri,dialogTitle:u(`common.selectSaveLocation`,{defaultValue:`选择保存位置`})}),I(u(`dataSettings.messages.pleaseSelectSaveLocation`),`info`)}catch(e){console.error(`分享文件失败:`,e);try{await w.open({filePath:o.uri,contentType:`application/json`}),I(u(`dataSettings.messages.fileOpened`),`info`)}catch(e){console.error(`打开文件失败:`,e),await Z(r,i)}}else await Z(r,i)}catch(e){console.error(`创建完整备份失败:`,e),I(u(`dataSettings.messages.backupFailed`)+`: `+e.message,`error`)}finally{f(!1)}},Z=async(e,t)=>{try{let n=`Download`;try{await A.mkdir({path:n,directory:O.External,recursive:!0})}catch(e){console.log(`目录可能已存在:`,e)}let r=`${n}/${e}`;await A.writeFile({path:r,data:t,directory:O.External,encoding:D.UTF8});let i=await A.getUri({path:r,directory:O.External});if(i&&i.uri)try{await w.open({filePath:i.uri,contentType:`application/json`});let e=await G(i.uri);I(`${u(`dataSettings.messages.backupSavedToDownload`)}: ${i.uri}${e?u(`dataSettings.messages.copiedToClipboard`):``}`,`success`)}catch(e){console.error(`打开文件失败，但文件已保存:`,e);let t=await G(i.uri);I(`${u(`dataSettings.messages.backupSavedToDownload`)}: ${i.uri}${t?u(`dataSettings.messages.copiedToClipboard`):``}`,`success`)}else I(u(`dataSettings.messages.backupSavedToDownload`),`success`)}catch(n){console.error(`保存到下载目录失败:`,n);try{await A.writeFile({path:e,data:t,directory:O.External,encoding:D.UTF8});let n=await A.getUri({path:e,directory:O.External});if(n&&n.uri){let e=await G(n.uri);I(`${u(`dataSettings.messages.backupSavedToRoot`)}: ${n.uri}${e?u(`dataSettings.messages.copiedToClipboard`):``}`,`success`)}else I(u(`dataSettings.messages.backupSavedToRoot`),`success`)}catch(e){console.error(`保存到内部存储根目录也失败:`,e),I(u(`dataSettings.messages.backupFailed`)+`: `+e.message,`error`)}}};return(0,Y.jsxs)(b,{children:[(0,Y.jsx)(S,{position:`static`,elevation:0,sx:{bgcolor:`background.paper`,color:`text.primary`,borderBottom:1,borderColor:`divider`,backdropFilter:`blur(8px)`},children:(0,Y.jsxs)(l,{children:[(0,Y.jsx)(o,{edge:`start`,onClick:F,"aria-label":`back`,sx:{color:e=>e.palette.primary.main},children:(0,Y.jsx)(W,{})}),(0,Y.jsx)(H,{variant:`h6`,component:`div`,sx:{flexGrow:1,fontWeight:600},children:u(`dataSettings.advancedBackup.title`)})]})}),(0,Y.jsx)(E,{sx:{flexGrow:1,overflowY:`auto`,p:2,pb:`var(--content-bottom-padding)`,"&::-webkit-scrollbar":{width:`6px`},"&::-webkit-scrollbar-thumb":{backgroundColor:`rgba(0,0,0,0.1)`,borderRadius:`3px`}},children:(0,Y.jsxs)(te,{maxWidth:`sm`,sx:{my:2},children:[(0,Y.jsxs)(n,{elevation:0,sx:{p:3,mb:3,borderRadius:2,border:`1px solid`,borderColor:`divider`,bgcolor:`background.paper`,boxShadow:`0 4px 12px rgba(0,0,0,0.05)`},children:[(0,Y.jsxs)(E,{sx:{display:`flex`,alignItems:`center`,mb:3},children:[(0,Y.jsx)(k,{sx:{width:56,height:56,bgcolor:`#9333EA`,fontSize:`1.5rem`,mr:2,boxShadow:`0 4px 8px rgba(0,0,0,0.1)`},children:(0,Y.jsx)(z,{})}),(0,Y.jsxs)(E,{children:[(0,Y.jsx)(H,{variant:`h6`,sx:{fontWeight:600},children:u(`dataSettings.advancedBackup.fullBackup.title`)}),(0,Y.jsx)(H,{variant:`body2`,color:`text.secondary`,children:u(`dataSettings.advancedBackup.fullBackup.description`)})]})]}),(0,Y.jsx)(R,{sx:{my:2}}),(0,Y.jsx)(p,{severity:`info`,variant:`outlined`,sx:{mb:3,borderRadius:2,"& .MuiAlert-icon":{color:`#9333EA`}},children:u(`dataSettings.advancedBackup.fullBackup.info`)}),(0,Y.jsx)(H,{variant:`subtitle1`,sx:{mb:2,fontWeight:600,color:`text.primary`},children:u(`dataSettings.advancedBackup.fullBackup.selectData`)}),(0,Y.jsxs)(g,{sx:{mb:3},children:[(0,Y.jsx)(n,{elevation:0,sx:{mb:2,borderRadius:2,border:`1px solid`,borderColor:`divider`,overflow:`hidden`,transition:`all 0.2s`,"&:hover":{boxShadow:`0 4px 8px rgba(0,0,0,0.05)`,borderColor:e=>P(e.palette.primary.main,.3)}},children:(0,Y.jsx)(h,{sx:{p:0},children:(0,Y.jsx)(y,{control:(0,Y.jsx)(E,{sx:{ml:2},children:(0,Y.jsx)(L,{checked:v.includeChats,onChange:K(`includeChats`)})}),label:(0,Y.jsxs)(E,{sx:{py:1},children:[(0,Y.jsx)(H,{variant:`body1`,fontWeight:500,children:u(`dataSettings.advancedBackup.fullBackup.chats.label`)}),(0,Y.jsx)(H,{variant:`caption`,color:`text.secondary`,children:u(`dataSettings.advancedBackup.fullBackup.chats.description`)})]}),sx:{width:`100%`}})})}),(0,Y.jsx)(n,{elevation:0,sx:{mb:2,borderRadius:2,border:`1px solid`,borderColor:`divider`,overflow:`hidden`,transition:`all 0.2s`,"&:hover":{boxShadow:`0 4px 8px rgba(0,0,0,0.05)`,borderColor:e=>P(e.palette.primary.main,.3)}},children:(0,Y.jsx)(h,{sx:{p:0},children:(0,Y.jsx)(y,{control:(0,Y.jsx)(E,{sx:{ml:2},children:(0,Y.jsx)(L,{checked:v.includeAssistants,onChange:K(`includeAssistants`)})}),label:(0,Y.jsxs)(E,{sx:{py:1},children:[(0,Y.jsx)(H,{variant:`body1`,fontWeight:500,children:u(`dataSettings.advancedBackup.fullBackup.assistants.label`)}),(0,Y.jsx)(H,{variant:`caption`,color:`text.secondary`,children:u(`dataSettings.advancedBackup.fullBackup.assistants.description`)})]}),sx:{width:`100%`}})})}),(0,Y.jsx)(n,{elevation:0,sx:{mb:2,borderRadius:2,border:`1px solid`,borderColor:`divider`,overflow:`hidden`,transition:`all 0.2s`,"&:hover":{boxShadow:`0 4px 8px rgba(0,0,0,0.05)`,borderColor:e=>P(e.palette.primary.main,.3)}},children:(0,Y.jsx)(h,{sx:{p:0},children:(0,Y.jsx)(y,{control:(0,Y.jsx)(E,{sx:{ml:2},children:(0,Y.jsx)(L,{checked:v.includeSettings,onChange:K(`includeSettings`)})}),label:(0,Y.jsxs)(E,{sx:{py:1},children:[(0,Y.jsx)(H,{variant:`body1`,fontWeight:500,children:u(`dataSettings.advancedBackup.fullBackup.settings.label`)}),(0,Y.jsx)(H,{variant:`caption`,color:`text.secondary`,children:u(`dataSettings.advancedBackup.fullBackup.settings.description`)})]}),sx:{width:`100%`}})})}),(0,Y.jsx)(n,{elevation:0,sx:{mb:2,borderRadius:2,border:`1px solid`,borderColor:`divider`,overflow:`hidden`,transition:`all 0.2s`,"&:hover":{boxShadow:`0 4px 8px rgba(0,0,0,0.05)`,borderColor:e=>P(e.palette.primary.main,.3)}},children:(0,Y.jsx)(h,{sx:{p:0},children:(0,Y.jsx)(y,{control:(0,Y.jsx)(E,{sx:{ml:2},children:(0,Y.jsx)(L,{checked:v.includeLocalStorage,onChange:K(`includeLocalStorage`)})}),label:(0,Y.jsxs)(E,{sx:{py:1},children:[(0,Y.jsx)(H,{variant:`body1`,fontWeight:500,children:u(`dataSettings.advancedBackup.fullBackup.localStorage.label`)}),(0,Y.jsx)(H,{variant:`caption`,color:`text.secondary`,children:u(`dataSettings.advancedBackup.fullBackup.localStorage.description`)})]}),sx:{width:`100%`}})})})]}),(0,Y.jsx)(T,{variant:`contained`,startIcon:d?(0,Y.jsx)(B,{size:24,color:`inherit`}):(0,Y.jsx)(c,{}),onClick:X,disabled:d||!v.includeChats&&!v.includeAssistants&&!v.includeSettings&&!v.includeLocalStorage,fullWidth:!0,sx:{py:1.5,borderRadius:2,background:`linear-gradient(90deg, #9333EA, #754AB4)`,fontWeight:600,"&:hover":{background:`linear-gradient(90deg, #8324DB, #6D3CAF)`}},children:u(d?`dataSettings.advancedBackup.fullBackup.creating`:`dataSettings.advancedBackup.fullBackup.createButton`)})]}),(0,Y.jsxs)(n,{elevation:0,sx:{p:3,borderRadius:2,border:`1px solid`,borderColor:`divider`,bgcolor:`background.paper`,boxShadow:`0 4px 12px rgba(0,0,0,0.05)`},children:[(0,Y.jsx)(H,{variant:`h6`,sx:{mb:2,fontWeight:600},children:u(`dataSettings.advancedBackup.fullBackup.instructions.title`)}),(0,Y.jsx)(R,{sx:{mb:2}}),(0,Y.jsxs)(g,{disablePadding:!0,children:[(0,Y.jsxs)(h,{sx:{px:0,py:1.5},children:[(0,Y.jsx)(a,{children:(0,Y.jsx)(i,{style:{color:`#9333EA`}})}),(0,Y.jsx)(q,{primary:(0,Y.jsx)(H,{variant:`body1`,fontWeight:500,children:u(`dataSettings.advancedBackup.fullBackup.instructions.jsonFile.primary`)}),secondary:u(`dataSettings.advancedBackup.fullBackup.instructions.jsonFile.secondary`),primaryTypographyProps:{component:`div`}})]}),(0,Y.jsxs)(h,{sx:{px:0,py:1.5},children:[(0,Y.jsx)(a,{children:(0,Y.jsx)(t,{style:{color:`#9333EA`}})}),(0,Y.jsx)(q,{primary:(0,Y.jsx)(H,{variant:`body1`,fontWeight:500,children:u(`dataSettings.advancedBackup.fullBackup.instructions.cloud.primary`)}),secondary:u(`dataSettings.advancedBackup.fullBackup.instructions.cloud.secondary`),primaryTypographyProps:{component:`div`}})]}),(0,Y.jsxs)(h,{sx:{px:0,py:1.5},children:[(0,Y.jsx)(a,{children:(0,Y.jsx)(x,{style:{color:`#9333EA`}})}),(0,Y.jsx)(q,{primary:(0,Y.jsx)(H,{variant:`body1`,fontWeight:500,children:u(`dataSettings.advancedBackup.fullBackup.instructions.regular.primary`)}),secondary:u(`dataSettings.advancedBackup.fullBackup.instructions.regular.secondary`),primaryTypographyProps:{component:`div`}})]})]})]})]})}),(0,Y.jsx)(r,{open:m.open,autoHideDuration:6e3,onClose:U,anchorOrigin:{vertical:`bottom`,horizontal:`center`},children:(0,Y.jsx)(p,{onClose:U,severity:m.severity,sx:{width:`100%`,borderRadius:2,boxShadow:`0 4px 12px rgba(0,0,0,0.1)`},variant:`filled`,children:m.message})})]})};export{re as default};