import{t as e}from"./InputAdornment-DO0tC8Wv.js";import{Ad as t,Cd as n,Du as r,Eu as i,Ot as a,Sd as o,Zu as s,_ as c,bd as l,ci as u,dd as d,fd as f,hu as p,ip as m,ju as h,np as g,nu as ee,pp as _,qp as v,s as y,td as b,tu as x,xd as S,xp as C,xu as w,zp as T}from"./index-hvLbsAjx.js";import"./SolidBridge-4JuNrAWl.js";import{d as E,f as D,p as O,t as k}from"./tts-v2-DDBlG3xK.js";import{t as A}from"./FullScreenSelectorSolid-D7sSYiET.js";import{t as j}from"./TTSTestSection-BqHpnV2B.js";var M=v(T(),1),N=v(C(),1),P=()=>{let v=_(),{t:C}=u(),T=(0,M.useMemo)(()=>k.getInstance(),[]),P=(0,M.useRef)(null),F=(0,M.useRef)(null),[I,L]=(0,M.useState)({apiKey:``,showApiKey:!1,modelId:`eleven_multilingual_v2`,voiceId:`JBFqnCBsd6RMkjVDRZzb`,outputFormat:`mp3_44100_128`,stability:.5,similarityBoost:.75,style:0,useSpeakerBoost:!0,speed:1}),[R,z]=(0,M.useState)({isSaved:!1,saveError:``,isTestPlaying:!1}),[B,V]=(0,M.useState)(``),[H,U]=(0,M.useState)(!0),[W,G]=(0,M.useState)(!1),[K,q]=(0,M.useState)(!1),[J,Y]=(0,M.useState)(!1),[X,Z]=(0,M.useState)(!1),Q=(0,M.useMemo)(()=>[{name:`预设语音`,items:O.map(e=>({key:e.id,label:e.name,subLabel:e.description}))}],[]),te=(0,M.useMemo)(()=>[{name:`可用模型`,items:E.map(e=>({key:e.id,label:e.name,subLabel:e.description}))}],[]),ne=(0,M.useMemo)(()=>[{name:`输出格式`,items:D.map(e=>({key:e.id,label:e.name,subLabel:e.description}))}],[]),re=(0,M.useMemo)(()=>O.find(e=>e.id===I.voiceId)?.name||I.voiceId,[I.voiceId]),ie=(0,M.useMemo)(()=>E.find(e=>e.id===I.modelId)?.name||I.modelId,[I.modelId]),ae=(0,M.useMemo)(()=>D.find(e=>e.id===I.outputFormat)?.name||I.outputFormat,[I.outputFormat]);(0,M.useEffect)(()=>{(async()=>{try{let e=await g(`elevenlabs_tts_api_key`)||``,t=await g(`elevenlabs_tts_model`)||`eleven_multilingual_v2`,n=await g(`elevenlabs_tts_voice`)||`JBFqnCBsd6RMkjVDRZzb`,r=await g(`elevenlabs_tts_format`)||`mp3_44100_128`,i=Number(await g(`elevenlabs_tts_stability`)||`0.5`),a=Number(await g(`elevenlabs_tts_similarity_boost`)||`0.75`),o=Number(await g(`elevenlabs_tts_style`)||`0`),s=await g(`elevenlabs_tts_speaker_boost`)!==`false`,c=Number(await g(`elevenlabs_tts_speed`)||`1.0`),l=await g(`enable_tts`)!==`false`,u=await g(`selected_tts_service`)||`siliconflow`;L({apiKey:e,showApiKey:!1,modelId:t,voiceId:n,outputFormat:r,stability:i,similarityBoost:a,style:o,useSpeakerBoost:s,speed:c}),U(l),G(u===`elevenlabs`),T.configureEngine(`elevenlabs`,{enabled:!0,apiKey:e,modelId:t,voiceId:n,outputFormat:r,stability:i,similarityBoost:a,style:o,useSpeakerBoost:s,speed:c}),V(C(`settings.voice.elevenlabs.testText`)||`Hello, this is a test of ElevenLabs text to speech.`)}catch(e){console.error(`加载 ElevenLabs TTS 设置失败:`,e)}})()},[T,C]);let oe=(0,M.useCallback)(async()=>{try{await m(`elevenlabs_tts_api_key`,I.apiKey),await m(`elevenlabs_tts_model`,I.modelId),await m(`elevenlabs_tts_voice`,I.voiceId),await m(`elevenlabs_tts_format`,I.outputFormat),await m(`elevenlabs_tts_stability`,I.stability.toString()),await m(`elevenlabs_tts_similarity_boost`,I.similarityBoost.toString()),await m(`elevenlabs_tts_style`,I.style.toString()),await m(`elevenlabs_tts_speaker_boost`,I.useSpeakerBoost.toString()),await m(`elevenlabs_tts_speed`,I.speed.toString()),await m(`enable_tts`,H.toString()),T.configureEngine(`elevenlabs`,{enabled:!0,apiKey:I.apiKey,modelId:I.modelId,voiceId:I.voiceId,outputFormat:I.outputFormat,stability:I.stability,similarityBoost:I.similarityBoost,style:I.style,useSpeakerBoost:I.useSpeakerBoost,speed:I.speed}),W?(await m(`selected_tts_service`,`elevenlabs`),T.setActiveEngine(`elevenlabs`)):T.configureEngine(`elevenlabs`,{enabled:!1}),setTimeout(()=>{v(`/settings/voice`)},0)}catch(e){console.error(`保存 ElevenLabs TTS 设置失败:`,e),z(e=>({...e,saveError:C(`settings.voice.common.saveError`)}))}},[I,H,W,T,v,C]),se=(0,M.useCallback)(e=>{G(e)},[]),ce=(0,M.useCallback)(async()=>{if(R.isTestPlaying){T.stop(),F.current&&clearInterval(F.current),z(e=>({...e,isTestPlaying:!1}));return}if(!I.apiKey){z(e=>({...e,saveError:C(`settings.voice.common.apiKeyRequired`)}));return}if(z(e=>({...e,isTestPlaying:!0})),T.configureEngine(`elevenlabs`,{enabled:!0,apiKey:I.apiKey,modelId:I.modelId,voiceId:I.voiceId,outputFormat:I.outputFormat,stability:I.stability,similarityBoost:I.similarityBoost,style:I.style,useSpeakerBoost:I.useSpeakerBoost,speed:I.speed}),T.setActiveEngine(`elevenlabs`),!await T.speak(B)){z(e=>({...e,isTestPlaying:!1}));return}F.current=setInterval(()=>{T.isPlaying||(z(e=>({...e,isTestPlaying:!1})),F.current&&clearInterval(F.current))},100)},[I,B,T,R.isTestPlaying,C]),le=()=>{v(`/settings/voice`)};(0,M.useEffect)(()=>{let e=P.current,t=F.current;return()=>{e&&clearTimeout(e),t&&clearInterval(t),R.isTestPlaying&&T.stop()}},[R.isTestPlaying,T]);let ue=a(`toolbar-bg`),de=a(`toolbar-border`),$=a(`toolbar-shadow`),fe=a(`text-primary`),pe=a(`border-default`),me=a(`border-subtle`),he=a(`hover-bg`),ge=a(`bg-paper`),_e=a(`bg-default`),ve=a(`primary`);return(0,N.jsxs)(c,{sx:{width:`100vw`,overflow:`hidden`,backgroundColor:_e},children:[(0,N.jsx)(l,{position:`static`,elevation:0,sx:{backgroundColor:ue,color:fe,borderBottom:`1px solid ${de}`,boxShadow:`0 18px 40px -24px ${$}`,backdropFilter:`blur(18px)`,WebkitBackdropFilter:`blur(18px)`},children:(0,N.jsxs)(r,{sx:{minHeight:{xs:56,sm:64},px:{xs:1.5,sm:2.5,md:4},gap:{xs:1,sm:1.5}},children:[(0,N.jsx)(n,{edge:`start`,onClick:le,"aria-label":C(`settings.voice.back`),size:`large`,sx:{color:ve,mr:{xs:1,sm:2},borderRadius:2,border:`1px solid ${me}`,"&:hover":{backgroundColor:he}},children:(0,N.jsx)(w,{size:20})}),(0,N.jsx)(S,{variant:`h6`,component:`div`,sx:{flexGrow:1,fontWeight:700,letterSpacing:`0.03em`,textTransform:`uppercase`},children:`ElevenLabs TTS`}),(0,N.jsx)(d,{onClick:oe,variant:`contained`,sx:{borderRadius:2,px:{xs:2.5,sm:3},py:{xs:.9,sm:1},fontWeight:700},children:C(`settings.voice.common.save`)})]})}),(0,N.jsx)(f,{sx:{flex:1,overflow:`auto`,pt:2,pb:`var(--content-bottom-padding)`,px:{xs:1.5,sm:2.5,md:4}},children:(0,N.jsxs)(f,{sx:{maxWidth:960,mx:`auto`,width:`100%`},children:[R.isSaved&&(0,N.jsx)(o,{severity:`success`,sx:{mb:2,borderRadius:2},children:C(`settings.voice.common.saveSuccess`)}),R.saveError&&(0,N.jsx)(o,{severity:`error`,sx:{mb:2,borderRadius:2},children:R.saveError}),(0,N.jsxs)(t,{elevation:0,sx:{p:{xs:2.5,sm:3},mb:{xs:2,sm:3},borderRadius:{xs:2,sm:2.5},border:`1px solid ${pe}`,bgcolor:ge,boxShadow:`0 18px 40px -28px ${$}`},children:[(0,N.jsx)(S,{variant:`h6`,sx:{mb:3,fontWeight:600},children:C(`settings.voice.common.apiConfig`)}),(0,N.jsxs)(f,{sx:{mb:3},children:[(0,N.jsx)(s,{control:(0,N.jsx)(y,{checked:W,onChange:e=>se(e.target.checked)}),label:C(`settings.voice.common.enableService`,{name:`ElevenLabs TTS`})}),(0,N.jsx)(S,{variant:`body2`,color:`text.secondary`,sx:{mt:1,ml:4},children:C(`settings.voice.elevenlabs.enableDesc`)||`启用后将使用 ElevenLabs 进行语音合成，提供高质量多语言语音`})]}),(0,N.jsx)(b,{sx:{mb:3}}),(0,N.jsx)(i,{fullWidth:!0,label:`API Key`,type:I.showApiKey?`text`:`password`,value:I.apiKey,onChange:e=>L(t=>({...t,apiKey:e.target.value})),sx:{mb:3},InputProps:{endAdornment:(0,N.jsx)(e,{position:`end`,children:(0,N.jsx)(n,{onClick:()=>L(e=>({...e,showApiKey:!e.showApiKey})),edge:`end`,children:I.showApiKey?(0,N.jsx)(ee,{size:20}):(0,N.jsx)(x,{size:20})})})},helperText:C(`settings.voice.elevenlabs.apiKeyHelper`)||`从 ElevenLabs 控制台获取 API Key`}),(0,N.jsxs)(f,{sx:{display:`flex`,flexWrap:`wrap`,gap:2},children:[(0,N.jsx)(f,{sx:{width:{xs:`100%`,sm:`calc(50% - 8px)`}},children:(0,N.jsx)(i,{fullWidth:!0,label:`模型`,value:ie,onClick:()=>Y(!0),InputProps:{readOnly:!0,endAdornment:(0,N.jsx)(e,{position:`end`,children:(0,N.jsx)(p,{size:18})}),sx:{cursor:`pointer`}},sx:{cursor:`pointer`}})}),(0,N.jsx)(f,{sx:{width:{xs:`100%`,sm:`calc(50% - 8px)`}},children:(0,N.jsx)(i,{fullWidth:!0,label:`语音`,value:re,onClick:()=>q(!0),InputProps:{readOnly:!0,endAdornment:(0,N.jsx)(e,{position:`end`,children:(0,N.jsx)(p,{size:18})}),sx:{cursor:`pointer`}},sx:{cursor:`pointer`}})}),(0,N.jsx)(f,{sx:{width:{xs:`100%`,sm:`calc(50% - 8px)`}},children:(0,N.jsx)(i,{fullWidth:!0,label:`输出格式`,value:ae,onClick:()=>Z(!0),InputProps:{readOnly:!0,endAdornment:(0,N.jsx)(e,{position:`end`,children:(0,N.jsx)(p,{size:18})}),sx:{cursor:`pointer`}},sx:{cursor:`pointer`}})}),(0,N.jsxs)(f,{sx:{width:{xs:`100%`,sm:`calc(50% - 8px)`}},children:[(0,N.jsxs)(S,{gutterBottom:!0,children:[`语速: `,I.speed.toFixed(2)]}),(0,N.jsx)(h,{value:I.speed,min:.5,max:2,step:.05,onChange:(e,t)=>L(e=>({...e,speed:t}))})]}),(0,N.jsxs)(f,{sx:{width:{xs:`100%`,sm:`calc(50% - 8px)`}},children:[(0,N.jsxs)(S,{gutterBottom:!0,children:[`稳定性: `,I.stability.toFixed(2)]}),(0,N.jsx)(h,{value:I.stability,min:0,max:1,step:.05,onChange:(e,t)=>L(e=>({...e,stability:t}))})]}),(0,N.jsxs)(f,{sx:{width:{xs:`100%`,sm:`calc(50% - 8px)`}},children:[(0,N.jsxs)(S,{gutterBottom:!0,children:[`相似度增强: `,I.similarityBoost.toFixed(2)]}),(0,N.jsx)(h,{value:I.similarityBoost,min:0,max:1,step:.05,onChange:(e,t)=>L(e=>({...e,similarityBoost:t}))})]}),(0,N.jsxs)(f,{sx:{width:{xs:`100%`,sm:`calc(50% - 8px)`}},children:[(0,N.jsxs)(S,{gutterBottom:!0,children:[`风格: `,I.style.toFixed(2)]}),(0,N.jsx)(h,{value:I.style,min:0,max:1,step:.05,onChange:(e,t)=>L(e=>({...e,style:t}))})]}),(0,N.jsx)(f,{sx:{width:{xs:`100%`,sm:`calc(50% - 8px)`}},children:(0,N.jsx)(s,{control:(0,N.jsx)(y,{checked:I.useSpeakerBoost,onChange:e=>L(t=>({...t,useSpeakerBoost:e.target.checked}))}),label:`说话者增强`})})]})]}),(0,N.jsx)(j,{testText:B,setTestText:V,handleTestTTS:ce,isTestPlaying:R.isTestPlaying,enableTTS:H,selectedTTSService:`elevenlabs`,openaiApiKey:``,azureApiKey:``,siliconFlowApiKey:``})]})}),(0,N.jsx)(A,{open:J,onClose:()=>Y(!1),title:`选择模型`,groups:te,selectedKey:I.modelId,onSelect:e=>L(t=>({...t,modelId:e}))}),(0,N.jsx)(A,{open:K,onClose:()=>q(!1),title:`选择语音`,groups:Q,selectedKey:I.voiceId,onSelect:e=>L(t=>({...t,voiceId:e}))}),(0,N.jsx)(A,{open:X,onClose:()=>Z(!1),title:`选择输出格式`,groups:ne,selectedKey:I.outputFormat,onSelect:e=>L(t=>({...t,outputFormat:e}))})]})};export{P as default};