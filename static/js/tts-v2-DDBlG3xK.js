const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["static/js/web-C91PSLAg.js","static/js/index-hvLbsAjx.js","static/css/index-iKlUzaLt.css"])))=>i.map(i=>d[i]);
import{Bp as e,Lp as t,Tn as n,jp as r,qp as i}from"./index-hvLbsAjx.js";var a=class{audio=null;audioContext=null;currentBlobUrl=null;_isPlaying=!1;_isPaused=!1;onEndCallback=null;onErrorCallback=null;constructor(){this.initAudio()}initAudio(){this.audio=new Audio,this.audio.onended=()=>{this._isPlaying=!1,this._isPaused=!1,this.releaseBlobUrl(),this.onEndCallback?.()},this.audio.onerror=()=>{this._isPlaying=!1,this._isPaused=!1,this.releaseBlobUrl(),this.onErrorCallback?.(Error(`Audio playback error`))},this.audio.onpause=()=>{this.audio?.ended||(this._isPaused=!0)},this.audio.onplay=()=>{this._isPlaying=!0,this._isPaused=!1};try{this.audioContext=new(window.AudioContext||window.webkitAudioContext)}catch(e){console.warn(`AudioContext 初始化失败:`,e)}}async play(e,t=`audio/mpeg`){if(!this.audio)return!1;try{this.stop();let n=new Blob([e],{type:t});return this.currentBlobUrl=URL.createObjectURL(n),this.audio.src=this.currentBlobUrl,await this.audio.play(),!0}catch(e){return console.error(`播放失败:`,e),this.releaseBlobUrl(),!1}}pause(){this.audio&&this._isPlaying&&!this._isPaused&&(this.audio.pause(),this._isPaused=!0)}async resume(){this.audio&&this._isPaused&&(await this.audio.play(),this._isPaused=!1)}stop(){this.audio&&(this.audio.pause(),this.audio.currentTime=0),this._isPlaying=!1,this._isPaused=!1,this.releaseBlobUrl()}releaseBlobUrl(){this.currentBlobUrl&&=(URL.revokeObjectURL(this.currentBlobUrl),null)}onEnd(e){this.onEndCallback=e}onError(e){this.onErrorCallback=e}get isPlaying(){return this._isPlaying}get isPaused(){return this._isPaused}getAudioContext(){return this.audioContext}dispose(){this.stop(),this.audio&&=(this.audio.src=``,null),this.audioContext&&this.audioContext.state!==`closed`&&(this.audioContext.close(),this.audioContext=null)}};function o(e){let t=e;return t=t.replace(/```[\s\S]*?```/gm,` `),t=t.replace(/`[^`]*`/g,` `),t=t.replace(/\[([^\]]+)\]\([^)]+\)/g,`$1`),t=t.replace(/!\[[^\]]*\]\([^)]*\)/g,` `),t=t.replace(/^[#>\-*+]+\s*/gm,``),t=t.replace(/[*_~]{1,3}/g,``),t=t.replace(/\|/g,` `),t=t.replace(/\s+/g,` `),t.trim()}function s(e,t=450){let n=[],r=e.split(/(?<=[。！？!?.;；])/).map(e=>e.trim()).filter(e=>e.length>0),i=``;for(let e of r)i.length+e.length>t&&i.length>0&&(n.push(i.trim()),i=``),i+=e,i.length>=t&&(n.push(i.trim()),i=``);return i.length>0&&n.push(i.trim()),n.length===0&&n.push(e.length>t?e.substring(0,t):e),n}function c(e){let t=o(e);return t=t.replace(/\n{3,}/g,`

`),t.trim()}var l;(function(e){e[e.Flush=0]=`Flush`,e[e.Add=1]=`Add`})(l||={});var u=t(`TextToSpeech`,{web:()=>r(()=>import(`./web-C91PSLAg.js`),__vite__mapDeps([0,1,2])).then(e=>new e.TextToSpeechWeb)});`speechSynthesis`in window&&window.speechSynthesis;var d=class{_initialized=!1;_available=!1;config={enabled:!1};async initialize(){if(!this._initialized)try{await this.doInitialize(),this._initialized=!0,this._available=!0}catch(e){console.warn(`${this.name} 引擎初始化失败:`,e),this._available=!1}}isAvailable(){return this._available&&this.config.enabled}updateConfig(e){this.config={...this.config,...e}}getConfig(){return{...this.config}}},f=class extends d{name=`capacitor`;priority=1;config={enabled:!1,language:`zh-CN`,rate:1,pitch:1,volume:1};async doInitialize(){try{console.log(`Capacitor TTS 引擎已注册，将在首次使用时完成初始化`),this.warmupAsync()}catch(e){console.warn(`Capacitor TTS 预检查失败，将在使用时重试:`,e)}}async warmupAsync(){await this.delay(500);for(let e=1;e<=3;e++)try{let e=await u.getSupportedLanguages();console.log(`✅ Capacitor TTS 预热完成，支持语言数:`,e.languages?.length||0);return}catch(t){if((t instanceof Error?t.message:String(t)).includes(`null object reference`)&&e<3){console.log(`Capacitor TTS 预热重试 (${e}/3)...`),await this.delay(1e3*e);continue}console.log(`Capacitor TTS 预热跳过，将在首次使用时初始化`);return}}delay(e){return new Promise(t=>setTimeout(t,e))}async synthesize(e){try{return await u.speak({text:e,lang:this.config.language,rate:this.config.rate,pitch:this.config.pitch,volume:this.config.volume,category:`ambient`,queueStrategy:0}),{success:!0,directPlay:!0}}catch(e){return{success:!1,error:e instanceof Error?e.message:String(e)}}}async speak(e){return(await this.synthesize(e)).success}stop(){try{u.stop()}catch(e){console.warn(`停止 Capacitor TTS 失败:`,e)}}updateConfig(e){this.config={...this.config,...e}}},p=class extends d{name=`gemini`;priority=2;config={enabled:!1,apiKey:``,model:`gemini-2.5-flash-preview-tts`,voice:`Kore`,stylePrompt:``,useMultiSpeaker:!1,speakers:[]};async doInitialize(){}isAvailable(){return this.config.enabled&&!!this.config.apiKey}async synthesize(e){if(!this.config.apiKey)return{success:!1,error:`API Key 未设置`};try{let t=`https://generativelanguage.googleapis.com/v1beta/models/${this.config.model}:generateContent`,n=e;this.config.stylePrompt&&(n=`${this.config.stylePrompt} ${e}`);let r={contents:[{parts:[{text:n}]}],generationConfig:{responseModalities:[`AUDIO`],speechConfig:this.buildSpeechConfig()}},i=await fetch(t,{method:`POST`,headers:{"x-goog-api-key":this.config.apiKey,"Content-Type":`application/json`},body:JSON.stringify(r)});if(!i.ok){let e=await i.json().catch(()=>({}));return{success:!1,error:`Gemini TTS 请求失败: ${i.status} ${JSON.stringify(e)}`}}let a=(await i.json()).candidates?.[0]?.content?.parts?.[0]?.inlineData?.data;if(!a)return{success:!1,error:`响应中没有音频数据`};let o=atob(a),s=new Uint8Array(o.length);for(let e=0;e<o.length;e++)s[e]=o.charCodeAt(e);return{success:!0,audioData:this.pcmToWav(s,24e3,1,16).buffer,mimeType:`audio/wav`}}catch(e){return{success:!1,error:e instanceof Error?e.message:String(e)}}}buildSpeechConfig(){return this.config.useMultiSpeaker&&this.config.speakers&&this.config.speakers.length>0?{multiSpeakerVoiceConfig:{speakerVoiceConfigs:this.config.speakers.slice(0,2).map(e=>({speaker:e.speaker,voiceConfig:{prebuiltVoiceConfig:{voiceName:e.voiceName}}}))}}:{voiceConfig:{prebuiltVoiceConfig:{voiceName:this.config.voice}}}}pcmToWav(e,t,n,r){let i=e.length,a=new ArrayBuffer(44+i),o=new DataView(a);return this.writeString(o,0,`RIFF`),o.setUint32(4,36+i,!0),this.writeString(o,8,`WAVE`),this.writeString(o,12,`fmt `),o.setUint32(16,16,!0),o.setUint16(20,1,!0),o.setUint16(22,n,!0),o.setUint32(24,t,!0),o.setUint32(28,t*n*(r/8),!0),o.setUint16(32,r/8*n,!0),o.setUint16(34,r,!0),this.writeString(o,36,`data`),o.setUint32(40,i,!0),new Uint8Array(a,44).set(e),new Uint8Array(a)}writeString(e,t,n){for(let r=0;r<n.length;r++)e.setUint8(t+r,n.charCodeAt(r))}stop(){}updateConfig(e){this.config={...this.config,...e}}},m=e((e=>{Object.defineProperty(e,`__esModule`,{value:!0}),e.default=r;var t,n=new Uint8Array(16);function r(){if(!t&&(t=typeof crypto<`u`&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto),!t))throw Error(`crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported`);return t(n)}})),h=e((e=>{Object.defineProperty(e,`__esModule`,{value:!0}),e.default=void 0,e.default=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000)$/i})),g=e((e=>{Object.defineProperty(e,`__esModule`,{value:!0}),e.default=void 0;var t=n(h());function n(e){return e&&e.__esModule?e:{default:e}}function r(e){return typeof e==`string`&&t.default.test(e)}e.default=r})),_=e((e=>{Object.defineProperty(e,`__esModule`,{value:!0}),e.default=void 0,e.unsafeStringify=i;var t=n(g());function n(e){return e&&e.__esModule?e:{default:e}}var r=[];for(let e=0;e<256;++e)r.push((e+256).toString(16).slice(1));function i(e,t=0){return r[e[t+0]]+r[e[t+1]]+r[e[t+2]]+r[e[t+3]]+`-`+r[e[t+4]]+r[e[t+5]]+`-`+r[e[t+6]]+r[e[t+7]]+`-`+r[e[t+8]]+r[e[t+9]]+`-`+r[e[t+10]]+r[e[t+11]]+r[e[t+12]]+r[e[t+13]]+r[e[t+14]]+r[e[t+15]]}function a(e,n=0){let r=i(e,n);if(!(0,t.default)(r))throw TypeError(`Stringified UUID is invalid`);return r}e.default=a})),v=e((e=>{Object.defineProperty(e,`__esModule`,{value:!0}),e.default=void 0;var t=r(m()),n=_();function r(e){return e&&e.__esModule?e:{default:e}}var i,a,o=0,s=0;function c(e,r,c){let l=r&&c||0,u=r||Array(16);e||={};let d=e.node||i,f=e.clockseq===void 0?a:e.clockseq;if(d==null||f==null){let n=e.random||(e.rng||t.default)();d??=i=[n[0]|1,n[1],n[2],n[3],n[4],n[5]],f??=a=(n[6]<<8|n[7])&16383}let p=e.msecs===void 0?Date.now():e.msecs,m=e.nsecs===void 0?s+1:e.nsecs,h=p-o+(m-s)/1e4;if(h<0&&e.clockseq===void 0&&(f=f+1&16383),(h<0||p>o)&&e.nsecs===void 0&&(m=0),m>=1e4)throw Error(`uuid.v1(): Can't create more than 10M uuids/sec`);o=p,s=m,a=f,p+=0xb1d069b5400;let g=((p&268435455)*1e4+m)%4294967296;u[l++]=g>>>24&255,u[l++]=g>>>16&255,u[l++]=g>>>8&255,u[l++]=g&255;let _=p/4294967296*1e4&268435455;u[l++]=_>>>8&255,u[l++]=_&255,u[l++]=_>>>24&15|16,u[l++]=_>>>16&255,u[l++]=f>>>8|128,u[l++]=f&255;for(let e=0;e<6;++e)u[l+e]=d[e];return r||(0,n.unsafeStringify)(u)}e.default=c})),y=e((e=>{Object.defineProperty(e,`__esModule`,{value:!0}),e.default=void 0;var t=n(g());function n(e){return e&&e.__esModule?e:{default:e}}function r(e){if(!(0,t.default)(e))throw TypeError(`Invalid UUID`);let n,r=new Uint8Array(16);return r[0]=(n=parseInt(e.slice(0,8),16))>>>24,r[1]=n>>>16&255,r[2]=n>>>8&255,r[3]=n&255,r[4]=(n=parseInt(e.slice(9,13),16))>>>8,r[5]=n&255,r[6]=(n=parseInt(e.slice(14,18),16))>>>8,r[7]=n&255,r[8]=(n=parseInt(e.slice(19,23),16))>>>8,r[9]=n&255,r[10]=(n=parseInt(e.slice(24,36),16))/1099511627776&255,r[11]=n/4294967296&255,r[12]=n>>>24&255,r[13]=n>>>16&255,r[14]=n>>>8&255,r[15]=n&255,r}e.default=r})),b=e((e=>{Object.defineProperty(e,`__esModule`,{value:!0}),e.URL=e.DNS=void 0,e.default=s;var t=_(),n=r(y());function r(e){return e&&e.__esModule?e:{default:e}}function i(e){e=unescape(encodeURIComponent(e));let t=[];for(let n=0;n<e.length;++n)t.push(e.charCodeAt(n));return t}var a=`6ba7b810-9dad-11d1-80b4-00c04fd430c8`;e.DNS=a;var o=`6ba7b811-9dad-11d1-80b4-00c04fd430c8`;e.URL=o;function s(e,r,s){function c(e,a,o,c){if(typeof e==`string`&&(e=i(e)),typeof a==`string`&&(a=(0,n.default)(a)),a?.length!==16)throw TypeError(`Namespace must be array-like (16 iterable integer values, 0-255)`);let l=new Uint8Array(16+e.length);if(l.set(a),l.set(e,a.length),l=s(l),l[6]=l[6]&15|r,l[8]=l[8]&63|128,o){c||=0;for(let e=0;e<16;++e)o[c+e]=l[e];return o}return(0,t.unsafeStringify)(l)}try{c.name=e}catch{}return c.DNS=a,c.URL=o,c}})),x=e((e=>{Object.defineProperty(e,`__esModule`,{value:!0}),e.default=void 0;function t(e){if(typeof e==`string`){let t=unescape(encodeURIComponent(e));e=new Uint8Array(t.length);for(let n=0;n<t.length;++n)e[n]=t.charCodeAt(n)}return n(i(a(e),e.length*8))}function n(e){let t=[],n=e.length*32,r=`0123456789abcdef`;for(let i=0;i<n;i+=8){let n=e[i>>5]>>>i%32&255,a=parseInt(r.charAt(n>>>4&15)+r.charAt(n&15),16);t.push(a)}return t}function r(e){return(e+64>>>9<<4)+14+1}function i(e,t){e[t>>5]|=128<<t%32,e[r(t)-1]=t;let n=1732584193,i=-271733879,a=-1732584194,s=271733878;for(let t=0;t<e.length;t+=16){let r=n,c=i,p=a,m=s;n=l(n,i,a,s,e[t],7,-680876936),s=l(s,n,i,a,e[t+1],12,-389564586),a=l(a,s,n,i,e[t+2],17,606105819),i=l(i,a,s,n,e[t+3],22,-1044525330),n=l(n,i,a,s,e[t+4],7,-176418897),s=l(s,n,i,a,e[t+5],12,1200080426),a=l(a,s,n,i,e[t+6],17,-1473231341),i=l(i,a,s,n,e[t+7],22,-45705983),n=l(n,i,a,s,e[t+8],7,1770035416),s=l(s,n,i,a,e[t+9],12,-1958414417),a=l(a,s,n,i,e[t+10],17,-42063),i=l(i,a,s,n,e[t+11],22,-1990404162),n=l(n,i,a,s,e[t+12],7,1804603682),s=l(s,n,i,a,e[t+13],12,-40341101),a=l(a,s,n,i,e[t+14],17,-1502002290),i=l(i,a,s,n,e[t+15],22,1236535329),n=u(n,i,a,s,e[t+1],5,-165796510),s=u(s,n,i,a,e[t+6],9,-1069501632),a=u(a,s,n,i,e[t+11],14,643717713),i=u(i,a,s,n,e[t],20,-373897302),n=u(n,i,a,s,e[t+5],5,-701558691),s=u(s,n,i,a,e[t+10],9,38016083),a=u(a,s,n,i,e[t+15],14,-660478335),i=u(i,a,s,n,e[t+4],20,-405537848),n=u(n,i,a,s,e[t+9],5,568446438),s=u(s,n,i,a,e[t+14],9,-1019803690),a=u(a,s,n,i,e[t+3],14,-187363961),i=u(i,a,s,n,e[t+8],20,1163531501),n=u(n,i,a,s,e[t+13],5,-1444681467),s=u(s,n,i,a,e[t+2],9,-51403784),a=u(a,s,n,i,e[t+7],14,1735328473),i=u(i,a,s,n,e[t+12],20,-1926607734),n=d(n,i,a,s,e[t+5],4,-378558),s=d(s,n,i,a,e[t+8],11,-2022574463),a=d(a,s,n,i,e[t+11],16,1839030562),i=d(i,a,s,n,e[t+14],23,-35309556),n=d(n,i,a,s,e[t+1],4,-1530992060),s=d(s,n,i,a,e[t+4],11,1272893353),a=d(a,s,n,i,e[t+7],16,-155497632),i=d(i,a,s,n,e[t+10],23,-1094730640),n=d(n,i,a,s,e[t+13],4,681279174),s=d(s,n,i,a,e[t],11,-358537222),a=d(a,s,n,i,e[t+3],16,-722521979),i=d(i,a,s,n,e[t+6],23,76029189),n=d(n,i,a,s,e[t+9],4,-640364487),s=d(s,n,i,a,e[t+12],11,-421815835),a=d(a,s,n,i,e[t+15],16,530742520),i=d(i,a,s,n,e[t+2],23,-995338651),n=f(n,i,a,s,e[t],6,-198630844),s=f(s,n,i,a,e[t+7],10,1126891415),a=f(a,s,n,i,e[t+14],15,-1416354905),i=f(i,a,s,n,e[t+5],21,-57434055),n=f(n,i,a,s,e[t+12],6,1700485571),s=f(s,n,i,a,e[t+3],10,-1894986606),a=f(a,s,n,i,e[t+10],15,-1051523),i=f(i,a,s,n,e[t+1],21,-2054922799),n=f(n,i,a,s,e[t+8],6,1873313359),s=f(s,n,i,a,e[t+15],10,-30611744),a=f(a,s,n,i,e[t+6],15,-1560198380),i=f(i,a,s,n,e[t+13],21,1309151649),n=f(n,i,a,s,e[t+4],6,-145523070),s=f(s,n,i,a,e[t+11],10,-1120210379),a=f(a,s,n,i,e[t+2],15,718787259),i=f(i,a,s,n,e[t+9],21,-343485551),n=o(n,r),i=o(i,c),a=o(a,p),s=o(s,m)}return[n,i,a,s]}function a(e){if(e.length===0)return[];let t=e.length*8,n=new Uint32Array(r(t));for(let r=0;r<t;r+=8)n[r>>5]|=(e[r/8]&255)<<r%32;return n}function o(e,t){let n=(e&65535)+(t&65535);return(e>>16)+(t>>16)+(n>>16)<<16|n&65535}function s(e,t){return e<<t|e>>>32-t}function c(e,t,n,r,i,a){return o(s(o(o(t,e),o(r,a)),i),n)}function l(e,t,n,r,i,a,o){return c(t&n|~t&r,e,t,i,a,o)}function u(e,t,n,r,i,a,o){return c(t&r|n&~r,e,t,i,a,o)}function d(e,t,n,r,i,a,o){return c(t^n^r,e,t,i,a,o)}function f(e,t,n,r,i,a,o){return c(n^(t|~r),e,t,i,a,o)}e.default=t})),ee=e((e=>{Object.defineProperty(e,`__esModule`,{value:!0}),e.default=void 0;var t=r(b()),n=r(x());function r(e){return e&&e.__esModule?e:{default:e}}e.default=(0,t.default)(`v3`,48,n.default)})),te=e((e=>{Object.defineProperty(e,`__esModule`,{value:!0}),e.default=void 0,e.default={randomUUID:typeof crypto<`u`&&crypto.randomUUID&&crypto.randomUUID.bind(crypto)}})),ne=e((e=>{Object.defineProperty(e,`__esModule`,{value:!0}),e.default=void 0;var t=i(te()),n=i(m()),r=_();function i(e){return e&&e.__esModule?e:{default:e}}function a(e,i,a){if(t.default.randomUUID&&!i&&!e)return t.default.randomUUID();e||={};let o=e.random||(e.rng||n.default)();if(o[6]=o[6]&15|64,o[8]=o[8]&63|128,i){a||=0;for(let e=0;e<16;++e)i[a+e]=o[e];return i}return(0,r.unsafeStringify)(o)}e.default=a})),re=e((e=>{Object.defineProperty(e,`__esModule`,{value:!0}),e.default=void 0;function t(e,t,n,r){switch(e){case 0:return t&n^~t&r;case 1:return t^n^r;case 2:return t&n^t&r^n&r;case 3:return t^n^r}}function n(e,t){return e<<t|e>>>32-t}function r(e){let r=[1518500249,1859775393,2400959708,3395469782],i=[1732584193,4023233417,2562383102,271733878,3285377520];if(typeof e==`string`){let t=unescape(encodeURIComponent(e));e=[];for(let n=0;n<t.length;++n)e.push(t.charCodeAt(n))}else Array.isArray(e)||(e=Array.prototype.slice.call(e));e.push(128);let a=e.length/4+2,o=Math.ceil(a/16),s=Array(o);for(let t=0;t<o;++t){let n=new Uint32Array(16);for(let r=0;r<16;++r)n[r]=e[t*64+r*4]<<24|e[t*64+r*4+1]<<16|e[t*64+r*4+2]<<8|e[t*64+r*4+3];s[t]=n}s[o-1][14]=(e.length-1)*8/2**32,s[o-1][14]=Math.floor(s[o-1][14]),s[o-1][15]=(e.length-1)*8&4294967295;for(let e=0;e<o;++e){let a=new Uint32Array(80);for(let t=0;t<16;++t)a[t]=s[e][t];for(let e=16;e<80;++e)a[e]=n(a[e-3]^a[e-8]^a[e-14]^a[e-16],1);let o=i[0],c=i[1],l=i[2],u=i[3],d=i[4];for(let e=0;e<80;++e){let i=Math.floor(e/20),s=n(o,5)+t(i,c,l,u)+d+r[i]+a[e]>>>0;d=u,u=l,l=n(c,30)>>>0,c=o,o=s}i[0]=i[0]+o>>>0,i[1]=i[1]+c>>>0,i[2]=i[2]+l>>>0,i[3]=i[3]+u>>>0,i[4]=i[4]+d>>>0}return[i[0]>>24&255,i[0]>>16&255,i[0]>>8&255,i[0]&255,i[1]>>24&255,i[1]>>16&255,i[1]>>8&255,i[1]&255,i[2]>>24&255,i[2]>>16&255,i[2]>>8&255,i[2]&255,i[3]>>24&255,i[3]>>16&255,i[3]>>8&255,i[3]&255,i[4]>>24&255,i[4]>>16&255,i[4]>>8&255,i[4]&255]}e.default=r})),ie=e((e=>{Object.defineProperty(e,`__esModule`,{value:!0}),e.default=void 0;var t=r(b()),n=r(re());function r(e){return e&&e.__esModule?e:{default:e}}e.default=(0,t.default)(`v5`,80,n.default)})),ae=e((e=>{Object.defineProperty(e,`__esModule`,{value:!0}),e.default=void 0,e.default=`00000000-0000-0000-0000-000000000000`})),oe=e((e=>{Object.defineProperty(e,`__esModule`,{value:!0}),e.default=void 0;var t=n(g());function n(e){return e&&e.__esModule?e:{default:e}}function r(e){if(!(0,t.default)(e))throw TypeError(`Invalid UUID`);return parseInt(e.slice(14,15),16)}e.default=r})),se=e((e=>{Object.defineProperty(e,`__esModule`,{value:!0}),Object.defineProperty(e,`NIL`,{enumerable:!0,get:function(){return a.default}}),Object.defineProperty(e,`parse`,{enumerable:!0,get:function(){return l.default}}),Object.defineProperty(e,`stringify`,{enumerable:!0,get:function(){return c.default}}),Object.defineProperty(e,`v1`,{enumerable:!0,get:function(){return t.default}}),Object.defineProperty(e,`v3`,{enumerable:!0,get:function(){return n.default}}),Object.defineProperty(e,`v4`,{enumerable:!0,get:function(){return r.default}}),Object.defineProperty(e,`v5`,{enumerable:!0,get:function(){return i.default}}),Object.defineProperty(e,`validate`,{enumerable:!0,get:function(){return s.default}}),Object.defineProperty(e,`version`,{enumerable:!0,get:function(){return o.default}});var t=u(v()),n=u(ee()),r=u(ne()),i=u(ie()),a=u(ae()),o=u(oe()),s=u(g()),c=u(_()),l=u(y());function u(e){return e&&e.__esModule?e:{default:e}}})),S=e((e=>{Object.defineProperty(e,`__esModule`,{value:!0}),e.createNoDashGuid=e.createGuid=void 0;var t=se(),n=()=>(0,t.v4)();e.createGuid=n,e.createNoDashGuid=()=>n().replace(RegExp(`-`,`g`),``).toUpperCase()})),C=e((e=>{Object.defineProperty(e,`__esModule`,{value:!0}),e.PlatformEvent=e.EventType=void 0;var t=S();(function(e){e[e.Debug=0]=`Debug`,e[e.Info=1]=`Info`,e[e.Warning=2]=`Warning`,e[e.Error=3]=`Error`,e[e.None=4]=`None`})(e.EventType||={}),e.PlatformEvent=class{constructor(e,n){this.privName=e,this.privEventId=(0,t.createNoDashGuid)(),this.privEventTime=new Date().toISOString(),this.privEventType=n,this.privMetadata={}}get name(){return this.privName}get eventId(){return this.privEventId}get eventTime(){return this.privEventTime}get eventType(){return this.privEventType}get metadata(){return this.privMetadata}}})),ce=e((e=>{Object.defineProperty(e,`__esModule`,{value:!0}),e.AudioStreamNodeErrorEvent=e.AudioStreamNodeDetachedEvent=e.AudioStreamNodeAttachedEvent=e.AudioStreamNodeAttachingEvent=e.AudioStreamNodeEvent=e.AudioSourceErrorEvent=e.AudioSourceOffEvent=e.AudioSourceReadyEvent=e.AudioSourceInitializingEvent=e.AudioSourceEvent=void 0;var t=C(),n=class extends t.PlatformEvent{constructor(e,n,r=t.EventType.Info){super(e,r),this.privAudioSourceId=n}get audioSourceId(){return this.privAudioSourceId}};e.AudioSourceEvent=n,e.AudioSourceInitializingEvent=class extends n{constructor(e){super(`AudioSourceInitializingEvent`,e)}},e.AudioSourceReadyEvent=class extends n{constructor(e){super(`AudioSourceReadyEvent`,e)}},e.AudioSourceOffEvent=class extends n{constructor(e){super(`AudioSourceOffEvent`,e)}},e.AudioSourceErrorEvent=class extends n{constructor(e,n){super(`AudioSourceErrorEvent`,e,t.EventType.Error),this.privError=n}get error(){return this.privError}};var r=class extends n{constructor(e,t,n){super(e,t),this.privAudioNodeId=n}get audioNodeId(){return this.privAudioNodeId}};e.AudioStreamNodeEvent=r,e.AudioStreamNodeAttachingEvent=class extends r{constructor(e,t){super(`AudioStreamNodeAttachingEvent`,e,t)}},e.AudioStreamNodeAttachedEvent=class extends r{constructor(e,t){super(`AudioStreamNodeAttachedEvent`,e,t)}},e.AudioStreamNodeDetachedEvent=class extends r{constructor(e,t){super(`AudioStreamNodeDetachedEvent`,e,t)}},e.AudioStreamNodeErrorEvent=class extends r{constructor(e,t,n){super(`AudioStreamNodeErrorEvent`,e,t),this.privError=n}get error(){return this.privError}}})),le=e((e=>{Object.defineProperty(e,`__esModule`,{value:!0}),e.ConnectionRedirectEvent=e.ConnectionMessageSentEvent=e.ConnectionMessageReceivedEvent=e.ConnectionEstablishErrorEvent=e.ConnectionErrorEvent=e.ConnectionClosedEvent=e.ConnectionEstablishedEvent=e.ConnectionStartEvent=e.ConnectionEvent=e.ServiceEvent=void 0;var t=C();e.ServiceEvent=class extends t.PlatformEvent{constructor(e,n,r=t.EventType.Info){super(e,r),this.privJsonResult=n}get jsonString(){return this.privJsonResult}};var n=class extends t.PlatformEvent{constructor(e,n,r=t.EventType.Info){super(e,r),this.privConnectionId=n}get connectionId(){return this.privConnectionId}};e.ConnectionEvent=n,e.ConnectionStartEvent=class extends n{constructor(e,t,n){super(`ConnectionStartEvent`,e),this.privUri=t,this.privHeaders=n}get uri(){return this.privUri}get headers(){return this.privHeaders}},e.ConnectionEstablishedEvent=class extends n{constructor(e){super(`ConnectionEstablishedEvent`,e)}},e.ConnectionClosedEvent=class extends n{constructor(e,n,r){super(`ConnectionClosedEvent`,e,t.EventType.Debug),this.privReason=r,this.privStatusCode=n}get reason(){return this.privReason}get statusCode(){return this.privStatusCode}},e.ConnectionErrorEvent=class extends n{constructor(e,n,r){super(`ConnectionErrorEvent`,e,t.EventType.Debug),this.privMessage=n,this.privType=r}get message(){return this.privMessage}get type(){return this.privType}},e.ConnectionEstablishErrorEvent=class extends n{constructor(e,n,r){super(`ConnectionEstablishErrorEvent`,e,t.EventType.Error),this.privStatusCode=n,this.privReason=r}get reason(){return this.privReason}get statusCode(){return this.privStatusCode}},e.ConnectionMessageReceivedEvent=class extends n{constructor(e,t,n){super(`ConnectionMessageReceivedEvent`,e),this.privNetworkReceivedTime=t,this.privMessage=n}get networkReceivedTime(){return this.privNetworkReceivedTime}get message(){return this.privMessage}},e.ConnectionMessageSentEvent=class extends n{constructor(e,t,n){super(`ConnectionMessageSentEvent`,e),this.privNetworkSentTime=t,this.privMessage=n}get networkSentTime(){return this.privNetworkSentTime}get message(){return this.privMessage}},e.ConnectionRedirectEvent=class extends n{constructor(e,n,r,i){super(`ConnectionRedirectEvent`,e,t.EventType.Info),this.privRedirectUrl=n,this.privOriginalUrl=r,this.privContext=i}get redirectUrl(){return this.privRedirectUrl}get originalUrl(){return this.privOriginalUrl}get context(){return this.privContext}}})),w=e((e=>{Object.defineProperty(e,`__esModule`,{value:!0}),e.ObjectDisposedError=e.InvalidOperationError=e.ArgumentNullError=void 0,e.ArgumentNullError=class extends Error{constructor(e){super(e),this.name=`ArgumentNull`,this.message=e}},e.InvalidOperationError=class extends Error{constructor(e){super(e),this.name=`InvalidOperation`,this.message=e}},e.ObjectDisposedError=class extends Error{constructor(e,t){super(t),this.name=e+`ObjectDisposed`,this.message=t}}})),T=e((e=>{Object.defineProperty(e,`__esModule`,{value:!0}),e.ConnectionMessage=e.MessageType=void 0;var t=w(),n=S(),r;(function(e){e[e.Text=0]=`Text`,e[e.Binary=1]=`Binary`})(r=e.MessageType||={}),e.ConnectionMessage=class{constructor(e,i,a,o){if(this.privBody=null,e===r.Text&&i&&typeof i!=`string`)throw new t.InvalidOperationError(`Payload must be a string`);if(e===r.Binary&&i&&!(i instanceof ArrayBuffer))throw new t.InvalidOperationError(`Payload must be ArrayBuffer`);switch(this.privMessageType=e,this.privBody=i,this.privHeaders=a||{},this.privId=o||(0,n.createNoDashGuid)(),this.messageType){case r.Binary:this.privSize=this.binaryBody===null?0:this.binaryBody.byteLength;break;case r.Text:this.privSize=this.textBody.length}}get messageType(){return this.privMessageType}get headers(){return this.privHeaders}get body(){return this.privBody}get textBody(){if(this.privMessageType===r.Binary)throw new t.InvalidOperationError(`Not supported for binary message`);return this.privBody}get binaryBody(){if(this.privMessageType===r.Text)throw new t.InvalidOperationError(`Not supported for text message`);return this.privBody}get id(){return this.privId}}})),ue=e((e=>{Object.defineProperty(e,`__esModule`,{value:!0}),e.ConnectionOpenResponse=void 0,e.ConnectionOpenResponse=class{constructor(e,t){this.privStatusCode=e,this.privReason=t}get statusCode(){return this.privStatusCode}get reason(){return this.privReason}}})),de=e((e=>{Object.defineProperty(e,`__esModule`,{value:!0}),e.DeferralMap=void 0,e.DeferralMap=class{constructor(){this.privMap={}}add(e,t){this.privMap[e]=t}getId(e){return this.privMap[e]}complete(e,t){try{this.privMap[e].resolve(t)}catch(t){this.privMap[e].reject(t)}finally{this.privMap[e]=void 0}}}})),E=e((e=>{Object.defineProperty(e,`__esModule`,{value:!0}),e.SendingAgentContextMessageEvent=e.DialogEvent=void 0;var t=C(),n=class extends t.PlatformEvent{constructor(e,n=t.EventType.Info){super(e,n)}};e.DialogEvent=n,e.SendingAgentContextMessageEvent=class extends n{constructor(e){super(`SendingAgentContextMessageEvent`),this.privAgentConfig=e}get agentConfig(){return this.privAgentConfig}}})),D=e((e=>{Object.defineProperty(e,`__esModule`,{value:!0}),e.EventSource=void 0;var t=w(),n=S();e.EventSource=class{constructor(e){this.privEventListeners={},this.privIsDisposed=!1,this.privConsoleListener=void 0,this.privMetadata=e}onEvent(e){if(this.isDisposed())throw new t.ObjectDisposedError(`EventSource`);if(this.metadata)for(let t in this.metadata)t&&e.metadata&&(e.metadata[t]||(e.metadata[t]=this.metadata[t]));for(let t in this.privEventListeners)t&&this.privEventListeners[t]&&this.privEventListeners[t](e)}attach(e){let t=(0,n.createNoDashGuid)();return this.privEventListeners[t]=e,{detach:()=>(delete this.privEventListeners[t],Promise.resolve())}}attachListener(e){return this.attach(t=>e.onEvent(t))}attachConsoleListener(e){return this.privConsoleListener&&this.privConsoleListener.detach(),this.privConsoleListener=this.attach(t=>e.onEvent(t)),this.privConsoleListener}isDisposed(){return this.privIsDisposed}dispose(){this.privEventListeners=null,this.privIsDisposed=!0}get metadata(){return this.privMetadata}}})),fe=e((e=>{Object.defineProperty(e,`__esModule`,{value:!0}),e.Events=void 0;var t=w(),n=D(),r=class e{static setEventSource(n){if(!n)throw new t.ArgumentNullError(`eventSource`);e.privInstance=n}static get instance(){return e.privInstance}};e.Events=r,r.privInstance=new n.EventSource})),pe=e((e=>{Object.defineProperty(e,`__esModule`,{value:!0})})),me=e((e=>{Object.defineProperty(e,`__esModule`,{value:!0}),e.ConnectionState=void 0,(function(e){e[e.None=0]=`None`,e[e.Connected=1]=`Connected`,e[e.Connecting=2]=`Connecting`,e[e.Disconnected=3]=`Disconnected`})(e.ConnectionState||={})})),he=e((e=>{Object.defineProperty(e,`__esModule`,{value:!0})})),ge=e((e=>{Object.defineProperty(e,`__esModule`,{value:!0})})),_e=e((e=>{Object.defineProperty(e,`__esModule`,{value:!0})})),ve=e((e=>{Object.defineProperty(e,`__esModule`,{value:!0})})),ye=e((e=>{Object.defineProperty(e,`__esModule`,{value:!0})})),be=e((e=>{Object.defineProperty(e,`__esModule`,{value:!0})})),xe=e((e=>{Object.defineProperty(e,`__esModule`,{value:!0})})),Se=e((e=>{Object.defineProperty(e,`__esModule`,{value:!0})})),O=e((e=>{Object.defineProperty(e,`__esModule`,{value:!0}),e.List=void 0;var t=w();e.List=class e{constructor(e){if(this.privSubscriptionIdCounter=0,this.privAddSubscriptions={},this.privRemoveSubscriptions={},this.privDisposedSubscriptions={},this.privDisposeReason=null,this.privList=[],e)for(let t of e)this.privList.push(t)}get(e){return this.throwIfDisposed(),this.privList[e]}first(){return this.get(0)}last(){return this.get(this.length()-1)}add(e){this.throwIfDisposed(),this.insertAt(this.privList.length,e)}insertAt(e,t){this.throwIfDisposed(),e===0?this.privList.unshift(t):e===this.privList.length?this.privList.push(t):this.privList.splice(e,0,t),this.triggerSubscriptions(this.privAddSubscriptions)}removeFirst(){return this.throwIfDisposed(),this.removeAt(0)}removeLast(){return this.throwIfDisposed(),this.removeAt(this.length()-1)}removeAt(e){return this.throwIfDisposed(),this.remove(e,1)[0]}remove(e,t){this.throwIfDisposed();let n=this.privList.splice(e,t);return this.triggerSubscriptions(this.privRemoveSubscriptions),n}clear(){this.throwIfDisposed(),this.remove(0,this.length())}length(){return this.throwIfDisposed(),this.privList.length}onAdded(e){this.throwIfDisposed();let t=this.privSubscriptionIdCounter++;return this.privAddSubscriptions[t]=e,{detach:()=>(delete this.privAddSubscriptions[t],Promise.resolve())}}onRemoved(e){this.throwIfDisposed();let t=this.privSubscriptionIdCounter++;return this.privRemoveSubscriptions[t]=e,{detach:()=>(delete this.privRemoveSubscriptions[t],Promise.resolve())}}onDisposed(e){this.throwIfDisposed();let t=this.privSubscriptionIdCounter++;return this.privDisposedSubscriptions[t]=e,{detach:()=>(delete this.privDisposedSubscriptions[t],Promise.resolve())}}join(e){return this.throwIfDisposed(),this.privList.join(e)}toArray(){let e=[];return this.privList.forEach(t=>{e.push(t)}),e}any(e){return this.throwIfDisposed(),e?this.where(e).length()>0:this.length()>0}all(e){return this.throwIfDisposed(),this.where(e).length()===this.length()}forEach(e){this.throwIfDisposed();for(let t=0;t<this.length();t++)e(this.privList[t],t)}select(t){this.throwIfDisposed();let n=[];for(let e=0;e<this.privList.length;e++)n.push(t(this.privList[e],e));return new e(n)}where(t){this.throwIfDisposed();let n=new e;for(let e=0;e<this.privList.length;e++)t(this.privList[e],e)&&n.add(this.privList[e]);return n}orderBy(t){return this.throwIfDisposed(),new e(this.toArray().sort(t))}orderByDesc(e){return this.throwIfDisposed(),this.orderBy((t,n)=>e(n,t))}clone(){return this.throwIfDisposed(),new e(this.toArray())}concat(t){return this.throwIfDisposed(),new e(this.privList.concat(t.toArray()))}concatArray(t){return this.throwIfDisposed(),new e(this.privList.concat(t))}isDisposed(){return this.privList==null}dispose(e){this.isDisposed()||(this.privDisposeReason=e,this.privList=null,this.privAddSubscriptions=null,this.privRemoveSubscriptions=null,this.triggerSubscriptions(this.privDisposedSubscriptions))}throwIfDisposed(){if(this.isDisposed())throw new t.ObjectDisposedError(`List`,this.privDisposeReason)}triggerSubscriptions(e){if(e)for(let t in e)t&&e[t]()}}})),Ce=e((e=>{Object.defineProperty(e,`__esModule`,{value:!0}),e.marshalPromiseToCallbacks=e.Sink=e.Deferred=e.PromiseResultEventSource=e.PromiseResult=e.PromiseState=void 0;var t;(function(e){e[e.None=0]=`None`,e[e.Resolved=1]=`Resolved`,e[e.Rejected=2]=`Rejected`})(t=e.PromiseState||={});var n=class{constructor(e){this.throwIfError=()=>{if(this.isError)throw this.error},e.on(e=>{this.privIsCompleted||(this.privIsCompleted=!0,this.privIsError=!1,this.privResult=e)},e=>{this.privIsCompleted||(this.privIsCompleted=!0,this.privIsError=!0,this.privError=e)})}get isCompleted(){return this.privIsCompleted}get isError(){return this.privIsError}get error(){return this.privError}get result(){return this.privResult}};e.PromiseResult=n;var r=class{constructor(){this.setResult=e=>{this.privOnSetResult(e)},this.setError=e=>{this.privOnSetError(e)},this.on=(e,t)=>{this.privOnSetResult=e,this.privOnSetError=t}}};e.PromiseResultEventSource=r,e.Deferred=class{constructor(){this.resolve=e=>(this.privResolve(e),this),this.reject=e=>(this.privReject(e),this),this.privPromise=new Promise((e,t)=>{this.privResolve=e,this.privReject=t})}get promise(){return this.privPromise}},e.Sink=class{constructor(){this.privState=t.None,this.privPromiseResult=null,this.privPromiseResultEvents=null,this.privSuccessHandlers=[],this.privErrorHandlers=[],this.privPromiseResultEvents=new r,this.privPromiseResult=new n(this.privPromiseResultEvents)}get state(){return this.privState}get result(){return this.privPromiseResult}resolve(e){if(this.privState!==t.None)throw Error(`'Cannot resolve a completed promise'`);this.privState=t.Resolved,this.privPromiseResultEvents.setResult(e);for(let t=0;t<this.privSuccessHandlers.length;t++)this.executeSuccessCallback(e,this.privSuccessHandlers[t],this.privErrorHandlers[t]);this.detachHandlers()}reject(e){if(this.privState!==t.None)throw Error(`'Cannot reject a completed promise'`);this.privState=t.Rejected,this.privPromiseResultEvents.setError(e);for(let t of this.privErrorHandlers)this.executeErrorCallback(e,t);this.detachHandlers()}on(e,n){e??=()=>{},this.privState===t.None?(this.privSuccessHandlers.push(e),this.privErrorHandlers.push(n)):(this.privState===t.Resolved?this.executeSuccessCallback(this.privPromiseResult.result,e,n):this.privState===t.Rejected&&this.executeErrorCallback(this.privPromiseResult.error,n),this.detachHandlers())}executeSuccessCallback(e,t,n){try{t(e)}catch(e){this.executeErrorCallback(`'Unhandled callback error: ${e}'`,n)}}executeErrorCallback(e,t){if(t)try{t(e)}catch(t){throw Error(`'Unhandled callback error: ${t}. InnerError: ${e}'`)}else throw Error(`'Unhandled error: ${e}'`)}detachHandlers(){this.privErrorHandlers=[],this.privSuccessHandlers=[]}};function i(e,t,n){e.then(e=>{try{t&&t(e)}catch(e){if(n)try{if(e instanceof Error){let t=e;n(t.name+`: `+t.message)}else n(e)}catch{}}},e=>{if(n)try{if(e instanceof Error){let t=e;n(t.name+`: `+t.message)}else n(e)}catch{}})}e.marshalPromiseToCallbacks=i})),k=e((e=>{Object.defineProperty(e,`__esModule`,{value:!0}),e.Queue=void 0;var t=w(),n=O(),r=Ce(),i;(function(e){e[e.Dequeue=0]=`Dequeue`,e[e.Peek=1]=`Peek`})(i||={}),e.Queue=class{constructor(e){this.privPromiseStore=new n.List,this.privIsDrainInProgress=!1,this.privIsDisposing=!1,this.privDisposeReason=null,this.privList=e||new n.List,this.privDetachables=[],this.privSubscribers=new n.List,this.privDetachables.push(this.privList.onAdded(()=>this.drain()))}enqueue(e){this.throwIfDispose(),this.enqueueFromPromise(new Promise(t=>t(e)))}enqueueFromPromise(e){this.throwIfDispose(),e.then(e=>{this.privList.add(e)},()=>{})}dequeue(){this.throwIfDispose();let e=new r.Deferred;return this.privSubscribers&&(this.privSubscribers.add({deferral:e,type:i.Dequeue}),this.drain()),e.promise}peek(){this.throwIfDispose();let e=new r.Deferred;return this.privSubscribers&&(this.privSubscribers.add({deferral:e,type:i.Peek}),this.drain()),e.promise}length(){return this.throwIfDispose(),this.privList.length()}isDisposed(){return this.privSubscribers==null}async drainAndDispose(e,t){if(!this.isDisposed()&&!this.privIsDisposing){this.privDisposeReason=t,this.privIsDisposing=!0;let n=this.privSubscribers;if(n){for(;n.length()>0;)n.removeFirst().deferral.resolve(void 0);this.privSubscribers===n&&(this.privSubscribers=n)}for(let e of this.privDetachables)await e.detach();if(this.privPromiseStore.length()>0&&e){let t=[];return this.privPromiseStore.toArray().forEach(e=>{t.push(e)}),Promise.all(t).finally(()=>{this.privSubscribers=null,this.privList.forEach(t=>{e(t)}),this.privList=null}).then()}else this.privSubscribers=null,this.privList=null}}async dispose(e){await this.drainAndDispose(null,e)}drain(){if(!this.privIsDrainInProgress&&!this.privIsDisposing){this.privIsDrainInProgress=!0;let e=this.privSubscribers,t=this.privList;if(e&&t){for(;t.length()>0&&e.length()>0&&!this.privIsDisposing;){let n=e.removeFirst();if(n.type===i.Peek)n.deferral.resolve(t.first());else{let e=t.removeFirst();n.deferral.resolve(e)}}this.privSubscribers===e&&(this.privSubscribers=e),this.privList===t&&(this.privList=t)}this.privIsDrainInProgress=!1}}throwIfDispose(){if(this.isDisposed())throw this.privDisposeReason?new t.InvalidOperationError(this.privDisposeReason):new t.ObjectDisposedError(`Queue`);if(this.privIsDisposing)throw new t.InvalidOperationError(`Queue disposing`)}}})),we=e((e=>{Object.defineProperty(e,`__esModule`,{value:!0}),e.RawWebsocketMessage=void 0;var t=T(),n=w(),r=S();e.RawWebsocketMessage=class{constructor(e,i,a){if(this.privPayload=null,!i)throw new n.ArgumentNullError(`payload`);if(e===t.MessageType.Binary&&Object.getPrototypeOf(i).constructor.name!==`ArrayBuffer`)throw new n.InvalidOperationError(`Payload must be ArrayBuffer`);if(e===t.MessageType.Text&&typeof i!=`string`)throw new n.InvalidOperationError(`Payload must be a string`);this.privMessageType=e,this.privPayload=i,this.privId=a||(0,r.createNoDashGuid)()}get messageType(){return this.privMessageType}get payload(){return this.privPayload}get textContent(){if(this.privMessageType===t.MessageType.Binary)throw new n.InvalidOperationError(`Not supported for binary message`);return this.privPayload}get binaryContent(){if(this.privMessageType===t.MessageType.Text)throw new n.InvalidOperationError(`Not supported for text message`);return this.privPayload}get id(){return this.privId}}})),Te=e((e=>{Object.defineProperty(e,`__esModule`,{value:!0}),e.RiffPcmEncoder=void 0,e.RiffPcmEncoder=class{constructor(e,t){this.privActualSampleRate=e,this.privDesiredSampleRate=t}encode(e){let t=this.downSampleAudioFrame(e,this.privActualSampleRate,this.privDesiredSampleRate);if(!t)return null;let n=t.length*2,r=new ArrayBuffer(n),i=new DataView(r);return this.floatTo16BitPCM(i,0,t),r}setString(e,t,n){for(let r=0;r<n.length;r++)e.setUint8(t+r,n.charCodeAt(r))}floatTo16BitPCM(e,t,n){for(let r=0;r<n.length;r++,t+=2){let i=Math.max(-1,Math.min(1,n[r]));e.setInt16(t,i<0?i*32768:i*32767,!0)}}downSampleAudioFrame(e,t,n){if(!e)return null;if(n===t||n>t)return e;let r=t/n,i=Math.round(e.length/r),a=new Float32Array(i),o=0,s=0;for(;s<i;){let t=Math.round((s+1)*r),n=0,i=0;for(;o<t&&o<e.length;)n+=e[o++],i++;a[s++]=n/i}return a}}})),Ee=e((e=>{Object.defineProperty(e,`__esModule`,{value:!0}),e.Stream=void 0;var t=w(),n=S(),r=k();e.Stream=class{constructor(e){this.privIsWriteEnded=!1,this.privIsReadEnded=!1,this.privId=e||(0,n.createNoDashGuid)(),this.privReaderQueue=new r.Queue}get isClosed(){return this.privIsWriteEnded}get isReadEnded(){return this.privIsReadEnded}get id(){return this.privId}close(){this.privIsWriteEnded||=(this.writeStreamChunk({buffer:null,isEnd:!0,timeReceived:Date.now()}),!0)}writeStreamChunk(e){if(this.throwIfClosed(),!this.privReaderQueue.isDisposed())try{this.privReaderQueue.enqueue(e)}catch{}}read(){if(this.privIsReadEnded)throw new t.InvalidOperationError(`Stream read has already finished`);return this.privReaderQueue.dequeue().then(async e=>((e===void 0||e.isEnd)&&await this.privReaderQueue.dispose(`End of stream reached`),e))}readEnded(){this.privIsReadEnded||(this.privIsReadEnded=!0,this.privReaderQueue=new r.Queue)}throwIfClosed(){if(this.privIsWriteEnded)throw new t.InvalidOperationError(`Stream closed`)}}})),A=e((e=>{Object.defineProperty(e,`__esModule`,{value:!0}),e.TranslationStatus=void 0,(function(e){e[e.Success=0]=`Success`,e[e.Error=1]=`Error`})(e.TranslationStatus||={})})),De=e((e=>{Object.defineProperty(e,`__esModule`,{value:!0}),e.ChunkedArrayBufferStream=void 0;var t=j();e.ChunkedArrayBufferStream=class extends t.Stream{constructor(e,t){super(t),this.privTargetChunkSize=Math.round(e),this.privNextBufferReadyBytes=0}writeStreamChunk(e){if(e.isEnd||this.privNextBufferReadyBytes===0&&e.buffer.byteLength===this.privTargetChunkSize){super.writeStreamChunk(e);return}let t=0;for(;t<e.buffer.byteLength;){this.privNextBufferToWrite===void 0&&(this.privNextBufferToWrite=new ArrayBuffer(this.privTargetChunkSize),this.privNextBufferStartTime=e.timeReceived);let n=Math.min(e.buffer.byteLength-t,this.privTargetChunkSize-this.privNextBufferReadyBytes),r=new Uint8Array(this.privNextBufferToWrite),i=new Uint8Array(e.buffer.slice(t,n+t));r.set(i,this.privNextBufferReadyBytes),this.privNextBufferReadyBytes+=n,t+=n,this.privNextBufferReadyBytes===this.privTargetChunkSize&&(super.writeStreamChunk({buffer:this.privNextBufferToWrite,isEnd:!1,timeReceived:this.privNextBufferStartTime}),this.privNextBufferReadyBytes=0,this.privNextBufferToWrite=void 0)}}close(){this.privNextBufferReadyBytes!==0&&!this.isClosed&&super.writeStreamChunk({buffer:this.privNextBufferToWrite.slice(0,this.privNextBufferReadyBytes),isEnd:!1,timeReceived:this.privNextBufferStartTime}),super.close()}}})),Oe=e((e=>{Object.defineProperty(e,`__esModule`,{value:!0})})),ke=e((e=>{Object.defineProperty(e,`__esModule`,{value:!0}),e.Timeout=void 0;var t=class e{static load(){let t=new Map([[0,()=>{}]]),n=new Map,r=`data:text/javascript;base64,`+btoa(`!function(e){var t={};function n(r){if(t[r])return t[r].exports;var o=t[r]={i:r,l:!1,exports:{}};return e[r].call(o.exports,o,o.exports,n),o.l=!0,o.exports}n.m=e,n.c=t,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)n.d(r,o,function(t){return e[t]}.bind(null,o));return r},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=14)}([function(e,t,n){"use strict";n.d(t,"a",(function(){return i})),n.d(t,"b",(function(){return u})),n.d(t,"c",(function(){return a})),n.d(t,"d",(function(){return d}));const r=new Map,o=new Map,i=e=>{const t=r.get(e);if(void 0===t)throw new Error('There is no interval scheduled with the given id "'.concat(e,'".'));clearTimeout(t),r.delete(e)},u=e=>{const t=o.get(e);if(void 0===t)throw new Error('There is no timeout scheduled with the given id "'.concat(e,'".'));clearTimeout(t),o.delete(e)},f=(e,t)=>{let n,r;if("performance"in self){const o=performance.now();n=o,r=e-Math.max(0,o-t)}else n=Date.now(),r=e;return{expected:n+r,remainingDelay:r}},c=(e,t,n,r)=>{const o="performance"in self?performance.now():Date.now();o>n?postMessage({id:null,method:"call",params:{timerId:t}}):e.set(t,setTimeout(c,n-o,e,t,n))},a=(e,t,n)=>{const{expected:o,remainingDelay:i}=f(e,n);r.set(t,setTimeout(c,i,r,t,o))},d=(e,t,n)=>{const{expected:r,remainingDelay:i}=f(e,n);o.set(t,setTimeout(c,i,o,t,r))}},function(e,t,n){"use strict";n.r(t);var r=n(2);for(var o in r)"default"!==o&&function(e){n.d(t,e,(function(){return r[e]}))}(o);var i=n(3);for(var o in i)"default"!==o&&function(e){n.d(t,e,(function(){return i[e]}))}(o);var u=n(4);for(var o in u)"default"!==o&&function(e){n.d(t,e,(function(){return u[e]}))}(o);var f=n(5);for(var o in f)"default"!==o&&function(e){n.d(t,e,(function(){return f[e]}))}(o);var c=n(6);for(var o in c)"default"!==o&&function(e){n.d(t,e,(function(){return c[e]}))}(o);var a=n(7);for(var o in a)"default"!==o&&function(e){n.d(t,e,(function(){return a[e]}))}(o);var d=n(8);for(var o in d)"default"!==o&&function(e){n.d(t,e,(function(){return d[e]}))}(o);var s=n(9);for(var o in s)"default"!==o&&function(e){n.d(t,e,(function(){return s[e]}))}(o)},function(e,t){},function(e,t){},function(e,t){},function(e,t){},function(e,t){},function(e,t){},function(e,t){},function(e,t){},function(e,t,n){"use strict";n.r(t);var r=n(11);for(var o in r)"default"!==o&&function(e){n.d(t,e,(function(){return r[e]}))}(o);var i=n(12);for(var o in i)"default"!==o&&function(e){n.d(t,e,(function(){return i[e]}))}(o);var u=n(13);for(var o in u)"default"!==o&&function(e){n.d(t,e,(function(){return u[e]}))}(o)},function(e,t){},function(e,t){},function(e,t){},function(e,t,n){"use strict";n.r(t);var r=n(0),o=n(1);for(var i in o)"default"!==i&&function(e){n.d(t,e,(function(){return o[e]}))}(i);var u=n(10);for(var i in u)"default"!==i&&function(e){n.d(t,e,(function(){return u[e]}))}(i);addEventListener("message",({data:e})=>{try{if("clear"===e.method){const{id:t,params:{timerId:n}}=e;Object(r.b)(n),postMessage({error:null,id:t})}else{if("set"!==e.method)throw new Error('The given method "'.concat(e.method,'" is not supported'));{const{params:{delay:t,now:n,timerId:o}}=e;Object(r.d)(t,o,n)}}}catch(t){postMessage({error:{message:t.message},id:e.id,result:null})}})}]);`),i=new Worker(r);return i.addEventListener(`message`,({data:r})=>{if(e.isCallNotification(r)){let{params:{timerId:e}}=r,i=t.get(e);if(typeof i==`number`){let t=n.get(i);if(t===void 0||t!==e)throw Error(`The timer is in an undefined state.`)}else if(i!==void 0)i(),t.delete(e);else throw Error(`The timer is in an undefined state.`)}else if(e.isClearResponse(r)){let{id:e}=r,i=n.get(e);if(i===void 0)throw Error(`The timer is in an undefined state.`);n.delete(e),t.delete(i)}else{let{error:{message:e}}=r;throw Error(e)}}),{clearTimeout:e=>{let r=Math.random();n.set(r,e),t.set(e,r),i.postMessage({id:r,method:`clear`,params:{timerId:e}})},setTimeout:(e,n)=>{let r=Math.random();return t.set(r,e),i.postMessage({id:null,method:`set`,params:{delay:n,now:performance.now(),timerId:r}}),r}}}static loadWorkerTimers(){return()=>(e.workerTimers===null&&(e.workerTimers=e.load()),e.workerTimers)}static isCallNotification(e){return e.method!==void 0&&e.method===`call`}static isClearResponse(e){return e.error===null&&typeof e.id==`number`}};e.Timeout=t,t.workerTimers=null,t.clearTimeout=e=>t.timers().clearTimeout(e),t.setTimeout=(e,n)=>t.timers().setTimeout(e,n),t.timers=t.loadWorkerTimers()})),Ae=e((e=>{Object.defineProperty(e,`__esModule`,{value:!0}),e.OCSPCacheUpdateErrorEvent=e.OCSPResponseRetrievedEvent=e.OCSPCacheFetchErrorEvent=e.OCSPVerificationFailedEvent=e.OCSPCacheHitEvent=e.OCSPCacheEntryNeedsRefreshEvent=e.OCSPCacheEntryExpiredEvent=e.OCSPWSUpgradeStartedEvent=e.OCSPStapleReceivedEvent=e.OCSPCacheUpdateCompleteEvent=e.OCSPDiskCacheStoreEvent=e.OCSPMemoryCacheStoreEvent=e.OCSPCacheUpdateNeededEvent=e.OCSPDiskCacheHitEvent=e.OCSPCacheMissEvent=e.OCSPMemoryCacheHitEvent=e.OCSPEvent=void 0;var t=C(),n=class extends t.PlatformEvent{constructor(e,t,n){super(e,t),this.privSignature=n}};e.OCSPEvent=n,e.OCSPMemoryCacheHitEvent=class extends n{constructor(e){super(`OCSPMemoryCacheHitEvent`,t.EventType.Debug,e)}},e.OCSPCacheMissEvent=class extends n{constructor(e){super(`OCSPCacheMissEvent`,t.EventType.Debug,e)}},e.OCSPDiskCacheHitEvent=class extends n{constructor(e){super(`OCSPDiskCacheHitEvent`,t.EventType.Debug,e)}},e.OCSPCacheUpdateNeededEvent=class extends n{constructor(e){super(`OCSPCacheUpdateNeededEvent`,t.EventType.Debug,e)}},e.OCSPMemoryCacheStoreEvent=class extends n{constructor(e){super(`OCSPMemoryCacheStoreEvent`,t.EventType.Debug,e)}},e.OCSPDiskCacheStoreEvent=class extends n{constructor(e){super(`OCSPDiskCacheStoreEvent`,t.EventType.Debug,e)}},e.OCSPCacheUpdateCompleteEvent=class extends n{constructor(e){super(`OCSPCacheUpdateCompleteEvent`,t.EventType.Debug,e)}},e.OCSPStapleReceivedEvent=class extends n{constructor(){super(`OCSPStapleReceivedEvent`,t.EventType.Debug,``)}},e.OCSPWSUpgradeStartedEvent=class extends n{constructor(e){super(`OCSPWSUpgradeStartedEvent`,t.EventType.Debug,e)}},e.OCSPCacheEntryExpiredEvent=class extends n{constructor(e,n){super(`OCSPCacheEntryExpiredEvent`,t.EventType.Debug,e),this.privExpireTime=n}},e.OCSPCacheEntryNeedsRefreshEvent=class extends n{constructor(e,n,r){super(`OCSPCacheEntryNeedsRefreshEvent`,t.EventType.Debug,e),this.privExpireTime=r,this.privStartTime=n}},e.OCSPCacheHitEvent=class extends n{constructor(e,n,r){super(`OCSPCacheHitEvent`,t.EventType.Debug,e),this.privExpireTime=r,this.privExpireTimeString=new Date(r).toLocaleDateString(),this.privStartTime=n,this.privStartTimeString=new Date(n).toLocaleTimeString()}},e.OCSPVerificationFailedEvent=class extends n{constructor(e,n){super(`OCSPVerificationFailedEvent`,t.EventType.Debug,e),this.privError=n}},e.OCSPCacheFetchErrorEvent=class extends n{constructor(e,n){super(`OCSPCacheFetchErrorEvent`,t.EventType.Debug,e),this.privError=n}},e.OCSPResponseRetrievedEvent=class extends n{constructor(e){super(`OCSPResponseRetrievedEvent`,t.EventType.Debug,e)}},e.OCSPCacheUpdateErrorEvent=class extends n{constructor(e,n){super(`OCSPCacheUpdateErrorEvent`,t.EventType.Debug,e),this.privError=n}}})),je=e((e=>{Object.defineProperty(e,`__esModule`,{value:!0}),e.BackgroundEvent=void 0;var t=j();e.BackgroundEvent=class extends t.PlatformEvent{constructor(e){super(`BackgroundEvent`,t.EventType.Error),this.privError=e}get error(){return this.privError}}})),j=e((e=>{var t=e&&e.__createBinding||(Object.create?(function(e,t,n,r){r===void 0&&(r=n),Object.defineProperty(e,r,{enumerable:!0,get:function(){return t[n]}})}):(function(e,t,n,r){r===void 0&&(r=n),e[r]=t[n]})),n=e&&e.__exportStar||function(e,n){for(var r in e)r!==`default`&&!Object.prototype.hasOwnProperty.call(n,r)&&t(n,e,r)};Object.defineProperty(e,`__esModule`,{value:!0}),e.TranslationStatus=void 0,n(ce(),e),n(le(),e),n(T(),e),n(ue(),e),n(de(),e),n(E(),e),n(w(),e),n(fe(),e),n(D(),e),n(S(),e),n(pe(),e),n(me(),e),n(he(),e),n(ge(),e),n(_e(),e),n(ve(),e),n(ye(),e),n(be(),e),n(xe(),e),n(Se(),e),n(O(),e),n(C(),e),n(Ce(),e),n(k(),e),n(we(),e),n(Te(),e),n(Ee(),e);var r=A();Object.defineProperty(e,`TranslationStatus`,{enumerable:!0,get:function(){return r.TranslationStatus}}),n(De(),e),n(Oe(),e),n(ke(),e),n(Ae(),e),n(je(),e)})),M=e((e=>{Object.defineProperty(e,`__esModule`,{value:!0}),e.HeaderNames=void 0;var t=class{};e.HeaderNames=t,t.AuthKey=`Ocp-Apim-Subscription-Key`,t.Authorization=`Authorization`,t.SpIDAuthKey=`Apim-Subscription-Id`,t.ConnectionId=`X-ConnectionId`,t.ContentType=`Content-Type`,t.CustomCommandsAppId=`X-CommandsAppId`,t.Path=`Path`,t.RequestId=`X-RequestId`,t.RequestStreamId=`X-StreamId`,t.RequestTimestamp=`X-Timestamp`})),N=e((e=>{Object.defineProperty(e,`__esModule`,{value:!0}),e.AuthInfo=void 0,e.AuthInfo=class{constructor(e,t){this.privHeaderName=e,this.privToken=t}get headerName(){return this.privHeaderName}get token(){return this.privToken}}})),Me=e((e=>{Object.defineProperty(e,`__esModule`,{value:!0}),e.CognitiveSubscriptionKeyAuthentication=void 0;var t=j(),n=M(),r=N();e.CognitiveSubscriptionKeyAuthentication=class{constructor(e){if(!e)throw new t.ArgumentNullError(`subscriptionKey`);this.privAuthInfo=new r.AuthInfo(n.HeaderNames.AuthKey,e)}fetch(e){return Promise.resolve(this.privAuthInfo)}fetchOnExpiry(e){return Promise.resolve(this.privAuthInfo)}}})),Ne=e((e=>{Object.defineProperty(e,`__esModule`,{value:!0}),e.CognitiveTokenAuthentication=void 0;var t=j(),n=N(),r=M(),i=class e{constructor(e,n){if(!e)throw new t.ArgumentNullError(`fetchCallback`);if(!n)throw new t.ArgumentNullError(`fetchOnExpiryCallback`);this.privFetchCallback=e,this.privFetchOnExpiryCallback=n}fetch(t){return this.privFetchCallback(t).then(t=>new n.AuthInfo(r.HeaderNames.Authorization,t===void 0?void 0:e.privTokenPrefix+t))}fetchOnExpiry(t){return this.privFetchOnExpiryCallback(t).then(t=>new n.AuthInfo(r.HeaderNames.Authorization,t===void 0?void 0:e.privTokenPrefix+t))}};e.CognitiveTokenAuthentication=i,i.privTokenPrefix=`Bearer `})),Pe=e((e=>{Object.defineProperty(e,`__esModule`,{value:!0})})),Fe=e((e=>{Object.defineProperty(e,`__esModule`,{value:!0})})),P=e((e=>{Object.defineProperty(e,`__esModule`,{value:!0}),e.RecognitionEndedEvent=e.RecognitionCompletionStatus=e.RecognitionStartedEvent=e.ConnectingToServiceEvent=e.ListeningStartedEvent=e.RecognitionTriggeredEvent=e.SpeechRecognitionEvent=void 0;var t=j(),n=class extends t.PlatformEvent{constructor(e,n,r,i=t.EventType.Info){super(e,i),this.privRequestId=n,this.privSessionId=r}get requestId(){return this.privRequestId}get sessionId(){return this.privSessionId}};e.SpeechRecognitionEvent=n,e.RecognitionTriggeredEvent=class extends n{constructor(e,t,n,r){super(`RecognitionTriggeredEvent`,e,t),this.privAudioSourceId=n,this.privAudioNodeId=r}get audioSourceId(){return this.privAudioSourceId}get audioNodeId(){return this.privAudioNodeId}},e.ListeningStartedEvent=class extends n{constructor(e,t,n,r){super(`ListeningStartedEvent`,e,t),this.privAudioSourceId=n,this.privAudioNodeId=r}get audioSourceId(){return this.privAudioSourceId}get audioNodeId(){return this.privAudioNodeId}},e.ConnectingToServiceEvent=class extends n{constructor(e,t,n){super(`ConnectingToServiceEvent`,e,n),this.privAuthFetchEventid=t}get authFetchEventid(){return this.privAuthFetchEventid}},e.RecognitionStartedEvent=class extends n{constructor(e,t,n,r,i){super(`RecognitionStartedEvent`,e,i),this.privAudioSourceId=t,this.privAudioNodeId=n,this.privAuthFetchEventId=r}get audioSourceId(){return this.privAudioSourceId}get audioNodeId(){return this.privAudioNodeId}get authFetchEventId(){return this.privAuthFetchEventId}};var r;(function(e){e[e.Success=0]=`Success`,e[e.AudioSourceError=1]=`AudioSourceError`,e[e.AudioSourceTimeout=2]=`AudioSourceTimeout`,e[e.AuthTokenFetchError=3]=`AuthTokenFetchError`,e[e.AuthTokenFetchTimeout=4]=`AuthTokenFetchTimeout`,e[e.UnAuthorized=5]=`UnAuthorized`,e[e.ConnectTimeout=6]=`ConnectTimeout`,e[e.ConnectError=7]=`ConnectError`,e[e.ClientRecognitionActivityTimeout=8]=`ClientRecognitionActivityTimeout`,e[e.UnknownError=9]=`UnknownError`})(r=e.RecognitionCompletionStatus||={}),e.RecognitionEndedEvent=class extends n{constructor(e,n,i,a,o,s,c,l){super(`RecognitionEndedEvent`,e,o,c===r.Success?t.EventType.Info:t.EventType.Error),this.privAudioSourceId=n,this.privAudioNodeId=i,this.privAuthFetchEventId=a,this.privStatus=c,this.privError=l,this.privServiceTag=s}get audioSourceId(){return this.privAudioSourceId}get audioNodeId(){return this.privAudioNodeId}get authFetchEventId(){return this.privAuthFetchEventId}get serviceTag(){return this.privServiceTag}get status(){return this.privStatus}get error(){return this.privError}}})),F=e(((e,t)=>{t.exports={}})),Ie=e((e=>{Object.defineProperty(e,`__esModule`,{value:!0}),e.LogLevel=void 0;var t=j();Object.defineProperty(e,`LogLevel`,{enumerable:!0,get:function(){return t.EventType}})})),I=e((e=>{Object.defineProperty(e,`__esModule`,{value:!0}),e.Contracts=void 0,e.Contracts=class e{static throwIfNullOrUndefined(e,t){if(e==null)throw Error(`throwIfNullOrUndefined:`+t)}static throwIfNull(e,t){if(e===null)throw Error(`throwIfNull:`+t)}static throwIfNullOrWhitespace(t,n){if(e.throwIfNullOrUndefined(t,n),(``+t).trim().length<1)throw Error(`throwIfNullOrWhitespace:`+n)}static throwIfNullOrTooLong(t,n,r){if(e.throwIfNullOrUndefined(t,n),(``+t).length>r)throw Error(`throwIfNullOrTooLong:`+n+` (more than `+r.toString()+` characters)`)}static throwIfNullOrTooShort(t,n,r){if(e.throwIfNullOrUndefined(t,n),(``+t).length<r)throw Error(`throwIfNullOrTooShort:`+n+` (less than `+r.toString()+` characters)`)}static throwIfDisposed(e){if(e)throw Error(`the object is already disposed`)}static throwIfArrayEmptyOrWhitespace(t,n){if(e.throwIfNullOrUndefined(t,n),t.length===0)throw Error(`throwIfArrayEmptyOrWhitespace:`+n);for(let r of t)e.throwIfNullOrWhitespace(r,n)}static throwIfFileDoesNotExist(t,n){e.throwIfNullOrWhitespace(t,n)}static throwIfNotUndefined(e,t){if(e!==void 0)throw Error(`throwIfNotUndefined:`+t)}static throwIfNumberOutOfRange(t,n,r,i){if(e.throwIfNullOrUndefined(t,n),t<r||t>i)throw Error(`throwIfNumberOutOfRange:`+n+` (must be between `+r.toString()+` and `+i.toString()+`)`)}}})),Le=e((e=>{var t=e&&e.__createBinding||(Object.create?(function(e,t,n,r){r===void 0&&(r=n),Object.defineProperty(e,r,{enumerable:!0,get:function(){return t[n]}})}):(function(e,t,n,r){r===void 0&&(r=n),e[r]=t[n]})),n=e&&e.__setModuleDefault||(Object.create?(function(e,t){Object.defineProperty(e,`default`,{enumerable:!0,value:t})}):function(e,t){e.default=t}),r=e&&e.__importStar||function(e){if(e&&e.__esModule)return e;var r={};if(e!=null)for(var i in e)i!==`default`&&Object.prototype.hasOwnProperty.call(e,i)&&t(r,e,i);return n(r,e),r};Object.defineProperty(e,`__esModule`,{value:!0}),e.ConsoleLoggingListener=void 0;var i=r(F()),a=Ie(),o=I();e.ConsoleLoggingListener=class{constructor(e=a.LogLevel.None){this.privLogPath=void 0,this.privEnableConsoleOutput=!0,this.privLogLevelFilter=e}set logPath(e){o.Contracts.throwIfNullOrUndefined(i.openSync,`
File System access not available`),this.privLogPath=e}set enableConsoleOutput(e){this.privEnableConsoleOutput=e}onEvent(e){if(e.eventType>=this.privLogLevelFilter){let t=this.toString(e);if(this.logCallback&&this.logCallback(t),this.privLogPath&&i.writeFileSync(this.privLogPath,t+`
`,{flag:`a+`}),this.privEnableConsoleOutput)switch(e.eventType){case a.LogLevel.Debug:console.debug(t);break;case a.LogLevel.Info:console.info(t);break;case a.LogLevel.Warning:console.warn(t);break;case a.LogLevel.Error:console.error(t);break;default:console.log(t);break}}}toString(e){let t=[`${e.eventTime}`,`${e.name}`],n=e;for(let r in n)if(r&&e.hasOwnProperty(r)&&r!==`eventTime`&&r!==`eventType`&&r!==`eventId`&&r!==`name`&&r!==`constructor`){let e=n[r],i=`<NULL>`;e!=null&&(i=typeof e==`number`||typeof e==`string`?e.toString():JSON.stringify(e)),t.push(`${r}: ${i}`)}return t.join(` | `)}}})),Re=e((e=>{Object.defineProperty(e,`__esModule`,{value:!0})})),L=e((e=>{Object.defineProperty(e,`__esModule`,{value:!0}),e.AudioStreamFormatImpl=e.AudioStreamFormat=e.AudioFormatTag=void 0;var t;(function(e){e[e.PCM=1]=`PCM`,e[e.MuLaw=2]=`MuLaw`,e[e.Siren=3]=`Siren`,e[e.MP3=4]=`MP3`,e[e.SILKSkype=5]=`SILKSkype`,e[e.OGG_OPUS=6]=`OGG_OPUS`,e[e.WEBM_OPUS=7]=`WEBM_OPUS`,e[e.ALaw=8]=`ALaw`,e[e.FLAC=9]=`FLAC`,e[e.OPUS=10]=`OPUS`,e[e.AMR_WB=11]=`AMR_WB`,e[e.G722=12]=`G722`})(t=e.AudioFormatTag||={});var n=class{static getDefaultInputFormat(){return r.getDefaultInputFormat()}static getWaveFormat(e,t,n,i){return new r(e,t,n,i)}static getWaveFormatPCM(e,t,n){return new r(e,t,n)}};e.AudioStreamFormat=n;var r=class e extends n{constructor(e=16e3,n=16,r=1,i=t.PCM){super();let a=!0;switch(i){case t.PCM:this.formatTag=1;break;case t.ALaw:this.formatTag=6;break;case t.MuLaw:this.formatTag=7;break;default:a=!1}if(this.bitsPerSample=n,this.samplesPerSec=e,this.channels=r,this.avgBytesPerSec=this.samplesPerSec*this.channels*(this.bitsPerSample/8),this.blockAlign=this.channels*Math.max(this.bitsPerSample,8),a){this.privHeader=new ArrayBuffer(44);let e=new DataView(this.privHeader);this.setString(e,0,`RIFF`),e.setUint32(4,0,!0),this.setString(e,8,`WAVEfmt `),e.setUint32(16,16,!0),e.setUint16(20,this.formatTag,!0),e.setUint16(22,this.channels,!0),e.setUint32(24,this.samplesPerSec,!0),e.setUint32(28,this.avgBytesPerSec,!0),e.setUint16(32,this.channels*(this.bitsPerSample/8),!0),e.setUint16(34,this.bitsPerSample,!0),this.setString(e,36,`data`),e.setUint32(40,0,!0)}}static getDefaultInputFormat(){return new e}static getAudioContext(e){let t=window.AudioContext||window.webkitAudioContext||!1;if(t)return e!==void 0&&navigator.mediaDevices.getSupportedConstraints().sampleRate?new t({sampleRate:e}):new t;throw Error(`Browser does not support Web Audio API (AudioContext is not available).`)}close(){}get header(){return this.privHeader}setString(e,t,n){for(let r=0;r<n.length;r++)e.setUint8(t+r,n.charCodeAt(r))}};e.AudioStreamFormatImpl=r})),ze=e((e=>{Object.defineProperty(e,`__esModule`,{value:!0}),e.MicAudioSource=e.AudioWorkletSourceURLPropertyName=void 0;var t=$(),n=j(),r=L();e.AudioWorkletSourceURLPropertyName=`MICROPHONE-WorkletSourceUrl`;var i=class i{constructor(e,t,r,a){this.privRecorder=e,this.deviceId=t,this.privStreams={},this.privOutputChunkSize=i.AUDIOFORMAT.avgBytesPerSec/10,this.privId=r||(0,n.createNoDashGuid)(),this.privEvents=new n.EventSource,this.privMediaStream=a||null,this.privIsClosing=!1}get format(){return Promise.resolve(i.AUDIOFORMAT)}turnOn(){if(this.privInitializeDeferral)return this.privInitializeDeferral.promise;this.privInitializeDeferral=new n.Deferred;try{this.createAudioContext()}catch(e){if(e instanceof Error){let t=e;this.privInitializeDeferral.reject(t.name+`: `+t.message)}else this.privInitializeDeferral.reject(e);return this.privInitializeDeferral.promise}let e=window.navigator,t=e.getUserMedia||e.webkitGetUserMedia||e.mozGetUserMedia||e.msGetUserMedia;if(e.mediaDevices&&(t=(t,n,r)=>{e.mediaDevices.getUserMedia(t).then(n).catch(r)}),t){let e=()=>{this.onEvent(new n.AudioSourceInitializingEvent(this.privId)),this.privMediaStream&&this.privMediaStream.active?(this.onEvent(new n.AudioSourceReadyEvent(this.privId)),this.privInitializeDeferral.resolve()):t({audio:this.deviceId?{deviceId:this.deviceId}:!0,video:!1},e=>{this.privMediaStream=e,this.onEvent(new n.AudioSourceReadyEvent(this.privId)),this.privInitializeDeferral.resolve()},e=>{let t=`Error occurred during microphone initialization: ${e}`;this.privInitializeDeferral.reject(t),this.onEvent(new n.AudioSourceErrorEvent(this.privId,t))})};this.privContext.state===`suspended`?this.privContext.resume().then(e).catch(e=>{this.privInitializeDeferral.reject(`Failed to initialize audio context: ${e}`)}):e()}else{let e=`Browser does not support getUserMedia.`;this.privInitializeDeferral.reject(e),this.onEvent(new n.AudioSourceErrorEvent(e,``))}return this.privInitializeDeferral.promise}id(){return this.privId}attach(e){return this.onEvent(new n.AudioStreamNodeAttachingEvent(this.privId,e)),this.listen(e).then(t=>(this.onEvent(new n.AudioStreamNodeAttachedEvent(this.privId,e)),{detach:async()=>(t.readEnded(),delete this.privStreams[e],this.onEvent(new n.AudioStreamNodeDetachedEvent(this.privId,e)),this.turnOff()),id:()=>e,read:()=>t.read()}))}detach(e){e&&this.privStreams[e]&&(this.privStreams[e].close(),delete this.privStreams[e],this.onEvent(new n.AudioStreamNodeDetachedEvent(this.privId,e)))}async turnOff(){for(let e in this.privStreams)if(e){let t=this.privStreams[e];t&&t.close()}this.onEvent(new n.AudioSourceOffEvent(this.privId)),this.privInitializeDeferral&&=(await this.privInitializeDeferral,null),await this.destroyAudioContext()}get events(){return this.privEvents}get deviceInfo(){return this.getMicrophoneLabel().then(e=>({bitspersample:i.AUDIOFORMAT.bitsPerSample,channelcount:i.AUDIOFORMAT.channels,connectivity:t.connectivity.Unknown,manufacturer:`Speech SDK`,model:e,samplerate:i.AUDIOFORMAT.samplesPerSec,type:t.type.Microphones}))}setProperty(t,n){if(t===e.AudioWorkletSourceURLPropertyName)this.privRecorder.setWorkletUrl(n);else throw Error(`Property '`+t+`' is not supported on Microphone.`)}getMicrophoneLabel(){let e=`microphone`;if(this.privMicrophoneLabel!==void 0)return Promise.resolve(this.privMicrophoneLabel);if(this.privMediaStream===void 0||!this.privMediaStream.active)return Promise.resolve(e);this.privMicrophoneLabel=e;let t=this.privMediaStream.getTracks()[0].getSettings().deviceId;if(t===void 0)return Promise.resolve(this.privMicrophoneLabel);let r=new n.Deferred;return navigator.mediaDevices.enumerateDevices().then(e=>{for(let n of e)if(n.deviceId===t){this.privMicrophoneLabel=n.label;break}r.resolve(this.privMicrophoneLabel)},()=>r.resolve(this.privMicrophoneLabel)),r.promise}async listen(e){await this.turnOn();let t=new n.ChunkedArrayBufferStream(this.privOutputChunkSize,e);this.privStreams[e]=t;try{this.privRecorder.record(this.privContext,this.privMediaStream,t)}catch(t){throw this.onEvent(new n.AudioStreamNodeErrorEvent(this.privId,e,t)),t}return t}onEvent(e){this.privEvents.onEvent(e),n.Events.instance.onEvent(e)}createAudioContext(){this.privContext||=r.AudioStreamFormatImpl.getAudioContext(i.AUDIOFORMAT.samplesPerSec)}async destroyAudioContext(){if(!this.privContext)return;this.privRecorder.releaseMediaResources(this.privContext);let e=!1;`close`in this.privContext&&(e=!0),e?this.privIsClosing||=(this.privIsClosing=!0,await this.privContext.close(),this.privContext=null,!1):this.privContext!==null&&this.privContext.state===`running`&&await this.privContext.suspend()}};e.MicAudioSource=i,i.AUDIOFORMAT=r.AudioStreamFormat.getDefaultInputFormat()})),Be=e((e=>{Object.defineProperty(e,`__esModule`,{value:!0}),e.FileAudioSource=void 0;var t=$(),n=j(),r=L();e.FileAudioSource=class{constructor(e,t,r){this.privStreams={},this.privHeaderEnd=44,this.privId=r||(0,n.createNoDashGuid)(),this.privEvents=new n.EventSource,this.privSource=e,typeof window<`u`&&typeof Blob<`u`&&this.privSource instanceof Blob?this.privFilename=e.name:this.privFilename=t||`unknown.wav`,this.privAudioFormatPromise=this.readHeader()}get format(){return this.privAudioFormatPromise}turnOn(){if(this.privFilename.lastIndexOf(`.wav`)!==this.privFilename.length-4){let e=this.privFilename+` is not supported. Only WAVE files are allowed at the moment.`;return this.onEvent(new n.AudioSourceErrorEvent(e,``)),Promise.reject(e)}this.onEvent(new n.AudioSourceInitializingEvent(this.privId)),this.onEvent(new n.AudioSourceReadyEvent(this.privId))}id(){return this.privId}async attach(e){this.onEvent(new n.AudioStreamNodeAttachingEvent(this.privId,e));let t=await this.upload(e);return this.onEvent(new n.AudioStreamNodeAttachedEvent(this.privId,e)),Promise.resolve({detach:async()=>{t.readEnded(),delete this.privStreams[e],this.onEvent(new n.AudioStreamNodeDetachedEvent(this.privId,e)),await this.turnOff()},id:()=>e,read:()=>t.read()})}detach(e){e&&this.privStreams[e]&&(this.privStreams[e].close(),delete this.privStreams[e],this.onEvent(new n.AudioStreamNodeDetachedEvent(this.privId,e)))}turnOff(){for(let e in this.privStreams)if(e){let t=this.privStreams[e];t&&!t.isClosed&&t.close()}return this.onEvent(new n.AudioSourceOffEvent(this.privId)),Promise.resolve()}get events(){return this.privEvents}get deviceInfo(){return this.privAudioFormatPromise.then(e=>Promise.resolve({bitspersample:e.bitsPerSample,channelcount:e.channels,connectivity:t.connectivity.Unknown,manufacturer:`Speech SDK`,model:`File`,samplerate:e.samplesPerSec,type:t.type.File}))}readHeader(){let e=4296,t=this.privSource.slice(0,e),i=new n.Deferred,a=t=>{let n=new DataView(t),a=e=>String.fromCharCode(n.getUint8(e),n.getUint8(e+1),n.getUint8(e+2),n.getUint8(e+3));if(a(0)!==`RIFF`){i.reject(`Invalid WAV header in file, RIFF was not found`);return}if(a(8)!==`WAVE`||a(12)!==`fmt `){i.reject(`Invalid WAV header in file, WAVEfmt was not found`);return}let o=n.getInt32(16,!0),s=n.getUint16(22,!0),c=n.getUint32(24,!0),l=n.getUint16(34,!0),u=36+Math.max(o-16,0);for(;a(u)!==`data`;u+=2)if(u>e-8){i.reject(`Invalid WAV header in file, data block was not found`);return}this.privHeaderEnd=u+8,i.resolve(r.AudioStreamFormat.getWaveFormatPCM(c,l,s))};if(typeof window<`u`&&typeof Blob<`u`&&t instanceof Blob){let e=new FileReader;e.onload=e=>{let t=e.target.result;a(t)},e.readAsArrayBuffer(t)}else{let e=t;a(e.buffer.slice(e.byteOffset,e.byteOffset+e.byteLength))}return i.promise}async upload(e){let t=t=>{let r=`Error occurred while processing '${this.privFilename}'. ${t}`;throw this.onEvent(new n.AudioStreamNodeErrorEvent(this.privId,e,r)),Error(r)};try{await this.turnOn();let r=await this.privAudioFormatPromise,i=new n.ChunkedArrayBufferStream(r.avgBytesPerSec/10,e);this.privStreams[e]=i;let a=this.privSource.slice(this.privHeaderEnd),o=e=>{i.isClosed||(i.writeStreamChunk({buffer:e,isEnd:!1,timeReceived:Date.now()}),i.close())};if(typeof window<`u`&&typeof Blob<`u`&&a instanceof Blob){let e=new FileReader;e.onerror=e=>t(e.toString()),e.onload=e=>{let t=e.target.result;o(t)},e.readAsArrayBuffer(a)}else{let e=a;o(e.buffer.slice(e.byteOffset,e.byteOffset+e.byteLength))}return i}catch(e){t(e)}}onEvent(e){this.privEvents.onEvent(e),n.Events.instance.onEvent(e)}}})),R=e((e=>{Object.defineProperty(e,`__esModule`,{value:!0}),e.PcmRecorder=void 0;var t=j();e.PcmRecorder=class{constructor(e){this.privStopInputOnRelease=e}record(e,n,r){let i=16e3,a=new t.RiffPcmEncoder(e.sampleRate,i),o=e.createMediaStreamSource(n),s=()=>{let t=(()=>{let t=0;try{return e.createScriptProcessor(t,1,1)}catch{t=2048;let n=e.sampleRate;for(;t<16384&&n>=2*i;)t<<=1,n>>=1;return e.createScriptProcessor(t,1,1)}})();t.onaudioprocess=e=>{let t=e.inputBuffer.getChannelData(0);if(r&&!r.isClosed){let e=a.encode(t);e&&r.writeStreamChunk({buffer:e,isEnd:!1,timeReceived:Date.now()})}},o.connect(t),t.connect(e.destination),this.privMediaResources={scriptProcessorNode:t,source:o,stream:n}},c=!!this.privSpeechProcessorScript&&this.privSpeechProcessorScript.toLowerCase()===`ignore`;if(e.audioWorklet&&!c){if(!this.privSpeechProcessorScript){let e=new Blob([`class SP extends AudioWorkletProcessor {
                    constructor(options) {
                      super(options);
                    }
                    process(inputs, outputs) {
                      const input = inputs[0];
                      const output = [];
                      for (let channel = 0; channel < input.length; channel += 1) {
                        output[channel] = input[channel];
                      }
                      this.port.postMessage(output[0]);
                      return true;
                    }
                  }
                  registerProcessor('speech-processor', SP);`],{type:`application/javascript; charset=utf-8`});this.privSpeechProcessorScript=URL.createObjectURL(e)}e.audioWorklet.addModule(this.privSpeechProcessorScript).then(()=>{let t=new AudioWorkletNode(e,`speech-processor`);t.port.onmessage=e=>{let t=e.data;if(r&&!r.isClosed){let e=a.encode(t);e&&r.writeStreamChunk({buffer:e,isEnd:!1,timeReceived:Date.now()})}},o.connect(t),t.connect(e.destination),this.privMediaResources={scriptProcessorNode:t,source:o,stream:n}}).catch(()=>{s()})}else try{s()}catch(e){throw Error(`Unable to start audio worklet node for PCMRecorder: ${e}`)}}releaseMediaResources(e){this.privMediaResources&&(this.privMediaResources.scriptProcessorNode&&(this.privMediaResources.scriptProcessorNode.disconnect(e.destination),this.privMediaResources.scriptProcessorNode=null),this.privMediaResources.source&&(this.privMediaResources.source.disconnect(),this.privStopInputOnRelease&&this.privMediaResources.stream.getTracks().forEach(e=>e.stop()),this.privMediaResources.source=null))}setWorkletUrl(e){this.privSpeechProcessorScript=e}}})),z=e((e=>{var t=e&&e.__createBinding||(Object.create?(function(e,t,n,r){r===void 0&&(r=n),Object.defineProperty(e,r,{enumerable:!0,get:function(){return t[n]}})}):(function(e,t,n,r){r===void 0&&(r=n),e[r]=t[n]})),n=e&&e.__setModuleDefault||(Object.create?(function(e,t){Object.defineProperty(e,`default`,{enumerable:!0,value:t})}):function(e,t){e.default=t}),r=e&&e.__importStar||function(e){if(e&&e.__esModule)return e;var r={};if(e!=null)for(var i in e)i!==`default`&&Object.prototype.hasOwnProperty.call(e,i)&&t(r,e,i);return n(r,e),r},i=e&&e.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(e,`__esModule`,{value:!0}),e.WebsocketMessageAdapter=void 0;var a=r(F()),o=r(F()),s=i(F()),c=i(F()),l=i(F()),u=M(),d=j(),f=class e{constructor(e,t,n,r,i,a){if(!e)throw new d.ArgumentNullError(`uri`);if(!n)throw new d.ArgumentNullError(`messageFormatter`);this.proxyInfo=r,this.privConnectionEvents=new d.EventSource,this.privConnectionId=t,this.privMessageFormatter=n,this.privConnectionState=d.ConnectionState.None,this.privUri=e,this.privHeaders=i,this.privEnableCompression=a,this.privHeaders[u.HeaderNames.ConnectionId]=this.privConnectionId,this.privHeaders.connectionId=this.privConnectionId,this.privLastErrorReceived=``}get state(){return this.privConnectionState}open(){if(this.privConnectionState===d.ConnectionState.Disconnected)return Promise.reject(`Cannot open a connection that is in ${this.privConnectionState} state`);if(this.privConnectionEstablishDeferral)return this.privConnectionEstablishDeferral.promise;this.privConnectionEstablishDeferral=new d.Deferred,this.privCertificateValidatedDeferral=new d.Deferred,this.privConnectionState=d.ConnectionState.Connecting;try{if(typeof WebSocket<`u`&&!e.forceNpmWebSocket)this.privCertificateValidatedDeferral.resolve(),this.privWebsocketClient=new WebSocket(this.privUri);else{let e=new URL(this.privUri).protocol;e?.toLocaleLowerCase()===`wss:`?e=`https:`:e?.toLocaleLowerCase()===`ws:`&&(e=`http:`);let t={headers:this.privHeaders,perMessageDeflate:this.privEnableCompression,followRedirects:e.toLocaleLowerCase()===`https:`};this.privCertificateValidatedDeferral.resolve(),t.agent=this.getAgent(),t.agent.protocol=e,this.privWebsocketClient=new l.default(this.privUri,t),this.privWebsocketClient.on(`redirect`,e=>{let t=new d.ConnectionRedirectEvent(this.privConnectionId,e,this.privUri,`Getting redirect URL from endpoint ${this.privUri} with redirect URL '${e}'`);d.Events.instance.onEvent(t)})}this.privWebsocketClient.binaryType=`arraybuffer`,this.privReceivingMessageQueue=new d.Queue,this.privDisconnectDeferral=new d.Deferred,this.privSendMessageQueue=new d.Queue,this.processSendQueue().catch(e=>{d.Events.instance.onEvent(new d.BackgroundEvent(e))})}catch(e){return this.privConnectionEstablishDeferral.resolve(new d.ConnectionOpenResponse(500,e)),this.privConnectionEstablishDeferral.promise}return this.onEvent(new d.ConnectionStartEvent(this.privConnectionId,this.privUri)),this.privWebsocketClient.onopen=()=>{this.privCertificateValidatedDeferral.promise.then(()=>{this.privConnectionState=d.ConnectionState.Connected,this.onEvent(new d.ConnectionEstablishedEvent(this.privConnectionId)),this.privConnectionEstablishDeferral.resolve(new d.ConnectionOpenResponse(200,``))},e=>{this.privConnectionEstablishDeferral.reject(e)})},this.privWebsocketClient.onerror=e=>{this.onEvent(new d.ConnectionErrorEvent(this.privConnectionId,e.message,e.type)),this.privLastErrorReceived=e.message},this.privWebsocketClient.onclose=e=>{this.privConnectionState===d.ConnectionState.Connecting?(this.privConnectionState=d.ConnectionState.Disconnected,this.privConnectionEstablishDeferral.resolve(new d.ConnectionOpenResponse(e.code,e.reason+` `+this.privLastErrorReceived))):(this.privConnectionState=d.ConnectionState.Disconnected,this.privWebsocketClient=null,this.onEvent(new d.ConnectionClosedEvent(this.privConnectionId,e.code,e.reason))),this.onClose(e.code,e.reason).catch(e=>{d.Events.instance.onEvent(new d.BackgroundEvent(e))})},this.privWebsocketClient.onmessage=e=>{let t=new Date().toISOString();if(this.privConnectionState===d.ConnectionState.Connected){let n=new d.Deferred;if(this.privReceivingMessageQueue.enqueueFromPromise(n.promise),e.data instanceof ArrayBuffer){let r=new d.RawWebsocketMessage(d.MessageType.Binary,e.data);this.privMessageFormatter.toConnectionMessage(r).then(e=>{this.onEvent(new d.ConnectionMessageReceivedEvent(this.privConnectionId,t,e)),n.resolve(e)},e=>{n.reject(`Invalid binary message format. Error: ${e}`)})}else{let r=new d.RawWebsocketMessage(d.MessageType.Text,e.data);this.privMessageFormatter.toConnectionMessage(r).then(e=>{this.onEvent(new d.ConnectionMessageReceivedEvent(this.privConnectionId,t,e)),n.resolve(e)},e=>{n.reject(`Invalid text message format. Error: ${e}`)})}}},this.privConnectionEstablishDeferral.promise}send(e){if(this.privConnectionState!==d.ConnectionState.Connected)return Promise.reject(`Cannot send on connection that is in ${d.ConnectionState[this.privConnectionState]} state`);let t=new d.Deferred,n=new d.Deferred;return this.privSendMessageQueue.enqueueFromPromise(n.promise),this.privMessageFormatter.fromConnectionMessage(e).then(r=>{n.resolve({Message:e,RawWebsocketMessage:r,sendStatusDeferral:t})},e=>{n.reject(`Error formatting the message. ${e}`)}),t.promise}read(){return this.privConnectionState===d.ConnectionState.Connected?this.privReceivingMessageQueue.dequeue():Promise.reject(`Cannot read on connection that is in ${this.privConnectionState} state`)}close(e){if(this.privWebsocketClient)this.privConnectionState!==d.ConnectionState.Disconnected&&this.privWebsocketClient.close(1e3,e||`Normal closure by client`);else return Promise.resolve();return this.privDisconnectDeferral.promise}get events(){return this.privConnectionEvents}sendRawMessage(e){try{if(!e)return Promise.resolve();if(this.onEvent(new d.ConnectionMessageSentEvent(this.privConnectionId,new Date().toISOString(),e.Message)),this.isWebsocketOpen)this.privWebsocketClient.send(e.RawWebsocketMessage.payload);else return Promise.reject(`websocket send error: Websocket not ready `+this.privConnectionId+` `+e.Message.id+` `+Error().stack);return Promise.resolve()}catch(e){return Promise.reject(`websocket send error: ${e}`)}}async onClose(e,t){let n=`Connection closed. ${e}: ${t}`;this.privConnectionState=d.ConnectionState.Disconnected,this.privDisconnectDeferral.resolve(),await this.privReceivingMessageQueue.drainAndDispose(()=>{},n),await this.privSendMessageQueue.drainAndDispose(e=>{e.sendStatusDeferral.reject(n)},n)}async processSendQueue(){for(;;){let e=await this.privSendMessageQueue.dequeue();if(!e)return;try{await this.sendRawMessage(e),e.sendStatusDeferral.resolve()}catch(t){e.sendStatusDeferral.reject(t)}}}onEvent(e){this.privConnectionEvents.onEvent(e),d.Events.instance.onEvent(e)}getAgent(){let e=new s.default.Agent(this.createConnection);return this.proxyInfo!==void 0&&this.proxyInfo.HostName!==void 0&&this.proxyInfo.Port>0&&(e.proxyInfo=this.proxyInfo),e}static GetProxyAgent(e){let t={host:e.HostName,port:e.Port};return e.UserName?t.headers={"Proxy-Authentication":`Basic `+Buffer.from(`${e.UserName}:${e.Password===void 0?``:e.Password}`).toString(`base64`)}:t.headers={},t.headers.requestOCSP=`true`,new c.default(t)}createConnection(t,n){let r;if(n={...n,requestOCSP:!0,servername:n.host},this.proxyInfo){let i=e.GetProxyAgent(this.proxyInfo);r=new Promise((e,r)=>{i.callback(t,n,(t,n)=>{t?r(t):e(n)})})}else r=n.secureEndpoint?Promise.resolve(o.connect(n)):Promise.resolve(a.connect(n));return r}get isWebsocketOpen(){return this.privWebsocketClient&&this.privWebsocketClient.readyState===this.privWebsocketClient.OPEN}};e.WebsocketMessageAdapter=f,f.forceNpmWebSocket=!1})),Ve=e((e=>{Object.defineProperty(e,`__esModule`,{value:!0}),e.WebsocketConnection=void 0;var t=j(),n=z();e.WebsocketConnection=class{constructor(e,r,i,a,o,s=!1,c){if(this.privIsDisposed=!1,!e)throw new t.ArgumentNullError(`uri`);if(!a)throw new t.ArgumentNullError(`messageFormatter`);this.privMessageFormatter=a;let l=``,u=0;if(r){for(let t in r)if(t){l+=u===0&&e.indexOf(`?`)===-1?`?`:`&`,l+=encodeURIComponent(t);let n=r[t];n&&(n=encodeURIComponent(n),l+=`=${n}`),u++}}if(i){for(let t in i)if(t){l+=u===0&&e.indexOf(`?`)===-1?`?`:`&`;let n=encodeURIComponent(i[t]);l+=`${t}=${n}`,u++}}this.privUri=e+l,this.privId=c||(0,t.createNoDashGuid)(),this.privConnectionMessageAdapter=new n.WebsocketMessageAdapter(this.privUri,this.id,this.privMessageFormatter,o,i,s)}async dispose(){this.privIsDisposed=!0,this.privConnectionMessageAdapter&&await this.privConnectionMessageAdapter.close()}isDisposed(){return this.privIsDisposed}get id(){return this.privId}get uri(){return this.privUri}state(){return this.privConnectionMessageAdapter.state}open(){return this.privConnectionMessageAdapter.open()}send(e){return this.privConnectionMessageAdapter.send(e)}read(){return this.privConnectionMessageAdapter.read()}get events(){return this.privConnectionMessageAdapter.events}}})),He=e((e=>{Object.defineProperty(e,`__esModule`,{value:!0}),e.ReplayableAudioNode=void 0,e.ReplayableAudioNode=class{constructor(e,t){this.privBuffers=[],this.privReplayOffset=0,this.privLastShrinkOffset=0,this.privBufferStartOffset=0,this.privBufferSerial=0,this.privBufferedBytes=0,this.privReplay=!1,this.privLastChunkAcquiredTime=0,this.privAudioNode=e,this.privBytesPerSecond=t}id(){return this.privAudioNode.id()}read(){if(this.privReplay&&this.privBuffers.length!==0){let e=this.privReplayOffset-this.privBufferStartOffset,t=Math.round(e*this.privBytesPerSecond*1e-7);t%2!=0&&t++;let n=0;for(;n<this.privBuffers.length&&t>=this.privBuffers[n].chunk.buffer.byteLength;)t-=this.privBuffers[n++].chunk.buffer.byteLength;if(n<this.privBuffers.length){let e=this.privBuffers[n].chunk.buffer.slice(t);return this.privReplayOffset+=e.byteLength/this.privBytesPerSecond*1e7,n===this.privBuffers.length-1&&(this.privReplay=!1),Promise.resolve({buffer:e,isEnd:!1,timeReceived:this.privBuffers[n].chunk.timeReceived})}}return this.privAudioNode.read().then(e=>(e&&e.buffer&&this.privBuffers&&(this.privBuffers.push(new t(e,this.privBufferSerial++,this.privBufferedBytes)),this.privBufferedBytes+=e.buffer.byteLength),e))}detach(){return this.privBuffers=void 0,this.privAudioNode.detach()}replay(){this.privBuffers&&this.privBuffers.length!==0&&(this.privReplay=!0,this.privReplayOffset=this.privLastShrinkOffset)}shrinkBuffers(e){if(this.privBuffers===void 0||this.privBuffers.length===0)return;this.privLastShrinkOffset=e;let t=e-this.privBufferStartOffset,n=Math.round(t*this.privBytesPerSecond*1e-7),r=0;for(;r<this.privBuffers.length&&n>=this.privBuffers[r].chunk.buffer.byteLength;)n-=this.privBuffers[r++].chunk.buffer.byteLength;this.privBufferStartOffset=Math.round(e-n/this.privBytesPerSecond*1e7),this.privBuffers=this.privBuffers.slice(r)}findTimeAtOffset(e){if(e<this.privBufferStartOffset||this.privBuffers===void 0)return 0;for(let t of this.privBuffers){let n=t.byteOffset/this.privBytesPerSecond*1e7,r=n+t.chunk.buffer.byteLength/this.privBytesPerSecond*1e7;if(e>=n&&e<=r)return t.chunk.timeReceived}return 0}};var t=class{constructor(e,t,n){this.chunk=e,this.serial=t,this.byteOffset=n}}})),Ue=e((e=>{var t=e&&e.__createBinding||(Object.create?(function(e,t,n,r){r===void 0&&(r=n),Object.defineProperty(e,r,{enumerable:!0,get:function(){return t[n]}})}):(function(e,t,n,r){r===void 0&&(r=n),e[r]=t[n]})),n=e&&e.__setModuleDefault||(Object.create?(function(e,t){Object.defineProperty(e,`default`,{enumerable:!0,value:t})}):function(e,t){e.default=t}),r=e&&e.__importStar||function(e){if(e&&e.__esModule)return e;var r={};if(e!=null)for(var i in e)i!==`default`&&Object.prototype.hasOwnProperty.call(e,i)&&t(r,e,i);return n(r,e),r};Object.defineProperty(e,`__esModule`,{value:!0}),e.AudioFileWriter=void 0;var i=r(F()),a=I();e.AudioFileWriter=class{constructor(e){a.Contracts.throwIfNullOrUndefined(i.openSync,`
File System access not available, please use Push or PullAudioOutputStream`),this.privFd=i.openSync(e,`w`)}set format(e){a.Contracts.throwIfNotUndefined(this.privAudioFormat,`format is already set`),this.privAudioFormat=e;let t=0;this.privAudioFormat.hasHeader&&(t=this.privAudioFormat.header.byteLength),this.privFd!==void 0&&(this.privWriteStream=i.createWriteStream(``,{fd:this.privFd,start:t,autoClose:!1}))}write(e){a.Contracts.throwIfNullOrUndefined(this.privAudioFormat,`must set format before writing.`),this.privWriteStream!==void 0&&this.privWriteStream.write(new Uint8Array(e.slice(0)))}close(){this.privFd!==void 0&&(this.privWriteStream.on(`finish`,()=>{this.privAudioFormat.hasHeader&&(this.privAudioFormat.updateHeader(this.privWriteStream.bytesWritten),i.writeSync(this.privFd,new Int8Array(this.privAudioFormat.header),0,this.privAudioFormat.header.byteLength,0)),i.closeSync(this.privFd),this.privFd=void 0}),this.privWriteStream.end())}id(){return this.privId}}})),We=e((e=>{Object.defineProperty(e,`__esModule`,{value:!0}),e.PullAudioInputStreamImpl=e.PullAudioInputStream=e.PushAudioInputStreamImpl=e.PushAudioInputStream=e.AudioInputStream=void 0;var t=$(),n=j(),r=S(),i=Y(),a=L(),o=class{constructor(){}static createPushStream(e){return s.create(e)}static createPullStream(e,t){return l.create(e,t)}};e.AudioInputStream=o;var s=class extends o{static create(e){return new c(e)}};e.PushAudioInputStream=s;var c=class extends s{constructor(e){super(),e===void 0?this.privFormat=a.AudioStreamFormatImpl.getDefaultInputFormat():this.privFormat=e,this.privEvents=new n.EventSource,this.privId=(0,r.createNoDashGuid)(),this.privStream=new n.ChunkedArrayBufferStream(this.privFormat.avgBytesPerSec/10)}get format(){return Promise.resolve(this.privFormat)}write(e){this.privStream.writeStreamChunk({buffer:e,isEnd:!1,timeReceived:Date.now()})}close(){this.privStream.close()}id(){return this.privId}turnOn(){this.onEvent(new n.AudioSourceInitializingEvent(this.privId)),this.onEvent(new n.AudioSourceReadyEvent(this.privId))}async attach(e){this.onEvent(new n.AudioStreamNodeAttachingEvent(this.privId,e)),await this.turnOn();let t=this.privStream;return this.onEvent(new n.AudioStreamNodeAttachedEvent(this.privId,e)),{detach:async()=>(this.onEvent(new n.AudioStreamNodeDetachedEvent(this.privId,e)),this.turnOff()),id:()=>e,read:()=>t.read()}}detach(e){this.onEvent(new n.AudioStreamNodeDetachedEvent(this.privId,e))}turnOff(){}get events(){return this.privEvents}get deviceInfo(){return Promise.resolve({bitspersample:this.privFormat.bitsPerSample,channelcount:this.privFormat.channels,connectivity:t.connectivity.Unknown,manufacturer:`Speech SDK`,model:`PushStream`,samplerate:this.privFormat.samplesPerSec,type:t.type.Stream})}onEvent(e){this.privEvents.onEvent(e),n.Events.instance.onEvent(e)}toBuffer(e){let t=Buffer.alloc(e.byteLength),n=new Uint8Array(e);for(let e=0;e<t.length;++e)t[e]=n[e];return t}};e.PushAudioInputStreamImpl=c;var l=class extends o{constructor(){super()}static create(e,t){return new u(e,t)}};e.PullAudioInputStream=l;var u=class extends l{constructor(e,t){super(),t===void 0?this.privFormat=i.AudioStreamFormat.getDefaultInputFormat():this.privFormat=t,this.privEvents=new n.EventSource,this.privId=(0,r.createNoDashGuid)(),this.privCallback=e,this.privIsClosed=!1,this.privBufferSize=this.privFormat.avgBytesPerSec/10}get format(){return Promise.resolve(this.privFormat)}close(){this.privIsClosed=!0,this.privCallback.close()}id(){return this.privId}turnOn(){this.onEvent(new n.AudioSourceInitializingEvent(this.privId)),this.onEvent(new n.AudioSourceReadyEvent(this.privId))}async attach(e){return this.onEvent(new n.AudioStreamNodeAttachingEvent(this.privId,e)),await this.turnOn(),this.onEvent(new n.AudioStreamNodeAttachedEvent(this.privId,e)),{detach:()=>(this.privCallback.close(),this.onEvent(new n.AudioStreamNodeDetachedEvent(this.privId,e)),this.turnOff()),id:()=>e,read:()=>{let e=0,t;for(;e<this.privBufferSize;){let n=new ArrayBuffer(this.privBufferSize-e),r=this.privCallback.read(n);if(t===void 0?t=n:new Int8Array(t).set(new Int8Array(n),e),r===0)break;e+=r}return Promise.resolve({buffer:t.slice(0,e),isEnd:this.privIsClosed||e===0,timeReceived:Date.now()})}}}detach(e){this.onEvent(new n.AudioStreamNodeDetachedEvent(this.privId,e))}turnOff(){}get events(){return this.privEvents}get deviceInfo(){return Promise.resolve({bitspersample:this.privFormat.bitsPerSample,channelcount:this.privFormat.channels,connectivity:t.connectivity.Unknown,manufacturer:`Speech SDK`,model:`PullStream`,samplerate:this.privFormat.samplesPerSec,type:t.type.Stream})}onEvent(e){this.privEvents.onEvent(e),n.Events.instance.onEvent(e)}};e.PullAudioInputStreamImpl=u})),Ge=e((e=>{Object.defineProperty(e,`__esModule`,{value:!0}),e.SpeechSynthesisOutputFormat=void 0,(function(e){e[e.Raw8Khz8BitMonoMULaw=0]=`Raw8Khz8BitMonoMULaw`,e[e.Riff16Khz16KbpsMonoSiren=1]=`Riff16Khz16KbpsMonoSiren`,e[e.Audio16Khz16KbpsMonoSiren=2]=`Audio16Khz16KbpsMonoSiren`,e[e.Audio16Khz32KBitRateMonoMp3=3]=`Audio16Khz32KBitRateMonoMp3`,e[e.Audio16Khz128KBitRateMonoMp3=4]=`Audio16Khz128KBitRateMonoMp3`,e[e.Audio16Khz64KBitRateMonoMp3=5]=`Audio16Khz64KBitRateMonoMp3`,e[e.Audio24Khz48KBitRateMonoMp3=6]=`Audio24Khz48KBitRateMonoMp3`,e[e.Audio24Khz96KBitRateMonoMp3=7]=`Audio24Khz96KBitRateMonoMp3`,e[e.Audio24Khz160KBitRateMonoMp3=8]=`Audio24Khz160KBitRateMonoMp3`,e[e.Raw16Khz16BitMonoTrueSilk=9]=`Raw16Khz16BitMonoTrueSilk`,e[e.Riff16Khz16BitMonoPcm=10]=`Riff16Khz16BitMonoPcm`,e[e.Riff8Khz16BitMonoPcm=11]=`Riff8Khz16BitMonoPcm`,e[e.Riff24Khz16BitMonoPcm=12]=`Riff24Khz16BitMonoPcm`,e[e.Riff8Khz8BitMonoMULaw=13]=`Riff8Khz8BitMonoMULaw`,e[e.Raw16Khz16BitMonoPcm=14]=`Raw16Khz16BitMonoPcm`,e[e.Raw24Khz16BitMonoPcm=15]=`Raw24Khz16BitMonoPcm`,e[e.Raw8Khz16BitMonoPcm=16]=`Raw8Khz16BitMonoPcm`,e[e.Ogg16Khz16BitMonoOpus=17]=`Ogg16Khz16BitMonoOpus`,e[e.Ogg24Khz16BitMonoOpus=18]=`Ogg24Khz16BitMonoOpus`,e[e.Raw48Khz16BitMonoPcm=19]=`Raw48Khz16BitMonoPcm`,e[e.Riff48Khz16BitMonoPcm=20]=`Riff48Khz16BitMonoPcm`,e[e.Audio48Khz96KBitRateMonoMp3=21]=`Audio48Khz96KBitRateMonoMp3`,e[e.Audio48Khz192KBitRateMonoMp3=22]=`Audio48Khz192KBitRateMonoMp3`,e[e.Ogg48Khz16BitMonoOpus=23]=`Ogg48Khz16BitMonoOpus`,e[e.Webm16Khz16BitMonoOpus=24]=`Webm16Khz16BitMonoOpus`,e[e.Webm24Khz16BitMonoOpus=25]=`Webm24Khz16BitMonoOpus`,e[e.Raw24Khz16BitMonoTrueSilk=26]=`Raw24Khz16BitMonoTrueSilk`,e[e.Raw8Khz8BitMonoALaw=27]=`Raw8Khz8BitMonoALaw`,e[e.Riff8Khz8BitMonoALaw=28]=`Riff8Khz8BitMonoALaw`,e[e.Webm24Khz16Bit24KbpsMonoOpus=29]=`Webm24Khz16Bit24KbpsMonoOpus`,e[e.Audio16Khz16Bit32KbpsMonoOpus=30]=`Audio16Khz16Bit32KbpsMonoOpus`,e[e.Audio24Khz16Bit48KbpsMonoOpus=31]=`Audio24Khz16Bit48KbpsMonoOpus`,e[e.Audio24Khz16Bit24KbpsMonoOpus=32]=`Audio24Khz16Bit24KbpsMonoOpus`,e[e.Raw22050Hz16BitMonoPcm=33]=`Raw22050Hz16BitMonoPcm`,e[e.Riff22050Hz16BitMonoPcm=34]=`Riff22050Hz16BitMonoPcm`,e[e.Raw44100Hz16BitMonoPcm=35]=`Raw44100Hz16BitMonoPcm`,e[e.Riff44100Hz16BitMonoPcm=36]=`Riff44100Hz16BitMonoPcm`,e[e.AmrWb16000Hz=37]=`AmrWb16000Hz`,e[e.G72216Khz64Kbps=38]=`G72216Khz64Kbps`})(e.SpeechSynthesisOutputFormat||={})})),B=e((e=>{Object.defineProperty(e,`__esModule`,{value:!0}),e.AudioOutputFormatImpl=void 0;var t=Ge(),n=L(),r=class e extends n.AudioStreamFormatImpl{constructor(e,t,n,r,i,a,o,s,c){super(n,a,t,e),this.formatTag=e,this.avgBytesPerSec=r,this.blockAlign=i,this.priAudioFormatString=o,this.priRequestAudioFormatString=s,this.priHasHeader=c}static fromSpeechSynthesisOutputFormat(t){return t===void 0?e.getDefaultOutputFormat():e.fromSpeechSynthesisOutputFormatString(e.SpeechSynthesisOutputFormatToString[t])}static fromSpeechSynthesisOutputFormatString(t){switch(t){case`raw-8khz-8bit-mono-mulaw`:return new e(n.AudioFormatTag.MuLaw,1,8e3,8e3,1,8,t,t,!1);case`riff-16khz-16kbps-mono-siren`:return new e(n.AudioFormatTag.Siren,1,16e3,2e3,40,0,t,`audio-16khz-16kbps-mono-siren`,!0);case`audio-16khz-16kbps-mono-siren`:return new e(n.AudioFormatTag.Siren,1,16e3,2e3,40,0,t,t,!1);case`audio-16khz-32kbitrate-mono-mp3`:return new e(n.AudioFormatTag.MP3,1,16e3,4096,2,16,t,t,!1);case`audio-16khz-128kbitrate-mono-mp3`:return new e(n.AudioFormatTag.MP3,1,16e3,16384,2,16,t,t,!1);case`audio-16khz-64kbitrate-mono-mp3`:return new e(n.AudioFormatTag.MP3,1,16e3,8192,2,16,t,t,!1);case`audio-24khz-48kbitrate-mono-mp3`:return new e(n.AudioFormatTag.MP3,1,24e3,6144,2,16,t,t,!1);case`audio-24khz-96kbitrate-mono-mp3`:return new e(n.AudioFormatTag.MP3,1,24e3,12288,2,16,t,t,!1);case`audio-24khz-160kbitrate-mono-mp3`:return new e(n.AudioFormatTag.MP3,1,24e3,20480,2,16,t,t,!1);case`raw-16khz-16bit-mono-truesilk`:return new e(n.AudioFormatTag.SILKSkype,1,16e3,32e3,2,16,t,t,!1);case`riff-8khz-16bit-mono-pcm`:return new e(n.AudioFormatTag.PCM,1,8e3,16e3,2,16,t,`raw-8khz-16bit-mono-pcm`,!0);case`riff-24khz-16bit-mono-pcm`:return new e(n.AudioFormatTag.PCM,1,24e3,48e3,2,16,t,`raw-24khz-16bit-mono-pcm`,!0);case`riff-8khz-8bit-mono-mulaw`:return new e(n.AudioFormatTag.MuLaw,1,8e3,8e3,1,8,t,`raw-8khz-8bit-mono-mulaw`,!0);case`raw-16khz-16bit-mono-pcm`:return new e(n.AudioFormatTag.PCM,1,16e3,32e3,2,16,t,`raw-16khz-16bit-mono-pcm`,!1);case`raw-24khz-16bit-mono-pcm`:return new e(n.AudioFormatTag.PCM,1,24e3,48e3,2,16,t,`raw-24khz-16bit-mono-pcm`,!1);case`raw-8khz-16bit-mono-pcm`:return new e(n.AudioFormatTag.PCM,1,8e3,16e3,2,16,t,`raw-8khz-16bit-mono-pcm`,!1);case`ogg-16khz-16bit-mono-opus`:return new e(n.AudioFormatTag.OGG_OPUS,1,16e3,8192,2,16,t,t,!1);case`ogg-24khz-16bit-mono-opus`:return new e(n.AudioFormatTag.OGG_OPUS,1,24e3,8192,2,16,t,t,!1);case`raw-48khz-16bit-mono-pcm`:return new e(n.AudioFormatTag.PCM,1,48e3,96e3,2,16,t,`raw-48khz-16bit-mono-pcm`,!1);case`riff-48khz-16bit-mono-pcm`:return new e(n.AudioFormatTag.PCM,1,48e3,96e3,2,16,t,`raw-48khz-16bit-mono-pcm`,!0);case`audio-48khz-96kbitrate-mono-mp3`:return new e(n.AudioFormatTag.MP3,1,48e3,12288,2,16,t,t,!1);case`audio-48khz-192kbitrate-mono-mp3`:return new e(n.AudioFormatTag.MP3,1,48e3,24576,2,16,t,t,!1);case`ogg-48khz-16bit-mono-opus`:return new e(n.AudioFormatTag.OGG_OPUS,1,48e3,12e3,2,16,t,t,!1);case`webm-16khz-16bit-mono-opus`:return new e(n.AudioFormatTag.WEBM_OPUS,1,16e3,4e3,2,16,t,t,!1);case`webm-24khz-16bit-mono-opus`:return new e(n.AudioFormatTag.WEBM_OPUS,1,24e3,6e3,2,16,t,t,!1);case`webm-24khz-16bit-24kbps-mono-opus`:return new e(n.AudioFormatTag.WEBM_OPUS,1,24e3,3e3,2,16,t,t,!1);case`audio-16khz-16bit-32kbps-mono-opus`:return new e(n.AudioFormatTag.OPUS,1,16e3,4e3,2,16,t,t,!1);case`audio-24khz-16bit-48kbps-mono-opus`:return new e(n.AudioFormatTag.OPUS,1,24e3,6e3,2,16,t,t,!1);case`audio-24khz-16bit-24kbps-mono-opus`:return new e(n.AudioFormatTag.OPUS,1,24e3,3e3,2,16,t,t,!1);case`audio-24khz-16bit-mono-flac`:return new e(n.AudioFormatTag.FLAC,1,24e3,24e3,2,16,t,t,!1);case`audio-48khz-16bit-mono-flac`:return new e(n.AudioFormatTag.FLAC,1,48e3,3e4,2,16,t,t,!1);case`raw-24khz-16bit-mono-truesilk`:return new e(n.AudioFormatTag.SILKSkype,1,24e3,48e3,2,16,t,t,!1);case`raw-8khz-8bit-mono-alaw`:return new e(n.AudioFormatTag.ALaw,1,8e3,8e3,1,8,t,t,!1);case`riff-8khz-8bit-mono-alaw`:return new e(n.AudioFormatTag.ALaw,1,8e3,8e3,1,8,t,`raw-8khz-8bit-mono-alaw`,!0);case`raw-22050hz-16bit-mono-pcm`:return new e(n.AudioFormatTag.PCM,1,22050,44100,2,16,t,t,!1);case`riff-22050hz-16bit-mono-pcm`:return new e(n.AudioFormatTag.PCM,1,22050,44100,2,16,t,`raw-22050hz-16bit-mono-pcm`,!0);case`raw-44100hz-16bit-mono-pcm`:return new e(n.AudioFormatTag.PCM,1,44100,88200,2,16,t,t,!1);case`riff-44100hz-16bit-mono-pcm`:return new e(n.AudioFormatTag.PCM,1,44100,88200,2,16,t,`raw-44100hz-16bit-mono-pcm`,!0);case`amr-wb-16000h`:return new e(n.AudioFormatTag.AMR_WB,1,16e3,3052,2,16,t,t,!1);case`g722-16khz-64kbps`:return new e(n.AudioFormatTag.G722,1,16e3,8e3,2,16,t,t,!1);case`riff-16khz-16bit-mono-pcm`:default:return new e(n.AudioFormatTag.PCM,1,16e3,32e3,2,16,`riff-16khz-16bit-mono-pcm`,`raw-16khz-16bit-mono-pcm`,!0)}}static getDefaultOutputFormat(){return e.fromSpeechSynthesisOutputFormatString(typeof window<`u`?`audio-24khz-48kbitrate-mono-mp3`:`riff-16khz-16bit-mono-pcm`)}get hasHeader(){return this.priHasHeader}get header(){if(this.hasHeader)return this.privHeader}updateHeader(e){if(this.priHasHeader){let t=new DataView(this.privHeader);t.setUint32(4,e+this.privHeader.byteLength-8,!0),t.setUint32(40,e,!0)}}get requestAudioFormatString(){return this.priRequestAudioFormatString}addHeader(e){if(!this.hasHeader)return e;this.updateHeader(e.byteLength);let t=new Uint8Array(e.byteLength+this.header.byteLength);return t.set(new Uint8Array(this.header),0),t.set(new Uint8Array(e),this.header.byteLength),t.buffer}};e.AudioOutputFormatImpl=r,r.SpeechSynthesisOutputFormatToString={[t.SpeechSynthesisOutputFormat.Raw8Khz8BitMonoMULaw]:`raw-8khz-8bit-mono-mulaw`,[t.SpeechSynthesisOutputFormat.Riff16Khz16KbpsMonoSiren]:`riff-16khz-16kbps-mono-siren`,[t.SpeechSynthesisOutputFormat.Audio16Khz16KbpsMonoSiren]:`audio-16khz-16kbps-mono-siren`,[t.SpeechSynthesisOutputFormat.Audio16Khz32KBitRateMonoMp3]:`audio-16khz-32kbitrate-mono-mp3`,[t.SpeechSynthesisOutputFormat.Audio16Khz128KBitRateMonoMp3]:`audio-16khz-128kbitrate-mono-mp3`,[t.SpeechSynthesisOutputFormat.Audio16Khz64KBitRateMonoMp3]:`audio-16khz-64kbitrate-mono-mp3`,[t.SpeechSynthesisOutputFormat.Audio24Khz48KBitRateMonoMp3]:`audio-24khz-48kbitrate-mono-mp3`,[t.SpeechSynthesisOutputFormat.Audio24Khz96KBitRateMonoMp3]:`audio-24khz-96kbitrate-mono-mp3`,[t.SpeechSynthesisOutputFormat.Audio24Khz160KBitRateMonoMp3]:`audio-24khz-160kbitrate-mono-mp3`,[t.SpeechSynthesisOutputFormat.Raw16Khz16BitMonoTrueSilk]:`raw-16khz-16bit-mono-truesilk`,[t.SpeechSynthesisOutputFormat.Riff16Khz16BitMonoPcm]:`riff-16khz-16bit-mono-pcm`,[t.SpeechSynthesisOutputFormat.Riff8Khz16BitMonoPcm]:`riff-8khz-16bit-mono-pcm`,[t.SpeechSynthesisOutputFormat.Riff24Khz16BitMonoPcm]:`riff-24khz-16bit-mono-pcm`,[t.SpeechSynthesisOutputFormat.Riff8Khz8BitMonoMULaw]:`riff-8khz-8bit-mono-mulaw`,[t.SpeechSynthesisOutputFormat.Raw16Khz16BitMonoPcm]:`raw-16khz-16bit-mono-pcm`,[t.SpeechSynthesisOutputFormat.Raw24Khz16BitMonoPcm]:`raw-24khz-16bit-mono-pcm`,[t.SpeechSynthesisOutputFormat.Raw8Khz16BitMonoPcm]:`raw-8khz-16bit-mono-pcm`,[t.SpeechSynthesisOutputFormat.Ogg16Khz16BitMonoOpus]:`ogg-16khz-16bit-mono-opus`,[t.SpeechSynthesisOutputFormat.Ogg24Khz16BitMonoOpus]:`ogg-24khz-16bit-mono-opus`,[t.SpeechSynthesisOutputFormat.Raw48Khz16BitMonoPcm]:`raw-48khz-16bit-mono-pcm`,[t.SpeechSynthesisOutputFormat.Riff48Khz16BitMonoPcm]:`riff-48khz-16bit-mono-pcm`,[t.SpeechSynthesisOutputFormat.Audio48Khz96KBitRateMonoMp3]:`audio-48khz-96kbitrate-mono-mp3`,[t.SpeechSynthesisOutputFormat.Audio48Khz192KBitRateMonoMp3]:`audio-48khz-192kbitrate-mono-mp3`,[t.SpeechSynthesisOutputFormat.Ogg48Khz16BitMonoOpus]:`ogg-48khz-16bit-mono-opus`,[t.SpeechSynthesisOutputFormat.Webm16Khz16BitMonoOpus]:`webm-16khz-16bit-mono-opus`,[t.SpeechSynthesisOutputFormat.Webm24Khz16BitMonoOpus]:`webm-24khz-16bit-mono-opus`,[t.SpeechSynthesisOutputFormat.Webm24Khz16Bit24KbpsMonoOpus]:`webm-24khz-16bit-24kbps-mono-opus`,[t.SpeechSynthesisOutputFormat.Raw24Khz16BitMonoTrueSilk]:`raw-24khz-16bit-mono-truesilk`,[t.SpeechSynthesisOutputFormat.Raw8Khz8BitMonoALaw]:`raw-8khz-8bit-mono-alaw`,[t.SpeechSynthesisOutputFormat.Riff8Khz8BitMonoALaw]:`riff-8khz-8bit-mono-alaw`,[t.SpeechSynthesisOutputFormat.Audio16Khz16Bit32KbpsMonoOpus]:`audio-16khz-16bit-32kbps-mono-opus`,[t.SpeechSynthesisOutputFormat.Audio24Khz16Bit48KbpsMonoOpus]:`audio-24khz-16bit-48kbps-mono-opus`,[t.SpeechSynthesisOutputFormat.Audio24Khz16Bit24KbpsMonoOpus]:`audio-24khz-16bit-24kbps-mono-opus`,[t.SpeechSynthesisOutputFormat.Raw22050Hz16BitMonoPcm]:`raw-22050hz-16bit-mono-pcm`,[t.SpeechSynthesisOutputFormat.Riff22050Hz16BitMonoPcm]:`riff-22050hz-16bit-mono-pcm`,[t.SpeechSynthesisOutputFormat.Raw44100Hz16BitMonoPcm]:`raw-44100hz-16bit-mono-pcm`,[t.SpeechSynthesisOutputFormat.Riff44100Hz16BitMonoPcm]:`riff-44100hz-16bit-mono-pcm`,[t.SpeechSynthesisOutputFormat.AmrWb16000Hz]:`amr-wb-16000hz`,[t.SpeechSynthesisOutputFormat.G72216Khz64Kbps]:`g722-16khz-64kbps`}})),V=e((e=>{Object.defineProperty(e,`__esModule`,{value:!0}),e.PushAudioOutputStreamImpl=e.PushAudioOutputStream=e.PullAudioOutputStreamImpl=e.PullAudioOutputStream=e.AudioOutputStream=void 0;var t=j(),n=I(),r=B(),i=class{constructor(){}static createPullStream(){return a.create()}};e.AudioOutputStream=i;var a=class extends i{static create(){return new o}};e.PullAudioOutputStream=a;var o=class extends a{constructor(){super(),this.privId=(0,t.createNoDashGuid)(),this.privStream=new t.Stream}set format(e){e??(this.privFormat=r.AudioOutputFormatImpl.getDefaultOutputFormat()),this.privFormat=e}get format(){return this.privFormat}get isClosed(){return this.privStream.isClosed}id(){return this.privId}async read(e){let t=new Int8Array(e),n=0;if(this.privLastChunkView!==void 0){if(this.privLastChunkView.length>e.byteLength)return t.set(this.privLastChunkView.slice(0,e.byteLength)),this.privLastChunkView=this.privLastChunkView.slice(e.byteLength),Promise.resolve(e.byteLength);t.set(this.privLastChunkView),n=this.privLastChunkView.length,this.privLastChunkView=void 0}for(;n<e.byteLength&&!this.privStream.isReadEnded;){let r=await this.privStream.read();if(r!==void 0&&!r.isEnd){let i;r.buffer.byteLength>e.byteLength-n?(i=r.buffer.slice(0,e.byteLength-n),this.privLastChunkView=new Int8Array(r.buffer.slice(e.byteLength-n))):i=r.buffer,t.set(new Int8Array(i),n),n+=i.byteLength}else this.privStream.readEnded()}return n}write(e){n.Contracts.throwIfNullOrUndefined(this.privStream,`must set format before writing`),this.privStream.writeStreamChunk({buffer:e,isEnd:!1,timeReceived:Date.now()})}close(){this.privStream.close()}};e.PullAudioOutputStreamImpl=o;var s=class extends i{constructor(){super()}static create(e){return new c(e)}};e.PushAudioOutputStream=s;var c=class extends s{constructor(e){super(),this.privId=(0,t.createNoDashGuid)(),this.privCallback=e}set format(e){}write(e){this.privCallback.write&&this.privCallback.write(e)}close(){this.privCallback.close&&this.privCallback.close()}id(){return this.privId}};e.PushAudioOutputStreamImpl=c})),Ke=e((e=>{Object.defineProperty(e,`__esModule`,{value:!0}),e.AudioOutputConfigImpl=e.AudioConfigImpl=e.AudioConfig=void 0;var t=X(),n=I(),r=Y(),i=Ue(),a=We(),o=V(),s=class e{static fromDefaultMicrophoneInput(){let e=new t.PcmRecorder(!0);return new c(new t.MicAudioSource(e))}static fromMicrophoneInput(e){let n=new t.PcmRecorder(!0);return new c(new t.MicAudioSource(n,e))}static fromWavFileInput(e,n=`unnamedBuffer.wav`){return new c(new t.FileAudioSource(e,n))}static fromStreamInput(e){if(e instanceof r.PullAudioInputStreamCallback)return new c(new a.PullAudioInputStreamImpl(e));if(e instanceof r.AudioInputStream)return new c(e);if(typeof MediaStream<`u`&&e instanceof MediaStream){let n=new t.PcmRecorder(!1);return new c(new t.MicAudioSource(n,null,null,e))}throw Error(`Not Supported Type`)}static fromDefaultSpeakerOutput(){return new l(new r.SpeakerAudioDestination)}static fromSpeakerOutput(t){if(t===void 0)return e.fromDefaultSpeakerOutput();if(t instanceof r.SpeakerAudioDestination)return new l(t);throw Error(`Not Supported Type`)}static fromAudioFileOutput(e){return new l(new i.AudioFileWriter(e))}static fromStreamOutput(e){if(e instanceof r.PushAudioOutputStreamCallback)return new l(new o.PushAudioOutputStreamImpl(e));if(e instanceof r.PushAudioOutputStream||e instanceof r.PullAudioOutputStream)return new l(e);throw Error(`Not Supported Type`)}};e.AudioConfig=s;var c=class extends s{constructor(e){super(),this.privSource=e}get format(){return this.privSource.format}close(e,t){this.privSource.turnOff().then(()=>{e&&e()},e=>{t&&t(e)})}id(){return this.privSource.id()}turnOn(){return this.privSource.turnOn()}attach(e){return this.privSource.attach(e)}detach(e){return this.privSource.detach(e)}turnOff(){return this.privSource.turnOff()}get events(){return this.privSource.events}setProperty(e,t){if(n.Contracts.throwIfNull(t,`value`),this.privSource.setProperty!==void 0)this.privSource.setProperty(e,t);else throw Error(`This AudioConfig instance does not support setting properties.`)}getProperty(e,t){if(this.privSource.getProperty!==void 0)return this.privSource.getProperty(e,t);throw Error(`This AudioConfig instance does not support getting properties.`)}get deviceInfo(){return this.privSource.deviceInfo}};e.AudioConfigImpl=c;var l=class extends s{constructor(e){super(),this.privDestination=e}set format(e){this.privDestination.format=e}write(e){this.privDestination.write(e)}close(){this.privDestination.close()}id(){return this.privDestination.id()}setProperty(){throw Error(`This AudioConfig instance does not support setting properties.`)}getProperty(){throw Error(`This AudioConfig instance does not support getting properties.`)}};e.AudioOutputConfigImpl=l})),qe=e((e=>{Object.defineProperty(e,`__esModule`,{value:!0}),e.CancellationReason=void 0,(function(e){e[e.Error=0]=`Error`,e[e.EndOfStream=1]=`EndOfStream`})(e.CancellationReason||={})})),Je=e((e=>{Object.defineProperty(e,`__esModule`,{value:!0}),e.PullAudioInputStreamCallback=void 0,e.PullAudioInputStreamCallback=class{}})),Ye=e((e=>{Object.defineProperty(e,`__esModule`,{value:!0}),e.PushAudioOutputStreamCallback=void 0,e.PushAudioOutputStreamCallback=class{}})),Xe=e((e=>{Object.defineProperty(e,`__esModule`,{value:!0}),e.KeywordRecognitionModel=void 0;var t=I();e.KeywordRecognitionModel=class{constructor(){this.privDisposed=!1}static fromFile(e){throw t.Contracts.throwIfFileDoesNotExist(e,`fileName`),Error(`Not yet implemented.`)}static fromStream(e){throw t.Contracts.throwIfNull(e,`file`),Error(`Not yet implemented.`)}close(){this.privDisposed||=!0}}})),Ze=e((e=>{Object.defineProperty(e,`__esModule`,{value:!0}),e.SessionEventArgs=void 0,e.SessionEventArgs=class{constructor(e){this.privSessionId=e}get sessionId(){return this.privSessionId}}})),Qe=e((e=>{Object.defineProperty(e,`__esModule`,{value:!0}),e.RecognitionEventArgs=void 0;var t=Y();e.RecognitionEventArgs=class extends t.SessionEventArgs{constructor(e,t){super(t),this.privOffset=e}get offset(){return this.privOffset}}})),$e=e((e=>{Object.defineProperty(e,`__esModule`,{value:!0}),e.OutputFormat=void 0,(function(e){e[e.Simple=0]=`Simple`,e[e.Detailed=1]=`Detailed`})(e.OutputFormat||={})})),et=e((e=>{Object.defineProperty(e,`__esModule`,{value:!0}),e.RecognitionResult=void 0,e.RecognitionResult=class{constructor(e,t,n,r,i,a,o,s,c,l){this.privResultId=e,this.privReason=t,this.privText=n,this.privDuration=r,this.privOffset=i,this.privLanguage=a,this.privLanguageDetectionConfidence=o,this.privErrorDetails=s,this.privJson=c,this.privProperties=l}get resultId(){return this.privResultId}get reason(){return this.privReason}get text(){return this.privText}get duration(){return this.privDuration}get offset(){return this.privOffset}get language(){return this.privLanguage}get languageDetectionConfidence(){return this.privLanguageDetectionConfidence}get errorDetails(){return this.privErrorDetails}get json(){return this.privJson}get properties(){return this.privProperties}}})),tt=e((e=>{Object.defineProperty(e,`__esModule`,{value:!0}),e.SpeechRecognitionResult=void 0;var t=Y();e.SpeechRecognitionResult=class extends t.RecognitionResult{constructor(e,t,n,r,i,a,o,s,c,l,u){super(e,t,n,r,i,a,o,c,l,u),this.privSpeakerId=s}get speakerId(){return this.privSpeakerId}}})),nt=e((e=>{Object.defineProperty(e,`__esModule`,{value:!0}),e.MeetingTranscriptionEventArgs=e.ConversationTranscriptionEventArgs=e.SpeechRecognitionEventArgs=void 0;var t=Y(),n=class extends t.RecognitionEventArgs{constructor(e,t,n){super(t,n),this.privResult=e}get result(){return this.privResult}};e.SpeechRecognitionEventArgs=n,e.ConversationTranscriptionEventArgs=class extends t.RecognitionEventArgs{constructor(e,t,n){super(t,n),this.privResult=e}get result(){return this.privResult}},e.MeetingTranscriptionEventArgs=class extends n{}})),H=e((e=>{Object.defineProperty(e,`__esModule`,{value:!0}),e.CancellationEventArgsBase=void 0;var t=Y();e.CancellationEventArgsBase=class extends t.RecognitionEventArgs{constructor(e,t,n,r,i){super(r,i),this.privReason=e,this.privErrorDetails=t,this.privErrorCode=n}get reason(){return this.privReason}get errorCode(){return this.privErrorCode}get errorDetails(){return this.privErrorDetails}}})),rt=e((e=>{Object.defineProperty(e,`__esModule`,{value:!0}),e.SpeechRecognitionCanceledEventArgs=void 0;var t=H();e.SpeechRecognitionCanceledEventArgs=class extends t.CancellationEventArgsBase{}})),it=e((e=>{Object.defineProperty(e,`__esModule`,{value:!0}),e.TranslationRecognitionEventArgs=void 0;var t=Y();e.TranslationRecognitionEventArgs=class extends t.RecognitionEventArgs{constructor(e,t,n){super(t,n),this.privResult=e}get result(){return this.privResult}}})),at=e((e=>{Object.defineProperty(e,`__esModule`,{value:!0}),e.TranslationSynthesisEventArgs=void 0;var t=Y();e.TranslationSynthesisEventArgs=class extends t.SessionEventArgs{constructor(e,t){super(t),this.privResult=e}get result(){return this.privResult}}})),ot=e((e=>{Object.defineProperty(e,`__esModule`,{value:!0}),e.TranslationRecognitionResult=void 0;var t=Y();e.TranslationRecognitionResult=class e extends t.SpeechRecognitionResult{constructor(e,t,n,r,i,a,o,s,c,l,u){super(t,n,r,i,a,o,s,void 0,c,l,u),this.privTranslations=e}static fromSpeechRecognitionResult(t){return new e(void 0,t.resultId,t.reason,t.text,t.duration,t.offset,t.language,t.languageDetectionConfidence,t.errorDetails,t.json,t.properties)}get translations(){return this.privTranslations}}})),st=e((e=>{Object.defineProperty(e,`__esModule`,{value:!0}),e.TranslationSynthesisResult=void 0,e.TranslationSynthesisResult=class{constructor(e,t){this.privReason=e,this.privAudio=t}get audio(){return this.privAudio}get reason(){return this.privReason}}})),ct=e((e=>{Object.defineProperty(e,`__esModule`,{value:!0}),e.ResultReason=void 0,(function(e){e[e.NoMatch=0]=`NoMatch`,e[e.Canceled=1]=`Canceled`,e[e.RecognizingSpeech=2]=`RecognizingSpeech`,e[e.RecognizedSpeech=3]=`RecognizedSpeech`,e[e.RecognizedKeyword=4]=`RecognizedKeyword`,e[e.TranslatingSpeech=5]=`TranslatingSpeech`,e[e.TranslatedSpeech=6]=`TranslatedSpeech`,e[e.SynthesizingAudio=7]=`SynthesizingAudio`,e[e.SynthesizingAudioCompleted=8]=`SynthesizingAudioCompleted`,e[e.SynthesizingAudioStarted=9]=`SynthesizingAudioStarted`,e[e.VoicesListRetrieved=10]=`VoicesListRetrieved`,e[e.TranslatingParticipantSpeech=11]=`TranslatingParticipantSpeech`,e[e.TranslatedParticipantSpeech=12]=`TranslatedParticipantSpeech`,e[e.TranslatedInstantMessage=13]=`TranslatedInstantMessage`,e[e.TranslatedParticipantInstantMessage=14]=`TranslatedParticipantInstantMessage`})(e.ResultReason||={})})),lt=e((e=>{Object.defineProperty(e,`__esModule`,{value:!0}),e.SpeechConfigImpl=e.SpeechConfig=void 0;var t=$(),n=I(),r=Y(),i=class{constructor(){}static fromSubscription(e,t){n.Contracts.throwIfNullOrWhitespace(e,`subscriptionKey`),n.Contracts.throwIfNullOrWhitespace(t,`region`);let i=new a;return i.setProperty(r.PropertyId.SpeechServiceConnection_Region,t),i.setProperty(r.PropertyId.SpeechServiceConnection_Key,e),i}static fromEndpoint(e,t){n.Contracts.throwIfNull(e,`endpoint`);let i=typeof t==`string`&&t.trim().length>0,o=typeof t==`object`&&!!t&&typeof t.getToken==`function`,s=typeof t==`object`&&!!t&&typeof t.key==`string`;if(t!==void 0&&!i&&!o&&!s)throw Error(`Invalid 'auth' parameter: expected a non-empty API key string, a TokenCredential, or a KeyCredential.`);let c;return typeof t==`string`?(c=new a,c.setProperty(r.PropertyId.SpeechServiceConnection_Key,t)):typeof t==`object`&&typeof t.getToken==`function`?c=new a(t):typeof t==`object`&&typeof t.key==`string`?(c=new a,c.setProperty(r.PropertyId.SpeechServiceConnection_Key,t.key)):c=new a,c.setProperty(r.PropertyId.SpeechServiceConnection_Endpoint,e.href),c}static fromHost(e,t){n.Contracts.throwIfNull(e,`hostName`);let i=new a;return i.setProperty(r.PropertyId.SpeechServiceConnection_Host,e.protocol+`//`+e.hostname+(e.port===``?``:`:`+e.port)),i.setProperty(r.PropertyId.SpeechServiceConnection_RecognitionEndpointVersion,`1`),t!==void 0&&i.setProperty(r.PropertyId.SpeechServiceConnection_Key,t),i}static fromAuthorizationToken(e,t){n.Contracts.throwIfNull(e,`authorizationToken`),n.Contracts.throwIfNullOrWhitespace(t,`region`);let i=new a;return i.setProperty(r.PropertyId.SpeechServiceConnection_Region,t),i.authorizationToken=e,i}close(){}};e.SpeechConfig=i;var a=class e extends i{constructor(e){super(),this.privProperties=new r.PropertyCollection,this.speechRecognitionLanguage=`en-US`,this.outputFormat=r.OutputFormat.Simple,this.privTokenCredential=e}get properties(){return this.privProperties}get endPoint(){return new URL(this.privProperties.getProperty(r.PropertyId.SpeechServiceConnection_Endpoint))}get subscriptionKey(){return this.privProperties.getProperty(r.PropertyId.SpeechServiceConnection_Key)}get region(){return this.privProperties.getProperty(r.PropertyId.SpeechServiceConnection_Region)}get authorizationToken(){return this.privProperties.getProperty(r.PropertyId.SpeechServiceAuthorization_Token)}set authorizationToken(e){this.privProperties.setProperty(r.PropertyId.SpeechServiceAuthorization_Token,e)}get speechRecognitionLanguage(){return this.privProperties.getProperty(r.PropertyId.SpeechServiceConnection_RecoLanguage)}set speechRecognitionLanguage(e){this.privProperties.setProperty(r.PropertyId.SpeechServiceConnection_RecoLanguage,e)}get autoDetectSourceLanguages(){return this.privProperties.getProperty(r.PropertyId.SpeechServiceConnection_AutoDetectSourceLanguages)}set autoDetectSourceLanguages(e){this.privProperties.setProperty(r.PropertyId.SpeechServiceConnection_AutoDetectSourceLanguages,e)}get outputFormat(){return r.OutputFormat[this.privProperties.getProperty(t.OutputFormatPropertyName,void 0)]}set outputFormat(e){this.privProperties.setProperty(t.OutputFormatPropertyName,r.OutputFormat[e])}get endpointId(){return this.privProperties.getProperty(r.PropertyId.SpeechServiceConnection_EndpointId)}set endpointId(e){this.privProperties.setProperty(r.PropertyId.SpeechServiceConnection_EndpointId,e)}get tokenCredential(){return this.privTokenCredential}setProperty(e,t){n.Contracts.throwIfNull(t,`value`),this.privProperties.setProperty(e,t)}getProperty(e,t){return this.privProperties.getProperty(e,t)}setProxy(e,t,n,i){this.setProperty(r.PropertyId[r.PropertyId.SpeechServiceConnection_ProxyHostName],e),this.setProperty(r.PropertyId[r.PropertyId.SpeechServiceConnection_ProxyPort],t),this.setProperty(r.PropertyId[r.PropertyId.SpeechServiceConnection_ProxyUserName],n),this.setProperty(r.PropertyId[r.PropertyId.SpeechServiceConnection_ProxyPassword],i)}setServiceProperty(e,n){let r=JSON.parse(this.privProperties.getProperty(t.ServicePropertiesPropertyName,`{}`));r[e]=n,this.privProperties.setProperty(t.ServicePropertiesPropertyName,JSON.stringify(r))}setProfanity(e){this.privProperties.setProperty(r.PropertyId.SpeechServiceResponse_ProfanityOption,r.ProfanityOption[e])}enableAudioLogging(){this.privProperties.setProperty(r.PropertyId.SpeechServiceConnection_EnableAudioLogging,`true`)}requestWordLevelTimestamps(){this.privProperties.setProperty(r.PropertyId.SpeechServiceResponse_RequestWordLevelTimestamps,`true`),this.privProperties.setProperty(t.OutputFormatPropertyName,r.OutputFormat[r.OutputFormat.Detailed])}enableDictation(){this.privProperties.setProperty(t.ForceDictationPropertyName,`true`)}clone(){let t=new e(this.tokenCredential);return t.privProperties=this.privProperties.clone(),t}get speechSynthesisLanguage(){return this.privProperties.getProperty(r.PropertyId.SpeechServiceConnection_SynthLanguage)}set speechSynthesisLanguage(e){this.privProperties.setProperty(r.PropertyId.SpeechServiceConnection_SynthLanguage,e)}get speechSynthesisVoiceName(){return this.privProperties.getProperty(r.PropertyId.SpeechServiceConnection_SynthVoice)}set speechSynthesisVoiceName(e){this.privProperties.setProperty(r.PropertyId.SpeechServiceConnection_SynthVoice,e)}get speechSynthesisOutputFormat(){return r.SpeechSynthesisOutputFormat[this.privProperties.getProperty(r.PropertyId.SpeechServiceConnection_SynthOutputFormat,void 0)]}set speechSynthesisOutputFormat(e){this.privProperties.setProperty(r.PropertyId.SpeechServiceConnection_SynthOutputFormat,r.SpeechSynthesisOutputFormat[e])}};e.SpeechConfigImpl=a})),ut=e((e=>{Object.defineProperty(e,`__esModule`,{value:!0}),e.SpeechTranslationConfigImpl=e.SpeechTranslationConfig=void 0;var t=$(),n=I(),r=Y(),i=class extends r.SpeechConfig{constructor(){super()}static fromSubscription(e,t){n.Contracts.throwIfNullOrWhitespace(e,`subscriptionKey`),n.Contracts.throwIfNullOrWhitespace(t,`region`);let i=new a;return i.properties.setProperty(r.PropertyId.SpeechServiceConnection_Key,e),i.properties.setProperty(r.PropertyId.SpeechServiceConnection_Region,t),i}static fromAuthorizationToken(e,t){n.Contracts.throwIfNullOrWhitespace(e,`authorizationToken`),n.Contracts.throwIfNullOrWhitespace(t,`region`);let i=new a;return i.properties.setProperty(r.PropertyId.SpeechServiceAuthorization_Token,e),i.properties.setProperty(r.PropertyId.SpeechServiceConnection_Region,t),i}static fromHost(e,t){n.Contracts.throwIfNull(e,`hostName`);let i=new a;return i.setProperty(r.PropertyId.SpeechServiceConnection_Host,e.protocol+`//`+e.hostname+(e.port===``?``:`:`+e.port)),t!==void 0&&i.setProperty(r.PropertyId.SpeechServiceConnection_Key,t),i}static fromEndpoint(e,t){n.Contracts.throwIfNull(e,`endpoint`);let i=typeof t==`string`&&t.trim().length>0,o=typeof t==`object`&&!!t&&typeof t.getToken==`function`,s=typeof t==`object`&&!!t&&typeof t.key==`string`;if(t!==void 0&&!i&&!o&&!s)throw Error(`Invalid 'auth' parameter: expected a non-empty API key string, a TokenCredential, or a KeyCredential.`);let c;return typeof t==`string`?(c=new a,c.setProperty(r.PropertyId.SpeechServiceConnection_Key,t)):typeof t==`object`&&typeof t.getToken==`function`?c=new a(t):typeof t==`object`&&typeof t.key==`string`?(c=new a,c.setProperty(r.PropertyId.SpeechServiceConnection_Key,t.key)):c=new a,c.setProperty(r.PropertyId.SpeechServiceConnection_Endpoint,e.href),c}};e.SpeechTranslationConfig=i;var a=class extends i{constructor(e){super(),this.privSpeechProperties=new r.PropertyCollection,this.outputFormat=r.OutputFormat.Simple,this.privTokenCredential=e}set authorizationToken(e){n.Contracts.throwIfNullOrWhitespace(e,`value`),this.privSpeechProperties.setProperty(r.PropertyId.SpeechServiceAuthorization_Token,e)}set speechRecognitionLanguage(e){n.Contracts.throwIfNullOrWhitespace(e,`value`),this.privSpeechProperties.setProperty(r.PropertyId.SpeechServiceConnection_RecoLanguage,e)}get speechRecognitionLanguage(){return this.privSpeechProperties.getProperty(r.PropertyId[r.PropertyId.SpeechServiceConnection_RecoLanguage])}get subscriptionKey(){return this.privSpeechProperties.getProperty(r.PropertyId[r.PropertyId.SpeechServiceConnection_Key])}get outputFormat(){return r.OutputFormat[this.privSpeechProperties.getProperty(t.OutputFormatPropertyName,void 0)]}set outputFormat(e){this.privSpeechProperties.setProperty(t.OutputFormatPropertyName,r.OutputFormat[e])}get endpointId(){return this.privSpeechProperties.getProperty(r.PropertyId.SpeechServiceConnection_EndpointId)}set endpointId(e){this.privSpeechProperties.setProperty(r.PropertyId.SpeechServiceConnection_EndpointId,e)}addTargetLanguage(e){n.Contracts.throwIfNullOrWhitespace(e,`value`);let t=this.targetLanguages;t.includes(e)||(t.push(e),this.privSpeechProperties.setProperty(r.PropertyId.SpeechServiceConnection_TranslationToLanguages,t.join(`,`)))}get targetLanguages(){return this.privSpeechProperties.getProperty(r.PropertyId.SpeechServiceConnection_TranslationToLanguages,void 0)===void 0?[]:this.privSpeechProperties.getProperty(r.PropertyId.SpeechServiceConnection_TranslationToLanguages).split(`,`)}get voiceName(){return this.getProperty(r.PropertyId[r.PropertyId.SpeechServiceConnection_TranslationVoice])}set voiceName(e){n.Contracts.throwIfNullOrWhitespace(e,`value`),this.privSpeechProperties.setProperty(r.PropertyId.SpeechServiceConnection_TranslationVoice,e)}get region(){return this.privSpeechProperties.getProperty(r.PropertyId.SpeechServiceConnection_Region)}get tokenCredential(){return this.privTokenCredential}setProxy(e,t,n,i){this.setProperty(r.PropertyId[r.PropertyId.SpeechServiceConnection_ProxyHostName],e),this.setProperty(r.PropertyId[r.PropertyId.SpeechServiceConnection_ProxyPort],t),this.setProperty(r.PropertyId[r.PropertyId.SpeechServiceConnection_ProxyUserName],n),this.setProperty(r.PropertyId[r.PropertyId.SpeechServiceConnection_ProxyPassword],i)}getProperty(e,t){return this.privSpeechProperties.getProperty(e,t)}setProperty(e,t){this.privSpeechProperties.setProperty(e,t)}get properties(){return this.privSpeechProperties}close(){}setServiceProperty(e,n){let r=JSON.parse(this.privSpeechProperties.getProperty(t.ServicePropertiesPropertyName,`{}`));r[e]=n,this.privSpeechProperties.setProperty(t.ServicePropertiesPropertyName,JSON.stringify(r))}setProfanity(e){this.privSpeechProperties.setProperty(r.PropertyId.SpeechServiceResponse_ProfanityOption,r.ProfanityOption[e])}enableAudioLogging(){this.privSpeechProperties.setProperty(r.PropertyId.SpeechServiceConnection_EnableAudioLogging,`true`)}requestWordLevelTimestamps(){this.privSpeechProperties.setProperty(r.PropertyId.SpeechServiceResponse_RequestWordLevelTimestamps,`true`)}enableDictation(){this.privSpeechProperties.setProperty(t.ForceDictationPropertyName,`true`)}get speechSynthesisLanguage(){return this.privSpeechProperties.getProperty(r.PropertyId.SpeechServiceConnection_SynthLanguage)}set speechSynthesisLanguage(e){this.privSpeechProperties.setProperty(r.PropertyId.SpeechServiceConnection_SynthLanguage,e)}get speechSynthesisVoiceName(){return this.privSpeechProperties.getProperty(r.PropertyId.SpeechServiceConnection_SynthVoice)}set speechSynthesisVoiceName(e){this.privSpeechProperties.setProperty(r.PropertyId.SpeechServiceConnection_SynthVoice,e)}get speechSynthesisOutputFormat(){return r.SpeechSynthesisOutputFormat[this.privSpeechProperties.getProperty(r.PropertyId.SpeechServiceConnection_SynthOutputFormat,void 0)]}set speechSynthesisOutputFormat(e){this.privSpeechProperties.setProperty(r.PropertyId.SpeechServiceConnection_SynthOutputFormat,r.SpeechSynthesisOutputFormat[e])}};e.SpeechTranslationConfigImpl=a})),dt=e((e=>{Object.defineProperty(e,`__esModule`,{value:!0}),e.PropertyCollection=void 0;var t=Y();e.PropertyCollection=class e{constructor(){this.privKeys=[],this.privValues=[]}getProperty(e,n){let r;r=typeof e==`string`?e:t.PropertyId[e];for(let e=0;e<this.privKeys.length;e++)if(this.privKeys[e]===r)return this.privValues[e];if(n!==void 0)return String(n)}setProperty(e,n){let r;r=typeof e==`string`?e:t.PropertyId[e];for(let e=0;e<this.privKeys.length;e++)if(this.privKeys[e]===r){this.privValues[e]=n;return}this.privKeys.push(r),this.privValues.push(n)}clone(){let t=new e;for(let e=0;e<this.privKeys.length;e++)t.privKeys.push(this.privKeys[e]),t.privValues.push(this.privValues[e]);return t}mergeTo(e){this.privKeys.forEach(t=>{if(e.getProperty(t,void 0)===void 0){let n=this.getProperty(t);e.setProperty(t,n)}})}get keys(){return this.privKeys}}})),ft=e((e=>{Object.defineProperty(e,`__esModule`,{value:!0}),e.PropertyId=void 0,(function(e){e[e.SpeechServiceConnection_Key=0]=`SpeechServiceConnection_Key`,e[e.SpeechServiceConnection_Endpoint=1]=`SpeechServiceConnection_Endpoint`,e[e.SpeechServiceConnection_Region=2]=`SpeechServiceConnection_Region`,e[e.SpeechServiceAuthorization_Token=3]=`SpeechServiceAuthorization_Token`,e[e.SpeechServiceAuthorization_Type=4]=`SpeechServiceAuthorization_Type`,e[e.SpeechServiceConnection_EndpointId=5]=`SpeechServiceConnection_EndpointId`,e[e.SpeechServiceConnection_TranslationToLanguages=6]=`SpeechServiceConnection_TranslationToLanguages`,e[e.SpeechServiceConnection_TranslationVoice=7]=`SpeechServiceConnection_TranslationVoice`,e[e.SpeechServiceConnection_TranslationFeatures=8]=`SpeechServiceConnection_TranslationFeatures`,e[e.SpeechServiceConnection_TranslationCategoryId=9]=`SpeechServiceConnection_TranslationCategoryId`,e[e.SpeechServiceConnection_ProxyHostName=10]=`SpeechServiceConnection_ProxyHostName`,e[e.SpeechServiceConnection_ProxyPort=11]=`SpeechServiceConnection_ProxyPort`,e[e.SpeechServiceConnection_ProxyUserName=12]=`SpeechServiceConnection_ProxyUserName`,e[e.SpeechServiceConnection_ProxyPassword=13]=`SpeechServiceConnection_ProxyPassword`,e[e.SpeechServiceConnection_RecoMode=14]=`SpeechServiceConnection_RecoMode`,e[e.SpeechServiceConnection_RecoLanguage=15]=`SpeechServiceConnection_RecoLanguage`,e[e.Speech_SessionId=16]=`Speech_SessionId`,e[e.SpeechServiceConnection_SynthLanguage=17]=`SpeechServiceConnection_SynthLanguage`,e[e.SpeechServiceConnection_SynthVoice=18]=`SpeechServiceConnection_SynthVoice`,e[e.SpeechServiceConnection_SynthOutputFormat=19]=`SpeechServiceConnection_SynthOutputFormat`,e[e.SpeechServiceConnection_AutoDetectSourceLanguages=20]=`SpeechServiceConnection_AutoDetectSourceLanguages`,e[e.SpeechServiceResponse_RequestDetailedResultTrueFalse=21]=`SpeechServiceResponse_RequestDetailedResultTrueFalse`,e[e.SpeechServiceResponse_RequestProfanityFilterTrueFalse=22]=`SpeechServiceResponse_RequestProfanityFilterTrueFalse`,e[e.SpeechServiceResponse_JsonResult=23]=`SpeechServiceResponse_JsonResult`,e[e.SpeechServiceResponse_JsonErrorDetails=24]=`SpeechServiceResponse_JsonErrorDetails`,e[e.CancellationDetails_Reason=25]=`CancellationDetails_Reason`,e[e.CancellationDetails_ReasonText=26]=`CancellationDetails_ReasonText`,e[e.CancellationDetails_ReasonDetailedText=27]=`CancellationDetails_ReasonDetailedText`,e[e.SpeechServiceConnection_Url=28]=`SpeechServiceConnection_Url`,e[e.SpeechServiceConnection_InitialSilenceTimeoutMs=29]=`SpeechServiceConnection_InitialSilenceTimeoutMs`,e[e.SpeechServiceConnection_EndSilenceTimeoutMs=30]=`SpeechServiceConnection_EndSilenceTimeoutMs`,e[e.Speech_SegmentationSilenceTimeoutMs=31]=`Speech_SegmentationSilenceTimeoutMs`,e[e.Speech_SegmentationMaximumTimeMs=32]=`Speech_SegmentationMaximumTimeMs`,e[e.Speech_SegmentationStrategy=33]=`Speech_SegmentationStrategy`,e[e.Speech_StartEventSensitivity=34]=`Speech_StartEventSensitivity`,e[e.SpeechServiceConnection_EnableAudioLogging=35]=`SpeechServiceConnection_EnableAudioLogging`,e[e.SpeechServiceConnection_LanguageIdMode=36]=`SpeechServiceConnection_LanguageIdMode`,e[e.SpeechServiceConnection_RecognitionEndpointVersion=37]=`SpeechServiceConnection_RecognitionEndpointVersion`,e[e.SpeechServiceResponse_ProfanityOption=38]=`SpeechServiceResponse_ProfanityOption`,e[e.SpeechServiceResponse_PostProcessingOption=39]=`SpeechServiceResponse_PostProcessingOption`,e[e.SpeechServiceResponse_RequestWordLevelTimestamps=40]=`SpeechServiceResponse_RequestWordLevelTimestamps`,e[e.SpeechServiceResponse_StablePartialResultThreshold=41]=`SpeechServiceResponse_StablePartialResultThreshold`,e[e.SpeechServiceResponse_OutputFormatOption=42]=`SpeechServiceResponse_OutputFormatOption`,e[e.SpeechServiceResponse_TranslationRequestStablePartialResult=43]=`SpeechServiceResponse_TranslationRequestStablePartialResult`,e[e.SpeechServiceResponse_RequestWordBoundary=44]=`SpeechServiceResponse_RequestWordBoundary`,e[e.SpeechServiceResponse_RequestPunctuationBoundary=45]=`SpeechServiceResponse_RequestPunctuationBoundary`,e[e.SpeechServiceResponse_RequestSentenceBoundary=46]=`SpeechServiceResponse_RequestSentenceBoundary`,e[e.SpeechServiceResponse_DiarizeIntermediateResults=47]=`SpeechServiceResponse_DiarizeIntermediateResults`,e[e.Conversation_ApplicationId=48]=`Conversation_ApplicationId`,e[e.Conversation_DialogType=49]=`Conversation_DialogType`,e[e.Conversation_Initial_Silence_Timeout=50]=`Conversation_Initial_Silence_Timeout`,e[e.Conversation_From_Id=51]=`Conversation_From_Id`,e[e.Conversation_Conversation_Id=52]=`Conversation_Conversation_Id`,e[e.Conversation_Custom_Voice_Deployment_Ids=53]=`Conversation_Custom_Voice_Deployment_Ids`,e[e.Conversation_Speech_Activity_Template=54]=`Conversation_Speech_Activity_Template`,e[e.Conversation_Request_Bot_Status_Messages=55]=`Conversation_Request_Bot_Status_Messages`,e[e.Conversation_Agent_Connection_Id=56]=`Conversation_Agent_Connection_Id`,e[e.SpeechServiceConnection_Host=57]=`SpeechServiceConnection_Host`,e[e.ConversationTranslator_Host=58]=`ConversationTranslator_Host`,e[e.ConversationTranslator_Name=59]=`ConversationTranslator_Name`,e[e.ConversationTranslator_CorrelationId=60]=`ConversationTranslator_CorrelationId`,e[e.ConversationTranslator_Token=61]=`ConversationTranslator_Token`,e[e.PronunciationAssessment_ReferenceText=62]=`PronunciationAssessment_ReferenceText`,e[e.PronunciationAssessment_GradingSystem=63]=`PronunciationAssessment_GradingSystem`,e[e.PronunciationAssessment_Granularity=64]=`PronunciationAssessment_Granularity`,e[e.PronunciationAssessment_EnableMiscue=65]=`PronunciationAssessment_EnableMiscue`,e[e.PronunciationAssessment_Json=66]=`PronunciationAssessment_Json`,e[e.PronunciationAssessment_Params=67]=`PronunciationAssessment_Params`,e[e.WebWorkerLoadType=68]=`WebWorkerLoadType`,e[e.TalkingAvatarService_WebRTC_SDP=69]=`TalkingAvatarService_WebRTC_SDP`})(e.PropertyId||={})})),pt=e((e=>{Object.defineProperty(e,`__esModule`,{value:!0}),e.Recognizer=void 0;var t=$(),n=j(),r=I(),i=Y();e.Recognizer=class e{constructor(e,t,n,r){this.audioConfig=e===void 0?i.AudioConfig.fromDefaultMicrophoneInput():e,this.privDisposed=!1,this.privProperties=t.clone(),this.privConnectionFactory=n,this.tokenCredential=r,this.implCommonRecognizerSetup()}close(e,t){r.Contracts.throwIfDisposed(this.privDisposed),(0,n.marshalPromiseToCallbacks)(this.dispose(!0),e,t)}get internalData(){return this.privReco}async dispose(e){this.privDisposed||(this.privDisposed=!0,e&&this.privReco&&(await this.privReco.audioSource.turnOff(),await this.privReco.dispose()))}static get telemetryEnabled(){return t.ServiceRecognizerBase.telemetryDataEnabled}static enableTelemetry(e){t.ServiceRecognizerBase.telemetryDataEnabled=e}implCommonRecognizerSetup(){let n=typeof window<`u`?`Browser`:`Node`,r=`unknown`,i=`unknown`;typeof navigator<`u`&&(n=n+`/`+navigator.platform,r=navigator.userAgent,i=navigator.appVersion);let a=this.createRecognizerConfig(new t.SpeechServiceConfig(new t.Context(new t.OS(n,r,i))));this.privReco=this.createServiceRecognizer(e.getAuth(this.privProperties,this.tokenCredential),this.privConnectionFactory,this.audioConfig,a)}async recognizeOnceAsyncImpl(e){r.Contracts.throwIfDisposed(this.privDisposed);let t=new n.Deferred;await this.implRecognizerStop(),await this.privReco.recognize(e,t.resolve,t.reject);let i=await t.promise;return await this.implRecognizerStop(),i}async startContinuousRecognitionAsyncImpl(e){r.Contracts.throwIfDisposed(this.privDisposed),await this.implRecognizerStop(),await this.privReco.recognize(e,void 0,void 0)}async stopContinuousRecognitionAsyncImpl(){r.Contracts.throwIfDisposed(this.privDisposed),await this.implRecognizerStop()}async implRecognizerStop(){this.privReco&&await this.privReco.stopRecognizing()}static getAuth(e,n){let r=e.getProperty(i.PropertyId.SpeechServiceConnection_Key,void 0);return r&&r!==``?new t.CognitiveSubscriptionKeyAuthentication(r):n?new t.CognitiveTokenAuthentication(async()=>{try{return(await n.getToken(`https://cognitiveservices.azure.com/.default`))?.token??``}catch(e){throw e}},async()=>{try{return(await n.getToken(`https://cognitiveservices.azure.com/.default`))?.token??``}catch(e){throw e}}):new t.CognitiveTokenAuthentication(()=>{let t=e.getProperty(i.PropertyId.SpeechServiceAuthorization_Token,void 0);return Promise.resolve(t)},()=>{let t=e.getProperty(i.PropertyId.SpeechServiceAuthorization_Token,void 0);return Promise.resolve(t)})}}})),U=e((e=>{Object.defineProperty(e,`__esModule`,{value:!0}),e.SpeechStartEventSensitivity=e.RecognitionMode=void 0,(function(e){e.Interactive=`Interactive`,e.Dictation=`Dictation`,e.Conversation=`Conversation`,e.None=`None`})(e.RecognitionMode||={}),(function(e){e.Low=`low`,e.Medium=`medium`,e.High=`high`})(e.SpeechStartEventSensitivity||={})})),mt=e((e=>{Object.defineProperty(e,`__esModule`,{value:!0}),e.SpeechRecognizer=void 0;var t=$(),n=U(),r=j(),i=I(),a=Y();e.SpeechRecognizer=class e extends a.Recognizer{constructor(e,n){let r=e;i.Contracts.throwIfNull(r,`speechConfig`),i.Contracts.throwIfNullOrWhitespace(r.properties.getProperty(a.PropertyId.SpeechServiceConnection_RecoLanguage),a.PropertyId[a.PropertyId.SpeechServiceConnection_RecoLanguage]),super(n,r.properties,new t.SpeechConnectionFactory,e.tokenCredential),this.privDisposedRecognizer=!1}static FromConfig(t,n,r){let i=t;return n.properties.mergeTo(i.properties),new e(t,r)}get endpointId(){return i.Contracts.throwIfDisposed(this.privDisposedRecognizer),this.properties.getProperty(a.PropertyId.SpeechServiceConnection_EndpointId,`00000000-0000-0000-0000-000000000000`)}get authorizationToken(){return this.properties.getProperty(a.PropertyId.SpeechServiceAuthorization_Token)}set authorizationToken(e){i.Contracts.throwIfNullOrWhitespace(e,`token`),this.properties.setProperty(a.PropertyId.SpeechServiceAuthorization_Token,e)}get speechRecognitionLanguage(){return i.Contracts.throwIfDisposed(this.privDisposedRecognizer),this.properties.getProperty(a.PropertyId.SpeechServiceConnection_RecoLanguage)}get outputFormat(){return i.Contracts.throwIfDisposed(this.privDisposedRecognizer),this.properties.getProperty(t.OutputFormatPropertyName,a.OutputFormat[a.OutputFormat.Simple])===a.OutputFormat[a.OutputFormat.Simple]?a.OutputFormat.Simple:a.OutputFormat.Detailed}get properties(){return this.privProperties}recognizeOnceAsync(e,t){(0,r.marshalPromiseToCallbacks)(this.recognizeOnceAsyncImpl(n.RecognitionMode.Interactive),e,t)}startContinuousRecognitionAsync(e,i){(0,r.marshalPromiseToCallbacks)(this.startContinuousRecognitionAsyncImpl(this.properties.getProperty(t.ForceDictationPropertyName,void 0)===void 0?n.RecognitionMode.Conversation:n.RecognitionMode.Dictation),e,i)}stopContinuousRecognitionAsync(e,t){(0,r.marshalPromiseToCallbacks)(this.stopContinuousRecognitionAsyncImpl(),e,t)}startKeywordRecognitionAsync(e,t,n){i.Contracts.throwIfNull(e,`model`),n&&n(`Not yet implemented.`)}stopKeywordRecognitionAsync(e){e&&e()}close(e,t){i.Contracts.throwIfDisposed(this.privDisposedRecognizer),(0,r.marshalPromiseToCallbacks)(this.dispose(!0),e,t)}async dispose(e){this.privDisposedRecognizer||(e&&(this.privDisposedRecognizer=!0,await this.implRecognizerStop()),await super.dispose(e))}createRecognizerConfig(e){return new t.RecognizerConfig(e,this.privProperties)}createServiceRecognizer(e,n,r,i){let a=r;return new t.SpeechServiceRecognizer(e,n,a,i,this)}}})),ht=e((e=>{Object.defineProperty(e,`__esModule`,{value:!0}),e.ConnectionMessageImpl=e.ConnectionMessage=void 0;var t=M(),n=j(),r=dt(),i=ft();e.ConnectionMessage=class{},e.ConnectionMessageImpl=class{constructor(e){this.privConnectionMessage=e,this.privProperties=new r.PropertyCollection,this.privConnectionMessage.headers[t.HeaderNames.ConnectionId]&&this.privProperties.setProperty(i.PropertyId.Speech_SessionId,this.privConnectionMessage.headers[t.HeaderNames.ConnectionId]),Object.keys(this.privConnectionMessage.headers).forEach(e=>{this.privProperties.setProperty(e,this.privConnectionMessage.headers[e])})}get path(){return this.privConnectionMessage.headers[Object.keys(this.privConnectionMessage.headers).find(e=>e.toLowerCase()===`path`)]}get isTextMessage(){return this.privConnectionMessage.messageType===n.MessageType.Text}get isBinaryMessage(){return this.privConnectionMessage.messageType===n.MessageType.Binary}get TextMessage(){return this.privConnectionMessage.textBody}get binaryMessage(){return this.privConnectionMessage.binaryBody}get properties(){return this.privProperties}toString(){return``}}})),gt=e((e=>{Object.defineProperty(e,`__esModule`,{value:!0}),e.Connection=void 0;var t=$(),n=j(),r=ht(),i=I(),a=Y();e.Connection=class e{static fromRecognizer(t){let n=t.internalData,r=new e;return r.privInternalData=n,r.setupEvents(),r}static fromSynthesizer(t){let n=t.internalData,r=new e;return r.privInternalData=n,r.setupEvents(),r}openConnection(e,t){(0,n.marshalPromiseToCallbacks)(this.privInternalData.connect(),e,t)}closeConnection(e,r){if(this.privInternalData instanceof t.SynthesisAdapterBase)throw Error(`Disconnecting a synthesizer's connection is currently not supported`);(0,n.marshalPromiseToCallbacks)(this.privInternalData.disconnect(),e,r)}setMessageProperty(e,n,r){if(i.Contracts.throwIfNullOrWhitespace(n,`propertyName`),this.privInternalData instanceof t.ServiceRecognizerBase){if(e.toLowerCase()!==`speech.context`)throw Error(`Only speech.context message property sets are currently supported for recognizer`);{let e=this.privInternalData.speechContext.getContext();e[n]=r}}else if(this.privInternalData instanceof t.SynthesisAdapterBase){if(e.toLowerCase()!==`speech.config`&&e.toLowerCase()!==`synthesis.context`)throw Error(`Only speech.config and synthesis.context message paths are currently supported for synthesizer`);if(e.toLowerCase()===`speech.config`){if(n.toLowerCase()!==`context`)throw Error(`Only context property is currently supported for speech.config message path for synthesizer`);this.privInternalData.synthesizerConfig.setContextFromJson(r)}else this.privInternalData.synthesisContext.setSection(n,r)}}sendMessageAsync(e,t,r,i){(0,n.marshalPromiseToCallbacks)(this.privInternalData.sendNetworkMessage(e,t),r,i)}close(){}setupEvents(){this.privEventListener=this.privInternalData.connectionEvents.attach(e=>{e.name===`ConnectionEstablishedEvent`?this.connected&&this.connected(new a.ConnectionEventArgs(e.connectionId)):e.name===`ConnectionClosedEvent`?this.disconnected&&this.disconnected(new a.ConnectionEventArgs(e.connectionId)):e.name===`ConnectionMessageSentEvent`?this.messageSent&&this.messageSent(new a.ConnectionMessageEventArgs(new r.ConnectionMessageImpl(e.message))):e.name===`ConnectionMessageReceivedEvent`&&this.messageReceived&&this.messageReceived(new a.ConnectionMessageEventArgs(new r.ConnectionMessageImpl(e.message)))}),this.privServiceEventListener=this.privInternalData.serviceEvents.attach(e=>{this.receivedServiceMessage&&this.receivedServiceMessage(new a.ServiceEventArgs(e.jsonString,e.name))})}}})),_t=e((e=>{Object.defineProperty(e,`__esModule`,{value:!0}),e.TranslationRecognizer=void 0;var t=$(),n=U(),r=j(),i=gt(),a=I(),o=Y();e.TranslationRecognizer=class e extends o.Recognizer{constructor(e,n,r){let i=e;a.Contracts.throwIfNull(i,`speechConfig`),super(n,i.properties,r||new t.TranslationConnectionFactory,e.tokenCredential),this.privDisposedTranslationRecognizer=!1,this.properties.getProperty(o.PropertyId.SpeechServiceConnection_TranslationVoice,void 0)!==void 0&&a.Contracts.throwIfNullOrWhitespace(this.properties.getProperty(o.PropertyId.SpeechServiceConnection_TranslationVoice),o.PropertyId[o.PropertyId.SpeechServiceConnection_TranslationVoice]),a.Contracts.throwIfNullOrWhitespace(this.properties.getProperty(o.PropertyId.SpeechServiceConnection_TranslationToLanguages),o.PropertyId[o.PropertyId.SpeechServiceConnection_TranslationToLanguages]),a.Contracts.throwIfNullOrWhitespace(this.properties.getProperty(o.PropertyId.SpeechServiceConnection_RecoLanguage),o.PropertyId[o.PropertyId.SpeechServiceConnection_RecoLanguage])}static FromConfig(n,r,i){let a=n;return r.properties.mergeTo(a.properties),r.properties.getProperty(o.PropertyId.SpeechServiceConnection_AutoDetectSourceLanguages,void 0)===t.AutoDetectSourceLanguagesOpenRangeOptionName&&a.properties.setProperty(o.PropertyId.SpeechServiceConnection_RecoLanguage,`en-US`),new e(n,i)}get speechRecognitionLanguage(){return a.Contracts.throwIfDisposed(this.privDisposedTranslationRecognizer),this.properties.getProperty(o.PropertyId.SpeechServiceConnection_RecoLanguage)}get targetLanguages(){return a.Contracts.throwIfDisposed(this.privDisposedTranslationRecognizer),this.properties.getProperty(o.PropertyId.SpeechServiceConnection_TranslationToLanguages).split(`,`)}get voiceName(){return a.Contracts.throwIfDisposed(this.privDisposedTranslationRecognizer),this.properties.getProperty(o.PropertyId.SpeechServiceConnection_TranslationVoice,void 0)}get properties(){return this.privProperties}get authorizationToken(){return this.properties.getProperty(o.PropertyId.SpeechServiceAuthorization_Token)}set authorizationToken(e){this.properties.setProperty(o.PropertyId.SpeechServiceAuthorization_Token,e)}recognizeOnceAsync(e,t){a.Contracts.throwIfDisposed(this.privDisposedTranslationRecognizer),(0,r.marshalPromiseToCallbacks)(this.recognizeOnceAsyncImpl(n.RecognitionMode.Interactive),e,t)}startContinuousRecognitionAsync(e,t){(0,r.marshalPromiseToCallbacks)(this.startContinuousRecognitionAsyncImpl(n.RecognitionMode.Conversation),e,t)}stopContinuousRecognitionAsync(e,t){(0,r.marshalPromiseToCallbacks)(this.stopContinuousRecognitionAsyncImpl(),e,t)}removeTargetLanguage(e){if(a.Contracts.throwIfNullOrUndefined(e,`language to be removed`),this.properties.getProperty(o.PropertyId.SpeechServiceConnection_TranslationToLanguages,void 0)!==void 0){let t=this.properties.getProperty(o.PropertyId.SpeechServiceConnection_TranslationToLanguages).split(`,`),n=t.indexOf(e);n>-1&&(t.splice(n,1),this.properties.setProperty(o.PropertyId.SpeechServiceConnection_TranslationToLanguages,t.join(`,`)),this.updateLanguages(t))}}addTargetLanguage(e){a.Contracts.throwIfNullOrUndefined(e,`language to be added`);let t=[];this.properties.getProperty(o.PropertyId.SpeechServiceConnection_TranslationToLanguages,void 0)===void 0?(this.properties.setProperty(o.PropertyId.SpeechServiceConnection_TranslationToLanguages,e),t=[e]):(t=this.properties.getProperty(o.PropertyId.SpeechServiceConnection_TranslationToLanguages).split(`,`),t.includes(e)||(t.push(e),this.properties.setProperty(o.PropertyId.SpeechServiceConnection_TranslationToLanguages,t.join(`,`)))),this.updateLanguages(t)}close(e,t){a.Contracts.throwIfDisposed(this.privDisposedTranslationRecognizer),(0,r.marshalPromiseToCallbacks)(this.dispose(!0),e,t)}onConnection(){}async dispose(e){this.privDisposedTranslationRecognizer||(this.privDisposedTranslationRecognizer=!0,e&&(await this.implRecognizerStop(),await super.dispose(e)))}createRecognizerConfig(e){return new t.RecognizerConfig(e,this.privProperties)}createServiceRecognizer(e,n,r,i){let a=r;return new t.TranslationServiceRecognizer(e,n,a,i,this)}updateLanguages(e){let t=i.Connection.fromRecognizer(this);t&&(t.setMessageProperty(`speech.context`,`translationcontext`,{to:e}),t.sendMessageAsync(`event`,JSON.stringify({id:`translation`,name:`updateLanguage`,to:e})))}}})),vt=e((e=>{Object.defineProperty(e,`__esModule`,{value:!0}),e.Translations=void 0;var t=Y();e.Translations=class{constructor(){this.privMap=new t.PropertyCollection}get languages(){return this.privMap.keys}get(e,t){return this.privMap.getProperty(e,t)}set(e,t){this.privMap.setProperty(e,t)}}})),yt=e((e=>{Object.defineProperty(e,`__esModule`,{value:!0}),e.NoMatchReason=void 0,(function(e){e[e.NotRecognized=0]=`NotRecognized`,e[e.InitialSilenceTimeout=1]=`InitialSilenceTimeout`,e[e.InitialBabbleTimeout=2]=`InitialBabbleTimeout`})(e.NoMatchReason||={})})),bt=e((e=>{Object.defineProperty(e,`__esModule`,{value:!0}),e.NoMatchDetails=void 0;var t=$(),n=Y();e.NoMatchDetails=class e{constructor(e){this.privReason=e}static fromResult(r){let i=t.SimpleSpeechPhrase.fromJSON(r.json,0),a=n.NoMatchReason.NotRecognized;switch(i.RecognitionStatus){case t.RecognitionStatus.BabbleTimeout:a=n.NoMatchReason.InitialBabbleTimeout;break;case t.RecognitionStatus.InitialSilenceTimeout:a=n.NoMatchReason.InitialSilenceTimeout;break;default:a=n.NoMatchReason.NotRecognized;break}return new e(a)}get reason(){return this.privReason}}})),xt=e((e=>{Object.defineProperty(e,`__esModule`,{value:!0}),e.TranslationRecognitionCanceledEventArgs=void 0,e.TranslationRecognitionCanceledEventArgs=class{constructor(e,t,n,r,i){this.privCancelReason=t,this.privErrorDetails=n,this.privResult=i,this.privSessionId=e,this.privErrorCode=r}get result(){return this.privResult}get sessionId(){return this.privSessionId}get reason(){return this.privCancelReason}get errorCode(){return this.privErrorCode}get errorDetails(){return this.privErrorDetails}}})),St=e((e=>{Object.defineProperty(e,`__esModule`,{value:!0}),e.CancellationDetailsBase=void 0,e.CancellationDetailsBase=class{constructor(e,t,n){this.privReason=e,this.privErrorDetails=t,this.privErrorCode=n}get reason(){return this.privReason}get errorDetails(){return this.privErrorDetails}get ErrorCode(){return this.privErrorCode}}})),Ct=e((e=>{Object.defineProperty(e,`__esModule`,{value:!0}),e.CancellationDetails=void 0;var t=$(),n=St(),r=Y();e.CancellationDetails=class e extends n.CancellationDetailsBase{constructor(e,t,n){super(e,t,n)}static fromResult(n){let i=r.CancellationReason.Error,a=r.CancellationErrorCode.NoError;if(n instanceof r.RecognitionResult&&n.json){let e=t.SimpleSpeechPhrase.fromJSON(n.json,0);i=t.EnumTranslation.implTranslateCancelResult(e.RecognitionStatus)}return n.properties&&(a=r.CancellationErrorCode[n.properties.getProperty(t.CancellationErrorCodePropertyName,r.CancellationErrorCode[r.CancellationErrorCode.NoError])]),new e(i,n.errorDetails||t.EnumTranslation.implTranslateErrorDetails(a),a)}}})),wt=e((e=>{Object.defineProperty(e,`__esModule`,{value:!0}),e.CancellationErrorCode=void 0,(function(e){e[e.NoError=0]=`NoError`,e[e.AuthenticationFailure=1]=`AuthenticationFailure`,e[e.BadRequestParameters=2]=`BadRequestParameters`,e[e.TooManyRequests=3]=`TooManyRequests`,e[e.ConnectionFailure=4]=`ConnectionFailure`,e[e.ServiceTimeout=5]=`ServiceTimeout`,e[e.ServiceError=6]=`ServiceError`,e[e.RuntimeError=7]=`RuntimeError`,e[e.Forbidden=8]=`Forbidden`})(e.CancellationErrorCode||={})})),Tt=e((e=>{Object.defineProperty(e,`__esModule`,{value:!0}),e.ConnectionEventArgs=void 0;var t=Y();e.ConnectionEventArgs=class extends t.SessionEventArgs{}})),Et=e((e=>{Object.defineProperty(e,`__esModule`,{value:!0}),e.ServiceEventArgs=void 0;var t=Y();e.ServiceEventArgs=class extends t.SessionEventArgs{constructor(e,t,n){super(n),this.privJsonResult=e,this.privEventName=t}get jsonString(){return this.privJsonResult}get eventName(){return this.privEventName}}})),Dt=e((e=>{Object.defineProperty(e,`__esModule`,{value:!0}),e.PhraseListGrammar=void 0;var t=I();e.PhraseListGrammar=class e{constructor(e){this.privGrammerBuilder=e.dynamicGrammar}static fromRecognizer(t){let n=t.internalData;return new e(n)}addPhrase(e){this.privGrammerBuilder.addPhrase(e)}addPhrases(e){this.privGrammerBuilder.addPhrase(e)}clear(){this.privGrammerBuilder.clearPhrases()}setWeight(e){t.Contracts.throwIfNumberOutOfRange(e,`weight`,0,2),this.privGrammerBuilder.setWeight(e)}}})),W=e((e=>{Object.defineProperty(e,`__esModule`,{value:!0}),e.DialogServiceConfigImpl=e.DialogServiceConfig=void 0;var t=I(),n=Y(),r=class{constructor(){}set applicationId(e){}static get DialogTypes(){return{BotFramework:`bot_framework`,CustomCommands:`custom_commands`}}};e.DialogServiceConfig=r,e.DialogServiceConfigImpl=class extends r{constructor(){super(),this.privSpeechConfig=new n.SpeechConfigImpl}get properties(){return this.privSpeechConfig.properties}get speechRecognitionLanguage(){return this.privSpeechConfig.speechRecognitionLanguage}set speechRecognitionLanguage(e){t.Contracts.throwIfNullOrWhitespace(e,`value`),this.privSpeechConfig.speechRecognitionLanguage=e}get outputFormat(){return this.privSpeechConfig.outputFormat}set outputFormat(e){this.privSpeechConfig.outputFormat=e}setProperty(e,t){this.privSpeechConfig.setProperty(e,t)}getProperty(e,t){return this.privSpeechConfig.getProperty(e)}setProxy(e,t,r,i){this.setProperty(n.PropertyId.SpeechServiceConnection_ProxyHostName,e),this.setProperty(n.PropertyId.SpeechServiceConnection_ProxyPort,`${t}`),r&&this.setProperty(n.PropertyId.SpeechServiceConnection_ProxyUserName,r),i&&this.setProperty(n.PropertyId.SpeechServiceConnection_ProxyPassword,i)}setServiceProperty(e,t,n){this.privSpeechConfig.setServiceProperty(e,t)}close(){}}})),Ot=e((e=>{Object.defineProperty(e,`__esModule`,{value:!0}),e.BotFrameworkConfig=void 0;var t=I(),n=W(),r=Y();e.BotFrameworkConfig=class extends n.DialogServiceConfigImpl{constructor(){super()}static fromSubscription(e,i,a){t.Contracts.throwIfNullOrWhitespace(e,`subscription`),t.Contracts.throwIfNullOrWhitespace(i,`region`);let o=new n.DialogServiceConfigImpl;return o.setProperty(r.PropertyId.Conversation_DialogType,n.DialogServiceConfig.DialogTypes.BotFramework),o.setProperty(r.PropertyId.SpeechServiceConnection_Key,e),o.setProperty(r.PropertyId.SpeechServiceConnection_Region,i),a&&o.setProperty(r.PropertyId.Conversation_ApplicationId,a),o}static fromAuthorizationToken(e,i,a){t.Contracts.throwIfNullOrWhitespace(e,`authorizationToken`),t.Contracts.throwIfNullOrWhitespace(i,`region`);let o=new n.DialogServiceConfigImpl;return o.setProperty(r.PropertyId.Conversation_DialogType,n.DialogServiceConfig.DialogTypes.BotFramework),o.setProperty(r.PropertyId.SpeechServiceAuthorization_Token,e),o.setProperty(r.PropertyId.SpeechServiceConnection_Region,i),a&&o.setProperty(r.PropertyId.Conversation_ApplicationId,a),o}static fromHost(e,i,a){t.Contracts.throwIfNullOrUndefined(e,`host`);let o=e instanceof URL?e:new URL(`wss://${e}.convai.speech.azure.us`);t.Contracts.throwIfNullOrUndefined(o,`resolvedHost`);let s=new n.DialogServiceConfigImpl;return s.setProperty(r.PropertyId.Conversation_DialogType,n.DialogServiceConfig.DialogTypes.BotFramework),s.setProperty(r.PropertyId.SpeechServiceConnection_Host,o.toString()),i!==void 0&&s.setProperty(r.PropertyId.SpeechServiceConnection_Key,i),s}static fromEndpoint(e,i){t.Contracts.throwIfNull(e,`endpoint`);let a=new n.DialogServiceConfigImpl;return a.setProperty(r.PropertyId.Conversation_DialogType,n.DialogServiceConfig.DialogTypes.BotFramework),a.setProperty(r.PropertyId.SpeechServiceConnection_Endpoint,e.toString()),i!==void 0&&a.setProperty(r.PropertyId.SpeechServiceConnection_Key,i),a}}})),kt=e((e=>{Object.defineProperty(e,`__esModule`,{value:!0}),e.CustomCommandsConfig=void 0;var t=I(),n=W(),r=Y();e.CustomCommandsConfig=class extends n.DialogServiceConfigImpl{constructor(){super()}static fromSubscription(e,i,a){t.Contracts.throwIfNullOrWhitespace(e,`applicationId`),t.Contracts.throwIfNullOrWhitespace(i,`subscription`),t.Contracts.throwIfNullOrWhitespace(a,`region`);let o=new n.DialogServiceConfigImpl;return o.setProperty(r.PropertyId.Conversation_DialogType,n.DialogServiceConfig.DialogTypes.CustomCommands),o.setProperty(r.PropertyId.Conversation_ApplicationId,e),o.setProperty(r.PropertyId.SpeechServiceConnection_Key,i),o.setProperty(r.PropertyId.SpeechServiceConnection_Region,a),o}static fromAuthorizationToken(e,i,a){t.Contracts.throwIfNullOrWhitespace(e,`applicationId`),t.Contracts.throwIfNullOrWhitespace(i,`authorizationToken`),t.Contracts.throwIfNullOrWhitespace(a,`region`);let o=new n.DialogServiceConfigImpl;return o.setProperty(r.PropertyId.Conversation_DialogType,n.DialogServiceConfig.DialogTypes.CustomCommands),o.setProperty(r.PropertyId.Conversation_ApplicationId,e),o.setProperty(r.PropertyId.SpeechServiceAuthorization_Token,i),o.setProperty(r.PropertyId.SpeechServiceConnection_Region,a),o}set applicationId(e){t.Contracts.throwIfNullOrWhitespace(e,`value`),this.setProperty(r.PropertyId.Conversation_ApplicationId,e)}get applicationId(){return this.getProperty(r.PropertyId.Conversation_ApplicationId)}}})),G=e((e=>{Object.defineProperty(e,`__esModule`,{value:!0}),e.QueryParameterNames=void 0;var t=class{};e.QueryParameterNames=t,t.BotId=`botid`,t.CustomSpeechDeploymentId=`cid`,t.CustomVoiceDeploymentId=`deploymentId`,t.EnableAudioLogging=`storeAudio`,t.EnableLanguageId=`lidEnabled`,t.EnableWordLevelTimestamps=`wordLevelTimestamps`,t.EndSilenceTimeoutMs=`endSilenceTimeoutMs`,t.SegmentationSilenceTimeoutMs=`segmentationSilenceTimeoutMs`,t.SegmentationMaximumTimeMs=`segmentationMaximumTimeMs`,t.SegmentationStrategy=`segmentationStrategy`,t.Format=`format`,t.InitialSilenceTimeoutMs=`initialSilenceTimeoutMs`,t.Language=`language`,t.Profanity=`profanity`,t.RequestBotStatusMessages=`enableBotMessageStatus`,t.StableIntermediateThreshold=`stableIntermediateThreshold`,t.StableTranslation=`stableTranslation`,t.TestHooks=`testhooks`,t.Postprocessing=`postprocessing`,t.CtsMeetingId=`meetingId`,t.CtsDeviceId=`deviceId`,t.CtsIsParticipant=`isParticipant`,t.EnableAvatar=`enableTalkingAvatar`})),K=e((e=>{Object.defineProperty(e,`__esModule`,{value:!0}),e.ConnectionFactoryBase=void 0;var t=$(),n=j(),r=Y(),i=G();e.ConnectionFactoryBase=class{static getHostSuffix(e){if(e){if(e.toLowerCase().startsWith(`china`))return`.azure.cn`;if(e.toLowerCase().startsWith(`usgov`))return`.azure.us`}return`.microsoft.com`}setCommonUrlParams(e,n,a){new Map([[r.PropertyId.Speech_SegmentationSilenceTimeoutMs,i.QueryParameterNames.SegmentationSilenceTimeoutMs],[r.PropertyId.SpeechServiceConnection_EnableAudioLogging,i.QueryParameterNames.EnableAudioLogging],[r.PropertyId.SpeechServiceConnection_EndSilenceTimeoutMs,i.QueryParameterNames.EndSilenceTimeoutMs],[r.PropertyId.SpeechServiceConnection_InitialSilenceTimeoutMs,i.QueryParameterNames.InitialSilenceTimeoutMs],[r.PropertyId.SpeechServiceResponse_PostProcessingOption,i.QueryParameterNames.Postprocessing],[r.PropertyId.SpeechServiceResponse_ProfanityOption,i.QueryParameterNames.Profanity],[r.PropertyId.SpeechServiceResponse_RequestWordLevelTimestamps,i.QueryParameterNames.EnableWordLevelTimestamps],[r.PropertyId.SpeechServiceResponse_StablePartialResultThreshold,i.QueryParameterNames.StableIntermediateThreshold]]).forEach((t,r)=>{this.setUrlParameter(r,t,e,n,a)});let o=JSON.parse(e.parameters.getProperty(t.ServicePropertiesPropertyName,`{}`));Object.keys(o).forEach(e=>{n[e]=o[e]})}setUrlParameter(e,t,n,r,i){let a=n.parameters.getProperty(e,void 0);a&&(!i||i.search(t)===-1)&&(r[t]=a.toLocaleLowerCase())}static async getRedirectUrlFromEndpoint(e){let t=new URL(e);t.protocol=`https:`,t.port=`443`,t.searchParams.append(`GenerateRedirectResponse`,`true`);let r=t.toString();n.Events.instance.onEvent(new n.ConnectionRedirectEvent(``,r,void 0,`ConnectionFactoryBase: redirectUrl request`));let i=await fetch(r);if(i.status!==200)return e;let a=await i.text();n.Events.instance.onEvent(new n.ConnectionRedirectEvent(``,a,e,`ConnectionFactoryBase: redirectUrlString`));try{return new URL(a.trim()).toString()}catch{return e}}}})),At=e((e=>{Object.defineProperty(e,`__esModule`,{value:!0}),e.DialogConnectionFactory=void 0;var t=X(),n=$(),r=Y(),i=K(),a=$(),o=M(),s=G(),c=class e extends i.ConnectionFactoryBase{create(c,l,u){let d=c.parameters.getProperty(r.PropertyId.Conversation_ApplicationId,``),f=c.parameters.getProperty(r.PropertyId.Conversation_DialogType),p=c.parameters.getProperty(r.PropertyId.SpeechServiceConnection_Region),m=c.parameters.getProperty(r.PropertyId.SpeechServiceConnection_RecoLanguage,`en-US`),h=c.parameters.getProperty(r.PropertyId.Conversation_Request_Bot_Status_Messages,`true`),g={};g[o.HeaderNames.ConnectionId]=u,g[s.QueryParameterNames.Format]=c.parameters.getProperty(n.OutputFormatPropertyName,r.OutputFormat[r.OutputFormat.Simple]).toLowerCase(),g[s.QueryParameterNames.Language]=m,g[s.QueryParameterNames.RequestBotStatusMessages]=h,d&&(g[s.QueryParameterNames.BotId]=d,f===r.DialogServiceConfig.DialogTypes.CustomCommands&&(g[o.HeaderNames.CustomCommandsAppId]=d));let _=f===r.DialogServiceConfig.DialogTypes.CustomCommands?`commands/`:``,v=f===r.DialogServiceConfig.DialogTypes.CustomCommands?`v1`:f===r.DialogServiceConfig.DialogTypes.BotFramework?`v3`:`v0`,y={};l.token!=null&&l.token!==``&&(y[l.headerName]=l.token);let b=c.parameters.getProperty(r.PropertyId.SpeechServiceConnection_Endpoint,``);if(!b){let t=i.ConnectionFactoryBase.getHostSuffix(p),n=c.parameters.getProperty(r.PropertyId.SpeechServiceConnection_Host,`wss://${p}.${e.BaseUrl}${t}`);b=`${n.endsWith(`/`)?n:n+`/`}${_}${e.ApiKey}/${v}`}this.setCommonUrlParams(c,g,b);let x=c.parameters.getProperty(`SPEECH-EnableWebsocketCompression`,`false`)===`true`;return Promise.resolve(new t.WebsocketConnection(b,g,y,new a.WebsocketMessageFormatter,t.ProxyInfo.fromRecognizerConfig(c),x,u))}};e.DialogConnectionFactory=c,c.ApiKey=`api`,c.BaseUrl=`convai.speech`})),jt=e((e=>{Object.defineProperty(e,`__esModule`,{value:!0}),e.DialogServiceConnector=void 0;var t=At(),n=$(),r=U(),i=j(),a=I(),o=Y(),s=ft();e.DialogServiceConnector=class extends o.Recognizer{constructor(e,n){let r=e;a.Contracts.throwIfNull(e,`dialogConfig`),super(n,r.properties,new t.DialogConnectionFactory),this.isTurnComplete=!0,this.privIsDisposed=!1,this.privProperties=r.properties.clone();let i=this.buildAgentConfig();this.privReco.agentConfig.set(i)}connect(e,t){(0,i.marshalPromiseToCallbacks)(this.privReco.connect(),e,t)}disconnect(e,t){(0,i.marshalPromiseToCallbacks)(this.privReco.disconnect(),e,t)}get authorizationToken(){return this.properties.getProperty(s.PropertyId.SpeechServiceAuthorization_Token)}set authorizationToken(e){a.Contracts.throwIfNullOrWhitespace(e,`token`),this.properties.setProperty(s.PropertyId.SpeechServiceAuthorization_Token,e)}get properties(){return this.privProperties}get speechActivityTemplate(){return this.properties.getProperty(s.PropertyId.Conversation_Speech_Activity_Template)}set speechActivityTemplate(e){this.properties.setProperty(s.PropertyId.Conversation_Speech_Activity_Template,e)}listenOnceAsync(e,t){if(this.isTurnComplete){a.Contracts.throwIfDisposed(this.privIsDisposed);let n=(async()=>{await this.privReco.connect(),await this.implRecognizerStop(),this.isTurnComplete=!1;let e=new i.Deferred;await this.privReco.recognize(r.RecognitionMode.Conversation,e.resolve,e.reject);let t=await e.promise;return await this.implRecognizerStop(),t})();n.catch(()=>{this.dispose(!0).catch(()=>{})}),(0,i.marshalPromiseToCallbacks)(n.finally(()=>{this.isTurnComplete=!0}),e,t)}}sendActivityAsync(e,t,n){(0,i.marshalPromiseToCallbacks)(this.privReco.sendMessage(e),t,n)}close(e,t){a.Contracts.throwIfDisposed(this.privIsDisposed),(0,i.marshalPromiseToCallbacks)(this.dispose(!0),e,t)}async dispose(e){this.privIsDisposed||e&&(this.privIsDisposed=!0,await this.implRecognizerStop(),await super.dispose(e))}createRecognizerConfig(e){return new n.RecognizerConfig(e,this.privProperties)}createServiceRecognizer(e,t,r,i){let a=r;return new n.DialogServiceAdapter(e,t,a,i,this)}buildAgentConfig(){return{botInfo:{commType:this.properties.getProperty(`Conversation_Communication_Type`,`Default`),commandsCulture:void 0,connectionId:this.properties.getProperty(s.PropertyId.Conversation_Agent_Connection_Id),conversationId:this.properties.getProperty(s.PropertyId.Conversation_Conversation_Id,void 0),fromId:this.properties.getProperty(s.PropertyId.Conversation_From_Id,void 0),ttsAudioFormat:this.properties.getProperty(s.PropertyId.SpeechServiceConnection_SynthOutputFormat,void 0)},version:.2}}}})),Mt=e((e=>{Object.defineProperty(e,`__esModule`,{value:!0}),e.ActivityReceivedEventArgs=void 0,e.ActivityReceivedEventArgs=class{constructor(e,t){this.privActivity=e,this.privAudioStream=t}get activity(){return this.privActivity}get audioStream(){return this.privAudioStream}}})),Nt=e((e=>{Object.defineProperty(e,`__esModule`,{value:!0}),e.TurnStatusResponsePayload=void 0,e.TurnStatusResponsePayload=class e{constructor(e){this.privMessageStatusResponse=JSON.parse(e)}static fromJSON(t){return new e(t)}get interactionId(){return this.privMessageStatusResponse.interactionId}get conversationId(){return this.privMessageStatusResponse.conversationId}get statusCode(){switch(this.privMessageStatusResponse.statusCode){case`Success`:return 200;case`Failed`:return 400;case`TimedOut`:return 429;default:return this.privMessageStatusResponse.statusCode}}}})),Pt=e((e=>{Object.defineProperty(e,`__esModule`,{value:!0}),e.TurnStatusReceivedEventArgs=void 0;var t=Nt();e.TurnStatusReceivedEventArgs=class{constructor(e){this.privTurnStatus=t.TurnStatusResponsePayload.fromJSON(e)}get interactionId(){return this.privTurnStatus.interactionId}get conversationId(){return this.privTurnStatus.conversationId}get statusCode(){return this.privTurnStatus.statusCode}}})),Ft=e((e=>{Object.defineProperty(e,`__esModule`,{value:!0}),e.ServicePropertyChannel=void 0,(function(e){e[e.UriQueryParameter=0]=`UriQueryParameter`})(e.ServicePropertyChannel||={})})),It=e((e=>{Object.defineProperty(e,`__esModule`,{value:!0}),e.ProfanityOption=void 0,(function(e){e[e.Masked=0]=`Masked`,e[e.Removed=1]=`Removed`,e[e.Raw=2]=`Raw`})(e.ProfanityOption||={})})),Lt=e((e=>{Object.defineProperty(e,`__esModule`,{value:!0}),e.BaseAudioPlayer=void 0;var t=w(),n=Y(),r=L();e.BaseAudioPlayer=class{constructor(e){this.audioContext=null,this.gainNode=null,this.autoUpdateBufferTimer=0,e===void 0&&(e=n.AudioStreamFormat.getDefaultInputFormat()),this.init(e)}playAudioSample(e,t,n){try{this.ensureInitializedContext();let n=this.formatAudioData(e),r=new Float32Array(this.samples.length+n.length);r.set(this.samples,0),r.set(n,this.samples.length),this.samples=r,t&&t()}catch(e){n&&n(e)}}stopAudio(e,t){this.audioContext!==null&&(this.samples=new Float32Array,clearInterval(this.autoUpdateBufferTimer),this.audioContext.close().then(()=>{e&&e()},e=>{t&&t(e)}),this.audioContext=null)}init(e){this.audioFormat=e,this.samples=new Float32Array}ensureInitializedContext(){this.audioContext===null&&(this.createAudioContext(),this.autoUpdateBufferTimer=setInterval(()=>{this.updateAudioBuffer()},200))}createAudioContext(){this.audioContext=r.AudioStreamFormatImpl.getAudioContext(),this.gainNode=this.audioContext.createGain(),this.gainNode.gain.value=1,this.gainNode.connect(this.audioContext.destination),this.startTime=this.audioContext.currentTime}formatAudioData(e){switch(this.audioFormat.bitsPerSample){case 8:return this.formatArrayBuffer(new Int8Array(e),128);case 16:return this.formatArrayBuffer(new Int16Array(e),32768);case 32:return this.formatArrayBuffer(new Int32Array(e),2147483648);default:throw new t.InvalidOperationError(`Only WAVE_FORMAT_PCM (8/16/32 bps) format supported at this time`)}}formatArrayBuffer(e,t){let n=new Float32Array(e.length);for(let r=0;r<e.length;r++)n[r]=e[r]/t;return n}updateAudioBuffer(){if(this.samples.length===0)return;let e=this.audioFormat.channels,t=this.audioContext.createBufferSource(),n=this.samples.length/e,r=this.audioContext.createBuffer(e,n,this.audioFormat.samplesPerSec);for(let t=0;t<e;t++){let n=t,i=r.getChannelData(t);for(let t=0;t<this.samples.length;t++,n+=e)i[t]=this.samples[n]}this.startTime<this.audioContext.currentTime&&(this.startTime=this.audioContext.currentTime),t.buffer=r,t.connect(this.gainNode),t.start(this.startTime),this.startTime+=r.duration,this.samples=new Float32Array}async playAudio(e){this.audioContext===null&&this.createAudioContext();let t=this.audioContext.createBufferSource(),n=this.audioContext.destination;await this.audioContext.decodeAudioData(e,e=>{t.buffer=e,t.connect(n),t.start(0)})}}})),Rt=e((e=>{Object.defineProperty(e,`__esModule`,{value:!0}),e.ConnectionMessageEventArgs=void 0,e.ConnectionMessageEventArgs=class{constructor(e){this.privConnectionMessage=e}get message(){return this.privConnectionMessage}toString(){return`Message: `+this.privConnectionMessage.toString()}}})),zt=e((e=>{Object.defineProperty(e,`__esModule`,{value:!0}),e.LanguageIdMode=void 0,(function(e){e[e.AtStart=0]=`AtStart`,e[e.Continuous=1]=`Continuous`})(e.LanguageIdMode||={})})),Bt=e((e=>{Object.defineProperty(e,`__esModule`,{value:!0}),e.AutoDetectSourceLanguageConfig=void 0;var t=$(),n=I(),r=Y(),i=zt();e.AutoDetectSourceLanguageConfig=class e{constructor(){this.privProperties=new r.PropertyCollection,this.privProperties.setProperty(r.PropertyId.SpeechServiceConnection_LanguageIdMode,`AtStart`),this.privLanguageIdMode=i.LanguageIdMode.AtStart}static fromOpenRange(){let n=new e;return n.properties.setProperty(r.PropertyId.SpeechServiceConnection_AutoDetectSourceLanguages,t.AutoDetectSourceLanguagesOpenRangeOptionName),n.properties.setProperty(r.PropertyId.SpeechServiceConnection_RecoLanguage,`en-US`),n}static fromLanguages(t){n.Contracts.throwIfArrayEmptyOrWhitespace(t,`languages`);let i=new e;return i.properties.setProperty(r.PropertyId.SpeechServiceConnection_AutoDetectSourceLanguages,t.join()),i}static fromSourceLanguageConfigs(t){if(t.length<1)throw Error(`Expected non-empty SourceLanguageConfig array.`);let n=new e,i=[];return t.forEach(e=>{if(i.push(e.language),e.endpointId!==void 0&&e.endpointId!==``){let t=e.language+r.PropertyId.SpeechServiceConnection_EndpointId.toString();n.properties.setProperty(t,e.endpointId)}}),n.properties.setProperty(r.PropertyId.SpeechServiceConnection_AutoDetectSourceLanguages,i.join()),n}get properties(){return this.privProperties}set mode(e){e===i.LanguageIdMode.Continuous?(this.privProperties.setProperty(r.PropertyId.SpeechServiceConnection_RecognitionEndpointVersion,`2`),this.privProperties.setProperty(r.PropertyId.SpeechServiceConnection_LanguageIdMode,`Continuous`)):(this.privProperties.setProperty(r.PropertyId.SpeechServiceConnection_RecognitionEndpointVersion,`1`),this.privProperties.setProperty(r.PropertyId.SpeechServiceConnection_LanguageIdMode,`AtStart`)),this.privLanguageIdMode=e}}})),Vt=e((e=>{Object.defineProperty(e,`__esModule`,{value:!0}),e.AutoDetectSourceLanguageResult=void 0;var t=I();e.AutoDetectSourceLanguageResult=class e{constructor(e,n){t.Contracts.throwIfNullOrUndefined(e,`language`),t.Contracts.throwIfNullOrUndefined(n,`languageDetectionConfidence`),this.privLanguage=e,this.privLanguageDetectionConfidence=n}static fromResult(t){return new e(t.language,t.languageDetectionConfidence)}static fromConversationTranscriptionResult(t){return new e(t.language,t.languageDetectionConfidence)}get language(){return this.privLanguage}get languageDetectionConfidence(){return this.privLanguageDetectionConfidence}}})),Ht=e((e=>{Object.defineProperty(e,`__esModule`,{value:!0}),e.SourceLanguageConfig=void 0;var t=I();e.SourceLanguageConfig=class e{constructor(e,n){t.Contracts.throwIfNullOrUndefined(e,`language`),this.privLanguage=e,this.privEndpointId=n}static fromLanguage(t,n){return new e(t,n)}get language(){return this.privLanguage}get endpointId(){return this.privEndpointId}}})),Ut=e((e=>{Object.defineProperty(e,`__esModule`,{value:!0}),e.ConversationImpl=e.Conversation=void 0;var t=$(),n=j(),r=I(),i=Y(),a=class{constructor(){}static createConversationAsync(e,a,s,c){r.Contracts.throwIfNullOrUndefined(e,t.ConversationConnectionConfig.restErrors.invalidArgs.replace(`{arg}`,`config`)),r.Contracts.throwIfNullOrUndefined(e.region,t.ConversationConnectionConfig.restErrors.invalidArgs.replace(`{arg}`,`SpeechServiceConnection_Region`)),!e.subscriptionKey&&!e.getProperty(i.PropertyId[i.PropertyId.SpeechServiceAuthorization_Token])&&r.Contracts.throwIfNullOrUndefined(e.subscriptionKey,t.ConversationConnectionConfig.restErrors.invalidArgs.replace(`{arg}`,`SpeechServiceConnection_Key`));let l,u,d;return typeof a==`string`?(l=new o(e,a),(0,n.marshalPromiseToCallbacks)((async()=>{})(),s,c)):(l=new o(e),u=a,d=s,l.createConversationAsync((()=>{u&&u()}),e=>{d&&d(e)})),l}};e.Conversation=a;var o=class extends a{constructor(e,n){if(super(),this.privErrors=t.ConversationConnectionConfig.restErrors,this.onConnected=e=>{this.privIsConnected=!0;try{this.privConversationTranslator?.sessionStarted&&this.privConversationTranslator.sessionStarted(this.privConversationTranslator,e)}catch{}},this.onDisconnected=e=>{try{this.privConversationTranslator?.sessionStopped&&this.privConversationTranslator.sessionStopped(this.privConversationTranslator,e)}catch{}finally{this.close(!1)}},this.onCanceled=(e,t)=>{try{this.privConversationTranslator?.canceled&&this.privConversationTranslator.canceled(this.privConversationTranslator,t)}catch{}},this.onParticipantUpdateCommandReceived=(e,n)=>{try{let e=this.privParticipants.getParticipant(n.id);if(e!==void 0){switch(n.key){case t.ConversationTranslatorCommandTypes.changeNickname:e.displayName=n.value;break;case t.ConversationTranslatorCommandTypes.setUseTTS:e.isUsingTts=n.value;break;case t.ConversationTranslatorCommandTypes.setProfanityFiltering:e.profanity=n.value;break;case t.ConversationTranslatorCommandTypes.setMute:e.isMuted=n.value;break;case t.ConversationTranslatorCommandTypes.setTranslateToLanguages:e.translateToLanguages=n.value;break}this.privParticipants.addOrUpdateParticipant(e),this.privConversationTranslator&&this.privConversationTranslator.participantsChanged(this.privConversationTranslator,new i.ConversationParticipantsChangedEventArgs(i.ParticipantChangedReason.Updated,[this.toParticipant(e)],n.sessionId))}}catch{}},this.onLockRoomCommandReceived=()=>{},this.onMuteAllCommandReceived=(e,t)=>{try{this.privParticipants.participants.forEach(e=>e.isMuted=e.isHost?!1:t.isMuted),this.privConversationTranslator&&this.privConversationTranslator.participantsChanged(this.privConversationTranslator,new i.ConversationParticipantsChangedEventArgs(i.ParticipantChangedReason.Updated,this.toParticipants(!1),t.sessionId))}catch{}},this.onParticipantJoinCommandReceived=(e,t)=>{try{let e=this.privParticipants.addOrUpdateParticipant(t.participant);e!==void 0&&this.privConversationTranslator&&this.privConversationTranslator.participantsChanged(this.privConversationTranslator,new i.ConversationParticipantsChangedEventArgs(i.ParticipantChangedReason.JoinedConversation,[this.toParticipant(e)],t.sessionId))}catch{}},this.onParticipantLeaveCommandReceived=(e,t)=>{try{let e=this.privParticipants.getParticipant(t.participant.id);e!==void 0&&(this.privParticipants.deleteParticipant(t.participant.id),this.privConversationTranslator&&this.privConversationTranslator.participantsChanged(this.privConversationTranslator,new i.ConversationParticipantsChangedEventArgs(i.ParticipantChangedReason.LeftConversation,[this.toParticipant(e)],t.sessionId)))}catch{}},this.onTranslationReceived=(e,n)=>{try{switch(n.command){case t.ConversationTranslatorMessageTypes.final:this.privConversationTranslator&&this.privConversationTranslator.transcribed(this.privConversationTranslator,new i.ConversationTranslationEventArgs(n.payload,void 0,n.sessionId));break;case t.ConversationTranslatorMessageTypes.partial:this.privConversationTranslator&&this.privConversationTranslator.transcribing(this.privConversationTranslator,new i.ConversationTranslationEventArgs(n.payload,void 0,n.sessionId));break;case t.ConversationTranslatorMessageTypes.instantMessage:this.privConversationTranslator&&this.privConversationTranslator.textMessageReceived(this.privConversationTranslator,new i.ConversationTranslationEventArgs(n.payload,void 0,n.sessionId));break}}catch{}},this.onParticipantsListReceived=(e,t)=>{try{if(t.sessionToken!==void 0&&t.sessionToken!==null&&(this.privRoom.token=t.sessionToken),this.privParticipants.participants=[...t.participants],this.privParticipants.me!==void 0&&(this.privIsReady=!0),this.privConversationTranslator&&this.privConversationTranslator.participantsChanged(this.privConversationTranslator,new i.ConversationParticipantsChangedEventArgs(i.ParticipantChangedReason.JoinedConversation,this.toParticipants(!0),t.sessionId)),this.me.isHost){let e=this.privConversationTranslator?.properties.getProperty(i.PropertyId.ConversationTranslator_Name);e!==void 0&&e.length>0&&e!==this.me.displayName&&this.changeNicknameAsync(e)}}catch{}},this.onConversationExpiration=(e,t)=>{try{this.privConversationTranslator&&this.privConversationTranslator.conversationExpiration(this.privConversationTranslator,t)}catch{}},this.privIsConnected=!1,this.privIsDisposed=!1,this.privConversationId=``,this.privProperties=new i.PropertyCollection,this.privManager=new t.ConversationManager,e.getProperty(i.PropertyId[i.PropertyId.SpeechServiceConnection_RecoLanguage])||e.setProperty(i.PropertyId[i.PropertyId.SpeechServiceConnection_RecoLanguage],t.ConversationConnectionConfig.defaultLanguageCode),this.privLanguage=e.getProperty(i.PropertyId[i.PropertyId.SpeechServiceConnection_RecoLanguage]),n)this.privConversationId=n;else{e.targetLanguages.length===0&&e.addTargetLanguage(this.privLanguage),e.getProperty(i.PropertyId[i.PropertyId.SpeechServiceResponse_ProfanityOption])||e.setProfanity(i.ProfanityOption.Masked);let t=e.getProperty(i.PropertyId[i.PropertyId.ConversationTranslator_Name]);t??=`Host`,r.Contracts.throwIfNullOrTooLong(t,`nickname`,50),r.Contracts.throwIfNullOrTooShort(t,`nickname`,2),e.setProperty(i.PropertyId[i.PropertyId.ConversationTranslator_Name],t)}this.privConfig=e;let a=e;r.Contracts.throwIfNull(a,`speechConfig`),this.privProperties=a.properties.clone(),this.privIsConnected=!1,this.privParticipants=new t.InternalParticipants,this.privIsReady=!1,this.privTextMessageMaxLength=1e3}get room(){return this.privRoom}get connection(){return this.privConversationRecognizer}get config(){return this.privConfig}get conversationId(){return this.privRoom?this.privRoom.roomId:this.privConversationId}get properties(){return this.privProperties}get speechRecognitionLanguage(){return this.privLanguage}get isMutedByHost(){return this.privParticipants.me?.isHost?!1:this.privParticipants.me?.isMuted}get isConnected(){return this.privIsConnected&&this.privIsReady}get participants(){return this.toParticipants(!0)}get me(){return this.toParticipant(this.privParticipants.me)}get host(){return this.toParticipant(this.privParticipants.host)}get transcriberRecognizer(){return this.privTranscriberRecognizer}get conversationInfo(){let e=this.conversationId,n=this.participants.map(e=>({id:e.id,preferredLanguage:e.preferredLanguage,voice:e.voice})),r={};for(let e of t.ConversationConnectionConfig.transcriptionEventKeys){let t=this.properties.getProperty(e,``);t!==``&&(r[e]=t)}return{id:e,participants:n,conversationProperties:r}}get canSend(){return this.privIsConnected&&!this.privParticipants.me?.isMuted}get canSendAsHost(){return this.privIsConnected&&this.privParticipants.me?.isHost}get authorizationToken(){return this.privToken}set authorizationToken(e){r.Contracts.throwIfNullOrWhitespace(e,`authorizationToken`),this.privToken=e}set conversationTranslator(e){this.privConversationTranslator=e}onToken(e){this.privConversationTranslator.onToken(e)}createConversationAsync(e,t){try{this.privConversationRecognizer&&this.handleError(Error(this.privErrors.permissionDeniedStart),t),this.privManager.createOrJoin(this.privProperties,void 0,(n=>{n||this.handleError(Error(this.privErrors.permissionDeniedConnect),t),this.privRoom=n,this.handleCallback(e,t)}),(e=>{this.handleError(e,t)}))}catch(e){this.handleError(e,t)}}startConversationAsync(e,n){try{this.privConversationRecognizer&&this.handleError(Error(this.privErrors.permissionDeniedStart),n),r.Contracts.throwIfNullOrUndefined(this.privRoom,this.privErrors.permissionDeniedConnect),this.privParticipants.meId=this.privRoom.participantId,this.privConversationRecognizer=t.ConversationRecognizerFactory.fromConfig(this,this.privConfig),this.privConversationRecognizer.connected=this.onConnected,this.privConversationRecognizer.disconnected=this.onDisconnected,this.privConversationRecognizer.canceled=this.onCanceled,this.privConversationRecognizer.participantUpdateCommandReceived=this.onParticipantUpdateCommandReceived,this.privConversationRecognizer.lockRoomCommandReceived=this.onLockRoomCommandReceived,this.privConversationRecognizer.muteAllCommandReceived=this.onMuteAllCommandReceived,this.privConversationRecognizer.participantJoinCommandReceived=this.onParticipantJoinCommandReceived,this.privConversationRecognizer.participantLeaveCommandReceived=this.onParticipantLeaveCommandReceived,this.privConversationRecognizer.translationReceived=this.onTranslationReceived,this.privConversationRecognizer.participantsListReceived=this.onParticipantsListReceived,this.privConversationRecognizer.conversationExpiration=this.onConversationExpiration,this.privConversationRecognizer.connect(this.privRoom.token,(()=>{this.handleCallback(e,n)}),(e=>{this.handleError(e,n)}))}catch(e){this.handleError(e,n)}}addParticipantAsync(e,t,i){r.Contracts.throwIfNullOrUndefined(e,`Participant`),(0,n.marshalPromiseToCallbacks)(this.addParticipantImplAsync(e),t,i)}joinConversationAsync(e,t,n,i,a){try{r.Contracts.throwIfNullOrWhitespace(e,this.privErrors.invalidArgs.replace(`{arg}`,`conversationId`)),r.Contracts.throwIfNullOrWhitespace(t,this.privErrors.invalidArgs.replace(`{arg}`,`nickname`)),r.Contracts.throwIfNullOrWhitespace(n,this.privErrors.invalidArgs.replace(`{arg}`,`language`)),this.privManager.createOrJoin(this.privProperties,e,(e=>{r.Contracts.throwIfNullOrUndefined(e,this.privErrors.permissionDeniedConnect),this.privRoom=e,this.privConfig.authorizationToken=e.cognitiveSpeechAuthToken,i&&i(e.cognitiveSpeechAuthToken)}),(e=>{this.handleError(e,a)}))}catch(e){this.handleError(e,a)}}deleteConversationAsync(e,t){(0,n.marshalPromiseToCallbacks)(this.deleteConversationImplAsync(),e,t)}async deleteConversationImplAsync(){r.Contracts.throwIfNullOrUndefined(this.privProperties,this.privErrors.permissionDeniedConnect),r.Contracts.throwIfNullOrWhitespace(this.privRoom.token,this.privErrors.permissionDeniedConnect),await this.privManager.leave(this.privProperties,this.privRoom.token),this.dispose()}endConversationAsync(e,t){(0,n.marshalPromiseToCallbacks)(this.endConversationImplAsync(),e,t)}endConversationImplAsync(){return this.close(!0)}lockConversationAsync(e,t){try{r.Contracts.throwIfDisposed(this.privIsDisposed),r.Contracts.throwIfDisposed(this.privConversationRecognizer.isDisposed()),r.Contracts.throwIfNullOrUndefined(this.privRoom,this.privErrors.permissionDeniedSend),this.canSendAsHost||this.handleError(Error(this.privErrors.permissionDeniedConversation.replace(`{command}`,`lock`)),t),this.privConversationRecognizer&&this.privConversationRecognizer.sendRequest(this.getLockCommand(!0),(()=>{this.handleCallback(e,t)}),(e=>{this.handleError(e,t)}))}catch(e){this.handleError(e,t)}}muteAllParticipantsAsync(e,t){try{r.Contracts.throwIfDisposed(this.privIsDisposed),r.Contracts.throwIfDisposed(this.privConversationRecognizer.isDisposed()),r.Contracts.throwIfNullOrUndefined(this.privConversationRecognizer,this.privErrors.permissionDeniedSend),r.Contracts.throwIfNullOrUndefined(this.privRoom,this.privErrors.permissionDeniedSend),this.canSendAsHost||this.handleError(Error(this.privErrors.permissionDeniedConversation.replace(`{command}`,`mute`)),t),this.privConversationRecognizer&&this.privConversationRecognizer.sendRequest(this.getMuteAllCommand(!0),(()=>{this.handleCallback(e,t)}),(e=>{this.handleError(e,t)}))}catch(e){this.handleError(e,t)}}muteParticipantAsync(e,t,n){try{r.Contracts.throwIfDisposed(this.privIsDisposed),r.Contracts.throwIfDisposed(this.privConversationRecognizer.isDisposed()),r.Contracts.throwIfNullOrWhitespace(e,this.privErrors.invalidArgs.replace(`{arg}`,`userId`)),r.Contracts.throwIfNullOrUndefined(this.privRoom,this.privErrors.permissionDeniedSend),this.canSend||this.handleError(Error(this.privErrors.permissionDeniedSend),n),!this.me.isHost&&this.me.id!==e&&this.handleError(Error(this.privErrors.permissionDeniedParticipant.replace(`{command}`,`mute`)),n),this.privParticipants.getParticipantIndex(e)===-1&&this.handleError(Error(this.privErrors.invalidParticipantRequest),n),this.privConversationRecognizer&&this.privConversationRecognizer.sendRequest(this.getMuteCommand(e,!0),(()=>{this.handleCallback(t,n)}),(e=>{this.handleError(e,n)}))}catch(e){this.handleError(e,n)}}removeParticipantAsync(e,t,i){try{if(r.Contracts.throwIfDisposed(this.privIsDisposed),this.privTranscriberRecognizer&&e.hasOwnProperty(`id`))(0,n.marshalPromiseToCallbacks)(this.removeParticipantImplAsync(e),t,i);else{r.Contracts.throwIfDisposed(this.privConversationRecognizer.isDisposed()),r.Contracts.throwIfNullOrUndefined(this.privRoom,this.privErrors.permissionDeniedSend),this.canSendAsHost||this.handleError(Error(this.privErrors.permissionDeniedParticipant.replace(`{command}`,`remove`)),i);let n=``;typeof e==`string`?n=e:e.hasOwnProperty(`id`)?n=e.id:e.hasOwnProperty(`userId`)&&(n=e.userId),r.Contracts.throwIfNullOrWhitespace(n,this.privErrors.invalidArgs.replace(`{arg}`,`userId`)),this.participants.findIndex(e=>e.id===n)===-1&&this.handleError(Error(this.privErrors.invalidParticipantRequest),i),this.privConversationRecognizer&&this.privConversationRecognizer.sendRequest(this.getEjectCommand(n),(()=>{this.handleCallback(t,i)}),(e=>{this.handleError(e,i)}))}}catch(e){this.handleError(e,i)}}unlockConversationAsync(e,t){try{r.Contracts.throwIfDisposed(this.privIsDisposed),r.Contracts.throwIfDisposed(this.privConversationRecognizer.isDisposed()),r.Contracts.throwIfNullOrUndefined(this.privRoom,this.privErrors.permissionDeniedSend),this.canSendAsHost||this.handleError(Error(this.privErrors.permissionDeniedConversation.replace(`{command}`,`unlock`)),t),this.privConversationRecognizer&&this.privConversationRecognizer.sendRequest(this.getLockCommand(!1),(()=>{this.handleCallback(e,t)}),(e=>{this.handleError(e,t)}))}catch(e){this.handleError(e,t)}}unmuteAllParticipantsAsync(e,t){try{r.Contracts.throwIfDisposed(this.privIsDisposed),r.Contracts.throwIfDisposed(this.privConversationRecognizer.isDisposed()),r.Contracts.throwIfNullOrUndefined(this.privRoom,this.privErrors.permissionDeniedSend),this.canSendAsHost||this.handleError(Error(this.privErrors.permissionDeniedConversation.replace(`{command}`,`unmute all`)),t),this.privConversationRecognizer&&this.privConversationRecognizer.sendRequest(this.getMuteAllCommand(!1),(()=>{this.handleCallback(e,t)}),(e=>{this.handleError(e,t)}))}catch(e){this.handleError(e,t)}}unmuteParticipantAsync(e,t,n){try{r.Contracts.throwIfDisposed(this.privIsDisposed),r.Contracts.throwIfDisposed(this.privConversationRecognizer.isDisposed()),r.Contracts.throwIfNullOrWhitespace(e,this.privErrors.invalidArgs.replace(`{arg}`,`userId`)),r.Contracts.throwIfNullOrUndefined(this.privRoom,this.privErrors.permissionDeniedSend),this.canSend||this.handleError(Error(this.privErrors.permissionDeniedSend),n),!this.me.isHost&&this.me.id!==e&&this.handleError(Error(this.privErrors.permissionDeniedParticipant.replace(`{command}`,`mute`)),n),this.privParticipants.getParticipantIndex(e)===-1&&this.handleError(Error(this.privErrors.invalidParticipantRequest),n),this.privConversationRecognizer&&this.privConversationRecognizer.sendRequest(this.getMuteCommand(e,!1),(()=>{this.handleCallback(t,n)}),(e=>{this.handleError(e,n)}))}catch(e){this.handleError(e,n)}}sendTextMessageAsync(e,t,n){try{r.Contracts.throwIfDisposed(this.privIsDisposed),r.Contracts.throwIfDisposed(this.privConversationRecognizer.isDisposed()),r.Contracts.throwIfNullOrWhitespace(e,this.privErrors.invalidArgs.replace(`{arg}`,`message`)),r.Contracts.throwIfNullOrUndefined(this.privRoom,this.privErrors.permissionDeniedSend),this.canSend||this.handleError(Error(this.privErrors.permissionDeniedSend),n),e.length>this.privTextMessageMaxLength&&this.handleError(Error(this.privErrors.invalidArgs.replace(`{arg}`,`message length`)),n),this.privConversationRecognizer&&this.privConversationRecognizer.sendRequest(this.getMessageCommand(e),(()=>{this.handleCallback(t,n)}),(e=>{this.handleError(e,n)}))}catch(e){this.handleError(e,n)}}setTranslatedLanguagesAsync(e,t,n){try{r.Contracts.throwIfDisposed(this.privIsDisposed),r.Contracts.throwIfDisposed(this.privConversationRecognizer.isDisposed()),r.Contracts.throwIfArrayEmptyOrWhitespace(e,this.privErrors.invalidArgs.replace(`{arg}`,`languages`)),r.Contracts.throwIfNullOrUndefined(this.privRoom,this.privErrors.permissionDeniedSend),this.canSend||this.handleError(Error(this.privErrors.permissionDeniedSend),n),this.privConversationRecognizer&&this.privConversationRecognizer.sendRequest(this.getSetTranslateToLanguagesCommand(e),(()=>{this.handleCallback(t,n)}),(e=>{this.handleError(e,n)}))}catch(e){this.handleError(e,n)}}changeNicknameAsync(e,t,n){try{r.Contracts.throwIfDisposed(this.privIsDisposed),r.Contracts.throwIfDisposed(this.privConversationRecognizer.isDisposed()),r.Contracts.throwIfNullOrWhitespace(e,this.privErrors.invalidArgs.replace(`{arg}`,`nickname`)),r.Contracts.throwIfNullOrUndefined(this.privRoom,this.privErrors.permissionDeniedSend),this.canSend||this.handleError(Error(this.privErrors.permissionDeniedSend),n),this.privConversationRecognizer&&this.privConversationRecognizer.sendRequest(this.getChangeNicknameCommand(e),(()=>{this.handleCallback(t,n)}),(e=>{this.handleError(e,n)}))}catch(e){this.handleError(e,n)}}isDisposed(){return this.privIsDisposed}dispose(){this.isDisposed||(this.privIsDisposed=!0,this.config&&this.config.close(),this.privConfig=void 0,this.privLanguage=void 0,this.privProperties=void 0,this.privRoom=void 0,this.privToken=void 0,this.privManager=void 0,this.privIsConnected=!1,this.privIsReady=!1,this.privParticipants=void 0)}async connectTranscriberRecognizer(e){this.privTranscriberRecognizer&&await this.privTranscriberRecognizer.close(),await e.enforceAudioGating(),this.privTranscriberRecognizer=e,this.privTranscriberRecognizer.conversation=this}getKeepAlive(){let e=this.me?this.me.displayName:`default_nickname`;return JSON.stringify({id:`0`,nickname:e,participantId:this.privRoom.participantId,roomId:this.privRoom.roomId,type:t.ConversationTranslatorMessageTypes.keepAlive})}addParticipantImplAsync(e){if(this.privParticipants.addOrUpdateParticipant(e)!==void 0&&this.privTranscriberRecognizer){let t=this.conversationInfo;return t.participants=[e],this.privTranscriberRecognizer.pushConversationEvent(t,`join`)}}removeParticipantImplAsync(e){this.privParticipants.deleteParticipant(e.id);let t=this.conversationInfo;return t.participants=[e],this.privTranscriberRecognizer.pushConversationEvent(t,`leave`)}async close(e){try{this.privIsConnected=!1,await this.privConversationRecognizer?.close(),this.privConversationRecognizer=void 0,this.privConversationTranslator&&this.privConversationTranslator.dispose()}catch(e){throw e}e&&this.dispose()}handleCallback(e,t){if(e){try{e()}catch(e){t&&t(e)}e=void 0}}handleError(e,t){if(t)if(e instanceof Error){let n=e;t(n.name+`: `+n.message)}else t(e)}toParticipants(e){let t=this.privParticipants.participants.map(e=>this.toParticipant(e));return e?t:t.filter(e=>e.isHost===!1)}toParticipant(e){return new i.Participant(e.id,e.avatar,e.displayName,e.isHost,e.isMuted,e.isUsingTts,e.preferredLanguage,e.voice)}getMuteAllCommand(e){return r.Contracts.throwIfNullOrWhitespace(this.privRoom.roomId,`conversationId`),r.Contracts.throwIfNullOrWhitespace(this.privRoom.participantId,`participantId`),JSON.stringify({command:t.ConversationTranslatorCommandTypes.setMuteAll,participantId:this.privRoom.participantId,roomid:this.privRoom.roomId,type:t.ConversationTranslatorMessageTypes.participantCommand,value:e})}getMuteCommand(e,n){return r.Contracts.throwIfNullOrWhitespace(this.privRoom.roomId,`conversationId`),r.Contracts.throwIfNullOrWhitespace(e,`participantId`),JSON.stringify({command:t.ConversationTranslatorCommandTypes.setMute,participantId:e,roomid:this.privRoom.roomId,type:t.ConversationTranslatorMessageTypes.participantCommand,value:n})}getLockCommand(e){return r.Contracts.throwIfNullOrWhitespace(this.privRoom.roomId,`conversationId`),r.Contracts.throwIfNullOrWhitespace(this.privRoom.participantId,`participantId`),JSON.stringify({command:t.ConversationTranslatorCommandTypes.setLockState,participantId:this.privRoom.participantId,roomid:this.privRoom.roomId,type:t.ConversationTranslatorMessageTypes.participantCommand,value:e})}getEjectCommand(e){return r.Contracts.throwIfNullOrWhitespace(this.privRoom.roomId,`conversationId`),r.Contracts.throwIfNullOrWhitespace(e,`participantId`),JSON.stringify({command:t.ConversationTranslatorCommandTypes.ejectParticipant,participantId:e,roomid:this.privRoom.roomId,type:t.ConversationTranslatorMessageTypes.participantCommand})}getSetTranslateToLanguagesCommand(e){return r.Contracts.throwIfNullOrWhitespace(this.privRoom.roomId,`conversationId`),r.Contracts.throwIfNullOrWhitespace(this.privRoom.participantId,`participantId`),JSON.stringify({command:t.ConversationTranslatorCommandTypes.setTranslateToLanguages,participantId:this.privRoom.participantId,roomid:this.privRoom.roomId,type:t.ConversationTranslatorMessageTypes.participantCommand,value:e})}getChangeNicknameCommand(e){return r.Contracts.throwIfNullOrWhitespace(this.privRoom.roomId,`conversationId`),r.Contracts.throwIfNullOrWhitespace(e,`nickname`),r.Contracts.throwIfNullOrWhitespace(this.privRoom.participantId,`participantId`),JSON.stringify({command:t.ConversationTranslatorCommandTypes.changeNickname,nickname:e,participantId:this.privRoom.participantId,roomid:this.privRoom.roomId,type:t.ConversationTranslatorMessageTypes.participantCommand,value:e})}getMessageCommand(e){return r.Contracts.throwIfNullOrWhitespace(this.privRoom.roomId,`conversationId`),r.Contracts.throwIfNullOrWhitespace(this.privRoom.participantId,`participantId`),r.Contracts.throwIfNullOrWhitespace(e,`message`),JSON.stringify({participantId:this.privRoom.participantId,roomId:this.privRoom.roomId,text:e,type:t.ConversationTranslatorMessageTypes.instantMessage})}};e.ConversationImpl=o})),Wt=e((e=>{Object.defineProperty(e,`__esModule`,{value:!0}),e.ConversationCommon=void 0,e.ConversationCommon=class{constructor(e){this.privAudioConfig=e}handleCallback(e,t){if(e){try{e()}catch(e){t&&t(e)}e=void 0}}handleError(e,t){if(t)if(e instanceof Error){let n=e;t(n.name+`: `+n.message)}else t(e)}}})),Gt=e((e=>{Object.defineProperty(e,`__esModule`,{value:!0}),e.ConversationExpirationEventArgs=void 0;var t=Y();e.ConversationExpirationEventArgs=class extends t.SessionEventArgs{constructor(e,t){super(t),this.privExpirationTime=e}get expirationTime(){return this.privExpirationTime}}})),Kt=e((e=>{Object.defineProperty(e,`__esModule`,{value:!0}),e.ConversationParticipantsChangedEventArgs=void 0;var t=Y();e.ConversationParticipantsChangedEventArgs=class extends t.SessionEventArgs{constructor(e,t,n){super(n),this.privReason=e,this.privParticipant=t}get reason(){return this.privReason}get participants(){return this.privParticipant}}})),qt=e((e=>{Object.defineProperty(e,`__esModule`,{value:!0}),e.ConversationTranslationCanceledEventArgs=void 0;var t=H();e.ConversationTranslationCanceledEventArgs=class extends t.CancellationEventArgsBase{}})),Jt=e((e=>{Object.defineProperty(e,`__esModule`,{value:!0}),e.ConversationTranslationEventArgs=void 0;var t=Y();e.ConversationTranslationEventArgs=class extends t.RecognitionEventArgs{constructor(e,t,n){super(t,n),this.privResult=e}get result(){return this.privResult}}})),Yt=e((e=>{Object.defineProperty(e,`__esModule`,{value:!0}),e.ConversationTranslationResult=void 0;var t=ot();e.ConversationTranslationResult=class extends t.TranslationRecognitionResult{constructor(e,t,n,r,i,a,o,s,c,l,u){super(t,r,i,a,o,s,void 0,void 0,c,l,u),this.privId=e,this.privOrigLang=n}get participantId(){return this.privId}get originalLang(){return this.privOrigLang}}})),Xt=e((e=>{Object.defineProperty(e,`__esModule`,{value:!0}),e.StringUtils=void 0,e.StringUtils=class{static formatString(e,t){if(!e)return``;if(!t)return e;let n=``,r=``,i=e=>{n+=e},a=e=>{r+=e},o=i;for(let s=0;s<e.length;s++){let c=e[s],l=s+1<e.length?e[s+1]:``;switch(c){case`{`:l===`{`?(o(`{`),s++):o=a;break;case`}`:l===`}`?(o(`}`),s++):(t.hasOwnProperty(r)&&(n+=t[r]),o=i,r=``);break;default:o(c);break}}return n}}})),Zt=e((e=>{Object.defineProperty(e,`__esModule`,{value:!0}),e.ConversationTranslatorConnectionFactory=void 0;var t=X(),n=Xt(),r=I(),i=Y(),a=M(),o=G(),s=K(),c=$(),l=class e extends s.ConnectionFactoryBase{constructor(e){super(),r.Contracts.throwIfNullOrUndefined(e,`convGetter`),this.privConvGetter=e}create(r,l,u){let d=r.parameters.getProperty(`ConversationTranslator_MultiChannelAudio`,``).toUpperCase()===`TRUE`,f=this.privConvGetter().room,p=f.cognitiveSpeechRegion||r.parameters.getProperty(i.PropertyId.SpeechServiceConnection_Region,``),m={hostSuffix:s.ConnectionFactoryBase.getHostSuffix(p),path:e.CTS_VIRT_MIC_PATH,region:encodeURIComponent(p)};m[o.QueryParameterNames.Language]=encodeURIComponent(r.parameters.getProperty(i.PropertyId.SpeechServiceConnection_RecoLanguage,``)),m[o.QueryParameterNames.CtsMeetingId]=encodeURIComponent(f.roomId),m[o.QueryParameterNames.CtsDeviceId]=encodeURIComponent(f.participantId),m[o.QueryParameterNames.CtsIsParticipant]=f.isHost?``:`&`+o.QueryParameterNames.CtsIsParticipant;let h=``,g={},_={};if(d){h=r.parameters.getProperty(i.PropertyId.SpeechServiceConnection_Endpoint),h||=`wss://`+r.parameters.getProperty(i.PropertyId.SpeechServiceConnection_Host,`transcribe.{region}.cts.speech{hostSuffix}`)+`{path}`,h=n.StringUtils.formatString(h,m);let e=new URL(h);e.searchParams.forEach((e,t)=>{g[t]=e}),new c.TranscriberConnectionFactory().setQueryParams(g,r,h),g[o.QueryParameterNames.CtsMeetingId]=m[o.QueryParameterNames.CtsMeetingId],g[o.QueryParameterNames.CtsDeviceId]=m[o.QueryParameterNames.CtsDeviceId],f.isHost||(g[o.QueryParameterNames.CtsIsParticipant]=``),o.QueryParameterNames.Format in g||(g[o.QueryParameterNames.Format]=`simple`),e.searchParams.forEach((t,n)=>{e.searchParams.set(n,g[n]),delete g[n]}),h=e.toString()}else{let e=new c.TranslationConnectionFactory;h=e.getEndpointUrl(r,!0),h=n.StringUtils.formatString(h,m),e.setQueryParams(g,r,h)}_[a.HeaderNames.ConnectionId]=u,_[t.RestConfigBase.configParams.token]=f.token,l.token&&(_[l.headerName]=l.token);let v=r.parameters.getProperty(`SPEECH-EnableWebsocketCompression`,``).toUpperCase()===`TRUE`;return Promise.resolve(new t.WebsocketConnection(h,g,_,new c.WebsocketMessageFormatter,t.ProxyInfo.fromRecognizerConfig(r),v,u))}};e.ConversationTranslatorConnectionFactory=l,l.CTS_VIRT_MIC_PATH=`/speech/recognition/dynamicaudio`})),Qt=e((e=>{Object.defineProperty(e,`__esModule`,{value:!0}),e.ConversationTranslator=e.SpeechState=void 0;var t=$(),n=Zt(),r=j(),i=I(),a=Y(),o=Ut(),s=q(),c;(function(e){e[e.Inactive=0]=`Inactive`,e[e.Connecting=1]=`Connecting`,e[e.Connected=2]=`Connected`})(c=e.SpeechState||={});var l=class extends a.TranslationRecognizer{constructor(e,t,r,i){super(e,t,new n.ConversationTranslatorConnectionFactory(i)),this.privSpeechState=c.Inactive,r&&(this.privTranslator=r,this.sessionStarted=()=>{this.privSpeechState=c.Connected},this.sessionStopped=()=>{this.privSpeechState=c.Inactive},this.recognizing=(e,t)=>{this.privTranslator.recognizing&&this.privTranslator.recognizing(this.privTranslator,t)},this.recognized=async(e,t)=>{t.result?.errorDetails?(await this.cancelSpeech(),this.fireCancelEvent(t.result.errorDetails)):this.privTranslator.recognized&&this.privTranslator.recognized(this.privTranslator,t)},this.canceled=async()=>{if(this.privSpeechState!==c.Inactive)try{await this.cancelSpeech()}catch{this.privSpeechState=c.Inactive}})}get state(){return this.privSpeechState}set state(e){this.privSpeechState=e}set authentication(e){this.privReco.authentication=e}onConnection(){this.privSpeechState=c.Connected}async onCancelSpeech(){this.privSpeechState=c.Inactive,await this.cancelSpeech()}fireCancelEvent(e){try{if(this.privTranslator.canceled){let t=new s.ConversationTranslationCanceledEventArgs(a.CancellationReason.Error,e,a.CancellationErrorCode.RuntimeError);this.privTranslator.canceled(this.privTranslator,t)}}catch{}}async cancelSpeech(){try{this.stopContinuousRecognitionAsync(),await this.privReco?.disconnect(),this.privSpeechState=c.Inactive}catch{}}};e.ConversationTranslator=class extends s.ConversationCommon{constructor(e){super(e),this.privErrors=t.ConversationConnectionConfig.restErrors,this.privIsDisposed=!1,this.privIsSpeaking=!1,this.privPlaceholderKey=`abcdefghijklmnopqrstuvwxyz012345`,this.privPlaceholderRegion=`westus`,this.privProperties=new a.PropertyCollection}get properties(){return this.privProperties}get speechRecognitionLanguage(){return this.privSpeechRecognitionLanguage}get participants(){return this.privConversation?.participants}get canSpeak(){return!(!this.privConversation.isConnected||!this.privCTRecognizer||this.privIsSpeaking||this.privCTRecognizer.state===c.Connected||this.privCTRecognizer.state===c.Connecting||this.privConversation.isMutedByHost)}onToken(e){this.privCTRecognizer.authentication=e}setServiceProperty(e,n){let r=JSON.parse(this.privProperties.getProperty(t.ServicePropertiesPropertyName,`{}`));r[e]=n,this.privProperties.setProperty(t.ServicePropertiesPropertyName,JSON.stringify(r))}joinConversationAsync(e,n,r,s,c){try{if(typeof e==`string`){i.Contracts.throwIfNullOrUndefined(e,this.privErrors.invalidArgs.replace(`{arg}`,`conversation id`)),i.Contracts.throwIfNullOrWhitespace(n,this.privErrors.invalidArgs.replace(`{arg}`,`nickname`)),this.privConversation&&this.handleError(Error(this.privErrors.permissionDeniedStart),c);let l=r;(l==null||l===``)&&(l=t.ConversationConnectionConfig.defaultLanguageCode),this.privSpeechTranslationConfig=a.SpeechTranslationConfig.fromSubscription(this.privPlaceholderKey,this.privPlaceholderRegion),this.privSpeechTranslationConfig.setProfanity(a.ProfanityOption.Masked),this.privSpeechTranslationConfig.addTargetLanguage(l),this.privSpeechTranslationConfig.setProperty(a.PropertyId[a.PropertyId.SpeechServiceConnection_RecoLanguage],l),this.privSpeechTranslationConfig.setProperty(a.PropertyId[a.PropertyId.ConversationTranslator_Name],n);let u=[a.PropertyId.SpeechServiceConnection_Host,a.PropertyId.ConversationTranslator_Host,a.PropertyId.SpeechServiceConnection_Endpoint,a.PropertyId.SpeechServiceConnection_ProxyHostName,a.PropertyId.SpeechServiceConnection_ProxyPassword,a.PropertyId.SpeechServiceConnection_ProxyPort,a.PropertyId.SpeechServiceConnection_ProxyUserName,`ConversationTranslator_MultiChannelAudio`,`ConversationTranslator_Region`];for(let e of u){let t=this.privProperties.getProperty(e);if(t){let n=typeof e==`string`?e:a.PropertyId[e];this.privSpeechTranslationConfig.setProperty(n,t)}}let d=JSON.parse(this.privProperties.getProperty(t.ServicePropertiesPropertyName,`{}`));for(let e of Object.keys(d))this.privSpeechTranslationConfig.setServiceProperty(e,d[e],a.ServicePropertyChannel.UriQueryParameter);this.privConversation=new o.ConversationImpl(this.privSpeechTranslationConfig),this.privConversation.conversationTranslator=this,this.privConversation.joinConversationAsync(e,n,l,(e=>{e||this.handleError(Error(this.privErrors.permissionDeniedConnect),c),this.privSpeechTranslationConfig.authorizationToken=e,this.privConversation.room.isHost=!1,this.privConversation.startConversationAsync((()=>{this.handleCallback(s,c)}),(e=>{this.handleError(e,c)}))}),(e=>{this.handleError(e,c)}))}else typeof e==`object`?(i.Contracts.throwIfNullOrUndefined(e,this.privErrors.invalidArgs.replace(`{arg}`,`conversation id`)),i.Contracts.throwIfNullOrWhitespace(n,this.privErrors.invalidArgs.replace(`{arg}`,`nickname`)),this.privProperties.setProperty(a.PropertyId.ConversationTranslator_Name,n),this.privConversation=e,this.privConversation.conversationTranslator=this,this.privConversation.room.isHost=!0,i.Contracts.throwIfNullOrUndefined(this.privConversation,this.privErrors.permissionDeniedConnect),i.Contracts.throwIfNullOrUndefined(this.privConversation.room.token,this.privErrors.permissionDeniedConnect),this.privSpeechTranslationConfig=e.config,this.handleCallback(r,s)):this.handleError(Error(this.privErrors.invalidArgs.replace(`{arg}`,`invalid conversation type`)),s)}catch(e){this.handleError(e,typeof r==`string`?c:s)}}leaveConversationAsync(e,t){(0,r.marshalPromiseToCallbacks)((async()=>{await this.cancelSpeech(),await this.privConversation.endConversationImplAsync(),await this.privConversation.deleteConversationImplAsync(),this.dispose()})(),e,t)}sendTextMessageAsync(e,t,n){try{i.Contracts.throwIfNullOrUndefined(this.privConversation,this.privErrors.permissionDeniedSend),i.Contracts.throwIfNullOrWhitespace(e,this.privErrors.invalidArgs.replace(`{arg}`,e)),this.privConversation.sendTextMessageAsync(e,t,n)}catch(e){this.handleError(e,n)}}startTranscribingAsync(e,t){(0,r.marshalPromiseToCallbacks)((async()=>{try{i.Contracts.throwIfNullOrUndefined(this.privConversation,this.privErrors.permissionDeniedSend),i.Contracts.throwIfNullOrUndefined(this.privConversation.room.token,this.privErrors.permissionDeniedConnect),this.privCTRecognizer===void 0&&await this.connectTranslatorRecognizer(),i.Contracts.throwIfNullOrUndefined(this.privCTRecognizer,this.privErrors.permissionDeniedSend),this.canSpeak||this.handleError(Error(this.privErrors.permissionDeniedSend),t),await this.startContinuousRecognition(),this.privIsSpeaking=!0}catch(e){throw this.privIsSpeaking=!1,await this.cancelSpeech(),e}})(),e,t)}stopTranscribingAsync(e,t){(0,r.marshalPromiseToCallbacks)((async()=>{try{if(!this.privIsSpeaking){await this.cancelSpeech();return}this.privIsSpeaking=!1,await new Promise((e,t)=>{this.privCTRecognizer.stopContinuousRecognitionAsync(e,t)})}catch{await this.cancelSpeech()}})(),e,t)}isDisposed(){return this.privIsDisposed}dispose(e,t,n){(0,r.marshalPromiseToCallbacks)((async()=>{this.isDisposed&&!this.privIsSpeaking||(await this.cancelSpeech(),this.privIsDisposed=!0,this.privSpeechTranslationConfig.close(),this.privSpeechRecognitionLanguage=void 0,this.privProperties=void 0,this.privAudioConfig=void 0,this.privSpeechTranslationConfig=void 0,this.privConversation.dispose(),this.privConversation=void 0)})(),t,n)}async cancelSpeech(){try{this.privIsSpeaking=!1,await this.privCTRecognizer?.onCancelSpeech(),this.privCTRecognizer=void 0}catch{}}async connectTranslatorRecognizer(){try{this.privAudioConfig===void 0&&(this.privAudioConfig=a.AudioConfig.fromDefaultMicrophoneInput()),this.privSpeechTranslationConfig.getProperty(a.PropertyId[a.PropertyId.SpeechServiceConnection_Key])===this.privPlaceholderKey&&this.privSpeechTranslationConfig.setProperty(a.PropertyId[a.PropertyId.SpeechServiceConnection_Key],``),this.privCTRecognizer=new l(this.privSpeechTranslationConfig,this.privAudioConfig,this,()=>this.privConversation)}catch(e){throw await this.cancelSpeech(),e}}startContinuousRecognition(){return new Promise((e,t)=>{this.privCTRecognizer.startContinuousRecognitionAsync(e,t)})}}})),$t=e((e=>{Object.defineProperty(e,`__esModule`,{value:!0}),e.ConversationTranscriber=void 0;var t=$(),n=U(),r=j(),i=I(),a=Y();e.ConversationTranscriber=class e extends a.Recognizer{constructor(e,n){let r=e;i.Contracts.throwIfNull(r,`speechConfig`),i.Contracts.throwIfNullOrWhitespace(r.properties.getProperty(a.PropertyId.SpeechServiceConnection_RecoLanguage),a.PropertyId[a.PropertyId.SpeechServiceConnection_RecoLanguage]),super(n,r.properties,new t.ConversationTranscriberConnectionFactory,e.tokenCredential),this.privProperties.setProperty(a.PropertyId.SpeechServiceConnection_RecognitionEndpointVersion,`2`),this.privDisposedRecognizer=!1}static FromConfig(t,n,r){let i=t;return n.properties.mergeTo(i.properties),new e(t,r)}get endpointId(){return i.Contracts.throwIfDisposed(this.privDisposedRecognizer),this.properties.getProperty(a.PropertyId.SpeechServiceConnection_EndpointId,`00000000-0000-0000-0000-000000000000`)}get authorizationToken(){return this.properties.getProperty(a.PropertyId.SpeechServiceAuthorization_Token)}set authorizationToken(e){i.Contracts.throwIfNullOrWhitespace(e,`token`),this.properties.setProperty(a.PropertyId.SpeechServiceAuthorization_Token,e)}get speechRecognitionLanguage(){return i.Contracts.throwIfDisposed(this.privDisposedRecognizer),this.properties.getProperty(a.PropertyId.SpeechServiceConnection_RecoLanguage)}get outputFormat(){return i.Contracts.throwIfDisposed(this.privDisposedRecognizer),this.properties.getProperty(t.OutputFormatPropertyName,a.OutputFormat[a.OutputFormat.Simple])===a.OutputFormat[a.OutputFormat.Simple]?a.OutputFormat.Simple:a.OutputFormat.Detailed}get properties(){return this.privProperties}startTranscribingAsync(e,t){(0,r.marshalPromiseToCallbacks)(this.startContinuousRecognitionAsyncImpl(n.RecognitionMode.Conversation),e,t)}stopTranscribingAsync(e,t){(0,r.marshalPromiseToCallbacks)(this.stopContinuousRecognitionAsyncImpl(),e,t)}close(e,t){i.Contracts.throwIfDisposed(this.privDisposedRecognizer),(0,r.marshalPromiseToCallbacks)(this.dispose(!0),e,t)}async dispose(e){this.privDisposedRecognizer||(e&&(this.privDisposedRecognizer=!0,await this.implRecognizerStop()),await super.dispose(e))}createRecognizerConfig(e){return new t.RecognizerConfig(e,this.privProperties)}createServiceRecognizer(e,n,r,i){let a=r;return i.isSpeakerDiarizationEnabled=!0,new t.ConversationTranscriptionServiceRecognizer(e,n,a,i,this)}}})),en=e((e=>{Object.defineProperty(e,`__esModule`,{value:!0}),e.Participant=e.User=void 0;var t=Y();e.User=class{constructor(e){this.privUserId=e}get userId(){return this.privUserId}},e.Participant=class e{constructor(e,n,r,i,a,o,s,c){this.privId=e,this.privAvatar=n,this.privDisplayName=r,this.privIsHost=i,this.privIsMuted=a,this.privIsUsingTts=o,this.privPreferredLanguage=s,this.privVoice=c,this.privProperties=new t.PropertyCollection}get avatar(){return this.privAvatar}get displayName(){return this.privDisplayName}get id(){return this.privId}get preferredLanguage(){return this.privPreferredLanguage}get isHost(){return this.privIsHost}get isMuted(){return this.privIsMuted}get isUsingTts(){return this.privIsUsingTts}get voice(){return this.privVoice}get properties(){return this.privProperties}static From(t,n,r){return new e(t,``,t,!1,!1,!1,n,r)}}})),tn=e((e=>{Object.defineProperty(e,`__esModule`,{value:!0}),e.ParticipantChangedReason=void 0,(function(e){e[e.JoinedConversation=0]=`JoinedConversation`,e[e.LeftConversation=1]=`LeftConversation`,e[e.Updated=2]=`Updated`})(e.ParticipantChangedReason||={})})),nn=e((e=>{Object.defineProperty(e,`__esModule`,{value:!0}),e.MeetingImpl=e.Meeting=void 0;var t=$(),n=j(),r=I(),i=Y(),a=class{constructor(){}static createMeetingAsync(e,a,s,c){if(r.Contracts.throwIfNullOrUndefined(e,t.ConversationConnectionConfig.restErrors.invalidArgs.replace(`{arg}`,`config`)),r.Contracts.throwIfNullOrUndefined(e.region,t.ConversationConnectionConfig.restErrors.invalidArgs.replace(`{arg}`,`SpeechServiceConnection_Region`)),r.Contracts.throwIfNull(a,`meetingId`),a.length===0)throw Error(`meetingId cannot be empty`);!e.subscriptionKey&&!e.getProperty(i.PropertyId[i.PropertyId.SpeechServiceAuthorization_Token])&&r.Contracts.throwIfNullOrUndefined(e.subscriptionKey,t.ConversationConnectionConfig.restErrors.invalidArgs.replace(`{arg}`,`SpeechServiceConnection_Key`));let l=new o(e,a);return(0,n.marshalPromiseToCallbacks)((async()=>{})(),s,c),l}};e.Meeting=a;var o=class extends a{constructor(e,n){super(),this.privErrors=t.ConversationConnectionConfig.restErrors,this.onConnected=e=>{this.privIsConnected=!0;try{this.privConversationTranslator?.sessionStarted&&this.privConversationTranslator.sessionStarted(this.privConversationTranslator,e)}catch{}},this.onDisconnected=e=>{try{this.privConversationTranslator?.sessionStopped&&this.privConversationTranslator.sessionStopped(this.privConversationTranslator,e)}catch{}finally{this.close(!1)}},this.onCanceled=(e,t)=>{try{this.privConversationTranslator?.canceled&&this.privConversationTranslator.canceled(this.privConversationTranslator,t)}catch{}},this.onParticipantUpdateCommandReceived=(e,n)=>{try{let e=this.privParticipants.getParticipant(n.id);if(e!==void 0){switch(n.key){case t.ConversationTranslatorCommandTypes.changeNickname:e.displayName=n.value;break;case t.ConversationTranslatorCommandTypes.setUseTTS:e.isUsingTts=n.value;break;case t.ConversationTranslatorCommandTypes.setProfanityFiltering:e.profanity=n.value;break;case t.ConversationTranslatorCommandTypes.setMute:e.isMuted=n.value;break;case t.ConversationTranslatorCommandTypes.setTranslateToLanguages:e.translateToLanguages=n.value;break}this.privParticipants.addOrUpdateParticipant(e),this.privConversationTranslator&&this.privConversationTranslator.participantsChanged(this.privConversationTranslator,new i.ConversationParticipantsChangedEventArgs(i.ParticipantChangedReason.Updated,[this.toParticipant(e)],n.sessionId))}}catch{}},this.onLockRoomCommandReceived=()=>{},this.onMuteAllCommandReceived=(e,t)=>{try{this.privParticipants.participants.forEach(e=>e.isMuted=e.isHost?!1:t.isMuted),this.privConversationTranslator&&this.privConversationTranslator.participantsChanged(this.privConversationTranslator,new i.ConversationParticipantsChangedEventArgs(i.ParticipantChangedReason.Updated,this.toParticipants(!1),t.sessionId))}catch{}},this.onParticipantJoinCommandReceived=(e,t)=>{try{let e=this.privParticipants.addOrUpdateParticipant(t.participant);e!==void 0&&this.privConversationTranslator&&this.privConversationTranslator.participantsChanged(this.privConversationTranslator,new i.ConversationParticipantsChangedEventArgs(i.ParticipantChangedReason.JoinedConversation,[this.toParticipant(e)],t.sessionId))}catch{}},this.onParticipantLeaveCommandReceived=(e,t)=>{try{let e=this.privParticipants.getParticipant(t.participant.id);e!==void 0&&(this.privParticipants.deleteParticipant(t.participant.id),this.privConversationTranslator&&this.privConversationTranslator.participantsChanged(this.privConversationTranslator,new i.ConversationParticipantsChangedEventArgs(i.ParticipantChangedReason.LeftConversation,[this.toParticipant(e)],t.sessionId)))}catch{}},this.onTranslationReceived=(e,n)=>{try{switch(n.command){case t.ConversationTranslatorMessageTypes.final:this.privConversationTranslator&&this.privConversationTranslator.transcribed(this.privConversationTranslator,new i.ConversationTranslationEventArgs(n.payload,void 0,n.sessionId));break;case t.ConversationTranslatorMessageTypes.partial:this.privConversationTranslator&&this.privConversationTranslator.transcribing(this.privConversationTranslator,new i.ConversationTranslationEventArgs(n.payload,void 0,n.sessionId));break;case t.ConversationTranslatorMessageTypes.instantMessage:this.privConversationTranslator&&this.privConversationTranslator.textMessageReceived(this.privConversationTranslator,new i.ConversationTranslationEventArgs(n.payload,void 0,n.sessionId));break}}catch{}},this.onParticipantsListReceived=(e,t)=>{try{if(t.sessionToken!==void 0&&t.sessionToken!==null&&(this.privRoom.token=t.sessionToken),this.privParticipants.participants=[...t.participants],this.privParticipants.me!==void 0&&(this.privIsReady=!0),this.privConversationTranslator&&this.privConversationTranslator.participantsChanged(this.privConversationTranslator,new i.ConversationParticipantsChangedEventArgs(i.ParticipantChangedReason.JoinedConversation,this.toParticipants(!0),t.sessionId)),this.me.isHost){let e=this.privConversationTranslator?.properties.getProperty(i.PropertyId.ConversationTranslator_Name);e!==void 0&&e.length>0&&e!==this.me.displayName&&this.changeNicknameAsync(e)}}catch{}},this.onConversationExpiration=(e,t)=>{try{this.privConversationTranslator&&this.privConversationTranslator.conversationExpiration(this.privConversationTranslator,t)}catch{}},this.privIsConnected=!1,this.privIsDisposed=!1,this.privConversationId=``,this.privProperties=new i.PropertyCollection,this.privManager=new t.ConversationManager,e.getProperty(i.PropertyId[i.PropertyId.SpeechServiceConnection_RecoLanguage])||e.setProperty(i.PropertyId[i.PropertyId.SpeechServiceConnection_RecoLanguage],t.ConversationConnectionConfig.defaultLanguageCode),this.privLanguage=e.getProperty(i.PropertyId[i.PropertyId.SpeechServiceConnection_RecoLanguage]),this.privConversationId=n,this.privConfig=e;let a=e;r.Contracts.throwIfNull(a,`speechConfig`),this.privProperties=a.properties.clone(),this.privIsConnected=!1,this.privParticipants=new t.InternalParticipants,this.privIsReady=!1,this.privTextMessageMaxLength=1e3}get room(){return this.privRoom}get connection(){return this.privConversationRecognizer}get config(){return this.privConfig}get meetingId(){return this.privRoom?this.privRoom.roomId:this.privConversationId}get properties(){return this.privProperties}get speechRecognitionLanguage(){return this.privLanguage}get isMutedByHost(){return this.privParticipants.me?.isHost?!1:this.privParticipants.me?.isMuted}get isConnected(){return this.privIsConnected&&this.privIsReady}get participants(){return this.toParticipants(!0)}get me(){return this.toParticipant(this.privParticipants.me)}get host(){return this.toParticipant(this.privParticipants.host)}get transcriberRecognizer(){return this.privTranscriberRecognizer}get meetingInfo(){let e=this.meetingId,n=this.participants.map(e=>({id:e.id,preferredLanguage:e.preferredLanguage,voice:e.voice})),r={};for(let e of t.ConversationConnectionConfig.transcriptionEventKeys){let t=this.properties.getProperty(e,``);t!==``&&(r[e]=t)}return{id:e,participants:n,meetingProperties:r}}get canSend(){return this.privIsConnected&&!this.privParticipants.me?.isMuted}get canSendAsHost(){return this.privIsConnected&&this.privParticipants.me?.isHost}get authorizationToken(){return this.privToken}set authorizationToken(e){r.Contracts.throwIfNullOrWhitespace(e,`authorizationToken`),this.privToken=e}createMeetingAsync(e,t){try{this.privConversationRecognizer&&this.handleError(Error(this.privErrors.permissionDeniedStart),t),this.privManager.createOrJoin(this.privProperties,void 0,(n=>{n||this.handleError(Error(this.privErrors.permissionDeniedConnect),t),this.privRoom=n,this.handleCallback(e,t)}),(e=>{this.handleError(e,t)}))}catch(e){this.handleError(e,t)}}startMeetingAsync(e,t){try{this.privConversationRecognizer&&this.handleError(Error(this.privErrors.permissionDeniedStart),t),r.Contracts.throwIfNullOrUndefined(this.privRoom,this.privErrors.permissionDeniedConnect),this.privParticipants.meId=this.privRoom.participantId,this.privConversationRecognizer.connected=this.onConnected,this.privConversationRecognizer.disconnected=this.onDisconnected,this.privConversationRecognizer.canceled=this.onCanceled,this.privConversationRecognizer.participantUpdateCommandReceived=this.onParticipantUpdateCommandReceived,this.privConversationRecognizer.lockRoomCommandReceived=this.onLockRoomCommandReceived,this.privConversationRecognizer.muteAllCommandReceived=this.onMuteAllCommandReceived,this.privConversationRecognizer.participantJoinCommandReceived=this.onParticipantJoinCommandReceived,this.privConversationRecognizer.participantLeaveCommandReceived=this.onParticipantLeaveCommandReceived,this.privConversationRecognizer.translationReceived=this.onTranslationReceived,this.privConversationRecognizer.participantsListReceived=this.onParticipantsListReceived,this.privConversationRecognizer.conversationExpiration=this.onConversationExpiration,this.privConversationRecognizer.connect(this.privRoom.token,(()=>{this.handleCallback(e,t)}),(e=>{this.handleError(e,t)}))}catch(e){this.handleError(e,t)}}addParticipantAsync(e,t,i){r.Contracts.throwIfNullOrUndefined(e,`Participant`),(0,n.marshalPromiseToCallbacks)(this.addParticipantImplAsync(e),t,i)}joinMeetingAsync(e,t,n,i,a){try{r.Contracts.throwIfNullOrWhitespace(e,this.privErrors.invalidArgs.replace(`{arg}`,`conversationId`)),r.Contracts.throwIfNullOrWhitespace(t,this.privErrors.invalidArgs.replace(`{arg}`,`nickname`)),r.Contracts.throwIfNullOrWhitespace(n,this.privErrors.invalidArgs.replace(`{arg}`,`language`)),this.privManager.createOrJoin(this.privProperties,e,(e=>{r.Contracts.throwIfNullOrUndefined(e,this.privErrors.permissionDeniedConnect),this.privRoom=e,this.privConfig.authorizationToken=e.cognitiveSpeechAuthToken,i&&i(e.cognitiveSpeechAuthToken)}),(e=>{this.handleError(e,a)}))}catch(e){this.handleError(e,a)}}deleteMeetingAsync(e,t){(0,n.marshalPromiseToCallbacks)(this.deleteMeetingImplAsync(),e,t)}async deleteMeetingImplAsync(){r.Contracts.throwIfNullOrUndefined(this.privProperties,this.privErrors.permissionDeniedConnect),r.Contracts.throwIfNullOrWhitespace(this.privRoom.token,this.privErrors.permissionDeniedConnect),await this.privManager.leave(this.privProperties,this.privRoom.token),this.dispose()}endMeetingAsync(e,t){(0,n.marshalPromiseToCallbacks)(this.endMeetingImplAsync(),e,t)}endMeetingImplAsync(){return this.close(!0)}lockMeetingAsync(e,t){try{r.Contracts.throwIfDisposed(this.privIsDisposed),r.Contracts.throwIfDisposed(this.privConversationRecognizer.isDisposed()),r.Contracts.throwIfNullOrUndefined(this.privRoom,this.privErrors.permissionDeniedSend),this.canSendAsHost||this.handleError(Error(this.privErrors.permissionDeniedConversation.replace(`{command}`,`lock`)),t),this.privConversationRecognizer&&this.privConversationRecognizer.sendRequest(this.getLockCommand(!0),(()=>{this.handleCallback(e,t)}),(e=>{this.handleError(e,t)}))}catch(e){this.handleError(e,t)}}muteAllParticipantsAsync(e,t){try{r.Contracts.throwIfDisposed(this.privIsDisposed),r.Contracts.throwIfDisposed(this.privConversationRecognizer.isDisposed()),r.Contracts.throwIfNullOrUndefined(this.privConversationRecognizer,this.privErrors.permissionDeniedSend),r.Contracts.throwIfNullOrUndefined(this.privRoom,this.privErrors.permissionDeniedSend),this.canSendAsHost||this.handleError(Error(this.privErrors.permissionDeniedConversation.replace(`{command}`,`mute`)),t),this.privConversationRecognizer&&this.privConversationRecognizer.sendRequest(this.getMuteAllCommand(!0),(()=>{this.handleCallback(e,t)}),(e=>{this.handleError(e,t)}))}catch(e){this.handleError(e,t)}}muteParticipantAsync(e,t,n){try{r.Contracts.throwIfDisposed(this.privIsDisposed),r.Contracts.throwIfDisposed(this.privConversationRecognizer.isDisposed()),r.Contracts.throwIfNullOrWhitespace(e,this.privErrors.invalidArgs.replace(`{arg}`,`userId`)),r.Contracts.throwIfNullOrUndefined(this.privRoom,this.privErrors.permissionDeniedSend),this.canSend||this.handleError(Error(this.privErrors.permissionDeniedSend),n),!this.me.isHost&&this.me.id!==e&&this.handleError(Error(this.privErrors.permissionDeniedParticipant.replace(`{command}`,`mute`)),n),this.privParticipants.getParticipantIndex(e)===-1&&this.handleError(Error(this.privErrors.invalidParticipantRequest),n),this.privConversationRecognizer&&this.privConversationRecognizer.sendRequest(this.getMuteCommand(e,!0),(()=>{this.handleCallback(t,n)}),(e=>{this.handleError(e,n)}))}catch(e){this.handleError(e,n)}}removeParticipantAsync(e,t,i){try{if(r.Contracts.throwIfDisposed(this.privIsDisposed),this.privTranscriberRecognizer&&e.hasOwnProperty(`id`))(0,n.marshalPromiseToCallbacks)(this.removeParticipantImplAsync(e),t,i);else{r.Contracts.throwIfDisposed(this.privConversationRecognizer.isDisposed()),r.Contracts.throwIfNullOrUndefined(this.privRoom,this.privErrors.permissionDeniedSend),this.canSendAsHost||this.handleError(Error(this.privErrors.permissionDeniedParticipant.replace(`{command}`,`remove`)),i);let n=``;typeof e==`string`?n=e:e.hasOwnProperty(`id`)?n=e.id:e.hasOwnProperty(`userId`)&&(n=e.userId),r.Contracts.throwIfNullOrWhitespace(n,this.privErrors.invalidArgs.replace(`{arg}`,`userId`)),this.participants.findIndex(e=>e.id===n)===-1&&this.handleError(Error(this.privErrors.invalidParticipantRequest),i),this.privConversationRecognizer&&this.privConversationRecognizer.sendRequest(this.getEjectCommand(n),(()=>{this.handleCallback(t,i)}),(e=>{this.handleError(e,i)}))}}catch(e){this.handleError(e,i)}}unlockMeetingAsync(e,t){try{r.Contracts.throwIfDisposed(this.privIsDisposed),r.Contracts.throwIfDisposed(this.privConversationRecognizer.isDisposed()),r.Contracts.throwIfNullOrUndefined(this.privRoom,this.privErrors.permissionDeniedSend),this.canSendAsHost||this.handleError(Error(this.privErrors.permissionDeniedConversation.replace(`{command}`,`unlock`)),t),this.privConversationRecognizer&&this.privConversationRecognizer.sendRequest(this.getLockCommand(!1),(()=>{this.handleCallback(e,t)}),(e=>{this.handleError(e,t)}))}catch(e){this.handleError(e,t)}}unmuteAllParticipantsAsync(e,t){try{r.Contracts.throwIfDisposed(this.privIsDisposed),r.Contracts.throwIfDisposed(this.privConversationRecognizer.isDisposed()),r.Contracts.throwIfNullOrUndefined(this.privRoom,this.privErrors.permissionDeniedSend),this.canSendAsHost||this.handleError(Error(this.privErrors.permissionDeniedConversation.replace(`{command}`,`unmute all`)),t),this.privConversationRecognizer&&this.privConversationRecognizer.sendRequest(this.getMuteAllCommand(!1),(()=>{this.handleCallback(e,t)}),(e=>{this.handleError(e,t)}))}catch(e){this.handleError(e,t)}}unmuteParticipantAsync(e,t,n){try{r.Contracts.throwIfDisposed(this.privIsDisposed),r.Contracts.throwIfDisposed(this.privConversationRecognizer.isDisposed()),r.Contracts.throwIfNullOrWhitespace(e,this.privErrors.invalidArgs.replace(`{arg}`,`userId`)),r.Contracts.throwIfNullOrUndefined(this.privRoom,this.privErrors.permissionDeniedSend),this.canSend||this.handleError(Error(this.privErrors.permissionDeniedSend),n),!this.me.isHost&&this.me.id!==e&&this.handleError(Error(this.privErrors.permissionDeniedParticipant.replace(`{command}`,`mute`)),n),this.privParticipants.getParticipantIndex(e)===-1&&this.handleError(Error(this.privErrors.invalidParticipantRequest),n),this.privConversationRecognizer&&this.privConversationRecognizer.sendRequest(this.getMuteCommand(e,!1),(()=>{this.handleCallback(t,n)}),(e=>{this.handleError(e,n)}))}catch(e){this.handleError(e,n)}}sendTextMessageAsync(e,t,n){try{r.Contracts.throwIfDisposed(this.privIsDisposed),r.Contracts.throwIfDisposed(this.privConversationRecognizer.isDisposed()),r.Contracts.throwIfNullOrWhitespace(e,this.privErrors.invalidArgs.replace(`{arg}`,`message`)),r.Contracts.throwIfNullOrUndefined(this.privRoom,this.privErrors.permissionDeniedSend),this.canSend||this.handleError(Error(this.privErrors.permissionDeniedSend),n),e.length>this.privTextMessageMaxLength&&this.handleError(Error(this.privErrors.invalidArgs.replace(`{arg}`,`message length`)),n),this.privConversationRecognizer&&this.privConversationRecognizer.sendRequest(this.getMessageCommand(e),(()=>{this.handleCallback(t,n)}),(e=>{this.handleError(e,n)}))}catch(e){this.handleError(e,n)}}setTranslatedLanguagesAsync(e,t,n){try{r.Contracts.throwIfDisposed(this.privIsDisposed),r.Contracts.throwIfDisposed(this.privConversationRecognizer.isDisposed()),r.Contracts.throwIfArrayEmptyOrWhitespace(e,this.privErrors.invalidArgs.replace(`{arg}`,`languages`)),r.Contracts.throwIfNullOrUndefined(this.privRoom,this.privErrors.permissionDeniedSend),this.canSend||this.handleError(Error(this.privErrors.permissionDeniedSend),n),this.privConversationRecognizer&&this.privConversationRecognizer.sendRequest(this.getSetTranslateToLanguagesCommand(e),(()=>{this.handleCallback(t,n)}),(e=>{this.handleError(e,n)}))}catch(e){this.handleError(e,n)}}changeNicknameAsync(e,t,n){try{r.Contracts.throwIfDisposed(this.privIsDisposed),r.Contracts.throwIfDisposed(this.privConversationRecognizer.isDisposed()),r.Contracts.throwIfNullOrWhitespace(e,this.privErrors.invalidArgs.replace(`{arg}`,`nickname`)),r.Contracts.throwIfNullOrUndefined(this.privRoom,this.privErrors.permissionDeniedSend),this.canSend||this.handleError(Error(this.privErrors.permissionDeniedSend),n),this.privConversationRecognizer&&this.privConversationRecognizer.sendRequest(this.getChangeNicknameCommand(e),(()=>{this.handleCallback(t,n)}),(e=>{this.handleError(e,n)}))}catch(e){this.handleError(e,n)}}isDisposed(){return this.privIsDisposed}dispose(){this.isDisposed||(this.privIsDisposed=!0,this.config&&this.config.close(),this.privConfig=void 0,this.privLanguage=void 0,this.privProperties=void 0,this.privRoom=void 0,this.privToken=void 0,this.privManager=void 0,this.privIsConnected=!1,this.privIsReady=!1,this.privParticipants=void 0)}async connectTranscriberRecognizer(e){this.privTranscriberRecognizer&&await this.privTranscriberRecognizer.close(),await e.enforceAudioGating(),this.privTranscriberRecognizer=e,this.privTranscriberRecognizer.meeting=this}getKeepAlive(){let e=this.me?this.me.displayName:`default_nickname`;return JSON.stringify({id:`0`,nickname:e,participantId:this.privRoom.participantId,roomId:this.privRoom.roomId,type:t.ConversationTranslatorMessageTypes.keepAlive})}addParticipantImplAsync(e){if(this.privParticipants.addOrUpdateParticipant(e)!==void 0&&this.privTranscriberRecognizer){let t=this.meetingInfo;return t.participants=[e],this.privTranscriberRecognizer.pushMeetingEvent(t,`join`)}}removeParticipantImplAsync(e){this.privParticipants.deleteParticipant(e.id);let t=this.meetingInfo;return t.participants=[e],this.privTranscriberRecognizer.pushMeetingEvent(t,`leave`)}async close(e){try{this.privIsConnected=!1,await this.privConversationRecognizer?.close(),this.privConversationRecognizer=void 0,this.privConversationTranslator&&this.privConversationTranslator.dispose()}catch(e){throw e}e&&this.dispose()}handleCallback(e,t){if(e){try{e()}catch(e){t&&t(e)}e=void 0}}handleError(e,t){if(t)if(e instanceof Error){let n=e;t(n.name+`: `+n.message)}else t(e)}toParticipants(e){let t=this.privParticipants.participants.map(e=>this.toParticipant(e));return e?t:t.filter(e=>e.isHost===!1)}toParticipant(e){return new i.Participant(e.id,e.avatar,e.displayName,e.isHost,e.isMuted,e.isUsingTts,e.preferredLanguage,e.voice)}getMuteAllCommand(e){return r.Contracts.throwIfNullOrWhitespace(this.privRoom.roomId,`meetingd`),r.Contracts.throwIfNullOrWhitespace(this.privRoom.participantId,`participantId`),JSON.stringify({command:t.ConversationTranslatorCommandTypes.setMuteAll,participantId:this.privRoom.participantId,roomid:this.privRoom.roomId,type:t.ConversationTranslatorMessageTypes.participantCommand,value:e})}getMuteCommand(e,n){return r.Contracts.throwIfNullOrWhitespace(this.privRoom.roomId,`conversationId`),r.Contracts.throwIfNullOrWhitespace(e,`participantId`),JSON.stringify({command:t.ConversationTranslatorCommandTypes.setMute,participantId:e,roomid:this.privRoom.roomId,type:t.ConversationTranslatorMessageTypes.participantCommand,value:n})}getLockCommand(e){return r.Contracts.throwIfNullOrWhitespace(this.privRoom.roomId,`meetingId`),r.Contracts.throwIfNullOrWhitespace(this.privRoom.participantId,`participantId`),JSON.stringify({command:t.ConversationTranslatorCommandTypes.setLockState,participantId:this.privRoom.participantId,roomid:this.privRoom.roomId,type:t.ConversationTranslatorMessageTypes.participantCommand,value:e})}getEjectCommand(e){return r.Contracts.throwIfNullOrWhitespace(this.privRoom.roomId,`meetingId`),r.Contracts.throwIfNullOrWhitespace(e,`participantId`),JSON.stringify({command:t.ConversationTranslatorCommandTypes.ejectParticipant,participantId:e,roomid:this.privRoom.roomId,type:t.ConversationTranslatorMessageTypes.participantCommand})}getSetTranslateToLanguagesCommand(e){return r.Contracts.throwIfNullOrWhitespace(this.privRoom.roomId,`meetingId`),r.Contracts.throwIfNullOrWhitespace(this.privRoom.participantId,`participantId`),JSON.stringify({command:t.ConversationTranslatorCommandTypes.setTranslateToLanguages,participantId:this.privRoom.participantId,roomid:this.privRoom.roomId,type:t.ConversationTranslatorMessageTypes.participantCommand,value:e})}getChangeNicknameCommand(e){return r.Contracts.throwIfNullOrWhitespace(this.privRoom.roomId,`meetingId`),r.Contracts.throwIfNullOrWhitespace(e,`nickname`),r.Contracts.throwIfNullOrWhitespace(this.privRoom.participantId,`participantId`),JSON.stringify({command:t.ConversationTranslatorCommandTypes.changeNickname,nickname:e,participantId:this.privRoom.participantId,roomid:this.privRoom.roomId,type:t.ConversationTranslatorMessageTypes.participantCommand,value:e})}getMessageCommand(e){return r.Contracts.throwIfNullOrWhitespace(this.privRoom.roomId,`meetingId`),r.Contracts.throwIfNullOrWhitespace(this.privRoom.participantId,`participantId`),r.Contracts.throwIfNullOrWhitespace(e,`message`),JSON.stringify({participantId:this.privRoom.participantId,roomId:this.privRoom.roomId,text:e,type:t.ConversationTranslatorMessageTypes.instantMessage})}};e.MeetingImpl=o})),rn=e((e=>{Object.defineProperty(e,`__esModule`,{value:!0}),e.MeetingTranscriptionCanceledEventArgs=void 0;var t=H();e.MeetingTranscriptionCanceledEventArgs=class extends t.CancellationEventArgsBase{}})),an=e((e=>{Object.defineProperty(e,`__esModule`,{value:!0}),e.MeetingTranscriber=void 0;var t=$(),n=j(),r=I(),i=Y(),a=q();e.MeetingTranscriber=class{constructor(e){this.privAudioConfig=e,this.privProperties=new i.PropertyCollection,this.privRecognizer=void 0,this.privDisposedRecognizer=!1}get speechRecognitionLanguage(){return r.Contracts.throwIfDisposed(this.privDisposedRecognizer),this.properties.getProperty(i.PropertyId.SpeechServiceConnection_RecoLanguage)}get properties(){return this.privProperties}get internalData(){return this.privRecognizer.internalData}get connection(){return i.Connection.fromRecognizer(this.privRecognizer)}get authorizationToken(){return this.properties.getProperty(i.PropertyId.SpeechServiceAuthorization_Token)}set authorizationToken(e){r.Contracts.throwIfNullOrWhitespace(e,`token`),this.properties.setProperty(i.PropertyId.SpeechServiceAuthorization_Token,e)}joinMeetingAsync(e,i,o){let s=e;r.Contracts.throwIfNullOrUndefined(a.MeetingImpl,`Meeting`),this.privRecognizer=new t.TranscriberRecognizer(e.config,this.privAudioConfig),r.Contracts.throwIfNullOrUndefined(this.privRecognizer,`Recognizer`),this.privRecognizer.connectMeetingCallbacks(this),(0,n.marshalPromiseToCallbacks)(s.connectTranscriberRecognizer(this.privRecognizer),i,o)}startTranscribingAsync(e,t){this.privRecognizer.startContinuousRecognitionAsync(e,t)}stopTranscribingAsync(e,t){this.privRecognizer.stopContinuousRecognitionAsync(e,t)}leaveMeetingAsync(e,t){this.privRecognizer.disconnectCallbacks(),(0,n.marshalPromiseToCallbacks)((async()=>{})(),e,t)}close(e,t){r.Contracts.throwIfDisposed(this.privDisposedRecognizer),(0,n.marshalPromiseToCallbacks)(this.dispose(!0),e,t)}async dispose(e){this.privDisposedRecognizer||(this.privRecognizer&&=(await this.privRecognizer.close(),void 0),e&&(this.privDisposedRecognizer=!0))}}})),on=e((e=>{Object.defineProperty(e,`__esModule`,{value:!0}),e.ConversationTranscriptionResult=void 0;var t=Y();e.ConversationTranscriptionResult=class extends t.RecognitionResult{constructor(e,t,n,r,i,a,o,s,c,l,u){super(e,t,n,r,i,a,o,c,l,u),this.privSpeakerId=s}get speakerId(){return this.privSpeakerId}}})),q=e((e=>{Object.defineProperty(e,`__esModule`,{value:!0}),e.ConversationTranscriptionResult=e.MeetingTranscriber=e.MeetingTranscriptionCanceledEventArgs=e.MeetingImpl=e.Meeting=e.ParticipantChangedReason=e.User=e.Participant=e.ConversationTranscriber=e.ConversationTranslator=e.ConversationTranslationResult=e.ConversationTranslationEventArgs=e.ConversationTranslationCanceledEventArgs=e.ConversationParticipantsChangedEventArgs=e.ConversationExpirationEventArgs=e.ConversationCommon=e.ConversationImpl=e.Conversation=void 0;var t=Ut();Object.defineProperty(e,`Conversation`,{enumerable:!0,get:function(){return t.Conversation}}),Object.defineProperty(e,`ConversationImpl`,{enumerable:!0,get:function(){return t.ConversationImpl}});var n=Wt();Object.defineProperty(e,`ConversationCommon`,{enumerable:!0,get:function(){return n.ConversationCommon}});var r=Gt();Object.defineProperty(e,`ConversationExpirationEventArgs`,{enumerable:!0,get:function(){return r.ConversationExpirationEventArgs}});var i=Kt();Object.defineProperty(e,`ConversationParticipantsChangedEventArgs`,{enumerable:!0,get:function(){return i.ConversationParticipantsChangedEventArgs}});var a=qt();Object.defineProperty(e,`ConversationTranslationCanceledEventArgs`,{enumerable:!0,get:function(){return a.ConversationTranslationCanceledEventArgs}});var o=Jt();Object.defineProperty(e,`ConversationTranslationEventArgs`,{enumerable:!0,get:function(){return o.ConversationTranslationEventArgs}});var s=Yt();Object.defineProperty(e,`ConversationTranslationResult`,{enumerable:!0,get:function(){return s.ConversationTranslationResult}});var c=Qt();Object.defineProperty(e,`ConversationTranslator`,{enumerable:!0,get:function(){return c.ConversationTranslator}});var l=$t();Object.defineProperty(e,`ConversationTranscriber`,{enumerable:!0,get:function(){return l.ConversationTranscriber}});var u=en();Object.defineProperty(e,`Participant`,{enumerable:!0,get:function(){return u.Participant}}),Object.defineProperty(e,`User`,{enumerable:!0,get:function(){return u.User}});var d=tn();Object.defineProperty(e,`ParticipantChangedReason`,{enumerable:!0,get:function(){return d.ParticipantChangedReason}});var f=nn();Object.defineProperty(e,`Meeting`,{enumerable:!0,get:function(){return f.Meeting}}),Object.defineProperty(e,`MeetingImpl`,{enumerable:!0,get:function(){return f.MeetingImpl}});var p=rn();Object.defineProperty(e,`MeetingTranscriptionCanceledEventArgs`,{enumerable:!0,get:function(){return p.MeetingTranscriptionCanceledEventArgs}});var m=an();Object.defineProperty(e,`MeetingTranscriber`,{enumerable:!0,get:function(){return m.MeetingTranscriber}});var h=on();Object.defineProperty(e,`ConversationTranscriptionResult`,{enumerable:!0,get:function(){return h.ConversationTranscriptionResult}})})),J=e((e=>{Object.defineProperty(e,`__esModule`,{value:!0}),e.SynthesisRequest=e.Synthesizer=void 0;var t=$(),n=j(),r=I(),i=Y();e.Synthesizer=class e{constructor(e){let t=e;r.Contracts.throwIfNull(t,`speechConfig`),this.privProperties=t.properties.clone(),this.privDisposed=!1,this.privSynthesizing=!1,this.synthesisRequestQueue=new n.Queue,this.tokenCredential=e.tokenCredential}get authorizationToken(){return this.properties.getProperty(i.PropertyId.SpeechServiceAuthorization_Token)}set authorizationToken(e){r.Contracts.throwIfNullOrWhitespace(e,`token`),this.properties.setProperty(i.PropertyId.SpeechServiceAuthorization_Token,e)}get properties(){return this.privProperties}get autoDetectSourceLanguage(){return this.properties.getProperty(i.PropertyId.SpeechServiceConnection_AutoDetectSourceLanguages)===t.AutoDetectSourceLanguagesOpenRangeOptionName}buildSsml(t){let n={"af-ZA":`af-ZA-AdriNeural`,"am-ET":`am-ET-AmehaNeural`,"ar-AE":`ar-AE-FatimaNeural`,"ar-BH":`ar-BH-AliNeural`,"ar-DZ":`ar-DZ-AminaNeural`,"ar-EG":`ar-EG-SalmaNeural`,"ar-IQ":`ar-IQ-BasselNeural`,"ar-JO":`ar-JO-SanaNeural`,"ar-KW":`ar-KW-FahedNeural`,"ar-LY":`ar-LY-ImanNeural`,"ar-MA":`ar-MA-JamalNeural`,"ar-QA":`ar-QA-AmalNeural`,"ar-SA":`ar-SA-HamedNeural`,"ar-SY":`ar-SY-AmanyNeural`,"ar-TN":`ar-TN-HediNeural`,"ar-YE":`ar-YE-MaryamNeural`,"bg-BG":`bg-BG-BorislavNeural`,"bn-BD":`bn-BD-NabanitaNeural`,"bn-IN":`bn-IN-BashkarNeural`,"ca-ES":`ca-ES-JoanaNeural`,"cs-CZ":`cs-CZ-AntoninNeural`,"cy-GB":`cy-GB-AledNeural`,"da-DK":`da-DK-ChristelNeural`,"de-AT":`de-AT-IngridNeural`,"de-CH":`de-CH-JanNeural`,"de-DE":`de-DE-KatjaNeural`,"el-GR":`el-GR-AthinaNeural`,"en-AU":`en-AU-NatashaNeural`,"en-CA":`en-CA-ClaraNeural`,"en-GB":`en-GB-LibbyNeural`,"en-HK":`en-HK-SamNeural`,"en-IE":`en-IE-ConnorNeural`,"en-IN":`en-IN-NeerjaNeural`,"en-KE":`en-KE-AsiliaNeural`,"en-NG":`en-NG-AbeoNeural`,"en-NZ":`en-NZ-MitchellNeural`,"en-PH":`en-PH-JamesNeural`,"en-SG":`en-SG-LunaNeural`,"en-TZ":`en-TZ-ElimuNeural`,"en-US":`en-US-AvaMultilingualNeural`,"en-ZA":`en-ZA-LeahNeural`,"es-AR":`es-AR-ElenaNeural`,"es-BO":`es-BO-MarceloNeural`,"es-CL":`es-CL-CatalinaNeural`,"es-CO":`es-CO-GonzaloNeural`,"es-CR":`es-CR-JuanNeural`,"es-CU":`es-CU-BelkysNeural`,"es-DO":`es-DO-EmilioNeural`,"es-EC":`es-EC-AndreaNeural`,"es-ES":`es-ES-AlvaroNeural`,"es-GQ":`es-GQ-JavierNeural`,"es-GT":`es-GT-AndresNeural`,"es-HN":`es-HN-CarlosNeural`,"es-MX":`es-MX-DaliaNeural`,"es-NI":`es-NI-FedericoNeural`,"es-PA":`es-PA-MargaritaNeural`,"es-PE":`es-PE-AlexNeural`,"es-PR":`es-PR-KarinaNeural`,"es-PY":`es-PY-MarioNeural`,"es-SV":`es-SV-LorenaNeural`,"es-US":`es-US-AlonsoNeural`,"es-UY":`es-UY-MateoNeural`,"es-VE":`es-VE-PaolaNeural`,"et-EE":`et-EE-AnuNeural`,"fa-IR":`fa-IR-DilaraNeural`,"fi-FI":`fi-FI-SelmaNeural`,"fil-PH":`fil-PH-AngeloNeural`,"fr-BE":`fr-BE-CharlineNeural`,"fr-CA":`fr-CA-SylvieNeural`,"fr-CH":`fr-CH-ArianeNeural`,"fr-FR":`fr-FR-DeniseNeural`,"ga-IE":`ga-IE-ColmNeural`,"gl-ES":`gl-ES-RoiNeural`,"gu-IN":`gu-IN-DhwaniNeural`,"he-IL":`he-IL-AvriNeural`,"hi-IN":`hi-IN-MadhurNeural`,"hr-HR":`hr-HR-GabrijelaNeural`,"hu-HU":`hu-HU-NoemiNeural`,"id-ID":`id-ID-ArdiNeural`,"is-IS":`is-IS-GudrunNeural`,"it-IT":`it-IT-IsabellaNeural`,"ja-JP":`ja-JP-NanamiNeural`,"jv-ID":`jv-ID-DimasNeural`,"kk-KZ":`kk-KZ-AigulNeural`,"km-KH":`km-KH-PisethNeural`,"kn-IN":`kn-IN-GaganNeural`,"ko-KR":`ko-KR-SunHiNeural`,"lo-LA":`lo-LA-ChanthavongNeural`,"lt-LT":`lt-LT-LeonasNeural`,"lv-LV":`lv-LV-EveritaNeural`,"mk-MK":`mk-MK-AleksandarNeural`,"ml-IN":`ml-IN-MidhunNeural`,"mr-IN":`mr-IN-AarohiNeural`,"ms-MY":`ms-MY-OsmanNeural`,"mt-MT":`mt-MT-GraceNeural`,"my-MM":`my-MM-NilarNeural`,"nb-NO":`nb-NO-PernilleNeural`,"nl-BE":`nl-BE-ArnaudNeural`,"nl-NL":`nl-NL-ColetteNeural`,"pl-PL":`pl-PL-AgnieszkaNeural`,"ps-AF":`ps-AF-GulNawazNeural`,"pt-BR":`pt-BR-FranciscaNeural`,"pt-PT":`pt-PT-DuarteNeural`,"ro-RO":`ro-RO-AlinaNeural`,"ru-RU":`ru-RU-SvetlanaNeural`,"si-LK":`si-LK-SameeraNeural`,"sk-SK":`sk-SK-LukasNeural`,"sl-SI":`sl-SI-PetraNeural`,"so-SO":`so-SO-MuuseNeural`,"sr-RS":`sr-RS-NicholasNeural`,"su-ID":`su-ID-JajangNeural`,"sv-SE":`sv-SE-SofieNeural`,"sw-KE":`sw-KE-RafikiNeural`,"sw-TZ":`sw-TZ-DaudiNeural`,"ta-IN":`ta-IN-PallaviNeural`,"ta-LK":`ta-LK-KumarNeural`,"ta-SG":`ta-SG-AnbuNeural`,"te-IN":`te-IN-MohanNeural`,"th-TH":`th-TH-PremwadeeNeural`,"tr-TR":`tr-TR-AhmetNeural`,"uk-UA":`uk-UA-OstapNeural`,"ur-IN":`ur-IN-GulNeural`,"ur-PK":`ur-PK-AsadNeural`,"uz-UZ":`uz-UZ-MadinaNeural`,"vi-VN":`vi-VN-HoaiMyNeural`,"zh-CN":`zh-CN-XiaoxiaoNeural`,"zh-HK":`zh-HK-HiuMaanNeural`,"zh-TW":`zh-TW-HsiaoChenNeural`,"zu-ZA":`zu-ZA-ThandoNeural`},r=this.properties.getProperty(i.PropertyId.SpeechServiceConnection_SynthLanguage,`en-US`),a=this.properties.getProperty(i.PropertyId.SpeechServiceConnection_SynthVoice,``),o=e.XMLEncode(t);return this.autoDetectSourceLanguage?r=`en-US`:a||=n[r],a&&(o=`<voice name='${a}'>${o}</voice>`),o=`<speak version='1.0' xmlns='http://www.w3.org/2001/10/synthesis' xmlns:mstts='http://www.w3.org/2001/mstts' xmlns:emo='http://www.w3.org/2009/10/emotionml' xml:lang='${r}'>${o}</speak>`,o}async dispose(e){this.privDisposed||=(e&&this.privAdapter&&await this.privAdapter.dispose(),!0)}async adapterSpeak(){if(!this.privDisposed&&!this.privSynthesizing){this.privSynthesizing=!0;let e=await this.synthesisRequestQueue.dequeue();return this.privAdapter.Speak(e.text,e.isSSML,e.requestId,e.cb,e.err,e.dataStream)}}createSynthesizerConfig(e){return new t.SynthesizerConfig(e,this.privProperties)}implCommonSynthesizeSetup(){let e=typeof window<`u`?`Browser`:`Node`,n=`unknown`,r=`unknown`;typeof navigator<`u`&&(e=e+`/`+navigator.platform,n=navigator.userAgent,r=navigator.appVersion);let a=this.createSynthesizerConfig(new t.SpeechServiceConfig(new t.Context(new t.OS(e,n,r)))),o=this.privProperties.getProperty(i.PropertyId.SpeechServiceConnection_Key,void 0),s=o&&o!==``?new t.CognitiveSubscriptionKeyAuthentication(o):this.tokenCredential?new t.CognitiveTokenAuthentication(async()=>{try{return(await this.tokenCredential.getToken(`https://cognitiveservices.azure.com/.default`))?.token??``}catch(e){throw e}},async()=>{try{return(await this.tokenCredential.getToken(`https://cognitiveservices.azure.com/.default`))?.token??``}catch(e){throw e}}):new t.CognitiveTokenAuthentication(()=>{let e=this.privProperties.getProperty(i.PropertyId.SpeechServiceAuthorization_Token,void 0);return Promise.resolve(e)},()=>{let e=this.privProperties.getProperty(i.PropertyId.SpeechServiceAuthorization_Token,void 0);return Promise.resolve(e)});this.privAdapter=this.createSynthesisAdapter(s,this.privConnectionFactory,a),this.privRestAdapter=this.createRestSynthesisAdapter(s,a)}static XMLEncode(e){return e.replace(/&/g,`&amp;`).replace(/</g,`&lt;`).replace(/>/g,`&gt;`).replace(/"/g,`&quot;`).replace(/'/g,`&apos;`)}},e.SynthesisRequest=class{constructor(e,t,n,r,i,a){this.requestId=e,this.text=t,this.isSSML=n,this.cb=r,this.err=i,this.dataStream=a}}})),sn=e((e=>{Object.defineProperty(e,`__esModule`,{value:!0}),e.SpeechSynthesizer=void 0;var t=$(),n=j(),r=Ue(),i=B(),a=V(),o=I(),s=Y(),c=J();e.SpeechSynthesizer=class e extends s.Synthesizer{constructor(e,n){super(e),n!==null&&(n===void 0?this.audioConfig=typeof window>`u`?void 0:s.AudioConfig.fromDefaultSpeakerOutput():this.audioConfig=n),this.privConnectionFactory=new t.SpeechSynthesisConnectionFactory,this.implCommonSynthesizeSetup()}static FromConfig(t,n,r){let i=t;return n.properties.mergeTo(i.properties),new e(t,r)}speakTextAsync(e,t,n,r){this.speakImpl(e,!1,t,n,r)}speakSsmlAsync(e,t,n,r){this.speakImpl(e,!0,t,n,r)}async getVoicesAsync(e=``){return this.getVoices(e)}close(e,t){o.Contracts.throwIfDisposed(this.privDisposed),(0,n.marshalPromiseToCallbacks)(this.dispose(!0),e,t)}get internalData(){return this.privAdapter}createSynthesisAdapter(e,n,r){return new t.SpeechSynthesisAdapter(e,n,r,this,this.audioConfig)}createRestSynthesisAdapter(e,n){return new t.SynthesisRestAdapter(n,e)}implCommonSynthesizeSetup(){super.implCommonSynthesizeSetup(),this.privAdapter.audioOutputFormat=i.AudioOutputFormatImpl.fromSpeechSynthesisOutputFormat(s.SpeechSynthesisOutputFormat[this.properties.getProperty(s.PropertyId.SpeechServiceConnection_SynthOutputFormat,void 0)])}speakImpl(e,t,i,l,u){try{o.Contracts.throwIfDisposed(this.privDisposed);let d=(0,n.createNoDashGuid)(),f;f=u instanceof s.PushAudioOutputStreamCallback?new a.PushAudioOutputStreamImpl(u):u instanceof s.PullAudioOutputStream?u:u===void 0?void 0:new r.AudioFileWriter(u),this.synthesisRequestQueue.enqueue(new c.SynthesisRequest(d,e,t,e=>{if(this.privSynthesizing=!1,i)try{i(e)}catch(e){l&&l(e)}i=void 0,this.adapterSpeak().catch(()=>{})},e=>{l&&l(e)},f)),this.adapterSpeak().catch(()=>{})}catch(e){if(l)if(e instanceof Error){let t=e;l(t.name+`: `+t.message)}else l(e);this.dispose(!0).catch(()=>{})}}async getVoices(e){let t=(0,n.createNoDashGuid)(),r=await this.privRestAdapter.getVoicesList(t);if(r.ok&&Array.isArray(r.json)){let n=r.json;return e&&e.length>0&&(n=n.filter(t=>!!t.Locale&&t.Locale.toLowerCase()===e.toLowerCase())),new s.SynthesisVoicesResult(t,n,void 0)}else return new s.SynthesisVoicesResult(t,void 0,`Error: ${r.status}: ${r.statusText}`)}}})),cn=e((e=>{Object.defineProperty(e,`__esModule`,{value:!0}),e.SynthesisResult=void 0,e.SynthesisResult=class{constructor(e,t,n,r){this.privResultId=e,this.privReason=t,this.privErrorDetails=n,this.privProperties=r}get resultId(){return this.privResultId}get reason(){return this.privReason}get errorDetails(){return this.privErrorDetails}get properties(){return this.privProperties}}})),ln=e((e=>{Object.defineProperty(e,`__esModule`,{value:!0}),e.SpeechSynthesisResult=void 0;var t=Y();e.SpeechSynthesisResult=class extends t.SynthesisResult{constructor(e,t,n,r,i,a){super(e,t,r,i),this.privAudioData=n,this.privAudioDuration=a}get audioData(){return this.privAudioData}get audioDuration(){return this.privAudioDuration}}})),un=e((e=>{Object.defineProperty(e,`__esModule`,{value:!0}),e.SpeechSynthesisEventArgs=void 0,e.SpeechSynthesisEventArgs=class{constructor(e){this.privResult=e}get result(){return this.privResult}}})),dn=e((e=>{Object.defineProperty(e,`__esModule`,{value:!0}),e.SpeechSynthesisWordBoundaryEventArgs=void 0,e.SpeechSynthesisWordBoundaryEventArgs=class{constructor(e,t,n,r,i,a){this.privAudioOffset=e,this.privDuration=t,this.privText=n,this.privWordLength=r,this.privTextOffset=i,this.privBoundaryType=a}get audioOffset(){return this.privAudioOffset}get duration(){return this.privDuration}get text(){return this.privText}get wordLength(){return this.privWordLength}get textOffset(){return this.privTextOffset}get boundaryType(){return this.privBoundaryType}}})),fn=e((e=>{Object.defineProperty(e,`__esModule`,{value:!0}),e.SpeechSynthesisBookmarkEventArgs=void 0,e.SpeechSynthesisBookmarkEventArgs=class{constructor(e,t){this.privAudioOffset=e,this.privText=t}get audioOffset(){return this.privAudioOffset}get text(){return this.privText}}})),pn=e((e=>{Object.defineProperty(e,`__esModule`,{value:!0}),e.SpeechSynthesisVisemeEventArgs=void 0,e.SpeechSynthesisVisemeEventArgs=class{constructor(e,t,n){this.privAudioOffset=e,this.privVisemeId=t,this.privAnimation=n}get audioOffset(){return this.privAudioOffset}get visemeId(){return this.privVisemeId}get animation(){return this.privAnimation}}})),mn=e((e=>{Object.defineProperty(e,`__esModule`,{value:!0}),e.SpeechSynthesisBoundaryType=void 0,(function(e){e.Word=`WordBoundary`,e.Punctuation=`PunctuationBoundary`,e.Sentence=`SentenceBoundary`})(e.SpeechSynthesisBoundaryType||={})})),hn=e((e=>{Object.defineProperty(e,`__esModule`,{value:!0}),e.SynthesisVoicesResult=void 0;var t=Y();e.SynthesisVoicesResult=class extends t.SynthesisResult{constructor(e,n,r){if(Array.isArray(n)){super(e,t.ResultReason.VoicesListRetrieved,void 0,new t.PropertyCollection),this.privVoices=[];for(let e of n)this.privVoices.push(new t.VoiceInfo(e))}else super(e,t.ResultReason.Canceled,r||`Error information unavailable`,new t.PropertyCollection)}get voices(){return this.privVoices}}})),gn=e((e=>{Object.defineProperty(e,`__esModule`,{value:!0}),e.VoiceInfo=e.SynthesisVoiceType=e.SynthesisVoiceGender=void 0;var t;(function(e){e[e.Unknown=0]=`Unknown`,e[e.Female=1]=`Female`,e[e.Male=2]=`Male`,e[e.Neutral=3]=`Neutral`})(t=e.SynthesisVoiceGender||={});var n;(function(e){e[e.Unknown=0]=`Unknown`,e[e.OnlineNeural=1]=`OnlineNeural`,e[e.OnlineStandard=2]=`OnlineStandard`,e[e.OfflineNeural=3]=`OfflineNeural`,e[e.OfflineStandard=4]=`OfflineStandard`,e[e.OnlineNeuralHD=5]=`OnlineNeuralHD`})(n=e.SynthesisVoiceType||={});var r={[t[t.Neutral]]:t.Neutral,[t[t.Male]]:t.Male,[t[t.Female]]:t.Female},i={Neural:n.OnlineNeural,NeuralHD:n.OnlineNeuralHD};e.VoiceInfo=class{constructor(e){if(this.privStyleList=[],e){if(this.privName=e.Name,this.privLocale=e.Locale,this.privShortName=e.ShortName,this.privLocaleName=e.LocaleName,this.privDisplayName=e.DisplayName,this.privLocalName=e.LocalName,this.privVoiceType=i[e.VoiceType]||n.Unknown,this.privGender=r[e.Gender]||t.Unknown,e.StyleList&&Array.isArray(e.StyleList))for(let t of e.StyleList)this.privStyleList.push(t);this.privSampleRateHertz=e.SampleRateHertz,this.privStatus=e.Status,e.ExtendedPropertyMap&&(this.privExtendedPropertyMap=e.ExtendedPropertyMap),this.privWordsPerMinute=e.WordsPerMinute,Array.isArray(e.SecondaryLocaleList)&&(this.privSecondaryLocaleList=[...e.SecondaryLocaleList]),Array.isArray(e.RolePlayList)&&(this.privRolePlayList=[...e.RolePlayList]),e.VoiceTag&&(this.privVoiceTag=e.VoiceTag)}}get name(){return this.privName}get locale(){return this.privLocale}get shortName(){return this.privShortName}get displayName(){return this.privDisplayName}get localName(){return this.privLocalName}get localeName(){return this.privLocaleName}get gender(){return this.privGender}get voiceType(){return this.privVoiceType}get styleList(){return this.privStyleList}get sampleRateHertz(){return this.privSampleRateHertz}get status(){return this.privStatus}get extendedPropertyMap(){return this.privExtendedPropertyMap}get wordsPerMinute(){return this.privWordsPerMinute}get secondaryLocaleList(){return this.privSecondaryLocaleList}get rolePlayList(){return this.privRolePlayList}get voiceTag(){return this.privVoiceTag}}})),_n=e((e=>{Object.defineProperty(e,`__esModule`,{value:!0}),e.SpeakerAudioDestination=void 0;var t=j(),n=V(),r=L(),i=1800,a={[r.AudioFormatTag.PCM]:`audio/wav`,[r.AudioFormatTag.MuLaw]:`audio/x-wav`,[r.AudioFormatTag.MP3]:`audio/mpeg`,[r.AudioFormatTag.OGG_OPUS]:`audio/ogg`,[r.AudioFormatTag.WEBM_OPUS]:`audio/webm; codecs=opus`,[r.AudioFormatTag.ALaw]:`audio/x-wav`,[r.AudioFormatTag.FLAC]:`audio/flac`,[r.AudioFormatTag.AMR_WB]:`audio/amr-wb`,[r.AudioFormatTag.G722]:`audio/G722`};e.SpeakerAudioDestination=class{constructor(e){this.privPlaybackStarted=!1,this.privAppendingToBuffer=!1,this.privMediaSourceOpened=!1,this.privBytesReceived=0,this.privId=e||(0,t.createNoDashGuid)(),this.privIsPaused=!1,this.privIsClosed=!1}id(){return this.privId}write(e,t,n){this.privAudioBuffer===void 0?this.privAudioOutputStream!==void 0&&(this.privAudioOutputStream.write(e),this.privBytesReceived+=e.byteLength):(this.privAudioBuffer.push(e),this.updateSourceBuffer().then(()=>{t&&t()},e=>{n&&n(e)}))}close(e,t){if(this.privIsClosed=!0,this.privSourceBuffer!==void 0)this.handleSourceBufferUpdateEnd().then(()=>{e&&e()},e=>{t&&t(e)});else if(this.privAudioOutputStream!==void 0&&typeof window<`u`)if((this.privFormat.formatTag===r.AudioFormatTag.PCM||this.privFormat.formatTag===r.AudioFormatTag.MuLaw||this.privFormat.formatTag===r.AudioFormatTag.ALaw)&&this.privFormat.hasHeader===!1)console.warn(`Play back is not supported for raw PCM, mulaw or alaw format without header.`),this.onAudioEnd&&this.onAudioEnd(this);else{let n=new ArrayBuffer(this.privBytesReceived);this.privAudioOutputStream.read(n).then(()=>{n=this.privFormat.addHeader(n);let r=new Blob([n],{type:a[this.privFormat.formatTag]});this.privAudio.src=window.URL.createObjectURL(r),this.notifyPlayback().then(()=>{e&&e()},e=>{t&&t(e)})},e=>{t&&t(e)})}else this.onAudioEnd&&this.onAudioEnd(this)}set format(e){if(typeof AudioContext<`u`||typeof window<`u`&&window.webkitAudioContext!==void 0){this.privFormat=e;let o=a[this.privFormat.formatTag];o===void 0?console.warn(`Unknown mimeType for format ${r.AudioFormatTag[this.privFormat.formatTag]}; playback is not supported.`):typeof MediaSource<`u`&&MediaSource.isTypeSupported(o)?(this.privAudio=new Audio,this.privAudioBuffer=[],this.privMediaSource=new MediaSource,this.privAudio.src=URL.createObjectURL(this.privMediaSource),this.privAudio.load(),this.privMediaSource.onsourceopen=()=>{this.privMediaSourceOpened=!0,this.privMediaSource.duration=i,this.privSourceBuffer=this.privMediaSource.addSourceBuffer(o),this.privSourceBuffer.onupdate=()=>{this.updateSourceBuffer().catch(e=>{t.Events.instance.onEvent(new t.BackgroundEvent(e))})},this.privSourceBuffer.onupdateend=()=>{this.handleSourceBufferUpdateEnd().catch(e=>{t.Events.instance.onEvent(new t.BackgroundEvent(e))})},this.privSourceBuffer.onupdatestart=()=>{this.privAppendingToBuffer=!1}},this.updateSourceBuffer().catch(e=>{t.Events.instance.onEvent(new t.BackgroundEvent(e))})):(console.warn(`Format ${r.AudioFormatTag[this.privFormat.formatTag]} could not be played by MSE, streaming playback is not enabled.`),this.privAudioOutputStream=new n.PullAudioOutputStreamImpl,this.privAudioOutputStream.format=this.privFormat,this.privAudio=new Audio)}}get volume(){return this.privAudio?.volume??-1}set volume(e){this.privAudio&&(this.privAudio.volume=e)}mute(){this.privAudio&&(this.privAudio.muted=!0)}unmute(){this.privAudio&&(this.privAudio.muted=!1)}get isClosed(){return this.privIsClosed}get currentTime(){return this.privAudio===void 0?-1:this.privAudio.currentTime}pause(){!this.privIsPaused&&this.privAudio!==void 0&&(this.privAudio.pause(),this.privIsPaused=!0)}resume(e,t){this.privIsPaused&&this.privAudio!==void 0&&(this.privAudio.play().then(()=>{e&&e()},e=>{t&&t(e)}),this.privIsPaused=!1)}get internalAudio(){return this.privAudio}async updateSourceBuffer(){if(this.privAudioBuffer!==void 0&&this.privAudioBuffer.length>0&&this.sourceBufferAvailable()){this.privAppendingToBuffer=!0;let e=this.privAudioBuffer.shift();try{this.privSourceBuffer.appendBuffer(e)}catch{this.privAudioBuffer.unshift(e),console.log(`buffer filled, pausing addition of binaries until space is made`);return}await this.notifyPlayback()}else this.canEndStream()&&await this.handleSourceBufferUpdateEnd()}async handleSourceBufferUpdateEnd(){this.canEndStream()&&this.sourceBufferAvailable()&&(this.privMediaSource.endOfStream(),await this.notifyPlayback())}async notifyPlayback(){!this.privPlaybackStarted&&this.privAudio!==void 0&&(this.privPlaybackStarted=!0,this.onAudioStart&&this.onAudioStart(this),this.privAudio.onended=()=>{this.onAudioEnd&&this.onAudioEnd(this)},this.privIsPaused||await this.privAudio.play())}canEndStream(){return this.isClosed&&this.privSourceBuffer!==void 0&&this.privAudioBuffer.length===0&&this.privMediaSourceOpened&&!this.privAppendingToBuffer&&this.privMediaSource.readyState===`open`}sourceBufferAvailable(){return this.privSourceBuffer!==void 0&&!this.privSourceBuffer.updating}}})),vn=e((e=>{Object.defineProperty(e,`__esModule`,{value:!0}),e.ConversationTranscriptionCanceledEventArgs=void 0;var t=H();e.ConversationTranscriptionCanceledEventArgs=class extends t.CancellationEventArgsBase{}})),yn=e((e=>{Object.defineProperty(e,`__esModule`,{value:!0}),e.MeetingTranscriptionCanceledEventArgs=void 0;var t=H();e.MeetingTranscriptionCanceledEventArgs=class extends t.CancellationEventArgsBase{}})),bn=e((e=>{Object.defineProperty(e,`__esModule`,{value:!0}),e.PronunciationAssessmentGradingSystem=void 0,(function(e){e[e.FivePoint=1]=`FivePoint`,e[e.HundredMark=2]=`HundredMark`})(e.PronunciationAssessmentGradingSystem||={})})),xn=e((e=>{Object.defineProperty(e,`__esModule`,{value:!0}),e.PronunciationAssessmentGranularity=void 0,(function(e){e[e.Phoneme=1]=`Phoneme`,e[e.Word=2]=`Word`,e[e.FullText=3]=`FullText`})(e.PronunciationAssessmentGranularity||={})})),Sn=e((e=>{Object.defineProperty(e,`__esModule`,{value:!0}),e.PronunciationAssessmentConfig=void 0;var t=I(),n=Y();e.PronunciationAssessmentConfig=class e{constructor(e,r=n.PronunciationAssessmentGradingSystem.FivePoint,i=n.PronunciationAssessmentGranularity.Phoneme,a=!1){t.Contracts.throwIfNullOrUndefined(e,`referenceText`),this.privProperties=new n.PropertyCollection,this.privProperties.setProperty(n.PropertyId.PronunciationAssessment_ReferenceText,e),this.privProperties.setProperty(n.PropertyId.PronunciationAssessment_GradingSystem,n.PronunciationAssessmentGradingSystem[r]),this.privProperties.setProperty(n.PropertyId.PronunciationAssessment_Granularity,n.PronunciationAssessmentGranularity[i]),this.privProperties.setProperty(n.PropertyId.PronunciationAssessment_EnableMiscue,String(a))}static fromJSON(r){t.Contracts.throwIfNullOrUndefined(r,`json`);let i=new e(``);return i.privProperties=new n.PropertyCollection,i.properties.setProperty(n.PropertyId.PronunciationAssessment_Json,r),i}toJSON(){return this.updateJson(),this.privProperties.getProperty(n.PropertyId.PronunciationAssessment_Params)}applyTo(e){this.updateJson();let t=e.internalData;t.speechContext.setPronunciationAssessmentParams(this.properties.getProperty(n.PropertyId.PronunciationAssessment_Params),t.isSpeakerDiarizationEnabled)}get referenceText(){return this.properties.getProperty(n.PropertyId.PronunciationAssessment_ReferenceText)}set referenceText(e){t.Contracts.throwIfNullOrWhitespace(e,`referenceText`),this.properties.setProperty(n.PropertyId.PronunciationAssessment_ReferenceText,e)}set phonemeAlphabet(e){t.Contracts.throwIfNullOrWhitespace(e,`phonemeAlphabet`),this.privPhonemeAlphabet=e}set enableMiscue(e){let t=e?`true`:`false`;this.properties.setProperty(n.PropertyId.PronunciationAssessment_EnableMiscue,t)}get enableMiscue(){return this.properties.getProperty(n.PropertyId.PronunciationAssessment_EnableMiscue,`false`).toLowerCase()===`true`}set nbestPhonemeCount(e){this.privNBestPhonemeCount=e}set enableProsodyAssessment(e){this.privEnableProsodyAssessment=e}get properties(){return this.privProperties}updateJson(){let e=this.privProperties.getProperty(n.PropertyId.PronunciationAssessment_Json,`{}`),t=JSON.parse(e),r=this.privProperties.getProperty(n.PropertyId.PronunciationAssessment_ReferenceText);r&&(t.referenceText=r);let i=this.privProperties.getProperty(n.PropertyId.PronunciationAssessment_GradingSystem);i&&(t.gradingSystem=i);let a=this.privProperties.getProperty(n.PropertyId.PronunciationAssessment_Granularity);a&&(t.granularity=a),this.privPhonemeAlphabet&&(t.phonemeAlphabet=this.privPhonemeAlphabet),this.privNBestPhonemeCount&&(t.nbestPhonemeCount=this.privNBestPhonemeCount),t.enableProsodyAssessment=this.privEnableProsodyAssessment,t.dimension=`Comprehensive`,this.privProperties.getProperty(n.PropertyId.PronunciationAssessment_EnableMiscue)&&(t.enableMiscue=this.enableMiscue),this.privProperties.setProperty(n.PropertyId.PronunciationAssessment_Params,JSON.stringify(t))}}})),Cn=e((e=>{Object.defineProperty(e,`__esModule`,{value:!0}),e.PronunciationAssessmentResult=void 0;var t=I(),n=Y();e.PronunciationAssessmentResult=class e{constructor(e){let n=JSON.parse(e);t.Contracts.throwIfNullOrUndefined(n.NBest[0],`NBest`),this.privPronJson=n.NBest[0]}static fromResult(r){t.Contracts.throwIfNullOrUndefined(r,`result`);let i=r.properties.getProperty(n.PropertyId.SpeechServiceResponse_JsonResult);return t.Contracts.throwIfNullOrUndefined(i,`json`),new e(i)}get detailResult(){return this.privPronJson}get accuracyScore(){return this.detailResult.PronunciationAssessment?.AccuracyScore}get pronunciationScore(){return this.detailResult.PronunciationAssessment?.PronScore}get completenessScore(){return this.detailResult.PronunciationAssessment?.CompletenessScore}get fluencyScore(){return this.detailResult.PronunciationAssessment?.FluencyScore}get prosodyScore(){return this.detailResult.PronunciationAssessment?.ProsodyScore}}})),wn=e((e=>{Object.defineProperty(e,`__esModule`,{value:!0}),e.AvatarConfig=void 0;var t=I(),n=Y();e.AvatarConfig=class{constructor(e,r,i){this.privCustomized=!1,this.privUseBuiltInVoice=!1,t.Contracts.throwIfNullOrWhitespace(e,`character`),this.character=e,this.style=r,i===void 0&&(i=new n.AvatarVideoFormat),this.videoFormat=i}get customized(){return this.privCustomized}set customized(e){this.privCustomized=e}get useBuiltInVoice(){return this.privUseBuiltInVoice}set useBuiltInVoice(e){this.privUseBuiltInVoice=e}get photoAvatarBaseModel(){return this.privPhotoAvatarBaseModel}set photoAvatarBaseModel(e){this.privPhotoAvatarBaseModel=e}get backgroundColor(){return this.privBackgroundColor}set backgroundColor(e){this.privBackgroundColor=e}get backgroundImage(){return this.privBackgroundImage}set backgroundImage(e){this.privBackgroundImage=e}get remoteIceServers(){return this.privRemoteIceServers}set remoteIceServers(e){this.privRemoteIceServers=e}}})),Tn=e((e=>{Object.defineProperty(e,`__esModule`,{value:!0}),e.AvatarEventArgs=e.AvatarEventTypes=void 0,(function(e){e.SwitchedToSpeaking=`SwitchedToSpeaking`,e.SwitchedToIdle=`SwitchedToIdle`,e.SessionClosed=`SessionClosed`})(e.AvatarEventTypes||={}),e.AvatarEventArgs=class{constructor(e,t){this.privOffset=e,this.privDescription=t}get type(){return this.privType}get offset(){return this.privOffset}get description(){return this.privDescription}}})),En=e((e=>{Object.defineProperty(e,`__esModule`,{value:!0}),e.SpeechSynthesisConnectionFactory=void 0;var t=X(),n=Y(),r=K(),i=$(),a=M(),o=G();e.SpeechSynthesisConnectionFactory=class{constructor(){this.synthesisUri=`/tts/cognitiveservices/websocket/v1`}async create(e,s,c){let l=e.parameters.getProperty(n.PropertyId.SpeechServiceConnection_Endpoint,void 0),u=e.parameters.getProperty(n.PropertyId.SpeechServiceConnection_Region,void 0),d=r.ConnectionFactoryBase.getHostSuffix(u),f=e.parameters.getProperty(n.PropertyId.SpeechServiceConnection_EndpointId,void 0),p=f===void 0?`tts`:`voice`,m=e.parameters.getProperty(n.PropertyId.SpeechServiceConnection_Host,`wss://`+u+`.`+p+`.speech`+d),h={},g={};if(s.token!==void 0&&s.token!==``&&(g[s.headerName]=s.token),g[a.HeaderNames.ConnectionId]=c,f!==void 0&&f!==``&&(!l||l.search(o.QueryParameterNames.CustomVoiceDeploymentId)===-1)&&(h[o.QueryParameterNames.CustomVoiceDeploymentId]=f),e.avatarEnabled&&(!l||l.search(o.QueryParameterNames.EnableAvatar)===-1)&&(h[o.QueryParameterNames.EnableAvatar]=`true`),l){let e=new URL(l),t=e.pathname;(t===``||t===`/`)&&(e.pathname=this.synthesisUri,l=await r.ConnectionFactoryBase.getRedirectUrlFromEndpoint(e.toString()))}l||=m+this.synthesisUri,e.parameters.setProperty(n.PropertyId.SpeechServiceConnection_Url,l);let _=e.parameters.getProperty(`SPEECH-EnableWebsocketCompression`,`false`)===`true`;return new t.WebsocketConnection(l,h,g,new i.WebsocketMessageFormatter,t.ProxyInfo.fromParameters(e.parameters),_,c)}}})),Dn=e((e=>{Object.defineProperty(e,`__esModule`,{value:!0}),e.AvatarSynthesizer=void 0;var t=En(),n=$(),r=j(),i=B(),a=Y(),o=I(),s=J();e.AvatarSynthesizer=class extends a.Synthesizer{constructor(e,n){super(e),o.Contracts.throwIfNullOrUndefined(n,`avatarConfig`),this.privConnectionFactory=new t.SpeechSynthesisConnectionFactory,this.privAvatarConfig=n,this.implCommonSynthesizeSetup()}implCommonSynthesizeSetup(){super.implCommonSynthesizeSetup(),this.privAdapter.audioOutputFormat=i.AudioOutputFormatImpl.fromSpeechSynthesisOutputFormat(a.SpeechSynthesisOutputFormat.Riff24Khz16BitMonoPcm)}async startAvatarAsync(e){o.Contracts.throwIfNullOrUndefined(e,`peerConnection`),this.privIceServers=e.getConfiguration().iceServers,o.Contracts.throwIfNullOrUndefined(this.privIceServers,`Ice servers must be set.`);let t=new r.Deferred;e.onicegatheringstatechange=()=>{r.Events.instance.onEvent(new r.PlatformEvent(`peer connection: ice gathering state: `+e.iceGatheringState,r.EventType.Debug)),e.iceGatheringState===`complete`&&(r.Events.instance.onEvent(new r.PlatformEvent(`peer connection: ice gathering complete.`,r.EventType.Info)),t.resolve())},e.onicecandidate=e=>{e.candidate?r.Events.instance.onEvent(new r.PlatformEvent(`peer connection: ice candidate: `+e.candidate.candidate,r.EventType.Debug)):(r.Events.instance.onEvent(new r.PlatformEvent(`peer connection: ice candidate: complete`,r.EventType.Debug)),t.resolve())},setTimeout(()=>{e.iceGatheringState!==`complete`&&(r.Events.instance.onEvent(new r.PlatformEvent(`peer connection: ice gathering timeout.`,r.EventType.Warning)),t.resolve())},2e3);let n=await e.createOffer();await e.setLocalDescription(n),await t.promise,r.Events.instance.onEvent(new r.PlatformEvent(`peer connection: got local SDP.`,r.EventType.Info)),this.privProperties.setProperty(a.PropertyId.TalkingAvatarService_WebRTC_SDP,JSON.stringify(e.localDescription));let i=await this.speak(``,!1);if(i.reason!==a.ResultReason.SynthesizingAudioCompleted)return new a.SynthesisResult(i.resultId,i.reason,i.errorDetails,i.properties);let s=atob(i.properties.getProperty(a.PropertyId.TalkingAvatarService_WebRTC_SDP)),c=new RTCSessionDescription(JSON.parse(s));return await e.setRemoteDescription(c),new a.SynthesisResult(i.resultId,i.reason,void 0,i.properties)}async speakTextAsync(e){let t=await this.speak(e,!1);return new a.SynthesisResult(t.resultId,t.reason,t.errorDetails,t.properties)}async speakSsmlAsync(e){let t=await this.speak(e,!0);return new a.SynthesisResult(t.resultId,t.reason,t.errorDetails,t.properties)}async stopSpeakingAsync(){for(;this.synthesisRequestQueue.length()>0;)(await this.synthesisRequestQueue.dequeue()).err(`Synthesis is canceled by user.`);return this.privAdapter.stopSpeaking()}async stopAvatarAsync(){return o.Contracts.throwIfDisposed(this.privDisposed),this.dispose(!0)}async close(){if(!this.privDisposed)return this.dispose(!0)}get iceServers(){return this.privIceServers}createSynthesisAdapter(e,t,r){return new n.AvatarSynthesisAdapter(e,t,r,this,this.privAvatarConfig)}createRestSynthesisAdapter(e,t){}createSynthesizerConfig(e){let t=super.createSynthesizerConfig(e);return t.avatarEnabled=!0,t}async speak(e,t){let n=(0,r.createNoDashGuid)(),i=new r.Deferred;return this.synthesisRequestQueue.enqueue(new s.SynthesisRequest(n,e,t,e=>{i.resolve(e),this.privSynthesizing=!1,this.adapterSpeak()},e=>{i.reject(e),this.privSynthesizing=!1})),this.adapterSpeak(),i.promise}}})),On=e((e=>{Object.defineProperty(e,`__esModule`,{value:!0}),e.AvatarVideoFormat=e.Coordinate=void 0,e.Coordinate=class{constructor(e,t){this.x=e,this.y=t}},e.AvatarVideoFormat=class{constructor(e=`H264`,t=2e6,n=1920,r=1080){this.codec=e,this.bitrate=t,this.width=n,this.height=r}setCropRange(e,t){this.cropRange={bottomRight:t,topLeft:e}}}})),kn=e((e=>{Object.defineProperty(e,`__esModule`,{value:!0}),e.AvatarWebRTCConnectionResult=void 0;var t=Y();e.AvatarWebRTCConnectionResult=class extends t.SynthesisResult{constructor(e,t,n,r,i){super(t,n,r,i),this.privSDPAnswer=e}get SDPAnswer(){return this.privSDPAnswer}}})),An=e((e=>{Object.defineProperty(e,`__esModule`,{value:!0}),e.Diagnostics=void 0;var t=X(),n=j(),r=class{static SetLoggingLevel(e){this.privListener=new t.ConsoleLoggingListener(e),n.Events.instance.attachConsoleListener(this.privListener)}static StartConsoleOutput(){this.privListener&&(this.privListener.enableConsoleOutput=!0)}static StopConsoleOutput(){this.privListener&&(this.privListener.enableConsoleOutput=!1)}static SetLogOutputPath(e){if(typeof window>`u`)this.privListener&&(this.privListener.logPath=e);else throw Error(`File system logging not available in browser.`)}static set onLogOutput(e){this.privListener&&(this.privListener.logCallback=e)}};e.Diagnostics=r,r.privListener=void 0})),Y=e((e=>{Object.defineProperty(e,`__esModule`,{value:!0}),e.CustomCommandsConfig=e.BotFrameworkConfig=e.DialogServiceConfig=e.PhraseListGrammar=e.Connection=e.ServiceEventArgs=e.ConnectionEventArgs=e.CancellationErrorCode=e.CancellationDetails=e.CancellationDetailsBase=e.TranslationRecognitionCanceledEventArgs=e.NoMatchDetails=e.NoMatchReason=e.Translations=e.TranslationRecognizer=e.SpeechRecognizer=e.Recognizer=e.PropertyId=e.PropertyCollection=e.SpeechTranslationConfigImpl=e.SpeechTranslationConfig=e.SpeechConfigImpl=e.SpeechConfig=e.ResultReason=e.TranslationSynthesisResult=e.TranslationRecognitionResult=e.TranslationSynthesisEventArgs=e.TranslationRecognitionEventArgs=e.SpeechRecognitionCanceledEventArgs=e.MeetingTranscriptionEventArgs=e.ConversationTranscriptionEventArgs=e.SpeechRecognitionEventArgs=e.SpeechRecognitionResult=e.RecognitionResult=e.OutputFormat=e.RecognitionEventArgs=e.SessionEventArgs=e.KeywordRecognitionModel=e.PushAudioOutputStreamCallback=e.PullAudioInputStreamCallback=e.CancellationReason=e.PushAudioOutputStream=e.PullAudioOutputStream=e.AudioOutputStream=e.PushAudioInputStream=e.PullAudioInputStream=e.AudioInputStream=e.AudioFormatTag=e.AudioStreamFormat=e.AudioConfig=void 0,e.AvatarSynthesizer=e.AvatarEventArgs=e.AvatarConfig=e.LanguageIdMode=e.PronunciationAssessmentResult=e.PronunciationAssessmentConfig=e.PronunciationAssessmentGranularity=e.PronunciationAssessmentGradingSystem=e.MeetingTranscriptionCanceledEventArgs=e.ConversationTranscriptionCanceledEventArgs=e.SpeakerAudioDestination=e.VoiceInfo=e.SynthesisVoiceType=e.SynthesisVoiceGender=e.SynthesisVoicesResult=e.SpeechSynthesisBoundaryType=e.SpeechSynthesisVisemeEventArgs=e.SpeechSynthesisBookmarkEventArgs=e.SpeechSynthesisWordBoundaryEventArgs=e.SpeechSynthesisEventArgs=e.SpeechSynthesisResult=e.SynthesisResult=e.SpeechSynthesizer=e.SpeechSynthesisOutputFormat=e.Synthesizer=e.User=e.ParticipantChangedReason=e.Participant=e.MeetingTranscriber=e.Meeting=e.ConversationTranscriptionResult=e.ConversationTranscriber=e.ConversationTranslator=e.ConversationTranslationResult=e.ConversationTranslationEventArgs=e.ConversationTranslationCanceledEventArgs=e.ConversationParticipantsChangedEventArgs=e.ConversationExpirationEventArgs=e.Conversation=e.SourceLanguageConfig=e.AutoDetectSourceLanguageResult=e.AutoDetectSourceLanguageConfig=e.ConnectionMessage=e.ConnectionMessageEventArgs=e.BaseAudioPlayer=e.ProfanityOption=e.ServicePropertyChannel=e.TurnStatusReceivedEventArgs=e.ActivityReceivedEventArgs=e.DialogServiceConnector=void 0,e.LogLevel=e.Diagnostics=e.AvatarWebRTCConnectionResult=e.Coordinate=e.AvatarVideoFormat=void 0;var t=Ke();Object.defineProperty(e,`AudioConfig`,{enumerable:!0,get:function(){return t.AudioConfig}});var n=L();Object.defineProperty(e,`AudioStreamFormat`,{enumerable:!0,get:function(){return n.AudioStreamFormat}}),Object.defineProperty(e,`AudioFormatTag`,{enumerable:!0,get:function(){return n.AudioFormatTag}});var r=We();Object.defineProperty(e,`AudioInputStream`,{enumerable:!0,get:function(){return r.AudioInputStream}}),Object.defineProperty(e,`PullAudioInputStream`,{enumerable:!0,get:function(){return r.PullAudioInputStream}}),Object.defineProperty(e,`PushAudioInputStream`,{enumerable:!0,get:function(){return r.PushAudioInputStream}});var i=V();Object.defineProperty(e,`AudioOutputStream`,{enumerable:!0,get:function(){return i.AudioOutputStream}}),Object.defineProperty(e,`PullAudioOutputStream`,{enumerable:!0,get:function(){return i.PullAudioOutputStream}}),Object.defineProperty(e,`PushAudioOutputStream`,{enumerable:!0,get:function(){return i.PushAudioOutputStream}});var a=qe();Object.defineProperty(e,`CancellationReason`,{enumerable:!0,get:function(){return a.CancellationReason}});var o=Je();Object.defineProperty(e,`PullAudioInputStreamCallback`,{enumerable:!0,get:function(){return o.PullAudioInputStreamCallback}});var s=Ye();Object.defineProperty(e,`PushAudioOutputStreamCallback`,{enumerable:!0,get:function(){return s.PushAudioOutputStreamCallback}});var c=Xe();Object.defineProperty(e,`KeywordRecognitionModel`,{enumerable:!0,get:function(){return c.KeywordRecognitionModel}});var l=Ze();Object.defineProperty(e,`SessionEventArgs`,{enumerable:!0,get:function(){return l.SessionEventArgs}});var u=Qe();Object.defineProperty(e,`RecognitionEventArgs`,{enumerable:!0,get:function(){return u.RecognitionEventArgs}});var d=$e();Object.defineProperty(e,`OutputFormat`,{enumerable:!0,get:function(){return d.OutputFormat}});var f=et();Object.defineProperty(e,`RecognitionResult`,{enumerable:!0,get:function(){return f.RecognitionResult}});var p=tt();Object.defineProperty(e,`SpeechRecognitionResult`,{enumerable:!0,get:function(){return p.SpeechRecognitionResult}});var m=nt();Object.defineProperty(e,`SpeechRecognitionEventArgs`,{enumerable:!0,get:function(){return m.SpeechRecognitionEventArgs}}),Object.defineProperty(e,`ConversationTranscriptionEventArgs`,{enumerable:!0,get:function(){return m.ConversationTranscriptionEventArgs}}),Object.defineProperty(e,`MeetingTranscriptionEventArgs`,{enumerable:!0,get:function(){return m.MeetingTranscriptionEventArgs}});var h=rt();Object.defineProperty(e,`SpeechRecognitionCanceledEventArgs`,{enumerable:!0,get:function(){return h.SpeechRecognitionCanceledEventArgs}});var g=it();Object.defineProperty(e,`TranslationRecognitionEventArgs`,{enumerable:!0,get:function(){return g.TranslationRecognitionEventArgs}});var _=at();Object.defineProperty(e,`TranslationSynthesisEventArgs`,{enumerable:!0,get:function(){return _.TranslationSynthesisEventArgs}});var v=ot();Object.defineProperty(e,`TranslationRecognitionResult`,{enumerable:!0,get:function(){return v.TranslationRecognitionResult}});var y=st();Object.defineProperty(e,`TranslationSynthesisResult`,{enumerable:!0,get:function(){return y.TranslationSynthesisResult}});var b=ct();Object.defineProperty(e,`ResultReason`,{enumerable:!0,get:function(){return b.ResultReason}});var x=lt();Object.defineProperty(e,`SpeechConfig`,{enumerable:!0,get:function(){return x.SpeechConfig}}),Object.defineProperty(e,`SpeechConfigImpl`,{enumerable:!0,get:function(){return x.SpeechConfigImpl}});var ee=ut();Object.defineProperty(e,`SpeechTranslationConfig`,{enumerable:!0,get:function(){return ee.SpeechTranslationConfig}}),Object.defineProperty(e,`SpeechTranslationConfigImpl`,{enumerable:!0,get:function(){return ee.SpeechTranslationConfigImpl}});var te=dt();Object.defineProperty(e,`PropertyCollection`,{enumerable:!0,get:function(){return te.PropertyCollection}});var ne=ft();Object.defineProperty(e,`PropertyId`,{enumerable:!0,get:function(){return ne.PropertyId}});var re=pt();Object.defineProperty(e,`Recognizer`,{enumerable:!0,get:function(){return re.Recognizer}});var ie=mt();Object.defineProperty(e,`SpeechRecognizer`,{enumerable:!0,get:function(){return ie.SpeechRecognizer}});var ae=_t();Object.defineProperty(e,`TranslationRecognizer`,{enumerable:!0,get:function(){return ae.TranslationRecognizer}});var oe=vt();Object.defineProperty(e,`Translations`,{enumerable:!0,get:function(){return oe.Translations}});var se=yt();Object.defineProperty(e,`NoMatchReason`,{enumerable:!0,get:function(){return se.NoMatchReason}});var S=bt();Object.defineProperty(e,`NoMatchDetails`,{enumerable:!0,get:function(){return S.NoMatchDetails}});var C=xt();Object.defineProperty(e,`TranslationRecognitionCanceledEventArgs`,{enumerable:!0,get:function(){return C.TranslationRecognitionCanceledEventArgs}});var ce=St();Object.defineProperty(e,`CancellationDetailsBase`,{enumerable:!0,get:function(){return ce.CancellationDetailsBase}});var le=Ct();Object.defineProperty(e,`CancellationDetails`,{enumerable:!0,get:function(){return le.CancellationDetails}});var w=wt();Object.defineProperty(e,`CancellationErrorCode`,{enumerable:!0,get:function(){return w.CancellationErrorCode}});var T=Tt();Object.defineProperty(e,`ConnectionEventArgs`,{enumerable:!0,get:function(){return T.ConnectionEventArgs}});var ue=Et();Object.defineProperty(e,`ServiceEventArgs`,{enumerable:!0,get:function(){return ue.ServiceEventArgs}});var de=gt();Object.defineProperty(e,`Connection`,{enumerable:!0,get:function(){return de.Connection}});var E=Dt();Object.defineProperty(e,`PhraseListGrammar`,{enumerable:!0,get:function(){return E.PhraseListGrammar}});var D=W();Object.defineProperty(e,`DialogServiceConfig`,{enumerable:!0,get:function(){return D.DialogServiceConfig}});var fe=Ot();Object.defineProperty(e,`BotFrameworkConfig`,{enumerable:!0,get:function(){return fe.BotFrameworkConfig}});var pe=kt();Object.defineProperty(e,`CustomCommandsConfig`,{enumerable:!0,get:function(){return pe.CustomCommandsConfig}});var me=jt();Object.defineProperty(e,`DialogServiceConnector`,{enumerable:!0,get:function(){return me.DialogServiceConnector}});var he=Mt();Object.defineProperty(e,`ActivityReceivedEventArgs`,{enumerable:!0,get:function(){return he.ActivityReceivedEventArgs}});var ge=Pt();Object.defineProperty(e,`TurnStatusReceivedEventArgs`,{enumerable:!0,get:function(){return ge.TurnStatusReceivedEventArgs}});var _e=Ft();Object.defineProperty(e,`ServicePropertyChannel`,{enumerable:!0,get:function(){return _e.ServicePropertyChannel}});var ve=It();Object.defineProperty(e,`ProfanityOption`,{enumerable:!0,get:function(){return ve.ProfanityOption}});var ye=Lt();Object.defineProperty(e,`BaseAudioPlayer`,{enumerable:!0,get:function(){return ye.BaseAudioPlayer}});var be=Rt();Object.defineProperty(e,`ConnectionMessageEventArgs`,{enumerable:!0,get:function(){return be.ConnectionMessageEventArgs}});var xe=ht();Object.defineProperty(e,`ConnectionMessage`,{enumerable:!0,get:function(){return xe.ConnectionMessage}});var Se=Bt();Object.defineProperty(e,`AutoDetectSourceLanguageConfig`,{enumerable:!0,get:function(){return Se.AutoDetectSourceLanguageConfig}});var O=Vt();Object.defineProperty(e,`AutoDetectSourceLanguageResult`,{enumerable:!0,get:function(){return O.AutoDetectSourceLanguageResult}});var Ce=Ht();Object.defineProperty(e,`SourceLanguageConfig`,{enumerable:!0,get:function(){return Ce.SourceLanguageConfig}});var k=q();Object.defineProperty(e,`Conversation`,{enumerable:!0,get:function(){return k.Conversation}}),Object.defineProperty(e,`ConversationExpirationEventArgs`,{enumerable:!0,get:function(){return k.ConversationExpirationEventArgs}}),Object.defineProperty(e,`ConversationParticipantsChangedEventArgs`,{enumerable:!0,get:function(){return k.ConversationParticipantsChangedEventArgs}}),Object.defineProperty(e,`ConversationTranslationCanceledEventArgs`,{enumerable:!0,get:function(){return k.ConversationTranslationCanceledEventArgs}}),Object.defineProperty(e,`ConversationTranslationEventArgs`,{enumerable:!0,get:function(){return k.ConversationTranslationEventArgs}}),Object.defineProperty(e,`ConversationTranslationResult`,{enumerable:!0,get:function(){return k.ConversationTranslationResult}}),Object.defineProperty(e,`ConversationTranslator`,{enumerable:!0,get:function(){return k.ConversationTranslator}}),Object.defineProperty(e,`ConversationTranscriber`,{enumerable:!0,get:function(){return k.ConversationTranscriber}}),Object.defineProperty(e,`ConversationTranscriptionResult`,{enumerable:!0,get:function(){return k.ConversationTranscriptionResult}}),Object.defineProperty(e,`Meeting`,{enumerable:!0,get:function(){return k.Meeting}}),Object.defineProperty(e,`MeetingTranscriber`,{enumerable:!0,get:function(){return k.MeetingTranscriber}}),Object.defineProperty(e,`Participant`,{enumerable:!0,get:function(){return k.Participant}}),Object.defineProperty(e,`ParticipantChangedReason`,{enumerable:!0,get:function(){return k.ParticipantChangedReason}}),Object.defineProperty(e,`User`,{enumerable:!0,get:function(){return k.User}});var we=J();Object.defineProperty(e,`Synthesizer`,{enumerable:!0,get:function(){return we.Synthesizer}});var Te=Ge();Object.defineProperty(e,`SpeechSynthesisOutputFormat`,{enumerable:!0,get:function(){return Te.SpeechSynthesisOutputFormat}});var Ee=sn();Object.defineProperty(e,`SpeechSynthesizer`,{enumerable:!0,get:function(){return Ee.SpeechSynthesizer}});var A=cn();Object.defineProperty(e,`SynthesisResult`,{enumerable:!0,get:function(){return A.SynthesisResult}});var De=ln();Object.defineProperty(e,`SpeechSynthesisResult`,{enumerable:!0,get:function(){return De.SpeechSynthesisResult}});var Oe=un();Object.defineProperty(e,`SpeechSynthesisEventArgs`,{enumerable:!0,get:function(){return Oe.SpeechSynthesisEventArgs}});var ke=dn();Object.defineProperty(e,`SpeechSynthesisWordBoundaryEventArgs`,{enumerable:!0,get:function(){return ke.SpeechSynthesisWordBoundaryEventArgs}});var Ae=fn();Object.defineProperty(e,`SpeechSynthesisBookmarkEventArgs`,{enumerable:!0,get:function(){return Ae.SpeechSynthesisBookmarkEventArgs}});var je=pn();Object.defineProperty(e,`SpeechSynthesisVisemeEventArgs`,{enumerable:!0,get:function(){return je.SpeechSynthesisVisemeEventArgs}});var j=mn();Object.defineProperty(e,`SpeechSynthesisBoundaryType`,{enumerable:!0,get:function(){return j.SpeechSynthesisBoundaryType}});var M=hn();Object.defineProperty(e,`SynthesisVoicesResult`,{enumerable:!0,get:function(){return M.SynthesisVoicesResult}});var N=gn();Object.defineProperty(e,`SynthesisVoiceGender`,{enumerable:!0,get:function(){return N.SynthesisVoiceGender}}),Object.defineProperty(e,`SynthesisVoiceType`,{enumerable:!0,get:function(){return N.SynthesisVoiceType}}),Object.defineProperty(e,`VoiceInfo`,{enumerable:!0,get:function(){return N.VoiceInfo}});var Me=_n();Object.defineProperty(e,`SpeakerAudioDestination`,{enumerable:!0,get:function(){return Me.SpeakerAudioDestination}});var Ne=vn();Object.defineProperty(e,`ConversationTranscriptionCanceledEventArgs`,{enumerable:!0,get:function(){return Ne.ConversationTranscriptionCanceledEventArgs}});var Pe=yn();Object.defineProperty(e,`MeetingTranscriptionCanceledEventArgs`,{enumerable:!0,get:function(){return Pe.MeetingTranscriptionCanceledEventArgs}});var Fe=bn();Object.defineProperty(e,`PronunciationAssessmentGradingSystem`,{enumerable:!0,get:function(){return Fe.PronunciationAssessmentGradingSystem}});var P=xn();Object.defineProperty(e,`PronunciationAssessmentGranularity`,{enumerable:!0,get:function(){return P.PronunciationAssessmentGranularity}});var F=Sn();Object.defineProperty(e,`PronunciationAssessmentConfig`,{enumerable:!0,get:function(){return F.PronunciationAssessmentConfig}});var I=Cn();Object.defineProperty(e,`PronunciationAssessmentResult`,{enumerable:!0,get:function(){return I.PronunciationAssessmentResult}});var Le=zt();Object.defineProperty(e,`LanguageIdMode`,{enumerable:!0,get:function(){return Le.LanguageIdMode}});var Re=wn();Object.defineProperty(e,`AvatarConfig`,{enumerable:!0,get:function(){return Re.AvatarConfig}});var ze=Tn();Object.defineProperty(e,`AvatarEventArgs`,{enumerable:!0,get:function(){return ze.AvatarEventArgs}});var Be=Dn();Object.defineProperty(e,`AvatarSynthesizer`,{enumerable:!0,get:function(){return Be.AvatarSynthesizer}});var R=On();Object.defineProperty(e,`AvatarVideoFormat`,{enumerable:!0,get:function(){return R.AvatarVideoFormat}}),Object.defineProperty(e,`Coordinate`,{enumerable:!0,get:function(){return R.Coordinate}});var z=kn();Object.defineProperty(e,`AvatarWebRTCConnectionResult`,{enumerable:!0,get:function(){return z.AvatarWebRTCConnectionResult}});var Ve=An();Object.defineProperty(e,`Diagnostics`,{enumerable:!0,get:function(){return Ve.Diagnostics}});var He=Ie();Object.defineProperty(e,`LogLevel`,{enumerable:!0,get:function(){return He.LogLevel}})})),jn=e((e=>{Object.defineProperty(e,`__esModule`,{value:!0}),e.ProxyInfo=void 0;var t=Y();e.ProxyInfo=class e{constructor(e,t,n,r){this.privProxyHostName=e,this.privProxyPort=t,this.privProxyUserName=n,this.privProxyPassword=r}static fromParameters(n){return new e(n.getProperty(t.PropertyId.SpeechServiceConnection_ProxyHostName),parseInt(n.getProperty(t.PropertyId.SpeechServiceConnection_ProxyPort),10),n.getProperty(t.PropertyId.SpeechServiceConnection_ProxyUserName),n.getProperty(t.PropertyId.SpeechServiceConnection_ProxyPassword))}static fromRecognizerConfig(e){return this.fromParameters(e.parameters)}get HostName(){return this.privProxyHostName}get Port(){return this.privProxyPort}get UserName(){return this.privProxyUserName}get Password(){return this.privProxyPassword}}})),Mn=e(((e,t)=>{var n=new Set([`json`,`buffer`,`string`]);t.exports=e=>(...t)=>{let r=new Set,i,a,o,s=``;return t.forEach(e=>{if(typeof e==`string`)if(e.toUpperCase()===e)if(i){let t=`Can't set method to ${e}, already set to ${i}.`;throw Error(t)}else i=e;else if(e.startsWith(`http:`)||e.startsWith(`https:`))s=e;else if(n.has(e))a=e;else throw Error(`Unknown encoding, ${e}`);else if(typeof e==`number`)r.add(e);else if(typeof e==`object`)if(Array.isArray(e)||e instanceof Set)e.forEach(e=>r.add(e));else{if(o)throw Error(`Cannot set headers twice.`);o=e}else throw Error(`Unknown type: ${typeof e}`)}),i||=`GET`,r.size===0&&r.add(200),e(r,i,a,o,s)}})),Nn=e(((e,t)=>{var n=Mn(),r=class e extends Error{constructor(t,...n){super(...n),Error.captureStackTrace&&Error.captureStackTrace(this,e),this.name=`StatusError`,this.message=t.statusMessage,this.statusCode=t.status,this.res=t,this.json=t.json.bind(t),this.text=t.text.bind(t),this.arrayBuffer=t.arrayBuffer.bind(t);let r;Object.defineProperty(this,`responseBody`,{get:()=>(r||=this.arrayBuffer(),r)}),this.headers={};for(let[e,n]of t.headers.entries())this.headers[e.toLowerCase()]=n}};t.exports=n((e,t,n,i,a)=>async(o,s,c={})=>{o=a+(o||``);let l=new URL(o);if(i||={},l.username&&(i.Authorization=`Basic `+btoa(l.username+`:`+l.password),l=new URL(l.protocol+`//`+l.host+l.pathname+l.search)),l.protocol!==`https:`&&l.protocol!==`http:`)throw Error(`Unknown protocol, ${l.protocol}`);if(s&&!(s instanceof ArrayBuffer||ArrayBuffer.isView(s)||typeof s==`string`))if(typeof s==`object`)s=JSON.stringify(s),i[`Content-Type`]=`application/json`;else throw Error(`Unknown body type.`);c=new Headers({...i||{},...c});let u=await fetch(l,{method:t,headers:c,body:s});if(u.statusCode=u.status,!e.has(u.status))throw new r(u);return n===`json`?u.json():n===`buffer`?u.arrayBuffer():n===`string`?u.text():u})})),Pn=e((e=>{var t=e&&e.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(e,`__esModule`,{value:!0}),e.RestMessageAdapter=e.RestRequestType=void 0;var n=t(Nn()),r=j(),i;(function(e){e.Get=`GET`,e.Post=`POST`,e.Delete=`DELETE`,e.File=`file`})(i=e.RestRequestType||={}),e.RestMessageAdapter=class{constructor(e){if(!e)throw new r.ArgumentNullError(`configParams`);this.privHeaders=e.headers,this.privIgnoreCache=e.ignoreCache}static extractHeaderValue(e,t){let n=``;try{let r=t.trim().split(/[\r\n]+/),i={};r.forEach(e=>{let t=e.split(`: `),n=t.shift().toLowerCase();i[n]=t.join(`: `)}),n=i[e.toLowerCase()]}catch{}return n}set options(e){this.privHeaders=e.headers,this.privIgnoreCache=e.ignoreCache}setHeaders(e,t){this.privHeaders[e]=t}request(e,t,a={},o=null){let s=new r.Deferred,c=e===i.File?`POST`:e,l=(e,t={})=>{let n=e;return{data:JSON.stringify(t),headers:JSON.stringify(e.headers),json:t,ok:e.statusCode>=200&&e.statusCode<300,status:e.statusCode,statusText:t.error?t.error.message:n.statusText?n.statusText:n.statusMessage}},u=r=>{(0,n.default)(t,c,this.privHeaders,200,201,202,204,400,401,402,403,404)(this.queryParams(a)===``?``:`?${this.queryParams(a)}`,r).then(async t=>{if(e===i.Delete||t.statusCode===204)s.resolve(l(t));else try{let e=await t.json();s.resolve(l(t,e))}catch{s.resolve(l(t))}}).catch(e=>{s.reject(e)})};return this.privIgnoreCache&&(this.privHeaders[`Cache-Control`]=`no-cache`),e===i.Post&&o&&(this.privHeaders[`content-type`]=`application/json`,this.privHeaders[`Content-Type`]=`application/json`),u(o),s.promise}queryParams(e={}){return Object.keys(e).map(t=>encodeURIComponent(t)+`=`+encodeURIComponent(e[t])).join(`&`)}}})),Fn=e((e=>{Object.defineProperty(e,`__esModule`,{value:!0}),e.RestConfigBase=void 0;var t=class e{static get requestOptions(){return e.privDefaultRequestOptions}static get configParams(){return e.privDefaultParams}static get restErrors(){return e.privRestErrors}};e.RestConfigBase=t,t.privDefaultRequestOptions={headers:{Accept:`application/json`},ignoreCache:!1,timeout:1e4},t.privRestErrors={authInvalidSubscriptionKey:`You must specify either an authentication token to use, or a Cognitive Speech subscription key.`,authInvalidSubscriptionRegion:`You must specify the Cognitive Speech region to use.`,invalidArgs:`Required input not found: {arg}.`,invalidCreateJoinConversationResponse:`Creating/Joining conversation failed with HTTP {status}.`,invalidParticipantRequest:`The requested participant was not found.`,permissionDeniedConnect:`Required credentials not found.`,permissionDeniedConversation:`Invalid operation: only the host can {command} the conversation.`,permissionDeniedParticipant:`Invalid operation: only the host can {command} a participant.`,permissionDeniedSend:`Invalid operation: the conversation is not in a connected state.`,permissionDeniedStart:`Invalid operation: there is already an active conversation.`},t.privDefaultParams={apiVersion:`api-version`,authorization:`Authorization`,clientAppId:`X-ClientAppId`,contentTypeKey:`Content-Type`,correlationId:`X-CorrelationId`,languageCode:`language`,nickname:`nickname`,profanity:`profanity`,requestId:`X-RequestId`,roomId:`roomid`,sessionToken:`token`,subscriptionKey:`Ocp-Apim-Subscription-Key`,subscriptionRegion:`Ocp-Apim-Subscription-Region`,token:`X-CapitoToken`}})),X=e((e=>{var t=e&&e.__createBinding||(Object.create?(function(e,t,n,r){r===void 0&&(r=n),Object.defineProperty(e,r,{enumerable:!0,get:function(){return t[n]}})}):(function(e,t,n,r){r===void 0&&(r=n),e[r]=t[n]})),n=e&&e.__exportStar||function(e,n){for(var r in e)r!==`default`&&!Object.prototype.hasOwnProperty.call(n,r)&&t(n,e,r)};Object.defineProperty(e,`__esModule`,{value:!0}),n(Le(),e),n(Re(),e),n(ze(),e),n(Be(),e),n(R(),e),n(Ve(),e),n(z(),e),n(He(),e),n(jn(),e),n(Pn(),e),n(Fn(),e)})),Z=e((e=>{Object.defineProperty(e,`__esModule`,{value:!0}),e.SpeechConnectionMessage=void 0;var t=j(),n=M();e.SpeechConnectionMessage=class e extends t.ConnectionMessage{constructor(e,r,i,a,o,s,c,l){if(!r)throw new t.ArgumentNullError(`path`);if(!i)throw new t.ArgumentNullError(`requestId`);let u={};if(u[n.HeaderNames.Path]=r,u[n.HeaderNames.RequestId]=i,u[n.HeaderNames.RequestTimestamp]=new Date().toISOString(),a&&(u[n.HeaderNames.ContentType]=a),s&&(u[n.HeaderNames.RequestStreamId]=s),c)for(let e in c)e&&(u[e]=c[e]);l?super(e,o,u,l):super(e,o,u),this.privPath=r,this.privRequestId=i,this.privContentType=a,this.privStreamId=s,this.privAdditionalHeaders=c}get path(){return this.privPath}get requestId(){return this.privRequestId}get contentType(){return this.privContentType}get streamId(){return this.privStreamId}get additionalHeaders(){return this.privAdditionalHeaders}static fromConnectionMessage(t){let r=null,i=null,a=null,o=null,s={};if(t.headers)for(let e in t.headers)e&&(e.toLowerCase()===n.HeaderNames.Path.toLowerCase()?r=t.headers[e]:e.toLowerCase()===n.HeaderNames.RequestId.toLowerCase()?i=t.headers[e]:e.toLowerCase()===n.HeaderNames.ContentType.toLowerCase()?a=t.headers[e]:e.toLowerCase()===n.HeaderNames.RequestStreamId.toLowerCase()?o=t.headers[e]:s[e]=t.headers[e]);return new e(t.messageType,r,i,a,t.body,o,s,t.id)}}})),In=e((e=>{Object.defineProperty(e,`__esModule`,{value:!0}),e.SegmentationMode=void 0,(function(e){e.Normal=`Normal`,e.Disabled=`Disabled`,e.Custom=`Custom`,e.Semantic=`Semantic`})(e.SegmentationMode||={})})),Ln=e((e=>{Object.defineProperty(e,`__esModule`,{value:!0}),e.NextAction=void 0,(function(e){e.None=`None`,e.Synthesize=`Synthesize`})(e.NextAction||={})})),Rn=e((e=>{Object.defineProperty(e,`__esModule`,{value:!0}),e.Mode=void 0,(function(e){e.None=`None`,e.Always=`Always`})(e.Mode||={})})),zn=e((e=>{Object.defineProperty(e,`__esModule`,{value:!0}),e.LanguageIdDetectionPriority=e.LanguageIdDetectionMode=void 0,(function(e){e.DetectAtAudioStart=`DetectAtAudioStart`,e.DetectContinuous=`DetectContinuous`,e.DetectSegments=`DetectSegments`})(e.LanguageIdDetectionMode||={}),(function(e){e.Auto=`Auto`,e.PrioritizeLatency=`PrioritizeLatency`,e.PrioritizeAccuracy=`PrioritizeAccuracy`})(e.LanguageIdDetectionPriority||={})})),Bn=e((e=>{Object.defineProperty(e,`__esModule`,{value:!0}),e.NextAction=void 0,(function(e){e.Recognize=`Recognize`,e.None=`None`})(e.NextAction||={})})),Vn=e((e=>{Object.defineProperty(e,`__esModule`,{value:!0}),e.OnUnknownAction=void 0,(function(e){e.RecognizeWithDefaultLanguage=`RecognizeWithDefaultLanguage`,e.None=`None`})(e.OnUnknownAction||={})})),Hn=e((e=>{Object.defineProperty(e,`__esModule`,{value:!0}),e.ResultType=void 0,(function(e){e.Auto=`Auto`,e.StableFragment=`StableFragment`,e.Hypothesis=`Hypothesis`,e.None=`None`})(e.ResultType||={})})),Un=e((e=>{Object.defineProperty(e,`__esModule`,{value:!0}),e.PhraseResultOutputType=void 0,(function(e){e.Always=`Always`,e.None=`None`})(e.PhraseResultOutputType||={})})),Wn=e((e=>{Object.defineProperty(e,`__esModule`,{value:!0}),e.NextAction=void 0,(function(e){e.None=`None`,e.Translate=`Translate`})(e.NextAction||={})})),Gn=e((e=>{Object.defineProperty(e,`__esModule`,{value:!0}),e.ServiceRecognizerBase=void 0;var t=X(),n=j(),r=Y(),i=$(),a=Z(),o=In(),s=U(),c=Ln(),l=Rn(),u=zn(),d=Bn(),f=Vn(),p=Hn(),m=Un(),h=Wn(),g=class e{constructor(e,t,a,o,s){if(this.privConnectionConfigurationPromise=void 0,this.privConnectionPromise=void 0,this.privSetTimeout=setTimeout,this.privIsLiveAudio=!1,this.privAverageBytesPerMs=0,this.privEnableSpeakerId=!1,this.privExpectContentAssessmentResponse=!1,this.recognizeOverride=void 0,this.disconnectOverride=void 0,this.receiveMessageOverride=void 0,this.sendPrePayloadJSONOverride=void 0,this.postConnectImplOverride=void 0,this.configConnectionOverride=void 0,this.handleSpeechPhraseMessage=void 0,this.handleSpeechHypothesisMessage=void 0,!e)throw new n.ArgumentNullError(`authentication`);if(!t)throw new n.ArgumentNullError(`connectionFactory`);if(!a)throw new n.ArgumentNullError(`audioSource`);if(!o)throw new n.ArgumentNullError(`recognizerConfig`);this.privEnableSpeakerId=o.isSpeakerDiarizationEnabled,this.privMustReportEndOfStream=!1,this.privAuthentication=e,this.privConnectionFactory=t,this.privAudioSource=a,this.privRecognizerConfig=o,this.privIsDisposed=!1,this.privRecognizer=s,this.privRequestSession=new i.RequestSession(this.privAudioSource.id()),this.privConnectionEvents=new n.EventSource,this.privServiceEvents=new n.EventSource,this.privDynamicGrammar=new i.DynamicGrammarBuilder,this.privSpeechContext=new i.SpeechContext(this.privDynamicGrammar),this.privAgentConfig=new i.AgentConfig,this.privRecognizerConfig.parameters.getProperty(r.PropertyId.WebWorkerLoadType,`on`).toLowerCase()===`on`&&typeof Blob<`u`&&typeof Worker<`u`?this.privSetTimeout=n.Timeout.setTimeout:(typeof window<`u`&&(this.privSetTimeout=window.setTimeout.bind(window)),typeof globalThis<`u`&&(this.privSetTimeout=globalThis.setTimeout.bind(globalThis))),this.connectionEvents.attach(e=>{if(e.name===`ConnectionClosedEvent`){let t=e;(t.statusCode===1003||t.statusCode===1007||t.statusCode===1002||t.statusCode===4e3||this.privRequestSession.numConnectionAttempts>this.privRecognizerConfig.maxRetryCount)&&this.cancelRecognitionLocal(r.CancellationReason.Error,t.statusCode===1007?r.CancellationErrorCode.BadRequestParameters:r.CancellationErrorCode.ConnectionFailure,`${t.reason} websocket error code: ${t.statusCode}`)}}),this.privEnableSpeakerId&&(this.privDiarizationSessionId=(0,n.createNoDashGuid)())}setTranslationJson(){let e=this.privRecognizerConfig.parameters.getProperty(r.PropertyId.SpeechServiceConnection_TranslationToLanguages,void 0);if(e!==void 0){let t=e.split(`,`),n=this.privRecognizerConfig.parameters.getProperty(r.PropertyId.SpeechServiceConnection_TranslationVoice,void 0),i=this.privRecognizerConfig.parameters.getProperty(r.PropertyId.SpeechServiceConnection_TranslationCategoryId,void 0),a=n===void 0?c.NextAction.None:c.NextAction.Synthesize;if(this.privSpeechContext.getContext().translation={onPassthrough:{action:a},onSuccess:{action:a},output:{includePassThroughResults:!0,interimResults:{mode:l.Mode.Always}},targetLanguages:t},i!==void 0&&(this.privSpeechContext.getContext().translation.category=i),n!==void 0){let e={};for(let r of t)e[r]=n;this.privSpeechContext.getContext().synthesis={defaultVoices:e}}let o=this.privSpeechContext.getContext().phraseDetection||{};o.onSuccess={action:h.NextAction.Translate},o.onInterim={action:h.NextAction.Translate},this.privSpeechContext.getContext().phraseDetection=o}}setSpeechSegmentationTimeoutJson(){let e=this.privRecognizerConfig.parameters.getProperty(r.PropertyId.Speech_SegmentationSilenceTimeoutMs,void 0),t=this.privRecognizerConfig.parameters.getProperty(r.PropertyId.Speech_SegmentationMaximumTimeMs,void 0),n=this.privRecognizerConfig.parameters.getProperty(r.PropertyId.Speech_SegmentationStrategy,void 0),i={mode:o.SegmentationMode.Normal},a=!1;if(n!==void 0){a=!0;let e=o.SegmentationMode.Normal;switch(n.toLowerCase()){case`default`:break;case`time`:e=o.SegmentationMode.Custom;break;case`semantic`:e=o.SegmentationMode.Semantic;break}i.mode=e}if(e!==void 0){a=!0;let t=parseInt(e,10);i.mode=o.SegmentationMode.Custom,i.segmentationSilenceTimeoutMs=t}if(t!==void 0){a=!0;let e=parseInt(t,10);i.mode=o.SegmentationMode.Custom,i.segmentationForcedTimeoutMs=e}if(a){let e=this.privSpeechContext.getContext().phraseDetection||{};switch(e.mode=this.recognitionMode,this.recognitionMode){case s.RecognitionMode.Conversation:e.conversation=e.conversation??{segmentation:{}},e.conversation.segmentation=i;break;case s.RecognitionMode.Interactive:e.interactive=e.interactive??{segmentation:{}},e.interactive.segmentation=i;break;case s.RecognitionMode.Dictation:e.dictation=e.dictation??{},e.dictation.segmentation=i;break}this.privSpeechContext.getContext().phraseDetection=e}}setLanguageIdJson(){let e=this.privSpeechContext.getContext().phraseDetection||{};if(this.privRecognizerConfig.autoDetectSourceLanguages!==void 0){let t=this.privRecognizerConfig.autoDetectSourceLanguages.split(`,`);t.length===1&&t[0]===i.AutoDetectSourceLanguagesOpenRangeOptionName&&(t[0]=`UND`);let n;n=this.privRecognizerConfig.languageIdMode===`Continuous`?u.LanguageIdDetectionMode.DetectContinuous:u.LanguageIdDetectionMode.DetectAtAudioStart,this.privSpeechContext.getContext().languageId={languages:t,mode:n,onSuccess:{action:d.NextAction.Recognize},onUnknown:{action:f.OnUnknownAction.None},priority:u.LanguageIdDetectionPriority.PrioritizeLatency},this.privSpeechContext.getContext().phraseOutput={interimResults:{resultType:p.ResultType.Auto},phraseResults:{resultType:m.PhraseResultOutputType.Always}};let r=this.privRecognizerConfig.sourceLanguageModels;r!==void 0&&(e.customModels=r,e.onInterim={action:h.NextAction.None},e.onSuccess={action:h.NextAction.None})}this.privSpeechContext.getContext().phraseDetection=e}setOutputDetailLevelJson(){this.privEnableSpeakerId&&(this.privRecognizerConfig.parameters.getProperty(r.PropertyId.SpeechServiceResponse_RequestWordLevelTimestamps,`false`).toLowerCase()===`true`?this.privSpeechContext.setWordLevelTimings():this.privRecognizerConfig.parameters.getProperty(i.OutputFormatPropertyName,r.OutputFormat[r.OutputFormat.Simple]).toLowerCase()===r.OutputFormat[r.OutputFormat.Detailed].toLocaleLowerCase()&&this.privSpeechContext.setDetailedOutputFormat())}setSpeechStartEventSensitivityJson(){let e=this.privRecognizerConfig.parameters.getProperty(r.PropertyId.Speech_StartEventSensitivity,void 0);if(e!==void 0){let t=!1;switch(e.toLowerCase()){case s.SpeechStartEventSensitivity.Low:case s.SpeechStartEventSensitivity.Medium:case s.SpeechStartEventSensitivity.High:t=!0;break}if(t){let t=this.privSpeechContext.getContext().phraseDetection||{};t.voiceOnsetSensitivity=e.toLowerCase(),this.privSpeechContext.getContext().phraseDetection=t}}}get isSpeakerDiarizationEnabled(){return this.privEnableSpeakerId}get audioSource(){return this.privAudioSource}get speechContext(){return this.privSpeechContext}get dynamicGrammar(){return this.privDynamicGrammar}get agentConfig(){return this.privAgentConfig}set conversationTranslatorToken(e){this.privRecognizerConfig.parameters.setProperty(r.PropertyId.ConversationTranslator_Token,e)}set authentication(e){this.privAuthentication=e}isDisposed(){return this.privIsDisposed}async dispose(e){if(this.privIsDisposed=!0,this.privConnectionPromise!==void 0)try{await(await this.privConnectionPromise).dispose(e)}catch{return}}get connectionEvents(){return this.privConnectionEvents}get serviceEvents(){return this.privServiceEvents}get recognitionMode(){return this.privRecognizerConfig.recognitionMode}async recognize(e,n,a){if(this.recognizeOverride!==void 0){await this.recognizeOverride(e,n,a);return}if(this.privConnectionConfigurationPromise=void 0,this.privRecognizerConfig.recognitionMode=e,this.privRecognizerConfig.recognitionEndpointVersion===`2`){let t=this.privSpeechContext.getContext().phraseDetection||{};t.mode=e,this.privSpeechContext.getContext().phraseDetection=t}this.setLanguageIdJson(),this.setTranslationJson(),this.privRecognizerConfig.autoDetectSourceLanguages!==void 0&&this.privRecognizerConfig.parameters.getProperty(r.PropertyId.SpeechServiceConnection_TranslationToLanguages,void 0)!==void 0&&this.setupTranslationWithLanguageId(),this.setSpeechSegmentationTimeoutJson(),this.setOutputDetailLevelJson(),this.setSpeechStartEventSensitivityJson(),this.privSuccessCallback=n,this.privErrorCallback=a,this.privRequestSession.startNewRecognition(),this.privRequestSession.listenForServiceTelemetry(this.privAudioSource.events);let o=this.connectImpl(),s;try{let e=await this.audioSource.attach(this.privRequestSession.audioNodeId),n=await this.audioSource.format,r=await this.audioSource.deviceInfo;this.privIsLiveAudio=r.type&&r.type===i.type.Microphones,s=new t.ReplayableAudioNode(e,n.avgBytesPerSec),await this.privRequestSession.onAudioSourceAttachCompleted(s,!1),this.privRecognizerConfig.SpeechServiceConfig.Context.audio={source:r}}catch(e){throw await this.privRequestSession.onStopRecognizing(),e}try{await o}catch(e){await this.cancelRecognitionLocal(r.CancellationReason.Error,r.CancellationErrorCode.ConnectionFailure,e);return}let c=new r.SessionEventArgs(this.privRequestSession.sessionId);this.privRecognizer.sessionStarted&&this.privRecognizer.sessionStarted(this.privRecognizer,c),this.receiveMessage(),this.sendAudio(s).catch(async e=>{await this.cancelRecognitionLocal(r.CancellationReason.Error,r.CancellationErrorCode.RuntimeError,e)})}async stopRecognizing(){if(this.privRequestSession.isRecognizing)try{await this.audioSource.turnOff(),await this.sendFinalAudio(),await this.privRequestSession.onStopRecognizing(),await this.privRequestSession.turnCompletionPromise}finally{await this.privRequestSession.dispose()}}async connect(){return await this.connectImpl(),Promise.resolve()}connectAsync(e,t){this.connectImpl().then(()=>{try{e&&e()}catch(e){t&&t(e)}},e=>{try{t&&t(e)}catch{}})}async disconnect(){if(await this.cancelRecognitionLocal(r.CancellationReason.Error,r.CancellationErrorCode.NoError,`Disconnecting`),this.disconnectOverride!==void 0&&await this.disconnectOverride(),this.privConnectionPromise!==void 0)try{await(await this.privConnectionPromise).dispose()}catch{}this.privConnectionPromise=void 0}sendMessage(e){}async sendNetworkMessage(e,t){let r=typeof t==`string`?n.MessageType.Text:n.MessageType.Binary,i=typeof t==`string`?`application/json`:``;return(await this.fetchConnection()).send(new a.SpeechConnectionMessage(r,e,this.privRequestSession.requestId,i,t))}set activityTemplate(e){this.privActivityTemplate=e}get activityTemplate(){return this.privActivityTemplate}set expectContentAssessmentResponse(e){this.privExpectContentAssessmentResponse=e}async sendTelemetryData(){let t=this.privRequestSession.getTelemetry();if(!(e.telemetryDataEnabled!==!0||this.privIsDisposed||t===null)){if(e.telemetryData)try{e.telemetryData(t)}catch{}await(await this.fetchConnection()).send(new a.SpeechConnectionMessage(n.MessageType.Text,`telemetry`,this.privRequestSession.requestId,`application/json`,t))}}async cancelRecognitionLocal(e,t,n){this.privRequestSession.isRecognizing&&(await this.privRequestSession.onStopRecognizing(),this.cancelRecognition(this.privRequestSession.sessionId,this.privRequestSession.requestId,e,t,n))}async receiveMessage(){try{if(this.privIsDisposed)return;let e=await this.fetchConnection(),t=await e.read();if(this.receiveMessageOverride!==void 0)return this.receiveMessageOverride();if(!t)return this.receiveMessage();this.privServiceHasSentMessage=!0;let o=a.SpeechConnectionMessage.fromConnectionMessage(t);if(o.requestId.toLowerCase()===this.privRequestSession.requestId.toLowerCase())switch(o.path.toLowerCase()){case`turn.start`:this.privMustReportEndOfStream=!0,this.privRequestSession.onServiceTurnStartResponse();break;case`speech.startdetected`:let t=i.SpeechDetected.fromJSON(o.textBody,this.privRequestSession.currentTurnAudioOffset),a=new r.RecognitionEventArgs(t.Offset,this.privRequestSession.sessionId);this.privRecognizer.speechStartDetected&&this.privRecognizer.speechStartDetected(this.privRecognizer,a);break;case`speech.enddetected`:let s;s=o.textBody.length>0?o.textBody:`{ Offset: 0 }`;let c=i.SpeechDetected.fromJSON(s,this.privRequestSession.currentTurnAudioOffset),l=new r.RecognitionEventArgs(c.Offset+this.privRequestSession.currentTurnAudioOffset,this.privRequestSession.sessionId);this.privRecognizer.speechEndDetected&&this.privRecognizer.speechEndDetected(this.privRecognizer,l);break;case`turn.end`:await this.sendTelemetryData(),this.privRequestSession.isSpeechEnded&&this.privMustReportEndOfStream&&(this.privMustReportEndOfStream=!1,await this.cancelRecognitionLocal(r.CancellationReason.EndOfStream,r.CancellationErrorCode.NoError,void 0));let u=new r.SessionEventArgs(this.privRequestSession.sessionId);if(await this.privRequestSession.onServiceTurnEndResponse(this.privRecognizerConfig.isContinuousRecognition),!this.privRecognizerConfig.isContinuousRecognition||this.privRequestSession.isSpeechEnded||!this.privRequestSession.isRecognizing){this.privRecognizer.sessionStopped&&this.privRecognizer.sessionStopped(this.privRecognizer,u);return}else e=await this.fetchConnection(),await this.sendPrePayloadJSON(e);break;default:await this.processTypeSpecificMessages(o)||this.privServiceEvents&&this.serviceEvents.onEvent(new n.ServiceEvent(o.path.toLowerCase(),o.textBody))}return this.receiveMessage()}catch{return null}}updateSpeakerDiarizationAudioOffset(){let e=this.privRequestSession.recognitionBytesSent,t=this.privAverageBytesPerMs===0?0:e/this.privAverageBytesPerMs;this.privSpeechContext.setSpeakerDiarizationAudioOffsetMs(t)}sendSpeechContext(e,t){this.privEnableSpeakerId&&this.updateSpeakerDiarizationAudioOffset();let r=this.speechContext.toJSON();if(t&&this.privRequestSession.onSpeechContext(),r)return e.send(new a.SpeechConnectionMessage(n.MessageType.Text,`speech.context`,this.privRequestSession.requestId,`application/json`,r))}setupTranslationWithLanguageId(){let e=this.privRecognizerConfig.parameters.getProperty(r.PropertyId.SpeechServiceConnection_TranslationToLanguages,void 0),t=this.privRecognizerConfig.autoDetectSourceLanguages!==void 0;if(e!==void 0&&t){this.privSpeechContext.getContext().phraseOutput={interimResults:{resultType:p.ResultType.None},phraseResults:{resultType:m.PhraseResultOutputType.None}};let e=this.privSpeechContext.getContext().translation;if(e){let t=this.privRecognizerConfig.sourceLanguageModels;if(t!==void 0&&t.length>0){let e=this.privSpeechContext.getContext().phraseDetection||{};e.customModels=t,this.privSpeechContext.getContext().phraseDetection=e}this.privRecognizerConfig.parameters.getProperty(r.PropertyId.SpeechServiceConnection_TranslationVoice,void 0)!==void 0&&(e.onSuccess={action:c.NextAction.Synthesize},e.onPassthrough={action:c.NextAction.Synthesize})}}}noOp(){}async sendPrePayloadJSON(e,t=!0){if(this.sendPrePayloadJSONOverride!==void 0)return this.sendPrePayloadJSONOverride(e);await this.sendSpeechContext(e,t),await this.sendWaveHeader(e)}async sendWaveHeader(e){let t=await this.audioSource.format;return e.send(new a.SpeechConnectionMessage(n.MessageType.Binary,`audio`,this.privRequestSession.requestId,`audio/x-wav`,t.header))}connectImpl(){return this.privConnectionPromise===void 0?(this.privConnectionPromise=this.retryableConnect(),this.privConnectionPromise.catch(()=>{}),this.postConnectImplOverride===void 0?this.privConnectionPromise:this.postConnectImplOverride(this.privConnectionPromise)):this.privConnectionPromise.then(e=>e.state()===n.ConnectionState.Disconnected?(this.privConnectionId=null,this.privConnectionPromise=void 0,this.privServiceHasSentMessage=!1,this.connectImpl()):this.privConnectionPromise,()=>(this.privConnectionId=null,this.privConnectionPromise=void 0,this.privServiceHasSentMessage=!1,this.connectImpl()))}sendSpeechServiceConfig(t,r,i){if(r.onSpeechContext(),e.telemetryDataEnabled!==!0){let e={context:{system:JSON.parse(i).context.system}};i=JSON.stringify(e)}if(this.privRecognizerConfig.parameters.getProperty(`f0f5debc-f8c9-4892-ac4b-90a7ab359fd2`,`false`).toLowerCase()===`true`){let e=JSON.parse(i);e.context.DisableReferenceChannel=`True`,e.context.MicSpec=`1_0_0`,i=JSON.stringify(e)}if(i)return t.send(new a.SpeechConnectionMessage(n.MessageType.Text,`speech.config`,r.requestId,`application/json`,i))}async fetchConnection(){return this.privConnectionConfigurationPromise===void 0?(this.privConnectionConfigurationPromise=this.configureConnection(),await this.privConnectionConfigurationPromise):this.privConnectionConfigurationPromise.then(e=>e.state()===n.ConnectionState.Disconnected?(this.privConnectionId=null,this.privConnectionConfigurationPromise=void 0,this.privServiceHasSentMessage=!1,this.fetchConnection()):this.privConnectionConfigurationPromise,()=>(this.privConnectionId=null,this.privConnectionConfigurationPromise=void 0,this.privServiceHasSentMessage=!1,this.fetchConnection()))}async sendAudio(e){let t=await this.audioSource.format;this.privAverageBytesPerMs=t.avgBytesPerSec/1e3;let r=Date.now(),i=this.privRecognizerConfig.parameters.getProperty(`SPEECH-TransmitLengthBeforThrottleMs`,`5000`),o=t.avgBytesPerSec/1e3*parseInt(i,10),s=this.privRequestSession.recogNumber,c=async()=>{if(!this.privIsDisposed&&!this.privRequestSession.isSpeechEnded&&this.privRequestSession.isRecognizing&&this.privRequestSession.recogNumber===s){let i=await this.fetchConnection(),l=await e.read();if(this.privRequestSession.isSpeechEnded)return;let u,d;if(!l||l.isEnd?(u=null,d=0):(u=l.buffer,this.privRequestSession.onAudioSent(u.byteLength),d=o>=this.privRequestSession.bytesSent?0:Math.max(0,r-Date.now())),d!==0&&await this.delay(d),u!==null&&(r=Date.now()+u.byteLength*1e3/(t.avgBytesPerSec*2)),!this.privIsDisposed&&!this.privRequestSession.isSpeechEnded&&this.privRequestSession.isRecognizing&&this.privRequestSession.recogNumber===s)if(i.send(new a.SpeechConnectionMessage(n.MessageType.Binary,`audio`,this.privRequestSession.requestId,null,u)).catch(()=>{this.privRequestSession.onServiceTurnEndResponse(this.privRecognizerConfig.isContinuousRecognition).catch(()=>{})}),l?.isEnd)this.privIsLiveAudio||this.privRequestSession.onSpeechEnded();else return c()}};return c()}async retryableConnect(){let e=!1;this.privAuthFetchEventId=(0,n.createNoDashGuid)();let t=this.privRequestSession.sessionId;this.privConnectionId=t===void 0?(0,n.createNoDashGuid)():t,this.privRequestSession.onPreConnectionStart(this.privAuthFetchEventId,this.privConnectionId);let i=0,a=``;for(;this.privRequestSession.numConnectionAttempts<=this.privRecognizerConfig.maxRetryCount;){this.privRequestSession.onRetryConnection();let t=await(e?this.privAuthentication.fetchOnExpiry(this.privAuthFetchEventId):this.privAuthentication.fetch(this.privAuthFetchEventId));await this.privRequestSession.onAuthCompleted(!1);let n=await this.privConnectionFactory.create(this.privRecognizerConfig,t,this.privConnectionId);this.privRequestSession.listenForServiceTelemetry(n.events),n.events.attach(e=>{this.connectionEvents.onEvent(e)});let r=await n.open();if(r.statusCode===200)return await this.privRequestSession.onConnectionEstablishCompleted(r.statusCode),Promise.resolve(n);r.statusCode===1006&&(e=!0),i=r.statusCode,a=r.reason}return await this.privRequestSession.onConnectionEstablishCompleted(i,a),Promise.reject(`Unable to contact server. StatusCode: ${i}, ${this.privRecognizerConfig.parameters.getProperty(r.PropertyId.SpeechServiceConnection_Endpoint)} Reason: ${a}`)}delay(e){return new Promise(t=>this.privSetTimeout(t,e))}writeBufferToConsole(e){let t=`Buffer Size: `;if(e===null)t+=`null`;else{let n=new Uint8Array(e);t+=`${e.byteLength}\r\n`;for(let r=0;r<e.byteLength;r++)t+=n[r].toString(16).padStart(2,`0`)+` `,(r+1)%16==0&&(console.info(t),t=``)}console.info(t)}async sendFinalAudio(){await(await this.fetchConnection()).send(new a.SpeechConnectionMessage(n.MessageType.Binary,`audio`,this.privRequestSession.requestId,null,null))}async configureConnection(){let e=await this.connectImpl();return this.configConnectionOverride===void 0?(await this.sendSpeechServiceConfig(e,this.privRequestSession,this.privRecognizerConfig.SpeechServiceConfig.serialize()),await this.sendPrePayloadJSON(e,!1),e):this.configConnectionOverride(e)}};e.ServiceRecognizerBase=g,g.telemetryDataEnabled=!0})),Kn=e((e=>{Object.defineProperty(e,`__esModule`,{value:!0}),e.ConversationServiceRecognizer=void 0;var t=Y(),n=$();e.ConversationServiceRecognizer=class extends n.ServiceRecognizerBase{constructor(e,t,n,r,i){super(e,t,n,r,i),this.handleSpeechPhraseMessage=async e=>this.handleSpeechPhrase(e),this.handleSpeechHypothesisMessage=e=>this.handleSpeechHypothesis(e)}processTypeSpecificMessages(e){}handleRecognizedCallback(e,t,n){}handleRecognizingCallback(e,t,n){}async processSpeechMessages(e){let t=!1;switch(e.path.toLowerCase()){case`speech.hypothesis`:case`speech.fragment`:this.handleSpeechHypothesisMessage&&this.handleSpeechHypothesisMessage(e.textBody),t=!0;break;case`speech.phrase`:this.handleSpeechPhraseMessage&&await this.handleSpeechPhraseMessage(e.textBody),t=!0;break;default:break}return t}cancelRecognition(e,t,n,r,i){}async handleSpeechPhrase(e){let r=n.SimpleSpeechPhrase.fromJSON(e,this.privRequestSession.currentTurnAudioOffset),i=n.EnumTranslation.implTranslateRecognitionResult(r.RecognitionStatus),a,o=new t.PropertyCollection;if(o.setProperty(t.PropertyId.SpeechServiceResponse_JsonResult,e),this.privRequestSession.onPhraseRecognized(r.Offset+r.Duration),t.ResultReason.Canceled===i){let e=n.EnumTranslation.implTranslateCancelResult(r.RecognitionStatus),t=n.EnumTranslation.implTranslateCancelErrorCode(r.RecognitionStatus);await this.cancelRecognitionLocal(e,t,n.EnumTranslation.implTranslateErrorDetails(t))}else if(r.RecognitionStatus!==n.RecognitionStatus.EndOfDictation){if(this.privRecognizerConfig.parameters.getProperty(n.OutputFormatPropertyName)===t.OutputFormat[t.OutputFormat.Simple])a=new t.SpeechRecognitionResult(this.privRequestSession.requestId,i,r.DisplayText,r.Duration,r.Offset,r.Language,r.LanguageDetectionConfidence,r.SpeakerId,void 0,r.asJson(),o);else{let r=n.DetailedSpeechPhrase.fromJSON(e,this.privRequestSession.currentTurnAudioOffset);a=new t.SpeechRecognitionResult(this.privRequestSession.requestId,i,r.Text,r.Duration,r.Offset,r.Language,r.LanguageDetectionConfidence,r.SpeakerId,void 0,r.asJson(),o)}this.handleRecognizedCallback(a,a.offset,this.privRequestSession.sessionId)}}handleSpeechHypothesis(e){let r=n.SpeechHypothesis.fromJSON(e,this.privRequestSession.currentTurnAudioOffset),i=new t.PropertyCollection;i.setProperty(t.PropertyId.SpeechServiceResponse_JsonResult,e);let a=new t.SpeechRecognitionResult(this.privRequestSession.requestId,t.ResultReason.RecognizingSpeech,r.Text,r.Duration,r.Offset,r.Language,r.LanguageDetectionConfidence,r.SpeakerId,void 0,r.asJson(),i);this.privRequestSession.onHypothesis(r.Offset),this.handleRecognizingCallback(a,r.Duration,this.privRequestSession.sessionId)}}})),qn=e((e=>{Object.defineProperty(e,`__esModule`,{value:!0}),e.RecognizerConfig=e.SpeechResultFormat=void 0;var t=Y(),n=$(),r=U();(function(e){e[e.Simple=0]=`Simple`,e[e.Detailed=1]=`Detailed`})(e.SpeechResultFormat||={}),e.RecognizerConfig=class{constructor(e,r){this.privSpeechServiceConfig=e||new n.SpeechServiceConfig(new n.Context(null)),this.privParameters=r,this.privMaxRetryCount=parseInt(r.getProperty(`SPEECH-Error-MaxRetryCount`,`4`),10),this.privLanguageIdMode=r.getProperty(t.PropertyId.SpeechServiceConnection_LanguageIdMode,void 0),this.privEnableSpeakerId=!1}get parameters(){return this.privParameters}get recognitionMode(){return this.privRecognitionMode}set recognitionMode(e){this.privRecognitionMode=e,this.privRecognitionActivityTimeout=e===r.RecognitionMode.Interactive?8e3:25e3,this.privSpeechServiceConfig.Recognition=r.RecognitionMode[e]}get SpeechServiceConfig(){return this.privSpeechServiceConfig}get recognitionActivityTimeout(){return this.privRecognitionActivityTimeout}get isContinuousRecognition(){return this.privRecognitionMode!==r.RecognitionMode.Interactive}get languageIdMode(){return this.privLanguageIdMode}get autoDetectSourceLanguages(){return this.parameters.getProperty(t.PropertyId.SpeechServiceConnection_AutoDetectSourceLanguages,void 0)}get recognitionEndpointVersion(){return this.parameters.getProperty(t.PropertyId.SpeechServiceConnection_RecognitionEndpointVersion,`2`)}set recognitionEndpointVersion(e){this.parameters.setProperty(t.PropertyId.SpeechServiceConnection_RecognitionEndpointVersion,e)}get sourceLanguageModels(){let e=[],n=!1;if(this.autoDetectSourceLanguages!==void 0)for(let r of this.autoDetectSourceLanguages.split(`,`)){let i=r+t.PropertyId.SpeechServiceConnection_EndpointId.toString(),a=this.parameters.getProperty(i,void 0);a===void 0?e.push({language:r,endpoint:``}):(e.push({language:r,endpoint:a}),n=!0)}return n?e:void 0}get maxRetryCount(){return this.privMaxRetryCount}get isSpeakerDiarizationEnabled(){return this.privEnableSpeakerId}set isSpeakerDiarizationEnabled(e){this.privEnableSpeakerId=e}}})),Jn=e((e=>{Object.defineProperty(e,`__esModule`,{value:!0})})),Yn=e((e=>{Object.defineProperty(e,`__esModule`,{value:!0}),e.WebsocketMessageFormatter=void 0;var t=j(),n=`\r
`;e.WebsocketMessageFormatter=class{toConnectionMessage(e){let n=new t.Deferred;try{if(e.messageType===t.MessageType.Text){let r=e.textContent,i={},a=null;if(r){let e=r.split(`\r
\r
`);e&&e.length>0&&(i=this.parseHeaders(e[0]),e.length>1&&(a=e[1]))}n.resolve(new t.ConnectionMessage(e.messageType,a,i,e.id))}else if(e.messageType===t.MessageType.Binary){let r=e.binaryContent,i={},a=null;if(!r||r.byteLength<2)throw Error(`Invalid binary message format. Header length missing.`);let o=new DataView(r),s=o.getInt16(0);if(r.byteLength<s+2)throw Error(`Invalid binary message format. Header content missing.`);let c=``;for(let e=0;e<s;e++)c+=String.fromCharCode(o.getInt8(e+2));i=this.parseHeaders(c),r.byteLength>s+2&&(a=r.slice(2+s)),n.resolve(new t.ConnectionMessage(e.messageType,a,i,e.id))}}catch(e){n.reject(`Error formatting the message. Error: ${e}`)}return n.promise}fromConnectionMessage(e){let r=new t.Deferred;try{if(e.messageType===t.MessageType.Text){let i=`${this.makeHeaders(e)}${n}${e.textBody?e.textBody:``}`;r.resolve(new t.RawWebsocketMessage(t.MessageType.Text,i,e.id))}else if(e.messageType===t.MessageType.Binary){let n=this.makeHeaders(e),i=e.binaryBody,a=this.stringToArrayBuffer(n),o=new Int8Array(a),s=o.byteLength,c=new Int8Array(2+s+(i?i.byteLength:0));if(c[0]=s>>8&255,c[1]=s&255,c.set(o,2),i){let e=new Int8Array(i);c.set(e,2+s)}let l=c.buffer;r.resolve(new t.RawWebsocketMessage(t.MessageType.Binary,l,e.id))}}catch(e){r.reject(`Error formatting the message. ${e}`)}return r.promise}makeHeaders(e){let t=``;if(e.headers)for(let r in e.headers)r&&(t+=`${r}: ${e.headers[r]}${n}`);return t}parseHeaders(e){let t={};if(e){let n=e.match(/[^\r\n]+/g);if(t){for(let e of n)if(e){let n=e.indexOf(`:`),r=n>0?e.substr(0,n).trim().toLowerCase():e;t[r]=n>0&&e.length>n+1?e.substr(n+1).trim():``}}}return t}stringToArrayBuffer(e){let t=new ArrayBuffer(e.length),n=new DataView(t);for(let t=0;t<e.length;t++)n.setUint8(t,e.charCodeAt(t));return t}}})),Xn=e((e=>{Object.defineProperty(e,`__esModule`,{value:!0}),e.SpeechConnectionFactory=void 0;var t=X(),n=$(),r=Y(),i=K(),a=$(),o=M(),s=G(),c=U();e.SpeechConnectionFactory=class extends i.ConnectionFactoryBase{constructor(){super(...arguments),this.interactiveRelativeUri=`/speech/recognition/interactive/cognitiveservices/v1`,this.conversationRelativeUri=`/speech/recognition/conversation/cognitiveservices/v1`,this.dictationRelativeUri=`/speech/recognition/dictation/cognitiveservices/v1`,this.universalUri=`/stt/speech/universal/v`}async create(e,l,u){let d=e.parameters.getProperty(r.PropertyId.SpeechServiceConnection_Endpoint,void 0),f=e.parameters.getProperty(r.PropertyId.SpeechServiceConnection_Region,void 0),p=i.ConnectionFactoryBase.getHostSuffix(f),m=e.parameters.getProperty(r.PropertyId.SpeechServiceConnection_Host,`wss://`+f+`.stt.speech`+p),h={},g=e.parameters.getProperty(r.PropertyId.SpeechServiceConnection_EndpointId,void 0),_=e.parameters.getProperty(r.PropertyId.SpeechServiceConnection_RecoLanguage,void 0);if(g?(!d||d.search(s.QueryParameterNames.CustomSpeechDeploymentId)===-1)&&(h[s.QueryParameterNames.CustomSpeechDeploymentId]=g):_&&(!d||d.search(s.QueryParameterNames.Language)===-1)&&(h[s.QueryParameterNames.Language]=_),(!d||d.search(s.QueryParameterNames.Format)===-1)&&(h[s.QueryParameterNames.Format]=e.parameters.getProperty(n.OutputFormatPropertyName,r.OutputFormat[r.OutputFormat.Simple]).toLowerCase()),e.autoDetectSourceLanguages!==void 0&&(h[s.QueryParameterNames.EnableLanguageId]=`true`),this.setCommonUrlParams(e,h,d),d){let t=new URL(d),n=t.pathname;(n===``||n===`/`)&&(t.pathname=this.universalUri+e.recognitionEndpointVersion,d=await i.ConnectionFactoryBase.getRedirectUrlFromEndpoint(t.toString()))}if(!d)switch(e.recognitionMode){case c.RecognitionMode.Conversation:d=e.parameters.getProperty(n.ForceDictationPropertyName,`false`)===`true`?m+this.dictationRelativeUri:e.recognitionEndpointVersion!==void 0&&parseInt(e.recognitionEndpointVersion,10)>1?`${m}${this.universalUri}${e.recognitionEndpointVersion}`:m+this.conversationRelativeUri;break;case c.RecognitionMode.Dictation:d=m+this.dictationRelativeUri;break;default:d=e.recognitionEndpointVersion!==void 0&&parseInt(e.recognitionEndpointVersion,10)>1?`${m}${this.universalUri}${e.recognitionEndpointVersion}`:m+this.interactiveRelativeUri;break}let v={};l.token!==void 0&&l.token!==``&&(v[l.headerName]=l.token),v[o.HeaderNames.ConnectionId]=u,v.connectionId=u;let y=e.parameters.getProperty(`SPEECH-EnableWebsocketCompression`,`false`)===`true`,b=new t.WebsocketConnection(d,h,v,new a.WebsocketMessageFormatter,t.ProxyInfo.fromRecognizerConfig(e),y,u),x=b.uri;return e.parameters.setProperty(r.PropertyId.SpeechServiceConnection_Url,x),b}}})),Zn=e((e=>{Object.defineProperty(e,`__esModule`,{value:!0}),e.ConversationTranscriberConnectionFactory=void 0;var t=X(),n=Y(),r=$(),i=K(),a=$(),o=M(),s=G();e.ConversationTranscriberConnectionFactory=class extends i.ConnectionFactoryBase{constructor(){super(...arguments),this.universalUri=`/stt/speech/universal/v2`,this.conversationRelativeUriV1=`/speech/recognition/conversation/cognitiveservices/v1`}async create(e,r,c){let l=e.parameters.getProperty(n.PropertyId.SpeechServiceConnection_Endpoint,void 0),u=e.parameters.getProperty(n.PropertyId.SpeechServiceConnection_Region,void 0),d=i.ConnectionFactoryBase.getHostSuffix(u),f=e.parameters.getProperty(n.PropertyId.SpeechServiceConnection_Host,`wss://`+u+`.stt.speech`+d),p={},m=e.parameters.getProperty(n.PropertyId.SpeechServiceConnection_EndpointId,void 0),h=e.parameters.getProperty(n.PropertyId.SpeechServiceConnection_RecoLanguage,void 0);if(m?(!l||l.search(s.QueryParameterNames.CustomSpeechDeploymentId)===-1)&&(p[s.QueryParameterNames.CustomSpeechDeploymentId]=m):h&&(!l||l.search(s.QueryParameterNames.Language)===-1)&&(p[s.QueryParameterNames.Language]=h),e.autoDetectSourceLanguages!==void 0&&(p[s.QueryParameterNames.EnableLanguageId]=`true`),e.parameters.getProperty(n.PropertyId.SpeechServiceConnection_RecognitionEndpointVersion,void 0)===`1`)l=`${f}${this.universalUri}`;else{if(this.setV2UrlParams(e,p,l),l){let e=new URL(l),t=e.pathname;(t===``||t===`/`)&&(e.pathname=this.universalUri,l=await i.ConnectionFactoryBase.getRedirectUrlFromEndpoint(e.toString()))}l||=`${f}${this.conversationRelativeUriV1}`}let g={};r.token!==void 0&&r.token!==``&&(g[r.headerName]=r.token),g[o.HeaderNames.ConnectionId]=c;let _=e.parameters.getProperty(`SPEECH-EnableWebsocketCompression`,`false`)===`true`,v=new t.WebsocketConnection(l,p,g,new a.WebsocketMessageFormatter,t.ProxyInfo.fromRecognizerConfig(e),_,c),y=v.uri;return e.parameters.setProperty(n.PropertyId.SpeechServiceConnection_Url,y),v}setV2UrlParams(e,t,i){new Map([[n.PropertyId.Speech_SegmentationSilenceTimeoutMs,s.QueryParameterNames.SegmentationSilenceTimeoutMs],[n.PropertyId.SpeechServiceConnection_EnableAudioLogging,s.QueryParameterNames.EnableAudioLogging],[n.PropertyId.SpeechServiceConnection_EndSilenceTimeoutMs,s.QueryParameterNames.EndSilenceTimeoutMs],[n.PropertyId.SpeechServiceConnection_InitialSilenceTimeoutMs,s.QueryParameterNames.InitialSilenceTimeoutMs],[n.PropertyId.SpeechServiceResponse_PostProcessingOption,s.QueryParameterNames.Postprocessing],[n.PropertyId.SpeechServiceResponse_ProfanityOption,s.QueryParameterNames.Profanity],[n.PropertyId.SpeechServiceResponse_StablePartialResultThreshold,s.QueryParameterNames.StableIntermediateThreshold]]).forEach((n,r)=>{this.setUrlParameter(r,n,e,t,i)});let a=JSON.parse(e.parameters.getProperty(r.ServicePropertiesPropertyName,`{}`));Object.keys(a).forEach(e=>{t[e]=a[e]})}}})),Qn=e((e=>{Object.defineProperty(e,`__esModule`,{value:!0}),e.TranscriberConnectionFactory=void 0;var t=X(),n=Y(),r=K(),i=$(),a=M(),o=G();e.TranscriberConnectionFactory=class extends r.ConnectionFactoryBase{constructor(){super(...arguments),this.multiaudioRelativeUri=`/speech/recognition/multiaudio`}create(e,o,s){let c=e.parameters.getProperty(n.PropertyId.SpeechServiceConnection_Endpoint,void 0),l=e.parameters.getProperty(n.PropertyId.SpeechServiceConnection_Region,`centralus`),u=r.ConnectionFactoryBase.getHostSuffix(l),d=`wss://transcribe.`+l+`.cts.speech`+u+this.multiaudioRelativeUri,f=e.parameters.getProperty(n.PropertyId.SpeechServiceConnection_Host,d),p={};this.setQueryParams(p,e,c),c||=f;let m={};o.token!==void 0&&o.token!==``&&(m[o.headerName]=o.token),m[a.HeaderNames.ConnectionId]=s,e.parameters.setProperty(n.PropertyId.SpeechServiceConnection_Url,c);let h=e.parameters.getProperty(`SPEECH-EnableWebsocketCompression`,`false`)===`true`;return Promise.resolve(new t.WebsocketConnection(c,p,m,new i.WebsocketMessageFormatter,t.ProxyInfo.fromRecognizerConfig(e),h,s))}setQueryParams(e,t,r){let a=t.parameters.getProperty(n.PropertyId.SpeechServiceConnection_EndpointId,void 0),s=t.parameters.getProperty(n.PropertyId.SpeechServiceConnection_RecoLanguage,void 0);a&&!(o.QueryParameterNames.CustomSpeechDeploymentId in e)&&(e[o.QueryParameterNames.CustomSpeechDeploymentId]=a),s&&!(o.QueryParameterNames.Language in e)&&(e[o.QueryParameterNames.Language]=s);let c=t.parameters.getProperty(n.PropertyId.SpeechServiceResponse_RequestWordLevelTimestamps,`false`).toLowerCase()===`true`,l=t.parameters.getProperty(i.OutputFormatPropertyName,n.OutputFormat[n.OutputFormat.Simple])!==n.OutputFormat[n.OutputFormat.Simple];(c||l)&&(e[o.QueryParameterNames.Format]=n.OutputFormat[n.OutputFormat.Detailed].toLowerCase()),this.setCommonUrlParams(t,e,r)}}})),$n=e((e=>{Object.defineProperty(e,`__esModule`,{value:!0}),e.TranslationConnectionFactory=void 0;var t=X(),n=Xt(),r=Y(),i=K(),a=$(),o=M(),s=G(),c=U();e.TranslationConnectionFactory=class extends i.ConnectionFactoryBase{constructor(){super(...arguments),this.universalUri=`/stt/speech/universal/v2`,this.translationV1Uri=`/speech/translation/cognitiveservices/v1`}async create(e,n,s){let c=this.getEndpointUrl(e),l={};if(this.setQueryParams(l,e,c),c){let e=new URL(c),t=e.pathname;(t===``||t===`/`)&&(e.pathname=this.universalUri,c=await i.ConnectionFactoryBase.getRedirectUrlFromEndpoint(e.toString()))}let u={};n.token!==void 0&&n.token!==``&&(u[n.headerName]=n.token),u[o.HeaderNames.ConnectionId]=s,e.parameters.setProperty(r.PropertyId.SpeechServiceConnection_Url,c);let d=e.parameters.getProperty(`SPEECH-EnableWebsocketCompression`,`false`)===`true`;return new t.WebsocketConnection(c,l,u,new a.WebsocketMessageFormatter,t.ProxyInfo.fromRecognizerConfig(e),d,s)}getEndpointUrl(e,t){let a=e.parameters.getProperty(r.PropertyId.SpeechServiceConnection_Region),o=i.ConnectionFactoryBase.getHostSuffix(a),s=e.parameters.getProperty(r.PropertyId.SpeechServiceConnection_Endpoint,void 0);return s||=e.parameters.getProperty(`SPEECH-ForceV1Endpoint`,`false`)===`true`?e.parameters.getProperty(r.PropertyId.SpeechServiceConnection_Host,`wss://{region}.s2s.speech`+o)+this.translationV1Uri:e.parameters.getProperty(r.PropertyId.SpeechServiceConnection_Host,`wss://{region}.stt.speech`+o)+this.universalUri,t===!0?s:n.StringUtils.formatString(s,{region:a})}setQueryParams(e,t,n){e.from=t.parameters.getProperty(r.PropertyId.SpeechServiceConnection_RecoLanguage),e.to=t.parameters.getProperty(r.PropertyId.SpeechServiceConnection_TranslationToLanguages),e.scenario=t.recognitionMode===c.RecognitionMode.Interactive?`interactive`:t.recognitionMode===c.RecognitionMode.Conversation?`conversation`:``,this.setCommonUrlParams(t,e,n),this.setUrlParameter(r.PropertyId.SpeechServiceResponse_TranslationRequestStablePartialResult,s.QueryParameterNames.StableTranslation,t,e,n);let i=t.parameters.getProperty(r.PropertyId.SpeechServiceConnection_TranslationVoice,void 0);i!==void 0&&(e.voice=i,e.features=`requireVoice`)}}})),er=e((e=>{Object.defineProperty(e,`__esModule`,{value:!0}),e.EnumTranslation=void 0;var t=Y(),n=$();e.EnumTranslation=class{static implTranslateRecognitionResult(e,r=!1){let i=t.ResultReason.Canceled;switch(e){case n.RecognitionStatus.Success:i=t.ResultReason.RecognizedSpeech;break;case n.RecognitionStatus.EndOfDictation:i=r?t.ResultReason.RecognizedSpeech:t.ResultReason.NoMatch;break;case n.RecognitionStatus.NoMatch:case n.RecognitionStatus.InitialSilenceTimeout:case n.RecognitionStatus.BabbleTimeout:i=t.ResultReason.NoMatch;break;case n.RecognitionStatus.Error:case n.RecognitionStatus.BadRequest:case n.RecognitionStatus.Forbidden:default:i=t.ResultReason.Canceled;break}return i}static implTranslateCancelResult(e){let r=t.CancellationReason.EndOfStream;switch(e){case n.RecognitionStatus.Success:case n.RecognitionStatus.EndOfDictation:case n.RecognitionStatus.NoMatch:r=t.CancellationReason.EndOfStream;break;case n.RecognitionStatus.InitialSilenceTimeout:case n.RecognitionStatus.BabbleTimeout:case n.RecognitionStatus.Error:case n.RecognitionStatus.BadRequest:case n.RecognitionStatus.Forbidden:default:r=t.CancellationReason.Error;break}return r}static implTranslateCancelErrorCode(e){let r=t.CancellationErrorCode.NoError;switch(e){case n.RecognitionStatus.Error:r=t.CancellationErrorCode.ServiceError;break;case n.RecognitionStatus.TooManyRequests:r=t.CancellationErrorCode.TooManyRequests;break;case n.RecognitionStatus.BadRequest:r=t.CancellationErrorCode.BadRequestParameters;break;case n.RecognitionStatus.Forbidden:r=t.CancellationErrorCode.Forbidden;break;default:r=t.CancellationErrorCode.NoError;break}return r}static implTranslateErrorDetails(e){let n=`The speech service encountered an internal error and could not continue.`;switch(e){case t.CancellationErrorCode.Forbidden:n=`The recognizer is using a free subscription that ran out of quota.`;break;case t.CancellationErrorCode.BadRequestParameters:n=`Invalid parameter or unsupported audio format in the request.`;break;case t.CancellationErrorCode.TooManyRequests:n=`The number of parallel requests exceeded the number of allowed concurrent transcriptions.`;break;default:break}return n}}})),tr=e((e=>{Object.defineProperty(e,`__esModule`,{value:!0}),e.RecognitionStatus=e.SynthesisStatus=void 0,(function(e){e[e.Success=0]=`Success`,e[e.SynthesisEnd=1]=`SynthesisEnd`,e[e.Error=2]=`Error`})(e.SynthesisStatus||={}),(function(e){e[e.Success=0]=`Success`,e[e.NoMatch=1]=`NoMatch`,e[e.InitialSilenceTimeout=2]=`InitialSilenceTimeout`,e[e.BabbleTimeout=3]=`BabbleTimeout`,e[e.Error=4]=`Error`,e[e.EndOfDictation=5]=`EndOfDictation`,e[e.TooManyRequests=6]=`TooManyRequests`,e[e.BadRequest=7]=`BadRequest`,e[e.Forbidden=8]=`Forbidden`})(e.RecognitionStatus||={})})),nr=e((e=>{Object.defineProperty(e,`__esModule`,{value:!0}),e.TranslationSynthesisEnd=void 0;var t=$();e.TranslationSynthesisEnd=class e{constructor(e){this.privSynthesisEnd=JSON.parse(e),this.privSynthesisEnd.SynthesisStatus&&(this.privSynthesisEnd.SynthesisStatus=t.SynthesisStatus[this.privSynthesisEnd.SynthesisStatus]),this.privSynthesisEnd.Status&&(this.privSynthesisEnd.SynthesisStatus=t.SynthesisStatus[this.privSynthesisEnd.Status])}static fromJSON(t){return new e(t)}get SynthesisStatus(){return this.privSynthesisEnd.SynthesisStatus}get FailureReason(){return this.privSynthesisEnd.FailureReason}}})),rr=e((e=>{Object.defineProperty(e,`__esModule`,{value:!0}),e.TranslationHypothesis=void 0;var t=I(),n=A();e.TranslationHypothesis=class e{constructor(e,t){this.privTranslationHypothesis=e,this.privTranslationHypothesis.Offset+=t,this.privTranslationHypothesis.Translation.TranslationStatus=this.mapTranslationStatus(this.privTranslationHypothesis.Translation.TranslationStatus)}static fromJSON(t,n){return new e(JSON.parse(t),n)}static fromTranslationResponse(n,r){t.Contracts.throwIfNullOrUndefined(n,`translationHypothesis`);let i=n.SpeechHypothesis;return n.SpeechHypothesis=void 0,i.Translation=n,new e(i,r)}get Duration(){return this.privTranslationHypothesis.Duration}get Offset(){return this.privTranslationHypothesis.Offset}get Text(){return this.privTranslationHypothesis.Text}get Translation(){return this.privTranslationHypothesis.Translation}get Language(){return this.privTranslationHypothesis.PrimaryLanguage?.Language}asJson(){let e={...this.privTranslationHypothesis};return e.Translation===void 0?JSON.stringify(e):JSON.stringify({...e,TranslationStatus:n.TranslationStatus[e.Translation.TranslationStatus]})}mapTranslationStatus(e){if(typeof e==`string`)return n.TranslationStatus[e];if(typeof e==`number`)return e}}})),ir=e((e=>{Object.defineProperty(e,`__esModule`,{value:!0}),e.TranslationPhrase=void 0;var t=I(),n=$(),r=A();e.TranslationPhrase=class e{constructor(e,t){this.privTranslationPhrase=e,this.privTranslationPhrase.Offset+=t,this.privTranslationPhrase.RecognitionStatus=this.mapRecognitionStatus(this.privTranslationPhrase.RecognitionStatus),this.privTranslationPhrase.Translation!==void 0&&(this.privTranslationPhrase.Translation.TranslationStatus=this.mapTranslationStatus(this.privTranslationPhrase.Translation.TranslationStatus))}static fromJSON(t,n){return new e(JSON.parse(t),n)}static fromTranslationResponse(n,r){t.Contracts.throwIfNullOrUndefined(n,`translationResponse`);let i=n.SpeechPhrase;return n.SpeechPhrase=void 0,i.Translation=n,i.Text=i.DisplayText,new e(i,r)}get RecognitionStatus(){return this.privTranslationPhrase.RecognitionStatus}get Offset(){return this.privTranslationPhrase.Offset}get Duration(){return this.privTranslationPhrase.Duration}get Text(){return this.privTranslationPhrase.Text}get Language(){return this.privTranslationPhrase.PrimaryLanguage?.Language}get Confidence(){return this.privTranslationPhrase.PrimaryLanguage?.Confidence}get Translation(){return this.privTranslationPhrase.Translation}asJson(){let e={...this.privTranslationPhrase},t={...e,RecognitionStatus:n.RecognitionStatus[e.RecognitionStatus]};return e.Translation&&(t.Translation={...e.Translation,TranslationStatus:r.TranslationStatus[e.Translation.TranslationStatus]}),JSON.stringify(t)}mapRecognitionStatus(e){if(typeof e==`string`)return n.RecognitionStatus[e];if(typeof e==`number`)return e}mapTranslationStatus(e){if(typeof e==`string`)return r.TranslationStatus[e];if(typeof e==`number`)return e}}})),ar=e((e=>{Object.defineProperty(e,`__esModule`,{value:!0}),e.TranslationServiceRecognizer=void 0;var t=j(),n=Y(),r=$();e.TranslationServiceRecognizer=class extends r.ConversationServiceRecognizer{constructor(e,t,n,r,i){super(e,t,n,r,i),this.privTranslationRecognizer=i,this.connectionEvents.attach(e=>{e.name===`ConnectionEstablishedEvent`&&this.privTranslationRecognizer.onConnection()})}async processTypeSpecificMessages(e){let i=new n.PropertyCollection,a=await this.processSpeechMessages(e);if(a)return!0;let o=async e=>{if(i.setProperty(n.PropertyId.SpeechServiceResponse_JsonResult,e.asJson()),this.privRequestSession.onPhraseRecognized(e.Offset+e.Duration),e.RecognitionStatus===r.RecognitionStatus.Success){let t=this.fireEventForResult(e,i);if(this.privTranslationRecognizer.recognized)try{this.privTranslationRecognizer.recognized(this.privTranslationRecognizer,t)}catch{}if(this.privSuccessCallback){try{this.privSuccessCallback(t.result)}catch(e){this.privErrorCallback&&this.privErrorCallback(e)}this.privSuccessCallback=void 0,this.privErrorCallback=void 0}}else{let t=r.EnumTranslation.implTranslateRecognitionResult(e.RecognitionStatus),o=new n.TranslationRecognitionResult(void 0,this.privRequestSession.requestId,t,e.Text,e.Duration,e.Offset,e.Language,e.Confidence,void 0,e.asJson(),i);if(t===n.ResultReason.Canceled){let t=r.EnumTranslation.implTranslateCancelResult(e.RecognitionStatus),n=r.EnumTranslation.implTranslateCancelErrorCode(e.RecognitionStatus);await this.cancelRecognitionLocal(t,n,r.EnumTranslation.implTranslateErrorDetails(n))}else if(e.RecognitionStatus!==r.RecognitionStatus.EndOfDictation){let e=new n.TranslationRecognitionEventArgs(o,o.offset,this.privRequestSession.sessionId);if(this.privTranslationRecognizer.recognized)try{this.privTranslationRecognizer.recognized(this.privTranslationRecognizer,e)}catch{}if(this.privSuccessCallback){try{this.privSuccessCallback(o)}catch(e){this.privErrorCallback&&this.privErrorCallback(e)}this.privSuccessCallback=void 0,this.privErrorCallback=void 0}}a=!0}},s=e=>{i.setProperty(n.PropertyId.SpeechServiceResponse_JsonResult,e.asJson());let t=this.fireEventForResult(e,i);if(this.privRequestSession.onHypothesis(t.offset),this.privTranslationRecognizer.recognizing)try{this.privTranslationRecognizer.recognizing(this.privTranslationRecognizer,t)}catch{}a=!0};switch(e.messageType===t.MessageType.Text&&i.setProperty(n.PropertyId.SpeechServiceResponse_JsonResult,e.textBody),e.path.toLowerCase()){case`translation.hypothesis`:s(r.TranslationHypothesis.fromJSON(e.textBody,this.privRequestSession.currentTurnAudioOffset));break;case`translation.response`:let t=JSON.parse(e.textBody);if(t.SpeechPhrase)await o(r.TranslationPhrase.fromTranslationResponse(t,this.privRequestSession.currentTurnAudioOffset));else{let t=JSON.parse(e.textBody);t.SpeechHypothesis&&s(r.TranslationHypothesis.fromTranslationResponse(t,this.privRequestSession.currentTurnAudioOffset))}break;case`translation.phrase`:await o(r.TranslationPhrase.fromJSON(e.textBody,this.privRequestSession.currentTurnAudioOffset));break;case`translation.synthesis`:case`audio`:this.sendSynthesisAudio(e.binaryBody,this.privRequestSession.sessionId),a=!0;break;case`audio.end`:case`translation.synthesis.end`:let i=r.TranslationSynthesisEnd.fromJSON(e.textBody);switch(i.SynthesisStatus){case r.SynthesisStatus.Error:if(this.privTranslationRecognizer.synthesizing){let e=new n.TranslationSynthesisResult(n.ResultReason.Canceled,void 0),t=new n.TranslationSynthesisEventArgs(e,this.privRequestSession.sessionId);try{this.privTranslationRecognizer.synthesizing(this.privTranslationRecognizer,t)}catch{}}if(this.privTranslationRecognizer.canceled){let e=new n.TranslationRecognitionCanceledEventArgs(this.privRequestSession.sessionId,n.CancellationReason.Error,i.FailureReason,n.CancellationErrorCode.ServiceError,null);try{this.privTranslationRecognizer.canceled(this.privTranslationRecognizer,e)}catch{}}break;case r.SynthesisStatus.Success:this.sendSynthesisAudio(void 0,this.privRequestSession.sessionId);break;default:break}a=!0;break;default:break}return a}cancelRecognition(e,t,i,a,o){let s=new n.PropertyCollection;if(s.setProperty(r.CancellationErrorCodePropertyName,n.CancellationErrorCode[a]),this.privTranslationRecognizer.canceled){let t=new n.TranslationRecognitionCanceledEventArgs(e,i,o,a,void 0);try{this.privTranslationRecognizer.canceled(this.privTranslationRecognizer,t)}catch{}}if(this.privSuccessCallback){let e=new n.TranslationRecognitionResult(void 0,t,n.ResultReason.Canceled,void 0,void 0,void 0,void 0,void 0,o,void 0,s);try{this.privSuccessCallback(e),this.privSuccessCallback=void 0}catch{}}}handleRecognizingCallback(e,t,r){try{let i=new n.TranslationRecognitionEventArgs(n.TranslationRecognitionResult.fromSpeechRecognitionResult(e),t,r);this.privTranslationRecognizer.recognizing(this.privTranslationRecognizer,i)}catch{}}handleRecognizedCallback(e,t,r){try{let i=new n.TranslationRecognitionEventArgs(n.TranslationRecognitionResult.fromSpeechRecognitionResult(e),t,r);this.privTranslationRecognizer.recognized(this.privTranslationRecognizer,i)}catch{}}fireEventForResult(e,i){let a;if(e.Translation.Translations!==void 0){a=new n.Translations;for(let t of e.Translation.Translations)a.set(t.Language,t.Text||t.DisplayText)}let o,s;e instanceof r.TranslationPhrase?(o=e.Translation&&e.Translation.TranslationStatus===t.TranslationStatus.Success?n.ResultReason.TranslatedSpeech:n.ResultReason.RecognizedSpeech,s=e.Confidence):o=n.ResultReason.TranslatingSpeech;let c=e.Language,l=new n.TranslationRecognitionResult(a,this.privRequestSession.requestId,o,e.Text,e.Duration,e.Offset,c,s,e.Translation.FailureReason,e.asJson(),i);return new n.TranslationRecognitionEventArgs(l,e.Offset,this.privRequestSession.sessionId)}sendSynthesisAudio(e,t){let r=e===void 0?n.ResultReason.SynthesizingAudioCompleted:n.ResultReason.SynthesizingAudio,i=new n.TranslationSynthesisResult(r,e),a=new n.TranslationSynthesisEventArgs(i,t);if(this.privTranslationRecognizer.synthesizing)try{this.privTranslationRecognizer.synthesizing(this.privTranslationRecognizer,a)}catch{}}}})),or=e((e=>{Object.defineProperty(e,`__esModule`,{value:!0}),e.SpeechDetected=void 0,e.SpeechDetected=class e{constructor(e,t){this.privSpeechStartDetected=JSON.parse(e),this.privSpeechStartDetected.Offset+=t}static fromJSON(t,n){return new e(t,n)}get Offset(){return this.privSpeechStartDetected.Offset}}})),sr=e((e=>{Object.defineProperty(e,`__esModule`,{value:!0}),e.SpeechHypothesis=void 0,e.SpeechHypothesis=class e{constructor(e,t){this.privSpeechHypothesis=JSON.parse(e),this.updateOffset(t)}static fromJSON(t,n){return new e(t,n)}updateOffset(e){this.privSpeechHypothesis.Offset+=e}asJson(){return JSON.stringify(this.privSpeechHypothesis)}get Text(){return this.privSpeechHypothesis.Text}get Offset(){return this.privSpeechHypothesis.Offset}get Duration(){return this.privSpeechHypothesis.Duration}get Language(){return this.privSpeechHypothesis.PrimaryLanguage===void 0?void 0:this.privSpeechHypothesis.PrimaryLanguage.Language}get LanguageDetectionConfidence(){return this.privSpeechHypothesis.PrimaryLanguage===void 0?void 0:this.privSpeechHypothesis.PrimaryLanguage.Confidence}get SpeakerId(){return this.privSpeechHypothesis.SpeakerId}}})),cr=e((e=>{Object.defineProperty(e,`__esModule`,{value:!0}),e.SpeechKeyword=void 0,e.SpeechKeyword=class e{constructor(e,t){this.privSpeechKeyword=JSON.parse(e),this.privSpeechKeyword.Offset+=t}static fromJSON(t,n){return new e(t,n)}get Status(){return this.privSpeechKeyword.Status}get Text(){return this.privSpeechKeyword.Text}get Offset(){return this.privSpeechKeyword.Offset}get Duration(){return this.privSpeechKeyword.Duration}asJson(){return JSON.stringify(this.privSpeechKeyword)}}})),lr=e((e=>{Object.defineProperty(e,`__esModule`,{value:!0}),e.SpeechServiceRecognizer=void 0;var t=Y(),n=$();e.SpeechServiceRecognizer=class extends n.ServiceRecognizerBase{constructor(e,t,n,r,i){super(e,t,n,r,i),this.privSpeechRecognizer=i}async processTypeSpecificMessages(e){let r,i=new t.PropertyCollection,a=!1;switch(e.path.toLowerCase()){case`speech.hypothesis`:case`speech.fragment`:let o=n.SpeechHypothesis.fromJSON(e.textBody,this.privRequestSession.currentTurnAudioOffset);i.setProperty(t.PropertyId.SpeechServiceResponse_JsonResult,o.asJson()),r=new t.SpeechRecognitionResult(this.privRequestSession.requestId,t.ResultReason.RecognizingSpeech,o.Text,o.Duration,o.Offset,o.Language,o.LanguageDetectionConfidence,void 0,void 0,o.asJson(),i),this.privRequestSession.onHypothesis(o.Offset);let s=new t.SpeechRecognitionEventArgs(r,o.Offset,this.privRequestSession.sessionId);if(this.privSpeechRecognizer.recognizing)try{this.privSpeechRecognizer.recognizing(this.privSpeechRecognizer,s)}catch{}a=!0;break;case`speech.phrase`:let c=n.SimpleSpeechPhrase.fromJSON(e.textBody,this.privRequestSession.currentTurnAudioOffset);i.setProperty(t.PropertyId.SpeechServiceResponse_JsonResult,c.asJson());let l=n.EnumTranslation.implTranslateRecognitionResult(c.RecognitionStatus,this.privExpectContentAssessmentResponse);if(this.privRequestSession.onPhraseRecognized(c.Offset+c.Duration),t.ResultReason.Canceled===l){let e=n.EnumTranslation.implTranslateCancelResult(c.RecognitionStatus),t=n.EnumTranslation.implTranslateCancelErrorCode(c.RecognitionStatus);await this.cancelRecognitionLocal(e,t,n.EnumTranslation.implTranslateErrorDetails(t))}else{if(c.RecognitionStatus===n.RecognitionStatus.EndOfDictation)break;if(this.privRecognizerConfig.parameters.getProperty(n.OutputFormatPropertyName)===t.OutputFormat[t.OutputFormat.Simple])r=new t.SpeechRecognitionResult(this.privRequestSession.requestId,l,c.DisplayText,c.Duration,c.Offset,c.Language,c.LanguageDetectionConfidence,void 0,void 0,c.asJson(),i);else{let a=n.DetailedSpeechPhrase.fromJSON(e.textBody,this.privRequestSession.currentTurnAudioOffset);i.setProperty(t.PropertyId.SpeechServiceResponse_JsonResult,a.asJson()),r=new t.SpeechRecognitionResult(this.privRequestSession.requestId,l,a.RecognitionStatus===n.RecognitionStatus.Success?a.NBest[0].Display:``,a.Duration,a.Offset,a.Language,a.LanguageDetectionConfidence,void 0,void 0,a.asJson(),i)}let a=new t.SpeechRecognitionEventArgs(r,r.offset,this.privRequestSession.sessionId);if(this.privSpeechRecognizer.recognized)try{this.privSpeechRecognizer.recognized(this.privSpeechRecognizer,a)}catch{}if(this.privSuccessCallback){try{this.privSuccessCallback(r)}catch(e){this.privErrorCallback&&this.privErrorCallback(e)}this.privSuccessCallback=void 0,this.privErrorCallback=void 0}}a=!0;break;default:break}return a}cancelRecognition(e,r,i,a,o){let s=new t.PropertyCollection;if(s.setProperty(n.CancellationErrorCodePropertyName,t.CancellationErrorCode[a]),this.privSpeechRecognizer.canceled){let n=new t.SpeechRecognitionCanceledEventArgs(i,o,a,void 0,e);try{this.privSpeechRecognizer.canceled(this.privSpeechRecognizer,n)}catch{}}if(this.privSuccessCallback){let e=new t.SpeechRecognitionResult(r,t.ResultReason.Canceled,void 0,void 0,void 0,void 0,void 0,void 0,o,void 0,s);try{this.privSuccessCallback(e),this.privSuccessCallback=void 0}catch{}}}}})),ur=e((e=>{Object.defineProperty(e,`__esModule`,{value:!0}),e.IdentityProvider=e.SpeakerDiarizationMode=void 0,(function(e){e.None=`None`,e.Identity=`Identity`,e.Anonymous=`Anonymous`})(e.SpeakerDiarizationMode||={}),(function(e){e.CallCenter=`CallCenter`})(e.IdentityProvider||={})})),dr=e((e=>{Object.defineProperty(e,`__esModule`,{value:!0}),e.ConversationTranscriptionServiceRecognizer=void 0;var t=Y(),n=$(),r=ur(),i=U();e.ConversationTranscriptionServiceRecognizer=class extends n.ServiceRecognizerBase{constructor(e,t,n,r,i){super(e,t,n,r,i),this.privConversationTranscriber=i,this.setSpeakerDiarizationJson()}setSpeakerDiarizationJson(){if(this.privEnableSpeakerId){let e=this.privSpeechContext.getContext().phraseDetection||{};e.mode=i.RecognitionMode.Conversation;let n={};n.mode=r.SpeakerDiarizationMode.Anonymous,n.audioSessionId=this.privDiarizationSessionId,n.audioOffsetMs=0,n.diarizeIntermediates=this.privRecognizerConfig.parameters.getProperty(t.PropertyId.SpeechServiceResponse_DiarizeIntermediateResults,`false`)===`true`,e.speakerDiarization=n,this.privSpeechContext.getContext().phraseDetection=e}}async processTypeSpecificMessages(e){let r,i=new t.PropertyCollection;i.setProperty(t.PropertyId.SpeechServiceResponse_JsonResult,e.textBody);let a=!1;switch(e.path.toLowerCase()){case`speech.hypothesis`:case`speech.fragment`:let o=n.SpeechHypothesis.fromJSON(e.textBody,this.privRequestSession.currentTurnAudioOffset);r=new t.ConversationTranscriptionResult(this.privRequestSession.requestId,t.ResultReason.RecognizingSpeech,o.Text,o.Duration,o.Offset,o.Language,o.LanguageDetectionConfidence,o.SpeakerId,void 0,o.asJson(),i),this.privRequestSession.onHypothesis(o.Offset);let s=new t.ConversationTranscriptionEventArgs(r,o.Duration,this.privRequestSession.sessionId);if(this.privConversationTranscriber.transcribing)try{this.privConversationTranscriber.transcribing(this.privConversationTranscriber,s)}catch{}a=!0;break;case`speech.phrase`:let c=n.SimpleSpeechPhrase.fromJSON(e.textBody,this.privRequestSession.currentTurnAudioOffset),l=n.EnumTranslation.implTranslateRecognitionResult(c.RecognitionStatus);if(this.privRequestSession.onPhraseRecognized(c.Offset+c.Duration),t.ResultReason.Canceled===l){let e=n.EnumTranslation.implTranslateCancelResult(c.RecognitionStatus),t=n.EnumTranslation.implTranslateCancelErrorCode(c.RecognitionStatus);await this.cancelRecognitionLocal(e,t,n.EnumTranslation.implTranslateErrorDetails(t))}else if(!(this.privRequestSession.isSpeechEnded&&l===t.ResultReason.NoMatch&&c.RecognitionStatus!==n.RecognitionStatus.InitialSilenceTimeout)){if(this.privRecognizerConfig.parameters.getProperty(n.OutputFormatPropertyName)===t.OutputFormat[t.OutputFormat.Simple])r=new t.ConversationTranscriptionResult(this.privRequestSession.requestId,l,c.DisplayText,c.Duration,c.Offset,c.Language,c.LanguageDetectionConfidence,c.SpeakerId,void 0,c.asJson(),i);else{let a=n.DetailedSpeechPhrase.fromJSON(e.textBody,this.privRequestSession.currentTurnAudioOffset);r=new t.ConversationTranscriptionResult(this.privRequestSession.requestId,l,a.RecognitionStatus===n.RecognitionStatus.Success?a.NBest[0].Display:void 0,a.Duration,a.Offset,a.Language,a.LanguageDetectionConfidence,c.SpeakerId,void 0,a.asJson(),i)}let a=new t.ConversationTranscriptionEventArgs(r,r.offset,this.privRequestSession.sessionId);if(this.privConversationTranscriber.transcribed)try{this.privConversationTranscriber.transcribed(this.privConversationTranscriber,a)}catch{}}a=!0;break;default:break}return a}cancelRecognition(e,r,i,a,o){if(new t.PropertyCollection().setProperty(n.CancellationErrorCodePropertyName,t.CancellationErrorCode[a]),this.privConversationTranscriber.canceled){let n=new t.ConversationTranscriptionCanceledEventArgs(i,o,a,void 0,e);try{this.privConversationTranscriber.canceled(this.privConversationTranscriber,n)}catch{}}}}})),fr=e((e=>{Object.defineProperty(e,`__esModule`,{value:!0}),e.TranscriptionServiceRecognizer=void 0;var t=j(),n=Y(),r=$(),i=Z();e.TranscriptionServiceRecognizer=class extends r.ConversationServiceRecognizer{constructor(e,t,r,i,a){super(e,t,r,i,a),this.privTranscriberRecognizer=a,this.sendPrePayloadJSONOverride=e=>this.sendTranscriptionStartJSON(e),this.privRecognizerConfig.parameters.getProperty(n.PropertyId.SpeechServiceResponse_RequestWordLevelTimestamps)===`true`&&this.privSpeechContext.setWordLevelTimings()}async sendSpeechEventAsync(e,t){if(this.privRequestSession.isRecognizing){let n=await this.fetchConnection();await this.sendSpeechEvent(n,this.createSpeechEventPayload(e,t))}}async sendMeetingSpeechEventAsync(e,t){if(this.privRequestSession.isRecognizing){let n=await this.fetchConnection();await this.sendSpeechEvent(n,this.createMeetingSpeechEventPayload(e,t))}}processTypeSpecificMessages(e){return this.processSpeechMessages(e)}handleRecognizedCallback(e,t,r){try{let i=new n.SpeechRecognitionEventArgs(e,t,r);if(this.privTranscriberRecognizer.recognized(this.privTranscriberRecognizer,i),this.privSuccessCallback){try{this.privSuccessCallback(e)}catch(e){this.privErrorCallback&&this.privErrorCallback(e)}this.privSuccessCallback=void 0,this.privErrorCallback=void 0}}catch{}}handleRecognizingCallback(e,t,r){try{let i=new n.SpeechRecognitionEventArgs(e,t,r);this.privTranscriberRecognizer.recognizing(this.privTranscriberRecognizer,i)}catch{}}cancelRecognition(e,t,i,a,o){let s=new n.PropertyCollection;if(s.setProperty(r.CancellationErrorCodePropertyName,n.CancellationErrorCode[a]),this.privTranscriberRecognizer.IsMeetingRecognizer()){if(this.privTranscriberRecognizer.canceled){let t=new n.MeetingTranscriptionCanceledEventArgs(i,o,a,void 0,e);try{this.privTranscriberRecognizer.canceled(this.privTranscriberRecognizer,t)}catch{}}}else if(this.privTranscriberRecognizer.canceled){let t=new n.ConversationTranscriptionCanceledEventArgs(i,o,a,void 0,e);try{this.privTranscriberRecognizer.canceled(this.privTranscriberRecognizer,t)}catch{}}if(this.privSuccessCallback){let e=new n.SpeechRecognitionResult(t,n.ResultReason.Canceled,void 0,void 0,void 0,void 0,void 0,void 0,o,void 0,s);try{this.privSuccessCallback(e),this.privSuccessCallback=void 0}catch{}}}async sendTranscriptionStartJSON(e){if(await this.sendSpeechContext(e,!0),this.privTranscriberRecognizer.IsMeetingRecognizer()){let t=this.privTranscriberRecognizer.getMeetingInfo(),n=this.createMeetingSpeechEventPayload(t,`start`);await this.sendSpeechEvent(e,n)}else{let t=this.privTranscriberRecognizer.getConversationInfo(),n=this.createSpeechEventPayload(t,`start`);await this.sendSpeechEvent(e,n)}await this.sendWaveHeader(e)}sendSpeechEvent(e,n){let r=JSON.stringify(n);if(r)return e.send(new i.SpeechConnectionMessage(t.MessageType.Text,`speech.event`,this.privRequestSession.requestId,`application/json`,r))}createSpeechEventPayload(e,t){let n={id:`meeting`,name:t,meeting:e.conversationProperties};return n.meeting.id=e.id,n.meeting.attendees=e.participants,n}createMeetingSpeechEventPayload(e,t){let n={id:`meeting`,name:t,meeting:e.meetingProperties};return n.meeting.id=e.id,n.meeting.attendees=e.participants,n}}})),pr=e((e=>{Object.defineProperty(e,`__esModule`,{value:!0}),e.DetailedSpeechPhrase=void 0;var t=$();e.DetailedSpeechPhrase=class e{constructor(e,t){this.privDetailedSpeechPhrase=JSON.parse(e),this.privDetailedSpeechPhrase.RecognitionStatus=this.mapRecognitionStatus(this.privDetailedSpeechPhrase.RecognitionStatus),this.updateOffsets(t)}static fromJSON(t,n){return new e(t,n)}updateOffsets(e){if(this.privDetailedSpeechPhrase.Offset+=e,this.privDetailedSpeechPhrase.NBest)for(let t of this.privDetailedSpeechPhrase.NBest){if(t.Words)for(let n of t.Words)n.Offset+=e;if(t.DisplayWords)for(let n of t.DisplayWords)n.Offset+=e}}asJson(){let e={...this.privDetailedSpeechPhrase};return JSON.stringify({...e,RecognitionStatus:t.RecognitionStatus[e.RecognitionStatus]})}get RecognitionStatus(){return this.privDetailedSpeechPhrase.RecognitionStatus}get NBest(){return this.privDetailedSpeechPhrase.NBest}get Duration(){return this.privDetailedSpeechPhrase.Duration}get Offset(){return this.privDetailedSpeechPhrase.Offset}get Language(){return this.privDetailedSpeechPhrase.PrimaryLanguage===void 0?void 0:this.privDetailedSpeechPhrase.PrimaryLanguage.Language}get LanguageDetectionConfidence(){return this.privDetailedSpeechPhrase.PrimaryLanguage===void 0?void 0:this.privDetailedSpeechPhrase.PrimaryLanguage.Confidence}get Text(){return this.privDetailedSpeechPhrase.NBest&&this.privDetailedSpeechPhrase.NBest[0]?this.privDetailedSpeechPhrase.NBest[0].Display||this.privDetailedSpeechPhrase.NBest[0].DisplayText:this.privDetailedSpeechPhrase.DisplayText}get SpeakerId(){return this.privDetailedSpeechPhrase.SpeakerId}mapRecognitionStatus(e){if(typeof e==`string`)return t.RecognitionStatus[e];if(typeof e==`number`)return e}}})),mr=e((e=>{Object.defineProperty(e,`__esModule`,{value:!0}),e.SimpleSpeechPhrase=void 0;var t=$();e.SimpleSpeechPhrase=class e{constructor(e,t=0){this.privSimpleSpeechPhrase=JSON.parse(e),this.privSimpleSpeechPhrase.RecognitionStatus=this.mapRecognitionStatus(this.privSimpleSpeechPhrase.RecognitionStatus),this.updateOffset(t)}static fromJSON(t,n){return new e(t,n)}updateOffset(e){this.privSimpleSpeechPhrase.Offset+=e}asJson(){let e={...this.privSimpleSpeechPhrase};return JSON.stringify({...e,RecognitionStatus:t.RecognitionStatus[e.RecognitionStatus]})}get RecognitionStatus(){return this.privSimpleSpeechPhrase.RecognitionStatus}get DisplayText(){return this.privSimpleSpeechPhrase.DisplayText}get Offset(){return this.privSimpleSpeechPhrase.Offset}get Duration(){return this.privSimpleSpeechPhrase.Duration}get Language(){return this.privSimpleSpeechPhrase.PrimaryLanguage===void 0?void 0:this.privSimpleSpeechPhrase.PrimaryLanguage.Language}get LanguageDetectionConfidence(){return this.privSimpleSpeechPhrase.PrimaryLanguage===void 0?void 0:this.privSimpleSpeechPhrase.PrimaryLanguage.Confidence}get SpeakerId(){return this.privSimpleSpeechPhrase.SpeakerId}mapRecognitionStatus(e){if(typeof e==`string`)return t.RecognitionStatus[e];if(typeof e==`number`)return e}}})),hr=e((e=>{Object.defineProperty(e,`__esModule`,{value:!0}),e.ServiceTelemetryListener=void 0;var t=j(),n=P();e.ServiceTelemetryListener=class{constructor(e,t,n){this.privIsDisposed=!1,this.privListeningTriggerMetric=null,this.privMicMetric=null,this.privConnectionEstablishMetric=null,this.privRequestId=e,this.privAudioSourceId=t,this.privAudioNodeId=n,this.privReceivedMessages={},this.privPhraseLatencies=[],this.privHypothesisLatencies=[]}phraseReceived(e){e>0&&this.privPhraseLatencies.push(Date.now()-e)}hypothesisReceived(e){e>0&&this.privHypothesisLatencies.push(Date.now()-e)}onEvent(e){this.privIsDisposed||(e instanceof n.RecognitionTriggeredEvent&&e.requestId===this.privRequestId&&(this.privListeningTriggerMetric={End:e.eventTime,Name:`ListeningTrigger`,Start:e.eventTime}),e instanceof t.AudioStreamNodeAttachingEvent&&e.audioSourceId===this.privAudioSourceId&&e.audioNodeId===this.privAudioNodeId&&(this.privMicStartTime=e.eventTime),e instanceof t.AudioStreamNodeAttachedEvent&&e.audioSourceId===this.privAudioSourceId&&e.audioNodeId===this.privAudioNodeId&&(this.privMicStartTime=e.eventTime),e instanceof t.AudioSourceErrorEvent&&e.audioSourceId===this.privAudioSourceId&&(this.privMicMetric||={End:e.eventTime,Error:e.error,Name:`Microphone`,Start:this.privMicStartTime}),e instanceof t.AudioStreamNodeErrorEvent&&e.audioSourceId===this.privAudioSourceId&&e.audioNodeId===this.privAudioNodeId&&(this.privMicMetric||={End:e.eventTime,Error:e.error,Name:`Microphone`,Start:this.privMicStartTime}),e instanceof t.AudioStreamNodeDetachedEvent&&e.audioSourceId===this.privAudioSourceId&&e.audioNodeId===this.privAudioNodeId&&(this.privMicMetric||={End:e.eventTime,Name:`Microphone`,Start:this.privMicStartTime}),e instanceof n.ConnectingToServiceEvent&&e.requestId===this.privRequestId&&(this.privConnectionId=e.sessionId),e instanceof t.ConnectionStartEvent&&e.connectionId===this.privConnectionId&&(this.privConnectionStartTime=e.eventTime),e instanceof t.ConnectionEstablishedEvent&&e.connectionId===this.privConnectionId&&(this.privConnectionEstablishMetric||={End:e.eventTime,Id:this.privConnectionId,Name:`Connection`,Start:this.privConnectionStartTime}),e instanceof t.ConnectionEstablishErrorEvent&&e.connectionId===this.privConnectionId&&(this.privConnectionEstablishMetric||={End:e.eventTime,Error:this.getConnectionError(e.statusCode),Id:this.privConnectionId,Name:`Connection`,Start:this.privConnectionStartTime}),e instanceof t.ConnectionMessageReceivedEvent&&e.connectionId===this.privConnectionId&&e.message&&e.message.headers&&e.message.headers.path&&(this.privReceivedMessages[e.message.headers.path]||(this.privReceivedMessages[e.message.headers.path]=[]),this.privReceivedMessages[e.message.headers.path].length<50&&this.privReceivedMessages[e.message.headers.path].push(e.networkReceivedTime)))}getTelemetry(){let e=[];this.privListeningTriggerMetric&&e.push(this.privListeningTriggerMetric),this.privMicMetric&&e.push(this.privMicMetric),this.privConnectionEstablishMetric&&e.push(this.privConnectionEstablishMetric),this.privPhraseLatencies.length>0&&e.push({PhraseLatencyMs:this.privPhraseLatencies}),this.privHypothesisLatencies.length>0&&e.push({FirstHypothesisLatencyMs:this.privHypothesisLatencies});let t={Metrics:e,ReceivedMessages:this.privReceivedMessages},n=JSON.stringify(t);return this.privReceivedMessages={},this.privListeningTriggerMetric=null,this.privMicMetric=null,this.privConnectionEstablishMetric=null,this.privPhraseLatencies=[],this.privHypothesisLatencies=[],n}get hasTelemetry(){return Object.keys(this.privReceivedMessages).length!==0||this.privListeningTriggerMetric!==null||this.privMicMetric!==null||this.privConnectionEstablishMetric!==null||this.privPhraseLatencies.length!==0||this.privHypothesisLatencies.length!==0}dispose(){this.privIsDisposed=!0}getConnectionError(e){switch(e){case 400:case 1002:case 1003:case 1005:case 1007:case 1008:case 1009:return`BadRequest`;case 401:return`Unauthorized`;case 403:return`Forbidden`;case 503:case 1001:return`ServerUnavailable`;case 500:case 1011:return`ServerError`;case 408:case 504:return`Timeout`;default:return`statuscode:`+e.toString()}}}})),gr=e((e=>{Object.defineProperty(e,`__esModule`,{value:!0}),e.RequestSession=void 0;var t=j(),n=P(),r=hr();e.RequestSession=class{constructor(e){this.privIsDisposed=!1,this.privDetachables=[],this.privIsAudioNodeDetached=!1,this.privIsRecognizing=!1,this.privIsSpeechEnded=!1,this.privTurnStartAudioOffset=0,this.privLastRecoOffset=0,this.privHypothesisReceived=!1,this.privBytesSent=0,this.privRecognitionBytesSent=0,this.privRecogNumber=0,this.privInTurn=!1,this.privConnectionAttempts=0,this.privAudioSourceId=e,this.privRequestId=(0,t.createNoDashGuid)(),this.privAudioNodeId=(0,t.createNoDashGuid)(),this.privTurnDeferral=new t.Deferred,this.privTurnDeferral.resolve()}get sessionId(){return this.privSessionId}get requestId(){return this.privRequestId}get audioNodeId(){return this.privAudioNodeId}get turnCompletionPromise(){return this.privTurnDeferral.promise}get isSpeechEnded(){return this.privIsSpeechEnded}get isRecognizing(){return this.privIsRecognizing}get currentTurnAudioOffset(){return this.privTurnStartAudioOffset}get recogNumber(){return this.privRecogNumber}get numConnectionAttempts(){return this.privConnectionAttempts}get bytesSent(){return this.privBytesSent}get recognitionBytesSent(){return this.privRecognitionBytesSent}listenForServiceTelemetry(e){this.privServiceTelemetryListener&&this.privDetachables.push(e.attachListener(this.privServiceTelemetryListener))}startNewRecognition(){this.privRecognitionBytesSent=0,this.privIsSpeechEnded=!1,this.privIsRecognizing=!0,this.privTurnStartAudioOffset=0,this.privLastRecoOffset=0,this.privRecogNumber++,this.privServiceTelemetryListener=new r.ServiceTelemetryListener(this.privRequestId,this.privAudioSourceId,this.privAudioNodeId),this.onEvent(new n.RecognitionTriggeredEvent(this.requestId,this.privSessionId,this.privAudioSourceId,this.privAudioNodeId))}async onAudioSourceAttachCompleted(e,t){this.privAudioNode=e,this.privIsAudioNodeDetached=!1,t?await this.onComplete():this.onEvent(new n.ListeningStartedEvent(this.privRequestId,this.privSessionId,this.privAudioSourceId,this.privAudioNodeId))}onPreConnectionStart(e,t){this.privAuthFetchEventId=e,this.privSessionId=t,this.onEvent(new n.ConnectingToServiceEvent(this.privRequestId,this.privAuthFetchEventId,this.privSessionId))}async onAuthCompleted(e){e&&await this.onComplete()}async onConnectionEstablishCompleted(e,t){if(e===200){this.onEvent(new n.RecognitionStartedEvent(this.requestId,this.privAudioSourceId,this.privAudioNodeId,this.privAuthFetchEventId,this.privSessionId)),this.privAudioNode&&this.privAudioNode.replay(),this.privTurnStartAudioOffset=this.privLastRecoOffset,this.privBytesSent=0;return}else e===403&&await this.onComplete()}async onServiceTurnEndResponse(e){this.privTurnDeferral.resolve(),!e||this.isSpeechEnded?(await this.onComplete(),this.privInTurn=!1):(this.privTurnStartAudioOffset=this.privLastRecoOffset,this.privAudioNode.replay())}onSpeechContext(){this.privRequestId=(0,t.createNoDashGuid)()}onServiceTurnStartResponse(){this.privTurnDeferral&&this.privInTurn&&(this.privTurnDeferral.reject(`Another turn started before current completed.`),this.privTurnDeferral.promise.then().catch(()=>{})),this.privInTurn=!0,this.privTurnDeferral=new t.Deferred}onHypothesis(e){this.privHypothesisReceived||(this.privHypothesisReceived=!0,this.privServiceTelemetryListener.hypothesisReceived(this.privAudioNode.findTimeAtOffset(e)))}onPhraseRecognized(e){this.privServiceTelemetryListener.phraseReceived(this.privAudioNode.findTimeAtOffset(e)),this.onServiceRecognized(e)}onServiceRecognized(e){this.privLastRecoOffset=e,this.privHypothesisReceived=!1,this.privAudioNode.shrinkBuffers(e),this.privConnectionAttempts=0}onAudioSent(e){this.privBytesSent+=e,this.privRecognitionBytesSent+=e}onRetryConnection(){this.privConnectionAttempts++}async dispose(){if(!this.privIsDisposed){this.privIsDisposed=!0;for(let e of this.privDetachables)await e.detach();this.privServiceTelemetryListener&&this.privServiceTelemetryListener.dispose(),this.privIsRecognizing=!1}}getTelemetry(){return this.privServiceTelemetryListener.hasTelemetry?this.privServiceTelemetryListener.getTelemetry():null}async onStopRecognizing(){await this.onComplete()}onSpeechEnded(){this.privIsSpeechEnded=!0}onEvent(e){this.privServiceTelemetryListener&&this.privServiceTelemetryListener.onEvent(e),t.Events.instance.onEvent(e)}async onComplete(){this.privIsRecognizing&&(this.privIsRecognizing=!1,await this.detachAudioNode())}async detachAudioNode(){this.privIsAudioNodeDetached||(this.privIsAudioNodeDetached=!0,this.privAudioNode&&await this.privAudioNode.detach())}}})),_r=e((e=>{Object.defineProperty(e,`__esModule`,{value:!0}),e.TentativePhraseResultsOption=e.OutputFormat=e.PhraseExtension=e.PhraseOption=void 0,(function(e){e.WordTimings=`WordTimings`,e.SNR=`SNR`,e.Pronunciation=`Pronunciation`,e.WordPronunciation=`WordPronunciation`,e.WordConfidence=`WordConfidence`,e.Words=`Words`,e.Sentiment=`Sentiment`,e.PronunciationAssessment=`PronunciationAssessment`,e.ContentAssessment=`ContentAssessment`,e.PhraseAMScore=`PhraseAMScore`,e.PhraseLMScore=`PhraseLMScore`,e.WordAMScore=`WordAMScore`,e.WordLMScore=`WordLMScore`,e.RuleTree=`RuleTree`,e.NBestTimings=`NBestTimings`,e.DecoderDiagnostics=`DecoderDiagnostics`,e.DisplayWordTimings=`DisplayWordTimings`,e.DisplayWords=`DisplayWords`})(e.PhraseOption||={}),(function(e){e.Graph=`Graph`,e.Corrections=`Corrections`,e.Sentiment=`Sentiment`})(e.PhraseExtension||={}),(function(e){e.Simple=`Simple`,e.Detailed=`Detailed`})(e.OutputFormat||={}),(function(e){e.None=`None`,e.Always=`Always`})(e.TentativePhraseResultsOption||={})})),vr=e((e=>{Object.defineProperty(e,`__esModule`,{value:!0}),e.SpeechContext=void 0;var t=U(),n=_r();e.SpeechContext=class{constructor(e){this.privContext={},this.privDynamicGrammar=e}getContext(){return this.privContext}setPronunciationAssessmentParams(e,r=!1){this.privContext.phraseDetection===void 0&&(this.privContext.phraseDetection={enrichment:{pronunciationAssessment:{}}}),this.privContext.phraseDetection.enrichment===void 0&&(this.privContext.phraseDetection.enrichment={pronunciationAssessment:{}}),this.privContext.phraseDetection.enrichment.pronunciationAssessment=JSON.parse(e)||{},r&&(this.privContext.phraseDetection.mode=t.RecognitionMode.Conversation),this.setWordLevelTimings(),this.privContext.phraseOutput.detailed.options.push(n.PhraseOption.PronunciationAssessment),this.privContext.phraseOutput.detailed.options.indexOf(n.PhraseOption.SNR)===-1&&this.privContext.phraseOutput.detailed.options.push(n.PhraseOption.SNR)}setDetailedOutputFormat(){this.privContext.phraseOutput===void 0&&(this.privContext.phraseOutput={detailed:{options:[]}}),this.privContext.phraseOutput.detailed===void 0&&(this.privContext.phraseOutput.detailed={options:[]}),this.privContext.phraseOutput.format=n.OutputFormat.Detailed}setWordLevelTimings(){this.privContext.phraseOutput===void 0&&(this.privContext.phraseOutput={detailed:{options:[]}}),this.privContext.phraseOutput.detailed===void 0&&(this.privContext.phraseOutput.detailed={options:[]}),this.privContext.phraseOutput.format=n.OutputFormat.Detailed,this.privContext.phraseOutput.detailed.options.indexOf(n.PhraseOption.WordTimings)===-1&&this.privContext.phraseOutput.detailed.options.push(n.PhraseOption.WordTimings)}setSpeakerDiarizationAudioOffsetMs(e){this.privContext.phraseDetection.speakerDiarization.audioOffsetMs=e}toJSON(){let e=this.privDynamicGrammar.generateGrammarObject();return this.privContext.dgi=e,JSON.stringify(this.privContext)}}})),yr=e((e=>{Object.defineProperty(e,`__esModule`,{value:!0}),e.SubstringMatchType=e.GroupType=void 0,(function(e){e.IntentText=`IntentText`,e.IntentEntity=`IntentEntity`,e.Generic=`Generic`,e.People=`People`,e.Place=`Place`,e.DynamicEntity=`DynamicEntity`})(e.GroupType||={}),(function(e){e.None=`None`,e.LeftRooted=`LeftRooted`,e.PartialName=`PartialName`,e.MiddleOfSentence=`MiddleOfSentence`})(e.SubstringMatchType||={})})),br=e((e=>{Object.defineProperty(e,`__esModule`,{value:!0}),e.DynamicGrammarBuilder=void 0;var t=yr();e.DynamicGrammarBuilder=class{constructor(){this.privWeight=1}addPhrase(e){this.privPhrases||=[],e instanceof Array?this.privPhrases=this.privPhrases.concat(e):this.privPhrases.push(e)}clearPhrases(){this.privPhrases=void 0}addReferenceGrammar(e){this.privGrammars||=[],e instanceof Array?this.privGrammars=this.privGrammars.concat(e):this.privGrammars.push(e)}clearGrammars(){this.privGrammars=void 0}setWeight(e){this.privWeight=e}generateGrammarObject(){if(this.privGrammars===void 0&&this.privPhrases===void 0)return;let e={};if(e.referenceGrammars=this.privGrammars,this.privPhrases!==void 0&&this.privPhrases.length!==0){let n=[];this.privPhrases.forEach(e=>{n.push({text:e})}),e.groups=[{type:t.GroupType.Generic,items:n}],e.bias=this.privWeight}return e}}})),xr=e((e=>{Object.defineProperty(e,`__esModule`,{value:!0}),e.MessageDataStreamType=e.ActivityPayloadResponse=void 0,e.ActivityPayloadResponse=class e{constructor(e){this.privActivityResponse=JSON.parse(e)}static fromJSON(t){return new e(t)}get conversationId(){return this.privActivityResponse.conversationId}get messageDataStreamType(){return this.privActivityResponse.messageDataStreamType}get messagePayload(){return this.privActivityResponse.messagePayload}get version(){return this.privActivityResponse.version}},(function(e){e[e.None=0]=`None`,e[e.TextToSpeechAudio=1]=`TextToSpeechAudio`})(e.MessageDataStreamType||={})})),Sr=e((e=>{Object.defineProperty(e,`__esModule`,{value:!0}),e.DialogServiceTurnState=void 0;var t=B(),n=V(),r=xr();e.DialogServiceTurnState=class{constructor(e,t){this.privRequestId=t,this.privIsCompleted=!1,this.privAudioStream=null,this.privTurnManager=e,this.resetTurnEndTimeout()}get audioStream(){return this.resetTurnEndTimeout(),this.privAudioStream}processActivityPayload(e,i){return e.messageDataStreamType===r.MessageDataStreamType.TextToSpeechAudio&&(this.privAudioStream=n.AudioOutputStream.createPullStream(),this.privAudioStream.format=i===void 0?t.AudioOutputFormatImpl.getDefaultOutputFormat():i),this.privAudioStream}endAudioStream(){this.privAudioStream!==null&&!this.privAudioStream.isClosed&&this.privAudioStream.close()}complete(){this.privTimeoutToken!==void 0&&clearTimeout(this.privTimeoutToken),this.endAudioStream()}resetTurnEndTimeout(){this.privTimeoutToken!==void 0&&clearTimeout(this.privTimeoutToken),this.privTimeoutToken=setTimeout(()=>{this.privTurnManager.CompleteTurn(this.privRequestId)},2e3)}}})),Cr=e((e=>{Object.defineProperty(e,`__esModule`,{value:!0}),e.DialogServiceTurnStateManager=void 0;var t=w(),n=Sr();e.DialogServiceTurnStateManager=class{constructor(){this.privTurnMap=new Map}StartTurn(e){if(this.privTurnMap.has(e))throw new t.InvalidOperationError(`Service error: There is already a turn with id:`+e);let r=new n.DialogServiceTurnState(this,e);return this.privTurnMap.set(e,r),this.privTurnMap.get(e)}GetTurn(e){return this.privTurnMap.get(e)}CompleteTurn(e){if(!this.privTurnMap.has(e))throw new t.InvalidOperationError(`Service error: Received turn end for an unknown turn id:`+e);let n=this.privTurnMap.get(e);return n.complete(),this.privTurnMap.delete(e),n}}})),wr=e((e=>{Object.defineProperty(e,`__esModule`,{value:!0}),e.InvocationSource=void 0,(function(e){e.None=`None`,e.VoiceActivationWithKeyword=`VoiceActivationWithKeyword`})(e.InvocationSource||={})})),Tr=e((e=>{Object.defineProperty(e,`__esModule`,{value:!0}),e.OnRejectAction=e.KeywordDetectionType=void 0,(function(e){e.StartTrigger=`StartTrigger`})(e.KeywordDetectionType||={}),(function(e){e.EndOfTurn=`EndOfTurn`,e.Continue=`Continue`})(e.OnRejectAction||={})})),Er=e((e=>{Object.defineProperty(e,`__esModule`,{value:!0}),e.DialogServiceAdapter=void 0;var t=X(),n=E(),r=j(),i=B(),a=Y(),o=Cr(),s=$(),c=xr(),l=wr(),u=Tr(),d=Z();e.DialogServiceAdapter=class extends s.ServiceRecognizerBase{constructor(e,t,n,i,a){super(e,t,n,i,a),this.privEvents=new r.EventSource,this.privDialogServiceConnector=a,this.receiveMessageOverride=()=>this.receiveDialogMessageOverride(),this.privTurnStateManager=new o.DialogServiceTurnStateManager,this.recognizeOverride=(e,t,n)=>this.listenOnce(e,t,n),this.postConnectImplOverride=e=>this.dialogConnectImpl(e),this.configConnectionOverride=e=>this.configConnection(e),this.disconnectOverride=()=>this.privDisconnect(),this.privDialogAudioSource=n,this.agentConfigSent=!1,this.privLastResult=null,this.connectionEvents.attach(e=>{e.name===`ConnectionClosedEvent`&&(this.terminateMessageLoop=!0)})}async sendMessage(e){let t=(0,r.createGuid)(),n=(0,r.createNoDashGuid)(),i={context:{interactionId:t},messagePayload:JSON.parse(e),version:.5},a=JSON.stringify(i);await(await this.fetchConnection()).send(new d.SpeechConnectionMessage(r.MessageType.Text,`agent`,n,`application/json`,a))}async privDisconnect(){await this.cancelRecognition(this.privRequestSession.sessionId,this.privRequestSession.requestId,a.CancellationReason.Error,a.CancellationErrorCode.NoError,`Disconnecting`),this.terminateMessageLoop=!0,this.agentConfigSent=!1}processTypeSpecificMessages(e){let t=new a.PropertyCollection;e.messageType===r.MessageType.Text&&t.setProperty(a.PropertyId.SpeechServiceResponse_JsonResult,e.textBody);let n,i;switch(e.path.toLowerCase()){case`speech.phrase`:let r=s.SimpleSpeechPhrase.fromJSON(e.textBody,this.privRequestSession.currentTurnAudioOffset);if(this.privRequestSession.onPhraseRecognized(r.Offset+r.Duration),r.RecognitionStatus!==s.RecognitionStatus.TooManyRequests&&r.RecognitionStatus!==s.RecognitionStatus.Error){let e=this.fireEventForResult(r,t);if(this.privLastResult=e.result,this.privDialogServiceConnector.recognized)try{this.privDialogServiceConnector.recognized(this.privDialogServiceConnector,e)}catch{}}i=!0;break;case`speech.hypothesis`:let o=s.SpeechHypothesis.fromJSON(e.textBody,this.privRequestSession.currentTurnAudioOffset);n=new a.SpeechRecognitionResult(this.privRequestSession.requestId,a.ResultReason.RecognizingSpeech,o.Text,o.Duration,o.Offset,o.Language,o.LanguageDetectionConfidence,void 0,void 0,o.asJson(),t),this.privRequestSession.onHypothesis(o.Offset);let c=new a.SpeechRecognitionEventArgs(n,o.Offset,this.privRequestSession.sessionId);if(this.privDialogServiceConnector.recognizing)try{this.privDialogServiceConnector.recognizing(this.privDialogServiceConnector,c)}catch{}i=!0;break;case`speech.keyword`:let l=s.SpeechKeyword.fromJSON(e.textBody,this.privRequestSession.currentTurnAudioOffset);n=new a.SpeechRecognitionResult(this.privRequestSession.requestId,l.Status===`Accepted`?a.ResultReason.RecognizedKeyword:a.ResultReason.NoMatch,l.Text,l.Duration,l.Offset,void 0,void 0,void 0,void 0,l.asJson(),t),l.Status!==`Accepted`&&(this.privLastResult=n);let u=new a.SpeechRecognitionEventArgs(n,n.duration,n.resultId);if(this.privDialogServiceConnector.recognized)try{this.privDialogServiceConnector.recognized(this.privDialogServiceConnector,u)}catch{}i=!0;break;case`audio`:{let t=e.requestId.toUpperCase(),n=this.privTurnStateManager.GetTurn(t);try{e.binaryBody?n.audioStream.write(e.binaryBody):n.endAudioStream()}catch{}}i=!0;break;case`response`:this.handleResponseMessage(e),i=!0;break;default:break}let o=new r.Deferred;return o.resolve(i),o.promise}async cancelRecognition(e,t,n,r,i){if(this.terminateMessageLoop=!0,this.privRequestSession.isRecognizing&&await this.privRequestSession.onStopRecognizing(),this.privDialogServiceConnector.canceled){let t=new a.PropertyCollection;t.setProperty(s.CancellationErrorCodePropertyName,a.CancellationErrorCode[r]);let o=new a.SpeechRecognitionCanceledEventArgs(n,i,r,void 0,e);try{this.privDialogServiceConnector.canceled(this.privDialogServiceConnector,o)}catch{}if(this.privSuccessCallback){let e=new a.SpeechRecognitionResult(void 0,a.ResultReason.Canceled,void 0,void 0,void 0,void 0,void 0,void 0,i,void 0,t);try{this.privSuccessCallback(e),this.privSuccessCallback=void 0}catch{}}}}async listenOnce(e,n,r){this.privRecognizerConfig.recognitionMode=e,this.privSuccessCallback=n,this.privErrorCallback=r,this.privRequestSession.startNewRecognition(),this.privRequestSession.listenForServiceTelemetry(this.privDialogAudioSource.events),this.privRecognizerConfig.parameters.setProperty(a.PropertyId.Speech_SessionId,this.privRequestSession.sessionId);let i=this.connectImpl(),o=this.sendPreAudioMessages(),s=await this.privDialogAudioSource.attach(this.privRequestSession.audioNodeId),c=await this.privDialogAudioSource.format,l=await this.privDialogAudioSource.deviceInfo,u=new t.ReplayableAudioNode(s,c.avgBytesPerSec);await this.privRequestSession.onAudioSourceAttachCompleted(u,!1),this.privRecognizerConfig.SpeechServiceConfig.Context.audio={source:l};try{await i,await o}catch(e){return await this.cancelRecognition(this.privRequestSession.sessionId,this.privRequestSession.requestId,a.CancellationReason.Error,a.CancellationErrorCode.ConnectionFailure,e),Promise.resolve()}let d=new a.SessionEventArgs(this.privRequestSession.sessionId);this.privRecognizer.sessionStarted&&this.privRecognizer.sessionStarted(this.privRecognizer,d),this.sendAudio(u).then(()=>{},async e=>{await this.cancelRecognition(this.privRequestSession.sessionId,this.privRequestSession.requestId,a.CancellationReason.Error,a.CancellationErrorCode.RuntimeError,e)})}dialogConnectImpl(e){return this.privConnectionLoop=this.startMessageLoop(),e}receiveDialogMessageOverride(){let e=new r.Deferred,t=async()=>{try{let n=this.isDisposed(),i=!this.isDisposed()&&this.terminateMessageLoop;if(n||i){e.resolve(void 0);return}let o=await(await this.fetchConnection()).read();if(!o)return t();let c=d.SpeechConnectionMessage.fromConnectionMessage(o);switch(c.path.toLowerCase()){case`turn.start`:{let e=c.requestId.toUpperCase();e===this.privRequestSession.requestId.toUpperCase()?this.privRequestSession.onServiceTurnStartResponse():this.privTurnStateManager.StartTurn(e)}break;case`speech.startdetected`:let e=s.SpeechDetected.fromJSON(c.textBody,this.privRequestSession.currentTurnAudioOffset),t=new a.RecognitionEventArgs(e.Offset,this.privRequestSession.sessionId);this.privRecognizer.speechStartDetected&&this.privRecognizer.speechStartDetected(this.privRecognizer,t);break;case`speech.enddetected`:let n;n=c.textBody.length>0?c.textBody:`{ Offset: 0 }`;let i=s.SpeechDetected.fromJSON(n,this.privRequestSession.currentTurnAudioOffset);this.privRequestSession.onServiceRecognized(i.Offset);let o=new a.RecognitionEventArgs(i.Offset,this.privRequestSession.sessionId);this.privRecognizer.speechEndDetected&&this.privRecognizer.speechEndDetected(this.privRecognizer,o);break;case`turn.end`:{let e=c.requestId.toUpperCase();if(e!==this.privRequestSession.requestId.toUpperCase())this.privTurnStateManager.CompleteTurn(e);else{let e=new a.SessionEventArgs(this.privRequestSession.sessionId);if(await this.privRequestSession.onServiceTurnEndResponse(!1),(!this.privRecognizerConfig.isContinuousRecognition||this.privRequestSession.isSpeechEnded||!this.privRequestSession.isRecognizing)&&this.privRecognizer.sessionStopped&&this.privRecognizer.sessionStopped(this.privRecognizer,e),this.privSuccessCallback&&this.privLastResult){try{this.privSuccessCallback(this.privLastResult),this.privLastResult=null}catch(e){this.privErrorCallback&&this.privErrorCallback(e)}this.privSuccessCallback=void 0,this.privErrorCallback=void 0}}}break;default:try{await this.processTypeSpecificMessages(c)||this.serviceEvents&&this.serviceEvents.onEvent(new r.ServiceEvent(c.path.toLowerCase(),c.textBody))}catch{}}return t()}catch{this.terminateMessageLoop=!0,e.resolve()}};return t().catch(e=>{r.Events.instance.onEvent(new r.BackgroundEvent(e))}),e.promise}async startMessageLoop(){this.terminateMessageLoop=!1;try{await this.receiveDialogMessageOverride()}catch(e){await this.cancelRecognition(this.privRequestSession.sessionId,this.privRequestSession.requestId,a.CancellationReason.Error,a.CancellationErrorCode.RuntimeError,e)}return Promise.resolve()}async configConnection(e){return this.terminateMessageLoop?(this.terminateMessageLoop=!1,Promise.reject(`Connection to service terminated.`)):(await this.sendSpeechServiceConfig(e,this.privRequestSession,this.privRecognizerConfig.SpeechServiceConfig.serialize()),await this.sendAgentConfig(e),e)}async sendPreAudioMessages(){let e=await this.fetchConnection();this.addKeywordContextData(),await this.sendSpeechContext(e,!0),await this.sendAgentContext(e),await this.sendWaveHeader(e)}sendAgentConfig(e){if(this.agentConfig&&!this.agentConfigSent){if(this.privRecognizerConfig.parameters.getProperty(a.PropertyId.Conversation_DialogType)===a.DialogServiceConfig.DialogTypes.CustomCommands){let e=this.agentConfig.get();e.botInfo.commandsCulture=this.privRecognizerConfig.parameters.getProperty(a.PropertyId.SpeechServiceConnection_RecoLanguage,`en-us`),this.agentConfig.set(e)}this.onEvent(new n.SendingAgentContextMessageEvent(this.agentConfig));let t=this.agentConfig.toJsonString();return this.agentConfigSent=!0,e.send(new d.SpeechConnectionMessage(r.MessageType.Text,`agent.config`,this.privRequestSession.requestId,`application/json`,t))}}sendAgentContext(e){let t=(0,r.createGuid)(),n=this.privDialogServiceConnector.properties.getProperty(a.PropertyId.Conversation_Speech_Activity_Template),i={channelData:``,context:{interactionId:t},messagePayload:n,version:.5},o=JSON.stringify(i);return e.send(new d.SpeechConnectionMessage(r.MessageType.Text,`speech.agent.context`,this.privRequestSession.requestId,`application/json`,o))}fireEventForResult(e,t){let n=s.EnumTranslation.implTranslateRecognitionResult(e.RecognitionStatus),r=new a.SpeechRecognitionResult(this.privRequestSession.requestId,n,e.DisplayText,e.Duration,e.Offset,e.Language,e.LanguageDetectionConfidence,void 0,void 0,e.asJson(),t);return new a.SpeechRecognitionEventArgs(r,e.Offset,this.privRequestSession.sessionId)}handleResponseMessage(e){let t=JSON.parse(e.textBody);switch(t.messageType.toLowerCase()){case`message`:let n=e.requestId.toUpperCase(),o=c.ActivityPayloadResponse.fromJSON(e.textBody),s=this.privTurnStateManager.GetTurn(n);if(o.conversationId){let e=this.agentConfig.get();e.botInfo.conversationId=o.conversationId,this.agentConfig.set(e)}let l=s.processActivityPayload(o,i.AudioOutputFormatImpl.fromSpeechSynthesisOutputFormatString(this.privDialogServiceConnector.properties.getProperty(a.PropertyId.SpeechServiceConnection_SynthOutputFormat,void 0))),u=new a.ActivityReceivedEventArgs(o.messagePayload,l);if(this.privDialogServiceConnector.activityReceived)try{this.privDialogServiceConnector.activityReceived(this.privDialogServiceConnector,u)}catch{}break;case`messagestatus`:if(this.privDialogServiceConnector.turnStatusReceived)try{this.privDialogServiceConnector.turnStatusReceived(this.privDialogServiceConnector,new a.TurnStatusReceivedEventArgs(e.textBody))}catch{}break;default:r.Events.instance.onEvent(new r.BackgroundEvent(`Unexpected response of type ${t.messageType}. Ignoring.`));break}}onEvent(e){this.privEvents.onEvent(e),r.Events.instance.onEvent(e)}addKeywordContextData(){let e=this.privRecognizerConfig.parameters.getProperty(`SPEECH-KeywordsToDetect`);if(e===void 0)return;let t=this.privRecognizerConfig.parameters.getProperty(`SPEECH-KeywordsToDetect-Offsets`),n=this.privRecognizerConfig.parameters.getProperty(`SPEECH-KeywordsToDetect-Durations`),r=e.split(`;`),i=t===void 0?[]:t.split(`;`),a=n===void 0?[]:n.split(`;`),o=[];for(let e=0;e<r.length;e++){let t={text:r[e]};e<i.length&&(t.startOffset=Number(i[e])),e<a.length&&(t.duration=Number(a[e])),o.push(t)}this.speechContext.getContext().invocationSource=l.InvocationSource.VoiceActivationWithKeyword,this.speechContext.getContext().keywordDetection=[{clientDetectedKeywords:o,onReject:{action:u.OnRejectAction.EndOfTurn},type:u.KeywordDetectionType.StartTrigger}]}}})),Dr=e((e=>{Object.defineProperty(e,`__esModule`,{value:!0}),e.AgentConfig=void 0,e.AgentConfig=class{toJsonString(){return JSON.stringify(this.iPrivConfig)}get(){return this.iPrivConfig}set(e){this.iPrivConfig=e}}})),Q=e((e=>{Object.defineProperty(e,`__esModule`,{value:!0}),e.ConversationConnectionConfig=void 0;var t=Fn(),n=class e extends t.RestConfigBase{static get host(){return e.privHost}static get apiVersion(){return e.privApiVersion}static get clientAppId(){return e.privClientAppId}static get defaultLanguageCode(){return e.privDefaultLanguageCode}static get restPath(){return e.privRestPath}static get webSocketPath(){return e.privWebSocketPath}static get transcriptionEventKeys(){return e.privTranscriptionEventKeys}};e.ConversationConnectionConfig=n,n.privHost=`dev.microsofttranslator.com`,n.privRestPath=`/capito/room`,n.privApiVersion=`2.0`,n.privDefaultLanguageCode=`en-US`,n.privClientAppId=`FC539C22-1767-4F1F-84BC-B4D811114F15`,n.privWebSocketPath=`/capito/translate`,n.privTranscriptionEventKeys=[`iCalUid`,`callId`,`organizer`,`FLAC`,`MTUri`,`DifferentiateGuestSpeakers`,`audiorecording`,`Threadid`,`OrganizerMri`,`OrganizerTenantId`,`UserToken`]})),Or=e((e=>{Object.defineProperty(e,`__esModule`,{value:!0}),e.ConversationManager=void 0;var t=X(),n=I(),r=Y(),i=Q();e.ConversationManager=class{constructor(){this.privRequestParams=i.ConversationConnectionConfig.configParams,this.privErrors=i.ConversationConnectionConfig.restErrors,this.privHost=i.ConversationConnectionConfig.host,this.privApiVersion=i.ConversationConnectionConfig.apiVersion,this.privRestPath=i.ConversationConnectionConfig.restPath,this.privRestAdapter=new t.RestMessageAdapter({})}createOrJoin(e,a,o,s){try{n.Contracts.throwIfNullOrUndefined(e,`args`);let c=e.getProperty(r.PropertyId.SpeechServiceConnection_RecoLanguage,i.ConversationConnectionConfig.defaultLanguageCode),l=e.getProperty(r.PropertyId.ConversationTranslator_Name,`conversation_host`),u=e.getProperty(r.PropertyId.ConversationTranslator_Host,this.privHost),d=e.getProperty(r.PropertyId.ConversationTranslator_CorrelationId),f=e.getProperty(r.PropertyId.SpeechServiceConnection_Key),p=e.getProperty(r.PropertyId.SpeechServiceConnection_Region),m=e.getProperty(r.PropertyId.SpeechServiceAuthorization_Token);n.Contracts.throwIfNullOrWhitespace(c,`languageCode`),n.Contracts.throwIfNullOrWhitespace(l,`nickname`),n.Contracts.throwIfNullOrWhitespace(u,`endpointHost`);let h={};h[this.privRequestParams.apiVersion]=this.privApiVersion,h[this.privRequestParams.languageCode]=c,h[this.privRequestParams.nickname]=l;let g={};d&&(g[this.privRequestParams.correlationId]=d),g[this.privRequestParams.clientAppId]=i.ConversationConnectionConfig.clientAppId,a===void 0?(n.Contracts.throwIfNullOrUndefined(p,this.privErrors.authInvalidSubscriptionRegion),g[this.privRequestParams.subscriptionRegion]=p,f?g[this.privRequestParams.subscriptionKey]=f:m?g[this.privRequestParams.authorization]=`Bearer ${m}`:n.Contracts.throwIfNullOrUndefined(f,this.privErrors.authInvalidSubscriptionKey)):h[this.privRequestParams.roomId]=a;let _={};_.headers=g,this.privRestAdapter.options=_;let v=`https://${u}${this.privRestPath}`;this.privRestAdapter.request(t.RestRequestType.Post,v,h,null).then(e=>{let n=t.RestMessageAdapter.extractHeaderValue(this.privRequestParams.requestId,e.headers);if(!e.ok){if(s){let t=this.privErrors.invalidCreateJoinConversationResponse.replace(`{status}`,e.status.toString()),r;try{r=JSON.parse(e.data),t+=` [${r.error.code}: ${r.error.message}]`}catch{t+=` [${e.data}]`}n&&(t+=` ${n}`),s(t)}return}let r=JSON.parse(e.data);if(r&&(r.requestId=n),o){try{o(r)}catch(e){s&&s(e)}o=void 0}}).catch(()=>{})}catch(e){if(s)if(e instanceof Error){let t=e;s(t.name+`: `+t.message)}else s(e)}}leave(e,i){return new Promise((a,o)=>{try{n.Contracts.throwIfNullOrUndefined(e,this.privErrors.invalidArgs.replace(`{arg}`,`config`)),n.Contracts.throwIfNullOrWhitespace(i,this.privErrors.invalidArgs.replace(`{arg}`,`token`));let o=e.getProperty(r.PropertyId.ConversationTranslator_Host,this.privHost),s=e.getProperty(r.PropertyId.ConversationTranslator_CorrelationId),c={};c[this.privRequestParams.apiVersion]=this.privApiVersion,c[this.privRequestParams.sessionToken]=i;let l={};s&&(l[this.privRequestParams.correlationId]=s);let u={};u.headers=l,this.privRestAdapter.options=u;let d=`https://${o}${this.privRestPath}`;this.privRestAdapter.request(t.RestRequestType.Delete,d,c,null).then(e=>{e.ok,a()}).catch(()=>{})}catch(e){if(e instanceof Error){let t=e;o(t.name+`: `+t.message)}else o(e)}})}}})),kr=e((e=>{Object.defineProperty(e,`__esModule`,{value:!0}),e.ConversationConnectionMessage=void 0;var t=j();e.ConversationConnectionMessage=class extends t.ConnectionMessage{constructor(e,t,n,r){super(e,t,n,r);let i=JSON.parse(this.textBody);i.type!==void 0&&(this.privConversationMessageType=i.type)}get conversationMessageType(){return this.privConversationMessageType}}})),Ar=e((e=>{Object.defineProperty(e,`__esModule`,{value:!0}),e.ConversationWebsocketMessageFormatter=void 0;var t=j(),n=kr();e.ConversationWebsocketMessageFormatter=class{toConnectionMessage(e){let r=new t.Deferred;try{if(e.messageType===t.MessageType.Text){let t=new n.ConversationConnectionMessage(e.messageType,e.textContent,{},e.id);r.resolve(t)}else e.messageType===t.MessageType.Binary&&r.resolve(new n.ConversationConnectionMessage(e.messageType,e.binaryContent,void 0,e.id))}catch(e){r.reject(`Error formatting the message. Error: ${e}`)}return r.promise}fromConnectionMessage(e){let n=new t.Deferred;try{if(e.messageType===t.MessageType.Text){let r=`${e.textBody?e.textBody:``}`;n.resolve(new t.RawWebsocketMessage(t.MessageType.Text,r,e.id))}}catch(e){n.reject(`Error formatting the message. ${e}`)}return n.promise}}})),jr=e((e=>{Object.defineProperty(e,`__esModule`,{value:!0}),e.ConversationConnectionFactory=void 0;var t=X(),n=j(),r=I(),i=Y(),a=K(),o=Q(),s=Ar();e.ConversationConnectionFactory=class extends a.ConnectionFactoryBase{create(e,a,c){let l=e.parameters.getProperty(i.PropertyId.ConversationTranslator_Host,o.ConversationConnectionConfig.host),u=e.parameters.getProperty(i.PropertyId.ConversationTranslator_CorrelationId,(0,n.createGuid)()),d=`wss://${l}${o.ConversationConnectionConfig.webSocketPath}`,f=e.parameters.getProperty(i.PropertyId.ConversationTranslator_Token,void 0);r.Contracts.throwIfNullOrUndefined(f,`token`);let p={};p[o.ConversationConnectionConfig.configParams.apiVersion]=o.ConversationConnectionConfig.apiVersion,p[o.ConversationConnectionConfig.configParams.token]=f,p[o.ConversationConnectionConfig.configParams.correlationId]=u;let m=e.parameters.getProperty(`SPEECH-EnableWebsocketCompression`,`false`)===`true`;return Promise.resolve(new t.WebsocketConnection(d,p,{},new s.ConversationWebsocketMessageFormatter,t.ProxyInfo.fromRecognizerConfig(e),m,c))}}})),Mr=e((e=>{Object.defineProperty(e,`__esModule`,{value:!0}),e.ConversationRequestSession=void 0;var t=j();e.ConversationRequestSession=class{constructor(e){this.privIsDisposed=!1,this.privDetachables=[],this.privSessionId=e,this.privRequestId=(0,t.createNoDashGuid)(),this.privRequestCompletionDeferral=new t.Deferred}get sessionId(){return this.privSessionId}get requestId(){return this.privRequestId}get completionPromise(){return this.privRequestCompletionDeferral.promise}onPreConnectionStart(e,t){this.privSessionId=t}onAuthCompleted(e){e&&this.onComplete()}onConnectionEstablishCompleted(e){e!==200&&e===403&&this.onComplete()}onServiceTurnEndResponse(e){e?this.privRequestId=(0,t.createNoDashGuid)():this.onComplete()}async dispose(){if(!this.privIsDisposed){this.privIsDisposed=!0;for(let e of this.privDetachables)await e.detach()}}onComplete(){}}})),Nr=e((e=>{Object.defineProperty(e,`__esModule`,{value:!0}),e.ConversationReceivedTranslationEventArgs=e.ParticipantsListEventArgs=e.ParticipantAttributeEventArgs=e.ParticipantEventArgs=e.LockRoomEventArgs=e.MuteAllEventArgs=void 0;var t=Y();e.MuteAllEventArgs=class extends t.SessionEventArgs{constructor(e,t){super(t),this.privIsMuted=e}get isMuted(){return this.privIsMuted}},e.LockRoomEventArgs=class extends t.SessionEventArgs{constructor(e,t){super(t),this.privIsLocked=e}get isMuted(){return this.privIsLocked}},e.ParticipantEventArgs=class extends t.SessionEventArgs{constructor(e,t){super(t),this.privParticipant=e}get participant(){return this.privParticipant}},e.ParticipantAttributeEventArgs=class extends t.SessionEventArgs{constructor(e,t,n,r){super(r),this.privKey=t,this.privValue=n,this.privParticipantId=e}get value(){return this.privValue}get key(){return this.privKey}get id(){return this.privParticipantId}},e.ParticipantsListEventArgs=class extends t.SessionEventArgs{constructor(e,t,n,r,i,a,o,s,c){super(c),this.privRoomId=e,this.privSessionToken=t,this.privTranslateTo=n,this.privProfanityFilter=r,this.privRoomProfanityFilter=i,this.privIsRoomLocked=a,this.privIsRoomLocked=o,this.privParticipants=s}get sessionToken(){return this.privSessionToken}get conversationId(){return this.privRoomId}get translateTo(){return this.privTranslateTo}get profanityFilter(){return this.privProfanityFilter}get roomProfanityFilter(){return this.privRoomProfanityFilter}get isRoomLocked(){return this.privIsRoomLocked}get isMuteAll(){return this.privIsMuteAll}get participants(){return this.privParticipants}},e.ConversationReceivedTranslationEventArgs=class{constructor(e,t,n){this.privPayload=t,this.privCommand=e,this.privSessionId=n}get payload(){return this.privPayload}get command(){return this.privCommand}get sessionId(){return this.privSessionId}}})),Pr=e((e=>{Object.defineProperty(e,`__esModule`,{value:!0}),e.ConversationTranslatorCommandTypes=e.ConversationTranslatorMessageTypes=e.InternalParticipants=void 0,e.InternalParticipants=class{constructor(e=[],t){this.participants=e,this.meId=t}addOrUpdateParticipant(e){if(e===void 0)return;let t=this.getParticipantIndex(e.id);return t>-1?this.participants.splice(t,1,e):this.participants.push(e),this.getParticipant(e.id)}getParticipantIndex(e){return this.participants.findIndex(t=>t.id===e)}getParticipant(e){return this.participants.find(t=>t.id===e)}deleteParticipant(e){this.participants=this.participants.filter(t=>t.id!==e)}get host(){return this.participants.find(e=>e.isHost===!0)}get me(){return this.getParticipant(this.meId)}},e.ConversationTranslatorMessageTypes={command:`command`,final:`final`,info:`info`,instantMessage:`instant_message`,keepAlive:`keep_alive`,partial:`partial`,participantCommand:`participant_command`,translatedMessage:`translated_message`},e.ConversationTranslatorCommandTypes={changeNickname:`ChangeNickname`,disconnectSession:`DisconnectSession`,ejectParticipant:`EjectParticipant`,instant_message:`instant_message`,joinSession:`JoinSession`,leaveSession:`LeaveSession`,participantList:`ParticipantList`,roomExpirationWarning:`RoomExpirationWarning`,setLockState:`SetLockState`,setMute:`SetMute`,setMuteAll:`SetMuteAll`,setProfanityFiltering:`SetProfanityFiltering`,setTranslateToLanguages:`SetTranslateToLanguages`,setUseTTS:`SetUseTTS`}})),Fr=e((e=>{Object.defineProperty(e,`__esModule`,{value:!0}),e.CommandResponsePayload=void 0;var t=e=>JSON.parse(e);e.CommandResponsePayload=class e{constructor(e){this.privCommandResponse=t(e)}get type(){return this.privCommandResponse.type}get command(){return this.privCommandResponse.command}get id(){return this.privCommandResponse.id}get nickname(){return this.privCommandResponse.nickname}get participantId(){return this.privCommandResponse.participantId}get roomid(){return this.privCommandResponse.roomid}get value(){return this.privCommandResponse.value}get token(){return this.privCommandResponse.token}static fromJSON(t){return new e(t)}}})),Ir=e((e=>{Object.defineProperty(e,`__esModule`,{value:!0}),e.ParticipantPayloadResponse=e.ParticipantsListPayloadResponse=void 0;var t=e=>JSON.parse(e),n=e=>JSON.parse(e);e.ParticipantsListPayloadResponse=class e{constructor(e){this.privParticipantsPayloadResponse=t(e)}get roomid(){return this.privParticipantsPayloadResponse.roomid}get id(){return this.privParticipantsPayloadResponse.id}get command(){return this.privParticipantsPayloadResponse.command}get participants(){return this.privParticipantsPayloadResponse.participants}get token(){return this.privParticipantsPayloadResponse.token}get translateTo(){return this.privParticipantsPayloadResponse.translateTo}get profanityFilter(){return this.privParticipantsPayloadResponse.profanityFilter}get roomProfanityFilter(){return this.privParticipantsPayloadResponse.roomProfanityFilter}get roomLocked(){return this.privParticipantsPayloadResponse.roomLocked}get muteAll(){return this.privParticipantsPayloadResponse.muteAll}get type(){return this.privParticipantsPayloadResponse.type}static fromJSON(t){return new e(t)}},e.ParticipantPayloadResponse=class e{constructor(e){this.privParticipantPayloadResponse=n(e)}get nickname(){return this.privParticipantPayloadResponse.nickname}get locale(){return this.privParticipantPayloadResponse.locale}get usetts(){return this.privParticipantPayloadResponse.usetts}get ismuted(){return this.privParticipantPayloadResponse.ismuted}get ishost(){return this.privParticipantPayloadResponse.ishost}get participantId(){return this.privParticipantPayloadResponse.participantId}get avatar(){return this.privParticipantPayloadResponse.avatar}static fromJSON(t){return new e(t)}}})),Lr=e((e=>{Object.defineProperty(e,`__esModule`,{value:!0}),e.TextResponsePayload=e.SpeechResponsePayload=void 0;var t=e=>JSON.parse(e),n=e=>JSON.parse(e);e.SpeechResponsePayload=class e{constructor(e){this.privSpeechResponse=t(e)}get recognition(){return this.privSpeechResponse.recognition}get translations(){return this.privSpeechResponse.translations}get id(){return this.privSpeechResponse.id}get language(){return this.privSpeechResponse.language}get nickname(){return this.privSpeechResponse.nickname}get participantId(){return this.privSpeechResponse.participantId}get roomid(){return this.privSpeechResponse.roomid}get timestamp(){return this.privSpeechResponse.timestamp}get type(){return this.privSpeechResponse.type}get isFinal(){return this.privSpeechResponse.type===`final`}static fromJSON(t){return new e(t)}},e.TextResponsePayload=class e{constructor(e){this.privTextResponse=n(e)}get originalText(){return this.privTextResponse.originalText}get translations(){return this.privTextResponse.translations}get id(){return this.privTextResponse.id}get language(){return this.privTextResponse.language}get nickname(){return this.privTextResponse.nickname}get participantId(){return this.privTextResponse.participantId}get roomid(){return this.privTextResponse.roomid}get timestamp(){return this.privTextResponse.timestamp}get type(){return this.privTextResponse.type}static fromJSON(t){return new e(t)}}})),Rr=e((e=>{Object.defineProperty(e,`__esModule`,{value:!0}),e.TextResponsePayload=e.SpeechResponsePayload=e.ParticipantPayloadResponse=e.ParticipantsListPayloadResponse=e.CommandResponsePayload=void 0;var t=Fr();Object.defineProperty(e,`CommandResponsePayload`,{enumerable:!0,get:function(){return t.CommandResponsePayload}});var n=Ir();Object.defineProperty(e,`ParticipantsListPayloadResponse`,{enumerable:!0,get:function(){return n.ParticipantsListPayloadResponse}}),Object.defineProperty(e,`ParticipantPayloadResponse`,{enumerable:!0,get:function(){return n.ParticipantPayloadResponse}});var r=Lr();Object.defineProperty(e,`SpeechResponsePayload`,{enumerable:!0,get:function(){return r.SpeechResponsePayload}}),Object.defineProperty(e,`TextResponsePayload`,{enumerable:!0,get:function(){return r.TextResponsePayload}})})),zr=e((e=>{Object.defineProperty(e,`__esModule`,{value:!0}),e.ConversationServiceAdapter=void 0;var t=j(),n=Y(),r=$(),i=kr(),a=Mr(),o=Nr(),s=Pr(),c=Rr();e.ConversationServiceAdapter=class extends r.ServiceRecognizerBase{constructor(e,n,r,i,o){super(e,n,r,i,o),this.privConnectionConfigPromise=void 0,this.privLastPartialUtteranceId=``,this.privConversationServiceConnector=o,this.privConversationAuthentication=e,this.receiveMessageOverride=()=>this.receiveConversationMessageOverride(),this.recognizeOverride=()=>this.noOp(),this.postConnectImplOverride=e=>this.conversationConnectImpl(e),this.configConnectionOverride=()=>this.configConnection(),this.disconnectOverride=()=>this.privDisconnect(),this.privConversationRequestSession=new a.ConversationRequestSession((0,t.createNoDashGuid)()),this.privConversationConnectionFactory=n,this.privConversationIsDisposed=!1}isDisposed(){return super.isDisposed()||this.privConversationIsDisposed}async dispose(e){this.privConversationIsDisposed=!0,this.privConnectionConfigPromise!==void 0&&await(await this.privConnectionConfigPromise).dispose(e),await super.dispose(e)}async sendMessage(e){return(await this.fetchConnection()).send(new i.ConversationConnectionMessage(t.MessageType.Text,e))}async sendMessageAsync(e){await(await this.fetchConnection()).send(new i.ConversationConnectionMessage(t.MessageType.Text,e))}privDisconnect(){if(!this.terminateMessageLoop)return this.cancelRecognition(this.privConversationRequestSession.sessionId,this.privConversationRequestSession.requestId,n.CancellationReason.Error,n.CancellationErrorCode.NoError,`Disconnecting`),this.terminateMessageLoop=!0,Promise.resolve()}async processTypeSpecificMessages(){return!0}cancelRecognition(e,t,r,i,a){this.terminateMessageLoop=!0;let o=new n.ConversationTranslationCanceledEventArgs(r,a,i,void 0,e);try{this.privConversationServiceConnector.canceled&&this.privConversationServiceConnector.canceled(this.privConversationServiceConnector,o)}catch{}}async conversationConnectImpl(e){return this.privConnectionLoop=this.startMessageLoop(),e}async receiveConversationMessageOverride(){if(this.isDisposed()||this.terminateMessageLoop)return Promise.resolve();let e=new t.Deferred;try{let t=await(await this.fetchConnection()).read();if(this.isDisposed()||this.terminateMessageLoop)return e.resolve(),Promise.resolve();if(!t)return this.receiveConversationMessageOverride();let i=this.privConversationRequestSession.sessionId,a=t.conversationMessageType.toLowerCase(),l=!1;try{switch(a){case`info`:case`participant_command`:case`command`:let e=c.CommandResponsePayload.fromJSON(t.textBody);switch(e.command.toLowerCase()){case`participantlist`:let a=c.ParticipantsListPayloadResponse.fromJSON(t.textBody),l=a.participants.map(e=>({avatar:e.avatar,displayName:e.nickname,id:e.participantId,isHost:e.ishost,isMuted:e.ismuted,isUsingTts:e.usetts,preferredLanguage:e.locale}));this.privConversationServiceConnector.participantsListReceived&&this.privConversationServiceConnector.participantsListReceived(this.privConversationServiceConnector,new o.ParticipantsListEventArgs(a.roomid,a.token,a.translateTo,a.profanityFilter,a.roomProfanityFilter,a.roomLocked,a.muteAll,l,i));break;case`settranslatetolanguages`:this.privConversationServiceConnector.participantUpdateCommandReceived&&this.privConversationServiceConnector.participantUpdateCommandReceived(this.privConversationServiceConnector,new o.ParticipantAttributeEventArgs(e.participantId,s.ConversationTranslatorCommandTypes.setTranslateToLanguages,e.value,i));break;case`setprofanityfiltering`:this.privConversationServiceConnector.participantUpdateCommandReceived&&this.privConversationServiceConnector.participantUpdateCommandReceived(this.privConversationServiceConnector,new o.ParticipantAttributeEventArgs(e.participantId,s.ConversationTranslatorCommandTypes.setProfanityFiltering,e.value,i));break;case`setmute`:this.privConversationServiceConnector.participantUpdateCommandReceived&&this.privConversationServiceConnector.participantUpdateCommandReceived(this.privConversationServiceConnector,new o.ParticipantAttributeEventArgs(e.participantId,s.ConversationTranslatorCommandTypes.setMute,e.value,i));break;case`setmuteall`:this.privConversationServiceConnector.muteAllCommandReceived&&this.privConversationServiceConnector.muteAllCommandReceived(this.privConversationServiceConnector,new o.MuteAllEventArgs(e.value,i));break;case`roomexpirationwarning`:this.privConversationServiceConnector.conversationExpiration&&this.privConversationServiceConnector.conversationExpiration(this.privConversationServiceConnector,new n.ConversationExpirationEventArgs(e.value,this.privConversationRequestSession.sessionId));break;case`setusetts`:this.privConversationServiceConnector.participantUpdateCommandReceived&&this.privConversationServiceConnector.participantUpdateCommandReceived(this.privConversationServiceConnector,new o.ParticipantAttributeEventArgs(e.participantId,s.ConversationTranslatorCommandTypes.setUseTTS,e.value,i));break;case`setlockstate`:this.privConversationServiceConnector.lockRoomCommandReceived&&this.privConversationServiceConnector.lockRoomCommandReceived(this.privConversationServiceConnector,new o.LockRoomEventArgs(e.value,i));break;case`changenickname`:this.privConversationServiceConnector.participantUpdateCommandReceived&&this.privConversationServiceConnector.participantUpdateCommandReceived(this.privConversationServiceConnector,new o.ParticipantAttributeEventArgs(e.participantId,s.ConversationTranslatorCommandTypes.changeNickname,e.value,i));break;case`joinsession`:let u=c.ParticipantPayloadResponse.fromJSON(t.textBody),d={avatar:u.avatar,displayName:u.nickname,id:u.participantId,isHost:u.ishost,isMuted:u.ismuted,isUsingTts:u.usetts,preferredLanguage:u.locale};this.privConversationServiceConnector.participantJoinCommandReceived&&this.privConversationServiceConnector.participantJoinCommandReceived(this.privConversationServiceConnector,new o.ParticipantEventArgs(d,i));break;case`leavesession`:let f={id:e.participantId};this.privConversationServiceConnector.participantLeaveCommandReceived&&this.privConversationServiceConnector.participantLeaveCommandReceived(this.privConversationServiceConnector,new o.ParticipantEventArgs(f,i));break;case`disconnectsession`:e.participantId;break;case`token`:let p=new r.CognitiveTokenAuthentication(()=>{let t=e.token;return Promise.resolve(t)},()=>{let t=e.token;return Promise.resolve(t)});this.authentication=p,this.privConversationServiceConnector.onToken(p);break;default:break}break;case`partial`:case`final`:let u=c.SpeechResponsePayload.fromJSON(t.textBody),d=a===`final`?n.ResultReason.TranslatedParticipantSpeech:n.ResultReason.TranslatingParticipantSpeech,f=new n.ConversationTranslationResult(u.participantId,this.getTranslations(u.translations),u.language,u.id,d,u.recognition,void 0,void 0,t.textBody,void 0);u.isFinal?((f.text!==void 0&&f.text.length>0||u.id===this.privLastPartialUtteranceId)&&(l=!0),l&&this.privConversationServiceConnector.translationReceived&&this.privConversationServiceConnector.translationReceived(this.privConversationServiceConnector,new o.ConversationReceivedTranslationEventArgs(s.ConversationTranslatorMessageTypes.final,f,i))):f.text!==void 0&&(this.privLastPartialUtteranceId=u.id,this.privConversationServiceConnector.translationReceived&&this.privConversationServiceConnector.translationReceived(this.privConversationServiceConnector,new o.ConversationReceivedTranslationEventArgs(s.ConversationTranslatorMessageTypes.partial,f,i)));break;case`translated_message`:let p=c.TextResponsePayload.fromJSON(t.textBody),m=new n.ConversationTranslationResult(p.participantId,this.getTranslations(p.translations),p.language,void 0,void 0,p.originalText,void 0,void 0,void 0,t.textBody,void 0);this.privConversationServiceConnector.translationReceived&&this.privConversationServiceConnector.translationReceived(this.privConversationServiceConnector,new o.ConversationReceivedTranslationEventArgs(s.ConversationTranslatorMessageTypes.instantMessage,m,i));break;default:break}}catch{}return this.receiveConversationMessageOverride()}catch{this.terminateMessageLoop=!0}return e.promise}async startMessageLoop(){if(this.isDisposed())return Promise.resolve();this.terminateMessageLoop=!1;let e=this.receiveConversationMessageOverride();try{return await e}catch(e){return this.cancelRecognition(this.privRequestSession?this.privRequestSession.sessionId:``,this.privRequestSession?this.privRequestSession.requestId:``,n.CancellationReason.Error,n.CancellationErrorCode.RuntimeError,e),null}}configConnection(){return this.isDisposed()?Promise.resolve(void 0):this.privConnectionConfigPromise===void 0?this.terminateMessageLoop?Promise.resolve(void 0):(this.privConnectionConfigPromise=this.connectImpl().then(e=>e),this.privConnectionConfigPromise):this.privConnectionConfigPromise.then(e=>e.state()===t.ConnectionState.Disconnected?(this.privConnectionId=null,this.privConnectionConfigPromise=void 0,this.configConnection()):this.privConnectionConfigPromise,()=>(this.privConnectionId=null,this.privConnectionConfigPromise=void 0,this.configConnection()))}getTranslations(e){let t;if(e!==void 0){t=new n.Translations;for(let n of e)t.set(n.lang,n.translation)}return t}}})),Br=e((e=>{Object.defineProperty(e,`__esModule`,{value:!0}),e.ConversationTranslatorRecognizer=e.ConversationRecognizerFactory=void 0;var t=$(),n=j(),r=I(),i=Y(),a=jr(),o=zr();e.ConversationRecognizerFactory=class{static fromConfig(e,t,n){return new s(e,t,n)}};var s=class extends i.Recognizer{constructor(e,t,o){let s=t;r.Contracts.throwIfNull(s,`speechConfig`);let c=e;r.Contracts.throwIfNull(c,`conversationImpl`),super(o,s.properties,new a.ConversationConnectionFactory),this.privConversation=c,this.privIsDisposed=!1,this.privProperties=s.properties.clone(),this.privConnection=i.Connection.fromRecognizer(this),this.privProperties.getProperty(i.PropertyId.WebWorkerLoadType,`on`).toLowerCase()===`on`&&typeof Blob<`u`&&typeof Worker<`u`?(this.privSetTimeout=n.Timeout.setTimeout,this.privClearTimeout=n.Timeout.clearTimeout):typeof window<`u`?(this.privSetTimeout=window.setTimeout.bind(window),this.privClearTimeout=window.clearTimeout.bind(window)):(this.privSetTimeout=setTimeout,this.privClearTimeout=clearTimeout)}set connected(e){this.privConnection.connected=e}set disconnected(e){this.privConnection.disconnected=e}get speechRecognitionLanguage(){return this.privSpeechRecognitionLanguage}get properties(){return this.privProperties}isDisposed(){return this.privIsDisposed}connect(e,t,n){try{r.Contracts.throwIfDisposed(this.privIsDisposed),r.Contracts.throwIfNullOrWhitespace(e,`token`),this.privReco.conversationTranslatorToken=e,this.resetConversationTimeout(),this.privReco.connectAsync(t,n)}catch(e){if(n)if(e instanceof Error){let t=e;n(t.name+`: `+t.message)}else n(e)}}disconnect(e,t){try{r.Contracts.throwIfDisposed(this.privIsDisposed),this.privTimeoutToken!==void 0&&this.privClearTimeout(this.privTimeoutToken),this.privReco.disconnect().then(()=>{e&&e()},e=>{t&&t(e)})}catch(e){if(t)if(e instanceof Error){let n=e;t(n.name+`: `+n.message)}else t(e);this.dispose(!0).catch(e=>{n.Events.instance.onEvent(new n.BackgroundEvent(e))})}}sendRequest(e,t,i){try{r.Contracts.throwIfDisposed(this.privIsDisposed),this.sendMessage(e,t,i)}catch(e){if(i)if(e instanceof Error){let t=e;i(t.name+`: `+t.message)}else i(e);this.dispose(!0).catch(e=>{n.Events.instance.onEvent(new n.BackgroundEvent(e))})}}onToken(e){this.privConversation.onToken(e)}async close(){this.privIsDisposed||(this.privConnection&&(this.privConnection.closeConnection(),this.privConnection.close()),this.privConnection=void 0,await this.dispose(!0))}async dispose(e){this.privIsDisposed||e&&(this.privTimeoutToken!==void 0&&this.privClearTimeout(this.privTimeoutToken),this.privIsDisposed=!0,this.privConnection&&=(this.privConnection.closeConnection(),this.privConnection.close(),void 0),await super.dispose(e))}createRecognizerConfig(e){return new t.RecognizerConfig(e,this.privProperties)}createServiceRecognizer(e,t,n,r){let i=n;return new o.ConversationServiceAdapter(e,t,i,r,this)}sendMessage(e,t,n){((e,t,n)=>{e===void 0?n&&n(`Null promise`):e.then(()=>{try{t&&t()}catch(e){n&&n(`'Unhandled error on promise callback: ${e}'`)}},e=>{try{n&&n(e)}catch{}})})(this.privReco.sendMessageAsync(e),t,n),this.resetConversationTimeout()}resetConversationTimeout(){this.privTimeoutToken!==void 0&&this.privClearTimeout(this.privTimeoutToken),this.privTimeoutToken=this.privSetTimeout(()=>{this.sendRequest(this.privConversation.getKeepAlive())},6e4)}};e.ConversationTranslatorRecognizer=s})),Vr=e((e=>{Object.defineProperty(e,`__esModule`,{value:!0}),e.TranscriberRecognizer=void 0;var t=j(),n=I(),r=Y(),i=$(),a=U();e.TranscriberRecognizer=class extends r.Recognizer{constructor(e,t){let a=e;n.Contracts.throwIfNull(a,`speechTranslationConfig`);let o=t;n.Contracts.throwIfNull(o,`audioConfigImpl`),n.Contracts.throwIfNullOrWhitespace(a.speechRecognitionLanguage,r.PropertyId[r.PropertyId.SpeechServiceConnection_RecoLanguage]),super(t,a.properties,new i.TranscriberConnectionFactory),this.privDisposedRecognizer=!1,this.isMeetingRecognizer=!1}get speechRecognitionLanguage(){return n.Contracts.throwIfDisposed(this.privDisposedRecognizer),this.properties.getProperty(r.PropertyId.SpeechServiceConnection_RecoLanguage)}get properties(){return this.privProperties}get authorizationToken(){return this.properties.getProperty(r.PropertyId.SpeechServiceAuthorization_Token)}set authorizationToken(e){n.Contracts.throwIfNullOrWhitespace(e,`token`),this.properties.setProperty(r.PropertyId.SpeechServiceAuthorization_Token,e)}set conversation(e){n.Contracts.throwIfNullOrUndefined(e,`Conversation`),this.isMeetingRecognizer=!1,this.privConversation=e}getConversationInfo(){return n.Contracts.throwIfNullOrUndefined(this.privConversation,`Conversation`),this.privConversation.conversationInfo}set meeting(e){n.Contracts.throwIfNullOrUndefined(e,`Meeting`),this.isMeetingRecognizer=!0,this.privMeeting=e}getMeetingInfo(){return n.Contracts.throwIfNullOrUndefined(this.privMeeting,`Meeting`),this.privMeeting.meetingInfo}IsMeetingRecognizer(){return this.isMeetingRecognizer}startContinuousRecognitionAsync(e,n){(0,t.marshalPromiseToCallbacks)(this.startContinuousRecognitionAsyncImpl(a.RecognitionMode.Conversation),e,n)}stopContinuousRecognitionAsync(e,n){(0,t.marshalPromiseToCallbacks)(this.stopContinuousRecognitionAsyncImpl(),e,n)}async close(){this.privDisposedRecognizer||await this.dispose(!0)}async pushConversationEvent(e,t){let r=this.privReco;n.Contracts.throwIfNullOrUndefined(r,`serviceRecognizer`),await r.sendSpeechEventAsync(e,t)}async pushMeetingEvent(e,t){let r=this.privReco;n.Contracts.throwIfNullOrUndefined(r,`serviceRecognizer`),await r.sendMeetingSpeechEventAsync(e,t)}async enforceAudioGating(){let e=(await this.audioConfig.format).channels;if(e===1){if(this.properties.getProperty(`f0f5debc-f8c9-4892-ac4b-90a7ab359fd2`,`false`).toLowerCase()!==`true`)throw Error(`Single channel audio configuration for MeetingTranscriber is currently under private preview, please contact diarizationrequest@microsoft.com for more details`)}else if(e!==8)throw Error(`Unsupported audio configuration: Detected ${e}-channel audio`)}connectMeetingCallbacks(e){this.isMeetingRecognizer=!0,this.canceled=(t,n)=>{e.canceled&&e.canceled(e,n)},this.recognizing=(t,n)=>{e.transcribing&&e.transcribing(e,n)},this.recognized=(t,n)=>{e.transcribed&&e.transcribed(e,n)},this.sessionStarted=(t,n)=>{e.sessionStarted&&e.sessionStarted(e,n)},this.sessionStopped=(t,n)=>{e.sessionStopped&&e.sessionStopped(e,n)}}disconnectCallbacks(){this.canceled=void 0,this.recognizing=void 0,this.recognized=void 0,this.sessionStarted=void 0,this.sessionStopped=void 0}async dispose(e){this.privDisposedRecognizer||(e&&(this.privDisposedRecognizer=!0,await this.implRecognizerStop()),await super.dispose(e))}createRecognizerConfig(e){return new i.RecognizerConfig(e,this.properties)}createServiceRecognizer(e,t,n,r){let a=n;return new i.TranscriptionServiceRecognizer(e,t,a,r,this)}}})),Hr=e((e=>{Object.defineProperty(e,`__esModule`,{value:!0}),e.InternalParticipants=e.ConversationTranslatorMessageTypes=e.ConversationTranslatorCommandTypes=e.ParticipantsListEventArgs=e.ParticipantEventArgs=e.ParticipantAttributeEventArgs=e.MuteAllEventArgs=e.LockRoomEventArgs=e.ConversationReceivedTranslationEventArgs=e.TranscriberRecognizer=e.ConversationRecognizerFactory=e.ConversationConnectionConfig=e.ConversationManager=void 0;var t=Or();Object.defineProperty(e,`ConversationManager`,{enumerable:!0,get:function(){return t.ConversationManager}});var n=Q();Object.defineProperty(e,`ConversationConnectionConfig`,{enumerable:!0,get:function(){return n.ConversationConnectionConfig}});var r=Br();Object.defineProperty(e,`ConversationRecognizerFactory`,{enumerable:!0,get:function(){return r.ConversationRecognizerFactory}});var i=Vr();Object.defineProperty(e,`TranscriberRecognizer`,{enumerable:!0,get:function(){return i.TranscriberRecognizer}});var a=Nr();Object.defineProperty(e,`ConversationReceivedTranslationEventArgs`,{enumerable:!0,get:function(){return a.ConversationReceivedTranslationEventArgs}}),Object.defineProperty(e,`LockRoomEventArgs`,{enumerable:!0,get:function(){return a.LockRoomEventArgs}}),Object.defineProperty(e,`MuteAllEventArgs`,{enumerable:!0,get:function(){return a.MuteAllEventArgs}}),Object.defineProperty(e,`ParticipantAttributeEventArgs`,{enumerable:!0,get:function(){return a.ParticipantAttributeEventArgs}}),Object.defineProperty(e,`ParticipantEventArgs`,{enumerable:!0,get:function(){return a.ParticipantEventArgs}}),Object.defineProperty(e,`ParticipantsListEventArgs`,{enumerable:!0,get:function(){return a.ParticipantsListEventArgs}});var o=Pr();Object.defineProperty(e,`ConversationTranslatorCommandTypes`,{enumerable:!0,get:function(){return o.ConversationTranslatorCommandTypes}}),Object.defineProperty(e,`ConversationTranslatorMessageTypes`,{enumerable:!0,get:function(){return o.ConversationTranslatorMessageTypes}}),Object.defineProperty(e,`InternalParticipants`,{enumerable:!0,get:function(){return o.InternalParticipants}})})),Ur=e((e=>{Object.defineProperty(e,`__esModule`,{value:!0}),e.SynthesisAudioMetadata=e.MetadataType=void 0,(function(e){e.WordBoundary=`WordBoundary`,e.Bookmark=`Bookmark`,e.Viseme=`Viseme`,e.SentenceBoundary=`SentenceBoundary`,e.SessionEnd=`SessionEnd`,e.AvatarSignal=`TalkingAvatarSignal`})(e.MetadataType||={}),e.SynthesisAudioMetadata=class e{constructor(e){this.privSynthesisAudioMetadata=JSON.parse(e)}static fromJSON(t){return new e(t)}get Metadata(){return this.privSynthesisAudioMetadata.Metadata}}})),Wr=e((e=>{Object.defineProperty(e,`__esModule`,{value:!0}),e.SynthesisStartedEvent=e.ConnectingToSynthesisServiceEvent=e.SynthesisTriggeredEvent=e.SpeechSynthesisEvent=void 0;var t=j(),n=class extends t.PlatformEvent{constructor(e,n,r=t.EventType.Info){super(e,r),this.privRequestId=n}get requestId(){return this.privRequestId}};e.SpeechSynthesisEvent=n,e.SynthesisTriggeredEvent=class extends n{constructor(e,t,n){super(`SynthesisTriggeredEvent`,e),this.privSessionAudioDestinationId=t,this.privTurnAudioDestinationId=n}get audioSessionDestinationId(){return this.privSessionAudioDestinationId}get audioTurnDestinationId(){return this.privTurnAudioDestinationId}},e.ConnectingToSynthesisServiceEvent=class extends n{constructor(e,t){super(`ConnectingToSynthesisServiceEvent`,e),this.privAuthFetchEventId=t}get authFetchEventId(){return this.privAuthFetchEventId}},e.SynthesisStartedEvent=class extends n{constructor(e,t){super(`SynthesisStartedEvent`,e),this.privAuthFetchEventId=t}get authFetchEventId(){return this.privAuthFetchEventId}}})),Gr=e((e=>{Object.defineProperty(e,`__esModule`,{value:!0}),e.SynthesisTurn=void 0;var t=j(),n=V(),r=Y(),i=Ur(),a=Wr();e.SynthesisTurn=class e{constructor(){this.privIsDisposed=!1,this.privIsSynthesizing=!1,this.privIsSynthesisEnded=!1,this.privBytesReceived=0,this.privInTurn=!1,this.privTextOffset=0,this.privNextSearchTextIndex=0,this.privSentenceOffset=0,this.privNextSearchSentenceIndex=0,this.privRequestId=(0,t.createNoDashGuid)(),this.privTurnDeferral=new t.Deferred,this.privTurnDeferral.resolve()}get requestId(){return this.privRequestId}get streamId(){return this.privStreamId}set streamId(e){this.privStreamId=e}get audioOutputFormat(){return this.privAudioOutputFormat}set audioOutputFormat(e){this.privAudioOutputFormat=e}get turnCompletionPromise(){return this.privTurnDeferral.promise}get isSynthesisEnded(){return this.privIsSynthesisEnded}get isSynthesizing(){return this.privIsSynthesizing}get currentTextOffset(){return this.privTextOffset}get currentSentenceOffset(){return this.privSentenceOffset}get bytesReceived(){return this.privBytesReceived}get audioDuration(){return this.privAudioDuration}get extraProperties(){if(this.privWebRTCSDP){let e=new r.PropertyCollection;return e.setProperty(r.PropertyId.TalkingAvatarService_WebRTC_SDP,this.privWebRTCSDP),e}}async getAllReceivedAudio(){return this.privReceivedAudio?Promise.resolve(this.privReceivedAudio):this.privIsSynthesisEnded?(await this.readAllAudioFromStream(),Promise.resolve(this.privReceivedAudio)):null}async getAllReceivedAudioWithHeader(){if(this.privReceivedAudioWithHeader)return this.privReceivedAudioWithHeader;if(!this.privIsSynthesisEnded)return null;if(this.audioOutputFormat.hasHeader){let e=await this.getAllReceivedAudio();return this.privReceivedAudioWithHeader=this.audioOutputFormat.addHeader(e),this.privReceivedAudioWithHeader}else return this.getAllReceivedAudio()}startNewSynthesis(e,t,r,i){this.privIsSynthesisEnded=!1,this.privIsSynthesizing=!0,this.privRequestId=e,this.privRawText=t,this.privIsSSML=r,this.privAudioOutputStream=new n.PullAudioOutputStreamImpl,this.privAudioOutputStream.format=this.privAudioOutputFormat,this.privReceivedAudio=null,this.privReceivedAudioWithHeader=null,this.privBytesReceived=0,this.privTextOffset=0,this.privNextSearchTextIndex=0,this.privSentenceOffset=0,this.privNextSearchSentenceIndex=0,this.privPartialVisemeAnimation=``,this.privWebRTCSDP=``,i!==void 0&&(this.privTurnAudioDestination=i,this.privTurnAudioDestination.format=this.privAudioOutputFormat),this.onEvent(new a.SynthesisTriggeredEvent(this.requestId,void 0,i===void 0?void 0:i.id()))}onPreConnectionStart(e){this.privAuthFetchEventId=e,this.onEvent(new a.ConnectingToSynthesisServiceEvent(this.privRequestId,this.privAuthFetchEventId))}onAuthCompleted(e){e&&this.onComplete()}onConnectionEstablishCompleted(e){if(e===200){this.onEvent(new a.SynthesisStartedEvent(this.requestId,this.privAuthFetchEventId)),this.privBytesReceived=0;return}else e===403&&this.onComplete()}onServiceResponseMessage(e){this.streamId=JSON.parse(e).audio.streamId}onServiceTurnEndResponse(){this.privInTurn=!1,this.privTurnDeferral.resolve(),this.onComplete()}onServiceTurnStartResponse(e){this.privTurnDeferral&&this.privInTurn&&(this.privTurnDeferral.reject(`Another turn started before current completed.`),this.privTurnDeferral.promise.then().catch(()=>{})),this.privInTurn=!0,this.privTurnDeferral=new t.Deferred;let n=JSON.parse(e);n.webrtc&&(this.privWebRTCSDP=n.webrtc.connectionString)}onAudioChunkReceived(e){this.isSynthesizing&&(this.privAudioOutputStream.write(e),this.privBytesReceived+=e.byteLength,this.privTurnAudioDestination!==void 0&&this.privTurnAudioDestination.write(e))}onTextBoundaryEvent(e){this.updateTextOffset(e.Data.text.Text,e.Type)}onVisemeMetadataReceived(e){e.Data.AnimationChunk!==void 0&&(this.privPartialVisemeAnimation+=e.Data.AnimationChunk)}onSessionEnd(e){this.privAudioDuration=e.Data.Offset}async constructSynthesisResult(){let e=await this.getAllReceivedAudioWithHeader();return new r.SpeechSynthesisResult(this.requestId,r.ResultReason.SynthesizingAudioCompleted,e,void 0,this.extraProperties,this.audioDuration)}dispose(){this.privIsDisposed||=!0}onStopSynthesizing(){this.onComplete()}getAndClearVisemeAnimation(){let e=this.privPartialVisemeAnimation;return this.privPartialVisemeAnimation=``,e}onEvent(e){t.Events.instance.onEvent(e)}static isXmlTag(e){return e.length>=2&&e[0]===`<`&&e[e.length-1]===`>`}updateTextOffset(t,n){n===i.MetadataType.WordBoundary?(this.privTextOffset=this.privRawText.indexOf(t,this.privNextSearchTextIndex),this.privTextOffset>=0&&(this.privNextSearchTextIndex=this.privTextOffset+t.length,this.privIsSSML&&this.withinXmlTag(this.privTextOffset)&&!e.isXmlTag(t)&&this.updateTextOffset(t,n))):(this.privSentenceOffset=this.privRawText.indexOf(t,this.privNextSearchSentenceIndex),this.privSentenceOffset>=0&&(this.privNextSearchSentenceIndex=this.privSentenceOffset+t.length,this.privIsSSML&&this.withinXmlTag(this.privSentenceOffset)&&!e.isXmlTag(t)&&this.updateTextOffset(t,n)))}onComplete(){this.privIsSynthesizing&&(this.privIsSynthesizing=!1,this.privIsSynthesisEnded=!0,this.privAudioOutputStream.close(),this.privInTurn=!1,this.privTurnAudioDestination!==void 0&&(this.privTurnAudioDestination.close(),this.privTurnAudioDestination=void 0))}async readAllAudioFromStream(){if(this.privIsSynthesisEnded){this.privReceivedAudio=new ArrayBuffer(this.bytesReceived);try{await this.privAudioOutputStream.read(this.privReceivedAudio)}catch{this.privReceivedAudio=new ArrayBuffer(0)}}}withinXmlTag(e){return this.privRawText.indexOf(`<`,e+1)>this.privRawText.indexOf(`>`,e+1)}}})),Kr=e((e=>{Object.defineProperty(e,`__esModule`,{value:!0}),e.SynthesisAdapterBase=void 0;var t=j(),n=Y(),r=$(),i=Z(),a=class{constructor(e,i,a,o){if(this.speakOverride=void 0,this.receiveMessageOverride=void 0,this.connectImplOverride=void 0,this.configConnectionOverride=void 0,this.privConnectionConfigurationPromise=void 0,!e)throw new t.ArgumentNullError(`authentication`);if(!i)throw new t.ArgumentNullError(`connectionFactory`);if(!a)throw new t.ArgumentNullError(`synthesizerConfig`);this.privAuthentication=e,this.privConnectionFactory=i,this.privSynthesizerConfig=a,this.privIsDisposed=!1,this.privSessionAudioDestination=o,this.privSynthesisTurn=new r.SynthesisTurn,this.privConnectionEvents=new t.EventSource,this.privServiceEvents=new t.EventSource,this.privSynthesisContext=new r.SynthesisContext,this.privAgentConfig=new r.AgentConfig,this.connectionEvents.attach(e=>{if(e.name===`ConnectionClosedEvent`){let t=e;t.statusCode!==1e3&&this.cancelSynthesisLocal(n.CancellationReason.Error,t.statusCode===1007?n.CancellationErrorCode.BadRequestParameters:n.CancellationErrorCode.ConnectionFailure,`${t.reason} websocket error code: ${t.statusCode}`)}})}get synthesizerConfig(){return this.privSynthesizerConfig}get synthesisContext(){return this.privSynthesisContext}get agentConfig(){return this.privAgentConfig}get connectionEvents(){return this.privConnectionEvents}get serviceEvents(){return this.privServiceEvents}set activityTemplate(e){this.privActivityTemplate=e}get activityTemplate(){return this.privActivityTemplate}set audioOutputFormat(e){this.privAudioOutputFormat=e,this.privSynthesisTurn.audioOutputFormat=e,this.privSessionAudioDestination!==void 0&&(this.privSessionAudioDestination.format=e),this.synthesisContext!==void 0&&(this.synthesisContext.audioOutputFormat=e)}isDisposed(){return this.privIsDisposed}async dispose(e){this.privIsDisposed=!0,this.privSessionAudioDestination!==void 0&&this.privSessionAudioDestination.close(),this.privConnectionConfigurationPromise!==void 0&&await(await this.privConnectionConfigurationPromise).dispose(e)}async connect(){await this.connectImpl()}async sendNetworkMessage(e,n){let r=typeof n==`string`?t.MessageType.Text:t.MessageType.Binary,a=typeof n==`string`?`application/json`:``;return(await this.fetchConnection()).send(new i.SpeechConnectionMessage(r,e,this.privSynthesisTurn.requestId,a,n))}async Speak(e,t,r,i,a,o){let s;if(s=t?e:this.privSynthesizer.buildSsml(e),this.speakOverride!==void 0)return this.speakOverride(s,r,i,a);this.privSuccessCallback=i,this.privErrorCallback=a,this.privSynthesisTurn.startNewSynthesis(r,e,t,o);try{await this.connectImpl();let e=await this.fetchConnection();await this.sendSynthesisContext(e),await this.sendSsmlMessage(e,s,r),this.onSynthesisStarted(r),this.receiveMessage()}catch(e){return this.cancelSynthesisLocal(n.CancellationReason.Error,n.CancellationErrorCode.ConnectionFailure,e),Promise.reject(e)}}async stopSpeaking(){return await this.connectImpl(),(await this.fetchConnection()).send(new i.SpeechConnectionMessage(t.MessageType.Text,`synthesis.control`,this.privSynthesisTurn.requestId,`application/json`,JSON.stringify({action:`stop`})))}cancelSynthesis(e,t,i,a){let o=new n.PropertyCollection;o.setProperty(r.CancellationErrorCodePropertyName,n.CancellationErrorCode[i]);let s=new n.SpeechSynthesisResult(e,n.ResultReason.Canceled,void 0,a,o);if(this.onSynthesisCancelled(s),this.privSuccessCallback)try{this.privSuccessCallback(s)}catch{}}cancelSynthesisLocal(e,t,n){this.privSynthesisTurn.isSynthesizing&&(this.privSynthesisTurn.onStopSynthesizing(),this.cancelSynthesis(this.privSynthesisTurn.requestId,e,t,n))}processTypeSpecificMessages(e){return!0}async receiveMessage(){try{let e=await(await this.fetchConnection()).read();if(this.receiveMessageOverride!==void 0)return this.receiveMessageOverride();if(this.privIsDisposed)return;if(!e)return this.privSynthesisTurn.isSynthesizing?this.receiveMessage():void 0;let a=i.SpeechConnectionMessage.fromConnectionMessage(e);if(a.requestId.toLowerCase()===this.privSynthesisTurn.requestId.toLowerCase())switch(a.path.toLowerCase()){case`turn.start`:this.privSynthesisTurn.onServiceTurnStartResponse(a.textBody);break;case`response`:this.privSynthesisTurn.onServiceResponseMessage(a.textBody);break;case`audio`:this.privSynthesisTurn.streamId.toLowerCase()===a.streamId.toLowerCase()&&a.binaryBody&&(this.privSynthesisTurn.onAudioChunkReceived(a.binaryBody),this.onSynthesizing(a.binaryBody),this.privSessionAudioDestination!==void 0&&this.privSessionAudioDestination.write(a.binaryBody));break;case`audio.metadata`:let e=r.SynthesisAudioMetadata.fromJSON(a.textBody).Metadata;for(let t of e)switch(t.Type){case r.MetadataType.WordBoundary:case r.MetadataType.SentenceBoundary:this.privSynthesisTurn.onTextBoundaryEvent(t);let e=new n.SpeechSynthesisWordBoundaryEventArgs(t.Data.Offset,t.Data.Duration,t.Data.text.Text,t.Data.text.Length,t.Type===r.MetadataType.WordBoundary?this.privSynthesisTurn.currentTextOffset:this.privSynthesisTurn.currentSentenceOffset,t.Data.text.BoundaryType);this.onWordBoundary(e);break;case r.MetadataType.Bookmark:let i=new n.SpeechSynthesisBookmarkEventArgs(t.Data.Offset,t.Data.Bookmark);this.onBookmarkReached(i);break;case r.MetadataType.Viseme:if(this.privSynthesisTurn.onVisemeMetadataReceived(t),t.Data.IsLastAnimation){let e=new n.SpeechSynthesisVisemeEventArgs(t.Data.Offset,t.Data.VisemeId,this.privSynthesisTurn.getAndClearVisemeAnimation());this.onVisemeReceived(e)}break;case r.MetadataType.AvatarSignal:this.onAvatarEvent(t);break;case r.MetadataType.SessionEnd:this.privSynthesisTurn.onSessionEnd(t);break}break;case`turn.end`:this.privSynthesisTurn.onServiceTurnEndResponse();let i;try{i=await this.privSynthesisTurn.constructSynthesisResult(),this.privSuccessCallback&&this.privSuccessCallback(i)}catch(e){this.privErrorCallback&&this.privErrorCallback(e)}this.onSynthesisCompleted(i);break;default:this.processTypeSpecificMessages(a)||this.privServiceEvents&&this.serviceEvents.onEvent(new t.ServiceEvent(a.path.toLowerCase(),a.textBody))}return this.receiveMessage()}catch{}}sendSynthesisContext(e){this.setSynthesisContextSynthesisSection();let n=this.synthesisContext.toJSON();if(n)return e.send(new i.SpeechConnectionMessage(t.MessageType.Text,`synthesis.context`,this.privSynthesisTurn.requestId,`application/json`,n))}setSpeechConfigSynthesisSection(){}connectImpl(e=!1){return this.privConnectionPromise==null?(this.privAuthFetchEventId=(0,t.createNoDashGuid)(),this.privConnectionId=(0,t.createNoDashGuid)(),this.privSynthesisTurn.onPreConnectionStart(this.privAuthFetchEventId),this.privConnectionPromise=(e?this.privAuthentication.fetchOnExpiry(this.privAuthFetchEventId):this.privAuthentication.fetch(this.privAuthFetchEventId)).then(async t=>{this.privSynthesisTurn.onAuthCompleted(!1);let r=await this.privConnectionFactory.create(this.privSynthesizerConfig,t,this.privConnectionId);r.events.attach(e=>{this.connectionEvents.onEvent(e)});let i=await r.open();return i.statusCode===200?(this.privSynthesisTurn.onConnectionEstablishCompleted(i.statusCode),Promise.resolve(r)):i.statusCode===403&&!e?this.connectImpl(!0):(this.privSynthesisTurn.onConnectionEstablishCompleted(i.statusCode),Promise.reject(`Unable to contact server. StatusCode: ${i.statusCode},
                    ${this.privSynthesizerConfig.parameters.getProperty(n.PropertyId.SpeechServiceConnection_Url)} Reason: ${i.reason}`))},e=>{throw this.privSynthesisTurn.onAuthCompleted(!0),Error(e)}),this.privConnectionPromise.catch(()=>{}),this.privConnectionPromise):this.privConnectionPromise.then(e=>e.state()===t.ConnectionState.Disconnected?(this.privConnectionId=null,this.privConnectionPromise=null,this.connectImpl()):this.privConnectionPromise,()=>(this.privConnectionId=null,this.privConnectionPromise=null,this.connectImpl()))}sendSpeechServiceConfig(e,n){if(n)return e.send(new i.SpeechConnectionMessage(t.MessageType.Text,`speech.config`,this.privSynthesisTurn.requestId,`application/json`,n))}sendSsmlMessage(e,n,r){return e.send(new i.SpeechConnectionMessage(t.MessageType.Text,`ssml`,r,`application/ssml+xml`,n))}async fetchConnection(){return this.privConnectionConfigurationPromise===void 0?(this.privConnectionConfigurationPromise=this.configureConnection(),await this.privConnectionConfigurationPromise):this.privConnectionConfigurationPromise.then(e=>e.state()===t.ConnectionState.Disconnected?(this.privConnectionId=null,this.privConnectionConfigurationPromise=void 0,this.fetchConnection()):this.privConnectionConfigurationPromise,()=>(this.privConnectionId=null,this.privConnectionConfigurationPromise=void 0,this.fetchConnection()))}async configureConnection(){let e=await this.connectImpl();return this.configConnectionOverride===void 0?(this.setSpeechConfigSynthesisSection(),await this.sendSpeechServiceConfig(e,this.privSynthesizerConfig.SpeechServiceConfig.serialize()),e):this.configConnectionOverride(e)}onAvatarEvent(e){}onSynthesisStarted(e){}onSynthesizing(e){}onSynthesisCancelled(e){}onSynthesisCompleted(e){}onWordBoundary(e){}onVisemeReceived(e){}onBookmarkReached(e){}};e.SynthesisAdapterBase=a,a.telemetryDataEnabled=!0})),qr=e((e=>{Object.defineProperty(e,`__esModule`,{value:!0}),e.AvatarSynthesisAdapter=void 0;var t=Y(),n=$();e.AvatarSynthesisAdapter=class extends n.SynthesisAdapterBase{constructor(e,t,n,r,i){super(e,t,n,void 0),this.privAvatarSynthesizer=r,this.privSynthesizer=r,this.privAvatarConfig=i}setSynthesisContextSynthesisSection(){this.privSynthesisContext.setSynthesisSection(void 0)}setSpeechConfigSynthesisSection(){this.privSynthesizerConfig.synthesisVideoSection={format:{bitrate:this.privAvatarConfig.videoFormat?.bitrate,codec:this.privAvatarConfig.videoFormat?.codec,crop:{bottomRight:{x:this.privAvatarConfig.videoFormat?.cropRange?.bottomRight?.x,y:this.privAvatarConfig.videoFormat?.cropRange?.bottomRight?.y},topLeft:{x:this.privAvatarConfig.videoFormat?.cropRange?.topLeft?.x,y:this.privAvatarConfig.videoFormat?.cropRange?.topLeft?.y}},resolution:{height:this.privAvatarConfig.videoFormat?.height,width:this.privAvatarConfig.videoFormat?.width}},protocol:{name:`WebRTC`,webrtcConfig:{clientDescription:btoa(this.privSynthesizerConfig.parameters.getProperty(t.PropertyId.TalkingAvatarService_WebRTC_SDP)),iceServers:this.privAvatarConfig.remoteIceServers??this.privAvatarSynthesizer.iceServers}},talkingAvatar:{background:{color:this.privAvatarConfig.backgroundColor,image:{url:this.privAvatarConfig.backgroundImage?.toString()}},character:this.privAvatarConfig.character,customized:this.privAvatarConfig.customized,photoAvatarBaseModel:this.privAvatarConfig.photoAvatarBaseModel,style:this.privAvatarConfig.style,useBuiltInVoice:this.privAvatarConfig.useBuiltInVoice}}}onAvatarEvent(e){if(this.privAvatarSynthesizer.avatarEventReceived){let n=new t.AvatarEventArgs(e.Data.Offset,e.Data.Name);try{this.privAvatarSynthesizer.avatarEventReceived(this.privAvatarSynthesizer,n)}catch{}}}}})),Jr=e((e=>{Object.defineProperty(e,`__esModule`,{value:!0}),e.SpeechSynthesisAdapter=void 0;var t=Y(),n=$();e.SpeechSynthesisAdapter=class extends n.SynthesisAdapterBase{constructor(e,t,n,r,i){super(e,t,n,i),this.privSpeechSynthesizer=r,this.privSynthesizer=r}setSynthesisContextSynthesisSection(){this.privSynthesisContext.setSynthesisSection(this.privSpeechSynthesizer)}onSynthesisStarted(e){let n=new t.SpeechSynthesisEventArgs(new t.SpeechSynthesisResult(e,t.ResultReason.SynthesizingAudioStarted));this.privSpeechSynthesizer.synthesisStarted&&this.privSpeechSynthesizer.synthesisStarted(this.privSpeechSynthesizer,n)}onSynthesizing(e){if(this.privSpeechSynthesizer.synthesizing)try{let n=this.privSynthesisTurn.audioOutputFormat.addHeader(e),r=new t.SpeechSynthesisEventArgs(new t.SpeechSynthesisResult(this.privSynthesisTurn.requestId,t.ResultReason.SynthesizingAudio,n));this.privSpeechSynthesizer.synthesizing(this.privSpeechSynthesizer,r)}catch{}}onSynthesisCancelled(e){if(this.privSpeechSynthesizer.SynthesisCanceled){let n=new t.SpeechSynthesisEventArgs(e);try{this.privSpeechSynthesizer.SynthesisCanceled(this.privSpeechSynthesizer,n)}catch{}}}onSynthesisCompleted(e){if(this.privSpeechSynthesizer.synthesisCompleted)try{this.privSpeechSynthesizer.synthesisCompleted(this.privSpeechSynthesizer,new t.SpeechSynthesisEventArgs(e))}catch{}}onWordBoundary(e){if(this.privSpeechSynthesizer.wordBoundary)try{this.privSpeechSynthesizer.wordBoundary(this.privSpeechSynthesizer,e)}catch{}}onVisemeReceived(e){if(this.privSpeechSynthesizer.visemeReceived)try{this.privSpeechSynthesizer.visemeReceived(this.privSpeechSynthesizer,e)}catch{}}onBookmarkReached(e){if(this.privSpeechSynthesizer.bookmarkReached)try{this.privSpeechSynthesizer.bookmarkReached(this.privSpeechSynthesizer,e)}catch{}}}})),Yr=e((e=>{Object.defineProperty(e,`__esModule`,{value:!0}),e.SynthesisRestAdapter=void 0;var t=X(),n=Y(),r=K(),i=M();e.SynthesisRestAdapter=class{constructor(e,i){let a=e.parameters.getProperty(n.PropertyId.SpeechServiceConnection_Endpoint,void 0);if(!a){let t=e.parameters.getProperty(n.PropertyId.SpeechServiceConnection_Region,`westus`),i=r.ConnectionFactoryBase.getHostSuffix(t);a=e.parameters.getProperty(n.PropertyId.SpeechServiceConnection_Host,`https://${t}.tts.speech${i}`)}this.privUri=`${a}/cognitiveservices/voices/list`;let o=t.RestConfigBase.requestOptions;this.privRestAdapter=new t.RestMessageAdapter(o),this.privAuthentication=i}getVoicesList(e){return this.privRestAdapter.setHeaders(i.HeaderNames.ConnectionId,e),this.privAuthentication.fetch(e).then(e=>(this.privRestAdapter.setHeaders(e.headerName,e.token),this.privRestAdapter.request(t.RestRequestType.Get,this.privUri)))}}})),Xr=e((e=>{Object.defineProperty(e,`__esModule`,{value:!0}),e.SynthesizerConfig=e.SynthesisServiceType=void 0;var t=$(),n;(function(e){e[e.Standard=0]=`Standard`,e[e.Custom=1]=`Custom`})(n=e.SynthesisServiceType||={}),e.SynthesizerConfig=class{constructor(e,r){this.privSynthesisServiceType=n.Standard,this.avatarEnabled=!1,this.privSpeechServiceConfig=e||new t.SpeechServiceConfig(new t.Context(null)),this.privParameters=r}get parameters(){return this.privParameters}get synthesisServiceType(){return this.privSynthesisServiceType}set synthesisServiceType(e){this.privSynthesisServiceType=e}set synthesisVideoSection(e){this.privSpeechServiceConfig.Context.synthesis={video:e}}get SpeechServiceConfig(){return this.privSpeechServiceConfig}setContextFromJson(e){let t=JSON.parse(e);t.system&&(this.privSpeechServiceConfig.Context.system=t.system),t.os&&(this.privSpeechServiceConfig.Context.os=t.os),t.audio&&(this.privSpeechServiceConfig.Context.audio=t.audio),t.synthesis&&(this.privSpeechServiceConfig.Context.synthesis=t.synthesis)}}})),Zr=e((e=>{Object.defineProperty(e,`__esModule`,{value:!0}),e.SynthesisContext=void 0;var t=Y();e.SynthesisContext=class{constructor(){this.privContext={}}setSection(e,t){this.privContext[e]=t}set audioOutputFormat(e){this.privAudioOutputFormat=e}toJSON(){return JSON.stringify(this.privContext)}setSynthesisSection(e){let t=this.buildSynthesisContext(e);this.setSection(`synthesis`,t)}buildSynthesisContext(e){return{audio:{metadataOptions:{bookmarkEnabled:!!e?.bookmarkReached,punctuationBoundaryEnabled:e?.properties.getProperty(t.PropertyId.SpeechServiceResponse_RequestPunctuationBoundary,!!e?.wordBoundary),sentenceBoundaryEnabled:e?.properties.getProperty(t.PropertyId.SpeechServiceResponse_RequestSentenceBoundary,!1),sessionEndEnabled:!0,visemeEnabled:!!e?.visemeReceived,wordBoundaryEnabled:e?.properties.getProperty(t.PropertyId.SpeechServiceResponse_RequestWordBoundary,!!e?.wordBoundary)},outputFormat:this.privAudioOutputFormat.requestAudioFormatString},language:{autoDetection:e?.autoDetectSourceLanguage}}}}})),Qr=e((e=>{Object.defineProperty(e,`__esModule`,{value:!0}),e.type=e.connectivity=e.Device=e.OS=e.System=e.Context=e.SpeechServiceConfig=void 0,e.SpeechServiceConfig=class{constructor(e){this.context=e}serialize(){return JSON.stringify(this,(e,t)=>{if(t&&typeof t==`object`&&!Array.isArray(t)){let e={};for(let n in t)Object.hasOwnProperty.call(t,n)&&(e[n&&n.charAt(0).toLowerCase()+n.substring(1)]=t[n]);return e}return t})}get Context(){return this.context}get Recognition(){return this.recognition}set Recognition(e){this.recognition=e.toLowerCase()}},e.Context=class{constructor(e){this.system=new t,this.os=e}};var t=class{constructor(){this.name=`SpeechSDK`,this.version=`1.47.0`,this.build=`JavaScript`,this.lang=`JavaScript`}};e.System=t,e.OS=class{constructor(e,t,n){this.platform=e,this.name=t,this.version=n}},e.Device=class{constructor(e,t,n){this.manufacturer=e,this.model=t,this.version=n}},(function(e){e.Bluetooth=`Bluetooth`,e.Wired=`Wired`,e.WiFi=`WiFi`,e.Cellular=`Cellular`,e.InBuilt=`InBuilt`,e.Unknown=`Unknown`})(e.connectivity||={}),(function(e){e.Phone=`Phone`,e.Speaker=`Speaker`,e.Car=`Car`,e.Headset=`Headset`,e.Thermostat=`Thermostat`,e.Microphones=`Microphones`,e.Deskphone=`Deskphone`,e.RemoteControl=`RemoteControl`,e.Unknown=`Unknown`,e.File=`File`,e.Stream=`Stream`})(e.type||={})})),$=e((e=>{var t=e&&e.__createBinding||(Object.create?(function(e,t,n,r){r===void 0&&(r=n),Object.defineProperty(e,r,{enumerable:!0,get:function(){return t[n]}})}):(function(e,t,n,r){r===void 0&&(r=n),e[r]=t[n]})),n=e&&e.__exportStar||function(e,n){for(var r in e)r!==`default`&&!Object.prototype.hasOwnProperty.call(n,r)&&t(n,e,r)};Object.defineProperty(e,`__esModule`,{value:!0}),e.AutoDetectSourceLanguagesOpenRangeOptionName=e.ForceDictationPropertyName=e.ServicePropertiesPropertyName=e.CancellationErrorCodePropertyName=e.OutputFormatPropertyName=e.SpeechSynthesisAdapter=e.AvatarSynthesisAdapter=void 0,n(Me(),e),n(Ne(),e),n(N(),e),n(Pe(),e),n(Fe(),e),n(P(),e),n(Gn(),e),n(Kn(),e),n(qn(),e),n(Jn(),e),n(Yn(),e),n(Xn(),e),n(Zn(),e),n(Qn(),e),n($n(),e),n(En(),e),n(er(),e),n(tr(),e),n(nr(),e),n(rr(),e),n(ir(),e),n(ar(),e),n(or(),e),n(sr(),e),n(cr(),e),n(lr(),e),n(dr(),e),n(fr(),e),n(pr(),e),n(mr(),e),n(gr(),e),n(vr(),e),n(br(),e),n(Er(),e),n(Dr(),e),n(Hr(),e),n(Ur(),e),n(Gr(),e),n(Kr(),e);var r=qr();Object.defineProperty(e,`AvatarSynthesisAdapter`,{enumerable:!0,get:function(){return r.AvatarSynthesisAdapter}});var i=Jr();Object.defineProperty(e,`SpeechSynthesisAdapter`,{enumerable:!0,get:function(){return i.SpeechSynthesisAdapter}}),n(Yr(),e),n(Xr(),e),n(Zr(),e),n(Qr(),e),e.OutputFormatPropertyName=`OutputFormat`,e.CancellationErrorCodePropertyName=`CancellationErrorCode`,e.ServicePropertiesPropertyName=`ServiceProperties`,e.ForceDictationPropertyName=`ForceDictation`,e.AutoDetectSourceLanguagesOpenRangeOptionName=`UND`})),$r=i(e((e=>{var t=e&&e.__createBinding||(Object.create?(function(e,t,n,r){r===void 0&&(r=n),Object.defineProperty(e,r,{enumerable:!0,get:function(){return t[n]}})}):(function(e,t,n,r){r===void 0&&(r=n),e[r]=t[n]})),n=e&&e.__exportStar||function(e,n){for(var r in e)r!==`default`&&!Object.prototype.hasOwnProperty.call(n,r)&&t(n,e,r)};Object.defineProperty(e,`__esModule`,{value:!0}),new($()).AgentConfig,n(Y(),e)}))(),1),ei=class extends d{name=`azure`;priority=3;config={enabled:!1,apiKey:``,region:`eastus`,voiceName:`zh-CN-XiaoxiaoNeural`,language:`zh-CN`,rate:`medium`,pitch:`medium`,volume:`medium`,style:void 0,styleDegree:1,role:void 0,useSSML:!0};async doInitialize(){}isAvailable(){return this.config.enabled&&!!this.config.apiKey&&!!this.config.region}async synthesize(e){if(!this.config.apiKey||!this.config.region)return{success:!1,error:`API Key 或 Region 未设置`};try{let t=$r.SpeechConfig.fromSubscription(this.config.apiKey,this.config.region);t.speechSynthesisVoiceName=this.config.voiceName;let n=new $r.SpeechSynthesizer(t,void 0),r=this.config.useSSML?this.buildSSML(e):e;return new Promise(e=>{(this.config.useSSML?n.speakSsmlAsync.bind(n):n.speakTextAsync.bind(n))(r,t=>{t.reason===$r.ResultReason.SynthesizingAudioCompleted?e({success:!0,audioData:t.audioData,mimeType:`audio/wav`}):e({success:!1,error:t.errorDetails||`Azure TTS 合成失败`}),n.close()},t=>{e({success:!1,error:t}),n.close()})})}catch(e){return{success:!1,error:e instanceof Error?e.message:String(e)}}}buildSSML(e){let t=e.replace(/&/g,`&amp;`).replace(/</g,`&lt;`).replace(/>/g,`&gt;`).replace(/"/g,`&quot;`).replace(/'/g,`&apos;`),n=`<speak version="1.0" xmlns="http://www.w3.org/2001/10/synthesis" xmlns:mstts="https://www.w3.org/2001/mstts" xml:lang="${this.config.language}">`;n+=`<voice name="${this.config.voiceName}">`;let r=[];if(this.config.rate!==`medium`&&r.push(`rate="${this.config.rate}"`),this.config.pitch!==`medium`&&r.push(`pitch="${this.config.pitch}"`),this.config.volume!==`medium`&&r.push(`volume="${this.config.volume}"`),r.length>0&&(n+=`<prosody ${r.join(` `)}>`),this.config.style&&this.config.voiceName.includes(`Neural`)){let e=[`style="${this.config.style}"`];this.config.styleDegree!==1&&e.push(`styledegree="${this.config.styleDegree}"`),this.config.role&&e.push(`role="${this.config.role}"`),n+=`<mstts:express-as ${e.join(` `)}>`}return n+=t,this.config.style&&this.config.voiceName.includes(`Neural`)&&(n+=`</mstts:express-as>`),r.length>0&&(n+=`</prosody>`),n+=`</voice></speak>`,n}stop(){}updateConfig(e){this.config={...this.config,...e}}},ti=class extends d{name=`openai`;priority=4;config={enabled:!1,apiKey:``,baseUrl:`https://api.openai.com/v1`,model:`tts-1`,voice:`alloy`,speed:1,responseFormat:`mp3`};async doInitialize(){}isAvailable(){return this.config.enabled&&!!this.config.apiKey}async synthesize(e){if(!this.config.apiKey)return{success:!1,error:`API Key 未设置`};try{let t=`${this.config.baseUrl?.replace(/\/$/,``)||`https://api.openai.com/v1`}/audio/speech`,n=await fetch(t,{method:`POST`,headers:{Authorization:`Bearer ${this.config.apiKey}`,"Content-Type":`application/json`},body:JSON.stringify({model:this.config.model,input:e,voice:this.config.voice,speed:this.config.speed,response_format:this.config.responseFormat})});if(!n.ok){let e=await n.json().catch(()=>({}));return{success:!1,error:`OpenAI TTS 请求失败: ${n.status} ${JSON.stringify(e)}`}}return{success:!0,audioData:await n.arrayBuffer(),mimeType:this.getMimeType(this.config.responseFormat)}}catch(e){return{success:!1,error:e instanceof Error?e.message:String(e)}}}getMimeType(e){return{mp3:`audio/mpeg`,opus:`audio/opus`,aac:`audio/aac`,flac:`audio/flac`}[e]||`audio/mpeg`}stop(){}updateConfig(e){this.config={...this.config,...e}}},ni=class extends d{name=`siliconflow`;priority=5;config={enabled:!1,apiKey:``,model:`FunAudioLLM/CosyVoice2-0.5B`,voice:`FunAudioLLM/CosyVoice2-0.5B:alex`,useStream:!1,speed:1,gain:0,maxTokens:1600,references:[]};async doInitialize(){}isAvailable(){return this.config.enabled&&!!this.config.apiKey}async synthesize(e){if(!this.config.apiKey)return{success:!1,error:`API Key 未设置`};try{let t=this.buildRequestBody(e),n=await fetch(`https://api.siliconflow.cn/v1/audio/speech`,{method:`POST`,headers:{Authorization:`Bearer ${this.config.apiKey}`,"Content-Type":`application/json`},body:JSON.stringify(t)});if(!n.ok){let e=await n.json().catch(()=>({}));return{success:!1,error:`硅基流动 TTS 请求失败: ${n.status} ${JSON.stringify(e)}`}}return this.config.useStream&&n.body?await this.handleStreamResponse(n):{success:!0,audioData:await n.arrayBuffer(),mimeType:`audio/mpeg`}}catch(e){return{success:!1,error:e instanceof Error?e.message:String(e)}}}async handleStreamResponse(e){let t=e.body.getReader(),n=[];try{for(;;){let{done:e,value:r}=await t.read();if(e)break;r&&n.push(r)}let e=n.reduce((e,t)=>e+t.length,0),r=new Uint8Array(e),i=0;for(let e of n)r.set(e,i),i+=e.length;return{success:!0,audioData:r.buffer,mimeType:`audio/mpeg`}}finally{t.releaseLock()}}stop(){}updateConfig(e){this.config={...this.config,...e}}buildRequestBody(e){let t=this.config.model===`fnlp/MOSS-TTSD-v0.5`,n=this.config.model===`IndexTeam/IndexTTS-2`;if(t){let t=this.config.voice;t&&!t.includes(`:`)&&(t=`${this.config.model}:${t}`);let n={model:this.config.model,input:e,voice:t||void 0,stream:this.config.useStream,response_format:`mp3`,speed:this.config.speed??1,gain:this.config.gain??0,max_tokens:this.config.maxTokens??1600};return this.config.references&&this.config.references.length>0&&(n.references=this.config.references),n}else if(n){let t=this.config.voice;t.includes(`:`)||(t=`${this.config.model}:${t}`);let n={model:this.config.model,input:e,voice:t,stream:this.config.useStream,response_format:`mp3`,speed:this.config.speed??1,gain:this.config.gain??0};return this.config.references&&this.config.references.length>0&&(n.references=this.config.references),n}else{let t=this.config.voice;return t.includes(`:`)||(t=`${this.config.model}:${t}`),{model:this.config.model,input:e,voice:t,response_format:`mp3`,stream:this.config.useStream}}}};const ri=[{id:`JBFqnCBsd6RMkjVDRZzb`,name:`George`,description:`温暖的英式男声`},{id:`EXAVITQu4vr4xnSDxMaL`,name:`Bella`,description:`柔和的女声`},{id:`TX3LPaxmHKxFdv7VOQHJ`,name:`Liam`,description:`专业的男性旁白`},{id:`pFZP5JQG7iQjIQuC4Bku`,name:`Lily`,description:`亲切的女声`},{id:`onwK4e9ZLuTAKqWW03F9`,name:`Daniel`,description:`深沉的英式男声`},{id:`N2lVS1w4EtoT3dr4eOWO`,name:`Callum`,description:`年轻的男声`},{id:`XB0fDUnXU5powFXDhCwa`,name:`Charlotte`,description:`优雅的女声`},{id:`Xb7hH8MSUJpSbSDYk0k2`,name:`Alice`,description:`成熟的女声`},{id:`iP95p4xoKVk53GoZ742B`,name:`Chris`,description:`亲切的男性声音`},{id:`cgSgspJ2msm6clMCkdW9`,name:`Jessica`,description:`活泼的女声`}],ii=[{id:`eleven_multilingual_v2`,name:`Multilingual v2`,description:`多语言高质量模型`},{id:`eleven_turbo_v2_5`,name:`Turbo v2.5`,description:`低延迟优化模型`},{id:`eleven_flash_v2_5`,name:`Flash v2.5`,description:`超低延迟模型`},{id:`eleven_monolingual_v1`,name:`English v1`,description:`英语专用模型`}],ai=[{id:`mp3_44100_128`,name:`MP3 44.1kHz 128kbps`,description:`高质量`},{id:`mp3_44100_64`,name:`MP3 44.1kHz 64kbps`,description:`标准质量`},{id:`mp3_22050_32`,name:`MP3 22.05kHz 32kbps`,description:`低带宽`},{id:`pcm_16000`,name:`PCM 16kHz`,description:`原始 PCM`},{id:`pcm_22050`,name:`PCM 22.05kHz`,description:`原始 PCM 高采样`},{id:`pcm_24000`,name:`PCM 24kHz`,description:`原始 PCM 24k`},{id:`pcm_44100`,name:`PCM 44.1kHz`,description:`原始 PCM CD 质量`},{id:`ulaw_8000`,name:`μ-law 8kHz`,description:`电话质量`}];var oi=class extends d{name=`elevenlabs`;priority=6;config={enabled:!1,apiKey:``,baseUrl:`https://api.elevenlabs.io`,modelId:`eleven_multilingual_v2`,voiceId:`JBFqnCBsd6RMkjVDRZzb`,outputFormat:`mp3_44100_128`,stability:.5,similarityBoost:.75,style:0,useSpeakerBoost:!0,speed:1};async doInitialize(){}isAvailable(){return this.config.enabled&&!!this.config.apiKey&&!!this.config.voiceId}async synthesize(e){if(!this.config.apiKey)return{success:!1,error:`ElevenLabs API Key 未设置`};if(!this.config.voiceId)return{success:!1,error:`ElevenLabs Voice ID 未设置`};try{let t=this.config.baseUrl?.replace(/\/$/,``)||`https://api.elevenlabs.io`,n=this.config.outputFormat||`mp3_44100_128`,r=`${t}/v1/text-to-speech/${this.config.voiceId}?output_format=${n}`,i={text:e,model_id:this.config.modelId},a={stability:this.config.stability??.5,similarity_boost:this.config.similarityBoost??.75,style:this.config.style??0,use_speaker_boost:this.config.useSpeakerBoost??!0};this.config.speed&&this.config.speed!==1&&(a.speed=this.config.speed),i.voice_settings=a;let o=this.getMimeType(n),s=await fetch(r,{method:`POST`,headers:{"xi-api-key":this.config.apiKey,"Content-Type":`application/json`,Accept:o},body:JSON.stringify(i)});if(!s.ok){let e=await s.json().catch(()=>({}));return{success:!1,error:`ElevenLabs TTS 请求失败: ${s.status} ${JSON.stringify(e)}`}}return{success:!0,audioData:await s.arrayBuffer(),mimeType:this.getMimeType(this.config.outputFormat)}}catch(e){return{success:!1,error:e instanceof Error?e.message:String(e)}}}getMimeType(e){return e.startsWith(`mp3_`)?`audio/mpeg`:e.startsWith(`pcm_`)?`audio/wav`:e.startsWith(`ulaw_`)?`audio/basic`:`audio/mpeg`}async getVoices(){if(!this.config.apiKey)return[];try{let e=this.config.baseUrl?.replace(/\/$/,``)||`https://api.elevenlabs.io`,t=await fetch(`${e}/v1/voices`,{headers:{"xi-api-key":this.config.apiKey}});return t.ok?((await t.json()).voices||[]).map(e=>({id:e.voice_id,name:e.name,category:e.category||`premade`})):(console.warn(`获取 ElevenLabs 语音列表失败`),[])}catch(e){return console.warn(`获取 ElevenLabs 语音列表错误:`,e),[]}}stop(){}updateConfig(e){this.config={...this.config,...e}}getConfig(){return{...this.config}}};const si=[{id:`female-tianmei`,name:`甜美女声`,description:`甜美温柔的女性声音`,language:`zh`},{id:`female-shaonv`,name:`少女`,description:`年轻活泼的少女声音`,language:`zh`},{id:`female-yujie`,name:`御姐`,description:`成熟魅力的女性声音`,language:`zh`},{id:`female-chengshu`,name:`成熟女声`,description:`稳重大气的女性声音`,language:`zh`},{id:`male-qn-qingse`,name:`青涩青年`,description:`年轻清新的男性声音`,language:`zh`},{id:`male-qn-jingying`,name:`精英青年`,description:`专业自信的男性声音`,language:`zh`},{id:`male-qn-badaozongjie`,name:`霸道总裁`,description:`低沉有磁性的男性声音`,language:`zh`},{id:`male-qn-daxuesheng`,name:`大学生`,description:`朝气蓬勃的男性声音`,language:`zh`},{id:`presenter_male`,name:`男性主持人`,description:`专业播音风格男声`,language:`zh`},{id:`presenter_female`,name:`女性主持人`,description:`专业播音风格女声`,language:`zh`},{id:`Chinese (Mandarin)_Warm_Bestie`,name:`温暖闺蜜（粤语兼容）`,description:`支持粤语的温暖女声`,language:`yue`},{id:`Cantonese_Female_1`,name:`粤语女声1`,description:`标准粤语女声`,language:`yue`},{id:`English_Male_1`,name:`英语男声`,description:`标准英语男声`,language:`en`},{id:`English_Female_1`,name:`英语女声`,description:`标准英语女声`,language:`en`}],ci=[{id:`speech-02-hd`,name:`Speech 02 HD`,description:`高清语音模型`},{id:`speech-02`,name:`Speech 02`,description:`标准语音模型`},{id:`speech-01-hd`,name:`Speech 01 HD`,description:`旧版高清模型`},{id:`speech-01`,name:`Speech 01`,description:`旧版标准模型`}],li=[{id:`neutral`,name:`中性`,description:`自然平和`},{id:`happy`,name:`开心`,description:`愉快积极`},{id:`sad`,name:`悲伤`,description:`忧郁低沉`},{id:`angry`,name:`愤怒`,description:`激动强烈`},{id:`fearful`,name:`恐惧`,description:`紧张害怕`},{id:`disgusted`,name:`厌恶`,description:`不满反感`},{id:`surprised`,name:`惊讶`,description:`惊奇意外`},{id:`calm`,name:`平静`,description:`舒缓安宁`}],ui=[{id:``,name:`自动`,description:`自动检测语言`},{id:`Chinese`,name:`中文普通话`,description:`优化普通话发音`},{id:`Chinese,Yue`,name:`粤语`,description:`优化粤语发音`},{id:`English`,name:`英语`,description:`优化英语发音`},{id:`Japanese`,name:`日语`,description:`优化日语发音`},{id:`Korean`,name:`韩语`,description:`优化韩语发音`}];var di=class extends d{name=`minimax`;priority=7;config={enabled:!1,apiKey:``,groupId:``,baseUrl:`https://api.minimaxi.chat`,model:`speech-02-hd`,voiceId:`female-tianmei`,emotion:`neutral`,speed:1,pitch:0,languageBoost:``,useStream:!1};async doInitialize(){}isAvailable(){return this.config.enabled&&!!this.config.apiKey&&!!this.config.groupId}async synthesize(e){if(!this.config.apiKey)return{success:!1,error:`MiniMax API Key 未设置`};if(!this.config.groupId)return{success:!1,error:`MiniMax Group ID 未设置`};try{let t=`${this.config.baseUrl?.replace(/\/$/,``)||`https://api.minimaxi.chat`}/v1/t2a_v2?GroupId=${this.config.groupId}`,n={text:e,model:this.config.model,stream:this.config.useStream??!1,voice_setting:{voice_id:this.config.voiceId,speed:this.config.speed??1,pitch:this.config.pitch??0,emotion:this.config.emotion??`neutral`}};if(this.config.languageBoost&&(n.language_boost=this.config.languageBoost),this.config.useStream)return this.synthesizeStream(t,n);let r=await fetch(t,{method:`POST`,headers:{Authorization:`Bearer ${this.config.apiKey}`,"Content-Type":`application/json`},body:JSON.stringify(n)});if(!r.ok){let e=await r.json().catch(()=>({}));return{success:!1,error:`MiniMax TTS 请求失败: ${r.status} ${JSON.stringify(e)}`}}let i=await r.json();if(i.base_resp?.status_code!==0)return{success:!1,error:`MiniMax TTS 错误: ${i.base_resp?.status_msg||`未知错误`}`};let a=i.data?.audio;return a?{success:!0,audioData:this.hexToArrayBuffer(a),mimeType:`audio/mpeg`}:{success:!1,error:`MiniMax TTS 未返回音频数据`}}catch(e){return{success:!1,error:e instanceof Error?e.message:String(e)}}}async synthesizeStream(e,t){try{t.stream=!0,t.stream_options={exclude_aggregated_audio:!0},t.output_format=`hex`;let n=await fetch(e,{method:`POST`,headers:{Authorization:`Bearer ${this.config.apiKey}`,"Content-Type":`application/json`,Accept:`text/event-stream`},body:JSON.stringify(t)});if(!n.ok){let e=await n.text();return{success:!1,error:`MiniMax TTS 流式请求失败: ${n.status} ${e}`}}if(!n.body)return{success:!1,error:`MiniMax TTS 流式响应体为空`};let r=n.body.getReader(),i=new TextDecoder,a=[],o=``;try{for(;;){let{done:e,value:t}=await r.read();if(e)break;o+=i.decode(t,{stream:!0});let n=o.split(`
`);o=n.pop()||``;for(let e of n){if(!e.startsWith(`data:`))continue;let t=e.substring(5).trim();if(t!==`[DONE]`)try{let e=JSON.parse(t),n=e.data?.audio;if(e.data?.status===2)continue;if(n){let e=this.hexToUint8Array(n);a.push(e)}}catch{}}}}finally{r.releaseLock()}let s=a.reduce((e,t)=>e+t.length,0),c=new Uint8Array(s),l=0;for(let e of a)c.set(e,l),l+=e.length;return{success:!0,audioData:c.buffer.slice(0),mimeType:`audio/mpeg`}}catch(e){return{success:!1,error:e instanceof Error?e.message:String(e)}}}hexToArrayBuffer(e){return this.hexToUint8Array(e).buffer.slice(0)}hexToUint8Array(e){let t=e.replace(/\s+/g,``);if(t.length%2!=0)throw Error(`Hex 字符串长度必须为偶数`);let n=new Uint8Array(t.length/2);for(let e=0;e<t.length;e+=2)n[e/2]=parseInt(t.substring(e,e+2),16);return n}stop(){}updateConfig(e){this.config={...this.config,...e}}getConfig(){return{...this.config}}};const fi={"灿灿2.0":`BV700_V2_streaming`,灿灿:`BV700_streaming`,炀炀:`BV705_streaming`,"擎苍2.0":`BV701_V2_streaming`,擎苍:`BV701_streaming`,"通用女声2.0":`BV001_V2_streaming`,通用女声:`BV001_streaming`,通用男声:`BV002_streaming`,"超自然音色-梓梓2.0":`BV406_V2_streaming`,"超自然音色-梓梓":`BV406_streaming`,"超自然音色-燃燃2.0":`BV407_V2_streaming`,"超自然音色-燃燃":`BV407_streaming`,阳光青年:`BV123_streaming`,反卷青年:`BV120_streaming`,通用赘婿:`BV119_streaming`,古风少御:`BV115_streaming`,霸气青叔:`BV107_streaming`,质朴青年:`BV100_streaming`,温柔淑女:`BV104_streaming`,开朗青年:`BV004_streaming`,甜宠少御:`BV113_streaming`,儒雅青年:`BV102_streaming`,甜美小源:`BV405_streaming`,亲切女声:`BV007_streaming`,知性女声:`BV009_streaming`,诚诚:`BV419_streaming`,童童:`BV415_streaming`,亲切男声:`BV008_streaming`,译制片男声:`BV408_streaming`,懒小羊:`BV426_streaming`,清新文艺女声:`BV428_streaming`,鸡汤女声:`BV403_streaming`,智慧老者:`BV158_streaming`,慈爱姥姥:`BV157_streaming`,说唱小哥:`BR001_streaming`,活力解说男:`BV410_streaming`,影视解说小帅:`BV411_streaming`,"解说小帅-多情感":`BV437_streaming`,影视解说小美:`BV412_streaming`,纨绔青年:`BV159_streaming`,直播一姐:`BV418_streaming`,沉稳解说男:`BV142_streaming`,潇洒青年:`BV143_streaming`,阳光男声:`BV056_streaming`,活泼女声:`BV005_streaming`,小萝莉:`BV064_streaming`,奶气萌娃:`BV051_streaming`,动漫海绵:`BV063_streaming`,动漫海星:`BV417_streaming`,动漫小新:`BV050_streaming`,天才童声:`BV061_streaming`,促销男声:`BV401_streaming`,促销女声:`BV402_streaming`,磁性男声:`BV006_streaming`,新闻女声:`BV011_streaming`,新闻男声:`BV012_streaming`,"知性姐姐-双语":`BV034_streaming`,温柔小哥:`BV033_streaming`,东北老铁:`BV021_streaming`,东北丫头:`BV020_streaming`,西安佟掌柜:`BV210_streaming`,沪上阿姐:`BV217_streaming`,广西表哥:`BV213_streaming`,甜美台妹:`BV025_streaming`,台普男声:`BV227_streaming`,港剧男神:`BV026_streaming`,广东女仔:`BV424_streaming`,相声演员:`BV212_streaming`,重庆小伙:`BV019_streaming`,四川甜妹儿:`BV221_streaming`,重庆幺妹儿:`BV423_streaming`,乡村企业家:`BV214_streaming`,湖南妹坨:`BV226_streaming`,长沙靓女:`BV216_streaming`,方言灿灿:`BV704_streaming`,"慵懒女声-Ava":`BV511_streaming`,"议论女声-Alicia":`BV505_streaming`,"情感女声-Lawrence":`BV138_streaming`,"美式女声-Amelia":`BV027_streaming`,"讲述女声-Amanda":`BV502_streaming`,"活力女声-Ariana":`BV503_streaming`,"活力男声-Jackson":`BV504_streaming`,天才少女:`BV421_streaming`,Stefan:`BV702_streaming`,"天真萌娃-Lily":`BV506_streaming`,"亲切女声-Anna":`BV040_streaming`,"澳洲男声-Henry":`BV516_streaming`,元气少女:`BV520_streaming`,萌系少女:`BV521_streaming`,气质女声:`BV522_streaming`,日语男声:`BV524_streaming`,"活力男声-Carlos":`BV531_streaming`,"活力女声-葡语":`BV530_streaming`,"气质御姐-西语":`BV065_streaming`,"[豆包]Vivi":`zh_female_vv_mars_bigtts`,"[豆包]灿灿":`zh_female_cancan_mars_bigtts`,"[豆包]爽快思思":`zh_female_shuangkuaisisi_moon_bigtts`,"[豆包]温暖阿虎":`zh_male_wennuanahu_moon_bigtts`,"[豆包]少年梓辛":`zh_male_shaonianzixin_moon_bigtts`,"[豆包]邻家女孩":`zh_female_linjianvhai_moon_bigtts`,"[豆包]渊博小叔":`zh_male_yuanboxiaoshu_moon_bigtts`,"[豆包]阳光青年":`zh_male_yangguangqingnian_moon_bigtts`,"[豆包]甜美小源":`zh_female_tianmeixiaoyuan_moon_bigtts`,"[豆包]清澈梓梓":`zh_female_qingchezizi_moon_bigtts`,"[豆包]邻家男孩":`zh_male_linjiananhai_moon_bigtts`,"[豆包]甜美悦悦":`zh_female_tianmeiyueyue_moon_bigtts`,"[豆包]心灵鸡汤":`zh_female_xinlingjitang_moon_bigtts`,"[豆包]解说小明":`zh_male_jieshuoxiaoming_moon_bigtts`,"[豆包]开朗姐姐":`zh_female_kailangjiejie_moon_bigtts`,"[豆包]亲切女声":`zh_female_qinqienvsheng_moon_bigtts`,"[豆包]温柔小雅":`zh_female_wenrouxiaoya_moon_bigtts`,"[豆包]快乐小东":`zh_male_xudong_conversation_wvae_bigtts`,"[豆包]文静毛毛":`zh_female_maomao_conversation_wvae_bigtts`,"[豆包]悠悠君子":`zh_male_M100_conversation_wvae_bigtts`,"[豆包]魅力苏菲":`zh_female_sophie_conversation_wvae_bigtts`,"[豆包]阳光阿辰":`zh_male_qingyiyuxuan_mars_bigtts`,"[豆包]甜美桃子":`zh_female_tianmeitaozi_mars_bigtts`,"[豆包]清新女声":`zh_female_qingxinnvsheng_mars_bigtts`,"[豆包]知性女声":`zh_female_zhixingnvsheng_mars_bigtts`,"[豆包]清爽男大":`zh_male_qingshuangnanda_mars_bigtts`,"[豆包]温柔小哥":`zh_male_wenrouxiaoge_mars_bigtts`,"[豆包]傲娇霸总":`zh_male_aojiaobazong_moon_bigtts`,"[豆包]病娇姐姐":`ICL_zh_female_bingjiaojiejie_tob`,"[豆包]妩媚御姐":`ICL_zh_female_wumeiyujie_tob`,"[豆包]傲娇女友":`ICL_zh_female_aojiaonvyou_tob`,"[豆包]冷酷哥哥":`ICL_zh_male_lengkugege_v1_tob`,"[豆包]成熟姐姐":`ICL_zh_female_chengshujiejie_tob`,"[豆包]贴心女友":`ICL_zh_female_tiexinnvyou_tob`,"[豆包]性感御姐":`ICL_zh_female_xingganyujie_tob`,"[豆包]病娇弟弟":`ICL_zh_male_bingjiaodidi_tob`,"[豆包]傲慢少爷":`ICL_zh_male_aomanshaoye_tob`,"[豆包]腹黑公子":`ICL_zh_male_fuheigongzi_tob`,"[豆包]暖心学姐":`ICL_zh_female_nuanxinxuejie_tob`,"[豆包]可爱女生":`ICL_zh_female_keainvsheng_tob`,"[豆包]知性温婉":`ICL_zh_female_zhixingwenwan_tob`,"[豆包]暖心体贴":`ICL_zh_male_nuanxintitie_tob`,"[豆包]开朗轻快":`ICL_zh_male_kailangqingkuai_tob`,"[豆包]活泼爽朗":`ICL_zh_male_huoposhuanglang_tob`,"[豆包]率真小伙":`ICL_zh_male_shuaizhenxiaohuo_tob`,"[豆包]温柔文雅":`ICL_zh_female_wenrouwenya_tob`,"[豆包]温柔女神":`ICL_zh_female_wenrounvshen_239eff5e8ffa_tob`,"[豆包]炀炀":`ICL_zh_male_BV705_streaming_cs_tob`,"[豆包]擎苍":`zh_male_qingcang_mars_bigtts`,"[豆包]霸气青叔":`zh_male_baqiqingshu_mars_bigtts`,"[豆包]温柔淑女":`zh_female_wenroushunv_mars_bigtts`,"[豆包]儒雅青年":`zh_male_ruyaqingnian_mars_bigtts`,"[豆包]悬疑解说":`zh_male_changtianyi_mars_bigtts`,"[豆包]古风少御":`zh_female_gufengshaoyu_mars_bigtts`,"[豆包]活力小哥":`zh_male_yangguangqingnian_mars_bigtts`,"[豆包]鸡汤妹妹":`zh_female_jitangmeimei_mars_bigtts`,"[豆包]贴心女声":`zh_female_tiexinnvsheng_mars_bigtts`,"[豆包]萌丫头":`zh_female_mengyatou_mars_bigtts`,"[豆包]磁性解说男声":`zh_male_jieshuonansheng_mars_bigtts`,"[豆包]广告解说":`zh_male_chunhui_mars_bigtts`,"[豆包]少儿故事":`zh_female_shaoergushi_mars_bigtts`,"[豆包]天才童声":`zh_male_tiancaitongsheng_mars_bigtts`,"[豆包]俏皮女声":`zh_female_qiaopinvsheng_mars_bigtts`,"[豆包]懒音绵宝":`zh_male_lanxiaoyang_mars_bigtts`,"[豆包]亮嗓萌仔":`zh_male_dongmanhaimian_mars_bigtts`,"[豆包]暖阳女声":`zh_female_kefunvsheng_mars_bigtts`,"[豆包]猴哥":`zh_male_sunwukong_mars_bigtts`,"[豆包]熊二":`zh_male_xionger_mars_bigtts`,"[豆包]佩奇猪":`zh_female_peiqi_mars_bigtts`,"[豆包]樱桃丸子":`zh_female_yingtaowanzi_mars_bigtts`,"[豆包]武则天":`zh_female_wuzetian_mars_bigtts`,"[豆包]顾姐":`zh_female_gujie_mars_bigtts`,"[豆包]四郎":`zh_male_silang_mars_bigtts`,"[豆包]鲁班七号":`zh_male_lubanqihao_mars_bigtts`,"[豆包]冷酷哥哥-多情感":`zh_male_lengkugege_emo_v2_mars_bigtts`,"[豆包]高冷御姐-多情感":`zh_female_gaolengyujie_emo_v2_mars_bigtts`,"[豆包]傲娇霸总-多情感":`zh_male_aojiaobazong_emo_v2_mars_bigtts`,"[豆包]邻居阿姨-多情感":`zh_female_linjuayi_emo_v2_mars_bigtts`,"[豆包]儒雅男友-多情感":`zh_male_ruyayichen_emo_v2_mars_bigtts`,"[豆包]俊朗男友-多情感":`zh_male_junlangnanyou_emo_v2_mars_bigtts`,"[豆包]柔美女友-多情感":`zh_female_roumeinvyou_emo_v2_mars_bigtts`,"[豆包]阳光青年-多情感":`zh_male_yangguangqingnian_emo_v2_mars_bigtts`,"[豆包]爽快思思-多情感":`zh_female_shuangkuaisisi_emo_v2_mars_bigtts`,"[豆包]深夜播客":`zh_male_shenyeboke_emo_v2_mars_bigtts`,"[豆包]Lauren":`en_female_lauren_moon_bigtts`,"[豆包]Amanda":`en_female_amanda_mars_bigtts`,"[豆包]Adam":`en_male_adam_mars_bigtts`,"[豆包]Jackson":`en_male_jackson_mars_bigtts`,"[豆包]Emily":`en_female_emily_mars_bigtts`,"[豆包]Smith":`en_male_smith_mars_bigtts`,"[豆包]Anna":`en_female_anna_mars_bigtts`,"[豆包]Sarah":`en_female_sarah_mars_bigtts`,"[豆包]Dryw":`en_male_dryw_mars_bigtts`,"[豆包]Nara":`en_female_nara_moon_bigtts`,"[豆包]Bruce":`en_male_bruce_moon_bigtts`,"[豆包]Michael":`en_male_michael_moon_bigtts`,"[豆包]Daisy":`en_female_dacey_conversation_wvae_bigtts`,"[豆包]Luna":`en_female_sarah_new_conversation_wvae_bigtts`,"[豆包]Owen":`en_male_charlie_conversation_wvae_bigtts`,"[豆包]Lucas":`zh_male_M100_conversation_wvae_bigtts`,"[豆包]Candice-多情感":`en_female_candice_emo_v2_mars_bigtts`,"[豆包]Serena-多情感":`en_female_skye_emo_v2_mars_bigtts`,"[豆包]Glen-多情感":`en_male_glen_emo_v2_mars_bigtts`,"[豆包]Sylus-多情感":`en_male_sylus_emo_v2_mars_bigtts`,"[豆包]理性圆子":`ICL_zh_female_lixingyuanzi_cs_tob`,"[豆包]清甜桃桃":`ICL_zh_female_qingtiantaotao_cs_tob`,"[豆包]清晰小雪":`ICL_zh_female_qingxixiaoxue_cs_tob`,"[豆包]开朗婷婷":`ICL_zh_female_kailangtingting_cs_tob`,"[豆包]温婉珊珊":`ICL_zh_female_wenwanshanshan_cs_tob`,"[豆包]甜美小雨":`ICL_zh_female_tianmeixiaoyu_cs_tob`,"[豆包]灵动欣欣":`ICL_zh_female_lingdongxinxin_cs_tob`,"[豆包]乖巧可儿":`ICL_zh_female_guaiqiaokeer_cs_tob`,"[豆包]阳光洋洋":`ICL_zh_male_yangguangyangyang_cs_tob`},pi={happy:`开心`,sad:`悲伤`,angry:`愤怒`,scare:`害怕`,hate:`厌恶`,surprise:`惊讶`,tear:`哭腔`,novel_dialog:`平和`,excited:`激动`,coldness:`冷漠`,neutral:`中性`,depressed:`沮丧`,fear:`恐惧`,pleased:`愉悦`,sorry:`抱歉`,annoyed:`嗔怪`,shy:`害羞`,tender:`温柔`,customer_service:`客服`,professional:`专业`,serious:`严肃`,assistant:`助手`,advertising:`广告`,news:`新闻播报`,entertainment:`娱乐八卦`,narrator:`旁白-舒缓`,narrator_immersive:`旁白-沉浸`,storytelling:`讲故事`,radio:`情感电台`,chat:`自然对话`,comfort:`安慰鼓励`,"lovey-dovey":`撒娇`,energetic:`可爱元气`,conniving:`绿茶`,tsundere:`傲娇`,charming:`娇媚`,yoga:`瑜伽`,tension:`咆哮/焦急`,magnetic:`磁性`,"vocal-fry":`气泡音`,asmr:`低语ASMR`,dialect:`方言`,warm:`温暖`,affectionate:`深情`,authoritative:`权威`};var mi=class e extends d{name=`volcano`;priority=6;static HTTP_API_URL=`https://openspeech.bytedance.com/api/v1/tts`;config={enabled:!1,appId:``,accessToken:``,cluster:`volcano_tts`,voiceType:`BV001_streaming`,emotion:``,speed:1,volume:1,pitch:1,encoding:`mp3`};async doInitialize(){}isAvailable(){return this.config.enabled&&!!this.config.appId&&!!this.config.accessToken}async synthesize(t){if(!this.config.appId||!this.config.accessToken)return{success:!1,error:`App ID 或 Access Token 未设置`};try{let r=this.buildRequestBody(t),i=await n(e.HTTP_API_URL,{method:`POST`,headers:{"Content-Type":`application/json`,Authorization:`Bearer;${this.config.accessToken}`},body:JSON.stringify(r)});if(!i.ok){let e=await i.json().catch(()=>({}));return{success:!1,error:`火山引擎 TTS 请求失败: ${i.status} ${JSON.stringify(e)}`}}let a=await i.json();return a.code===3e3?a.data?{success:!0,audioData:this.base64ToArrayBuffer(a.data),mimeType:this.getMimeType()}:{success:!1,error:`未收到音频数据`}:{success:!1,error:`火山引擎 TTS 错误: ${a.message||`未知错误`} (code: ${a.code})`}}catch(e){return{success:!1,error:e instanceof Error?e.message:String(e)}}}stop(){}updateConfig(e){this.config={...this.config,...e}}getClusterForVoice(e){return this.config.cluster?this.config.cluster:`volcano_tts`}buildRequestBody(e){let t=this.config.voiceType,n=this.getClusterForVoice(t),r={app:{appid:this.config.appId,token:this.config.accessToken,cluster:n},user:{uid:`aetherlink_user`},audio:{voice_type:this.config.voiceType,encoding:this.config.encoding||`mp3`,speed_ratio:this.config.speed??1,volume_ratio:this.config.volume??1,pitch_ratio:this.config.pitch??1},request:{reqid:this.generateRequestId(),text:e,text_type:`plain`,operation:`query`}};return this.config.emotion&&(r.audio.emotion=this.config.emotion),r}generateRequestId(){return`xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx`.replace(/[xy]/g,e=>{let t=Math.random()*16|0;return(e===`x`?t:t&3|8).toString(16)})}base64ToArrayBuffer(e){let t=atob(e),n=new Uint8Array(t.length);for(let e=0;e<t.length;e++)n[e]=t.charCodeAt(e);return n.buffer}getMimeType(){switch(this.config.encoding){case`mp3`:return`audio/mpeg`;case`ogg_opus`:return`audio/ogg`;case`wav`:return`audio/wav`;case`pcm`:return`audio/pcm`;default:return`audio/mpeg`}}getConfig(){return{...this.config}}},hi=class extends d{name=`webspeech`;priority=99;utterance=null;voices=[];config={enabled:!0,voice:void 0,rate:1,pitch:1,volume:1};async doInitialize(){if(!(`speechSynthesis`in window))throw Error(`浏览器不支持 Web Speech API`);this.voices=window.speechSynthesis.getVoices(),this.voices.length===0&&await new Promise(e=>{window.speechSynthesis.onvoiceschanged=()=>{this.voices=window.speechSynthesis.getVoices(),e()},setTimeout(e,1e3)}),console.log(`Web Speech API 初始化完成，语音数:`,this.voices.length)}isAvailable(){return`speechSynthesis`in window}async synthesize(e){return{success:!0,directPlay:!0}}async speak(e){if(!(`speechSynthesis`in window))return!1;try{window.speechSynthesis.cancel(),this.utterance=new SpeechSynthesisUtterance(e);let t=this.selectVoice();return t&&(this.utterance.voice=t),this.utterance.rate=this.config.rate,this.utterance.pitch=this.config.pitch,this.utterance.volume=this.config.volume,new Promise(e=>{if(!this.utterance){e(!1);return}this.utterance.onend=()=>e(!0),this.utterance.onerror=()=>e(!1),window.speechSynthesis.speak(this.utterance)})}catch(e){return console.error(`Web Speech API 播放失败:`,e),!1}}selectVoice(){if(this.voices.length===0&&(this.voices=window.speechSynthesis.getVoices()),this.config.voice){let e=this.voices.find(e=>e.name===this.config.voice);if(e)return e}return this.voices.find(e=>e.lang===`zh-CN`)||this.voices[0]||null}stop(){`speechSynthesis`in window&&window.speechSynthesis.cancel(),this.utterance=null}getVoices(){return this.voices}updateConfig(e){this.config={...this.config,...e}}},gi=class{chunks=[];currentIndex=0;isPaused=!1;setChunks(e){this.chunks=e,this.currentIndex=0,this.isPaused=!1}getCurrentChunk(){return this.currentIndex>=this.chunks.length?null:this.chunks[this.currentIndex]}advance(){return this.currentIndex<this.chunks.length-1?(this.currentIndex++,!0):!1}pause(){this.isPaused=!0}resume(){this.isPaused=!1}reset(){this.chunks=[],this.currentIndex=0,this.isPaused=!1}isFinished(){return this.currentIndex>=this.chunks.length}getProgress(){return{current:this.currentIndex,total:this.chunks.length,percentage:this.chunks.length>0?this.currentIndex/this.chunks.length*100:0}}get chunksArray(){return this.chunks}get index(){return this.currentIndex}get paused(){return this.isPaused}},_i=class e{static instance;engines=new Map;activeEngine=null;audioPlayer;eventListeners=[];_state={isPlaying:!1,isPaused:!1,currentMessageId:null,currentEngine:null,error:null};playbackQueue=new gi;constructor(){this.audioPlayer=new a,this.registerEngines(),this.setupAudioCallbacks(),this.initializeEngines()}static getInstance(){return e.instance||=new e,e.instance}registerEngines(){[new f,new p,new ei,new ti,new ni,new oi,new di,new mi,new hi].forEach(e=>{this.engines.set(e.name,e)})}async initializeEngines(){let e=Array.from(this.engines.values()).map(async e=>{try{await e.initialize(),console.log(`✅ ${e.name} 引擎初始化完成`)}catch(t){console.warn(`⚠️ ${e.name} 引擎初始化失败:`,t)}});await Promise.allSettled(e),console.log(`🎵 TTS Manager 初始化完成`)}setupAudioCallbacks(){this.audioPlayer.onEnd(()=>{this._state.currentEngine&&!this.isDirectPlayEngine(this._state.currentEngine)&&this.advanceOrFinish()}),this.audioPlayer.onError(e=>{this._state.error=e.message,this.stopInternal(),this.emit({type:`error`,error:e.message})})}isDirectPlayEngine(e){return e===`capacitor`||e===`webspeech`}async speak(e,t){this._state.isPlaying&&this.stop();let n=c(e);if(!n)return console.warn(`文本为空，无法播放`),!1;let r=s(n);return this.playbackQueue.setChunks(r),this._state={isPlaying:!0,isPaused:!1,currentMessageId:t||null,currentEngine:null,error:null},this.emit({type:`start`,messageId:t}),this.playNextChunk()}async playNextChunk(){if(console.log(`🎵 [DEBUG] playNextChunk called, currentIndex: ${this.playbackQueue.index}, isFinished: ${this.playbackQueue.isFinished()}`),this.playbackQueue.isFinished())return console.log(`🎵 [DEBUG] Playback finished, calling finishPlayback()`),this.finishPlayback(),!0;let e=this.playbackQueue.getCurrentChunk();if(!e)return console.log(`🎵 [DEBUG] No current chunk, calling finishPlayback()`),this.finishPlayback(),!0;if(console.log(`🎵 [DEBUG] Playing chunk: "${e.substring(0,50)}..."`),this.activeEngine){let t=this.engines.get(this.activeEngine);if(t?.isAvailable())try{console.log(`🎵 使用 ${t.name} 引擎播放`);let n=await t.synthesize(e);if(n.success){if(this._state.currentEngine=t.name,n.directPlay)return console.log(`🎵 [DEBUG] DirectPlay engine completed, advancing to next chunk...`),this.playbackQueue.advance()?(console.log(`🎵 [DEBUG] Advanced to next chunk, continuing playback`),this.playNextChunk()):(console.log(`🎵 [DEBUG] No more chunks, finishing playback`),this.finishPlayback(),!0);if(n.audioData&&await this.audioPlayer.play(n.audioData,n.mimeType))return!0}}catch(e){console.warn(`${t.name} 引擎播放失败:`,e)}}let t=Array.from(this.engines.values()).filter(e=>e.isAvailable()&&e.name!==this.activeEngine).sort((e,t)=>e.priority-t.priority);for(let n of t)try{console.log(`🎵 降级到 ${n.name} 引擎`);let t=await n.synthesize(e);if(t.success){if(this._state.currentEngine=n.name,t.directPlay)return console.log(`🎵 [DEBUG] DirectPlay engine completed, advancing to next chunk...`),this.playbackQueue.advance()?(console.log(`🎵 [DEBUG] Advanced to next chunk, continuing playback`),this.playNextChunk()):(console.log(`🎵 [DEBUG] No more chunks, finishing playback`),this.finishPlayback(),!0);if(t.audioData&&await this.audioPlayer.play(t.audioData,t.mimeType))return!0}}catch(e){console.warn(`${n.name} 引擎播放失败:`,e)}return this._state.error=`所有 TTS 引擎播放失败`,this.stopInternal(),this.emit({type:`error`,error:this._state.error}),!1}advanceOrFinish(){if(console.log(`🎵 [DEBUG] advanceOrFinish called, paused: ${this.playbackQueue.paused}, index: ${this.playbackQueue.index}`),this.playbackQueue.paused){console.log(`🎵 [DEBUG] Queue is paused, not advancing`);return}this.playbackQueue.advance()?(console.log(`🎵 [DEBUG] Advanced to next chunk, new index: ${this.playbackQueue.index}`),this.playNextChunk()):(console.log(`🎵 [DEBUG] Cannot advance, calling finishPlayback()`),this.finishPlayback())}finishPlayback(){let e=this._state.currentMessageId;this.stopInternal(),this.emit({type:`end`,messageId:e||void 0})}stop(){this.engines.forEach(e=>e.stop()),this.audioPlayer.stop(),this.stopInternal()}pause(){return!this._state.isPlaying||this._state.isPaused?!1:(this.audioPlayer.pause(),this.engines.forEach(e=>{if(`pause`in e&&typeof e.pause==`function`)try{e.pause()}catch(e){console.warn(`引擎暂停失败:`,e)}}),this.playbackQueue.pause(),this._state.isPaused=!0,this.emit({type:`pause`,messageId:this._state.currentMessageId||void 0}),!0)}async resume(){if(!this._state.isPaused)return!1;try{if(this.playbackQueue.resume(),this.audioPlayer.isPaused)await this.audioPlayer.resume();else return this.playNextChunk();return this.engines.forEach(e=>{if(`resume`in e&&typeof e.resume==`function`)try{e.resume()}catch(e){console.warn(`引擎恢复失败:`,e)}}),this._state.isPaused=!1,this.emit({type:`resume`,messageId:this._state.currentMessageId||void 0}),!0}catch(e){return console.error(`恢复播放失败:`,e),this._state.error=`恢复播放失败`,this.emit({type:`error`,error:this._state.error}),!1}}stopInternal(){this.playbackQueue.reset(),this._state={isPlaying:!1,isPaused:!1,currentMessageId:null,currentEngine:null,error:this._state.error}}setActiveEngine(e){this.engines.has(e)&&(this.activeEngine=e)}getEngine(e){return this.engines.get(e)}configureEngine(e,t){let n=this.engines.get(e);n&&n.updateConfig(t)}getProgress(){return this._state.isPlaying?this.playbackQueue.getProgress():null}get state(){return{...this._state}}get isPlaying(){return this._state.isPlaying}get currentMessageId(){return this._state.currentMessageId}addEventListener(e){return this.eventListeners.push(e),()=>{this.eventListeners=this.eventListeners.filter(t=>t!==e)}}emit(e){this.eventListeners.forEach(t=>t(e))}dispose(){this.stop(),this.audioPlayer.dispose(),this.eventListeners=[]}};export{a as C,o as S,ei as _,mi as a,s as b,ci as c,ii as d,ai as f,ti as g,ni as h,fi as i,si as l,oi as m,hi as n,li as o,ri as p,pi as r,ui as s,_i as t,di as u,p as v,c as x,f as y};