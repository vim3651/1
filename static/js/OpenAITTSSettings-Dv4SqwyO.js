import{Ad as e,Cd as t,Du as n,Ot as r,Sd as i,Zu as a,_ as o,bd as s,ci as c,dd as l,fd as u,ip as d,np as f,pp as p,qp as m,s as h,td as g,xd as _,xp as v,xu as y,zp as b}from"./index-hvLbsAjx.js";import"./SolidBridge-4JuNrAWl.js";import{t as x}from"./tts-v2-DDBlG3xK.js";import"./FullScreenSelectorSolid-D7sSYiET.js";import{n as S}from"./TTS-tegaWkfT.js";import{t as C}from"./TTSTestSection-BqHpnV2B.js";var w=m(b(),1),T=m(v(),1),E=()=>{let m=p(),{t:v}=c(),b=(0,w.useMemo)(()=>x.getInstance(),[]),E=(0,w.useRef)(null),D=(0,w.useRef)(null),O=(0,w.useRef)(null),[k,A]=(0,w.useState)({apiKey:``,showApiKey:!1,selectedModel:`tts-1`,selectedVoice:`alloy`,selectedFormat:`mp3`,speed:1,useStream:!1}),[j,M]=(0,w.useState)({isSaved:!1,saveError:``,isTestPlaying:!1}),[N,P]=(0,w.useState)(``),[F,I]=(0,w.useState)(!0),[L,R]=(0,w.useState)(!1);(0,w.useEffect)(()=>{(async()=>{try{let e=await f(`openai_tts_api_key`)||``,t=await f(`openai_tts_model`)||`tts-1`,n=await f(`openai_tts_voice`)||`alloy`,r=await f(`openai_tts_format`)||`mp3`,i=Number(await f(`openai_tts_speed`)||`1.0`),a=await f(`openai_tts_stream`)===`true`,o=await f(`enable_tts`)!==`false`,s=await f(`selected_tts_service`)||`siliconflow`;A({apiKey:e,showApiKey:!1,selectedModel:t,selectedVoice:n,selectedFormat:r,speed:i,useStream:a}),I(o),R(s===`openai`),b.configureEngine(`openai`,{enabled:!0,apiKey:e,model:t,voice:n,speed:i,responseFormat:r}),P(v(`settings.voice.openai.testText`))}catch(e){console.error(v(`settings.voice.common.loadingError`,{service:`OpenAI TTS`}),e)}})()},[b,v]);let z=(0,w.useCallback)(async()=>{try{await d(`openai_tts_api_key`,k.apiKey),await d(`openai_tts_model`,k.selectedModel),await d(`openai_tts_voice`,k.selectedVoice),await d(`openai_tts_format`,k.selectedFormat),await d(`openai_tts_speed`,k.speed.toString()),await d(`openai_tts_stream`,k.useStream.toString()),await d(`enable_tts`,F.toString()),await d(`use_capacitor_tts`,`false`),L?(await d(`selected_tts_service`,`openai`),await d(`use_openai_tts`,`true`),await d(`use_azure_tts`,`false`)):await d(`use_openai_tts`,`false`),b.configureEngine(`openai`,{enabled:!0,apiKey:k.apiKey,model:k.selectedModel,voice:k.selectedVoice,speed:k.speed,responseFormat:k.selectedFormat}),L?(await d(`selected_tts_service`,`openai`),await d(`use_openai_tts`,`true`),await d(`use_azure_tts`,`false`),await d(`use_capacitor_tts`,`false`),b.setActiveEngine(`openai`)):(await d(`use_openai_tts`,`false`),b.configureEngine(`openai`,{enabled:!1})),E.current&&clearTimeout(E.current),setTimeout(()=>{m(`/settings/voice`)},0)}catch(e){console.error(v(`settings.voice.common.saveErrorText`,{service:`OpenAI TTS`}),e),M(e=>({...e,saveError:v(`settings.voice.common.saveError`)}))}},[k,F,L,b,m,v]),B=(0,w.useCallback)(e=>{R(e)},[]),V=(0,w.useCallback)(async()=>{if(j.isTestPlaying){b.stop(),D.current&&clearInterval(D.current),M(e=>({...e,isTestPlaying:!1}));return}if(!k.apiKey){M(e=>({...e,saveError:v(`settings.voice.common.apiKeyRequired`)}));return}if(M(e=>({...e,isTestPlaying:!0})),b.configureEngine(`openai`,{enabled:!0,apiKey:k.apiKey,model:k.selectedModel,voice:k.selectedVoice,speed:k.speed,responseFormat:k.selectedFormat}),b.setActiveEngine(`openai`),!await b.speak(N)){M(e=>({...e,isTestPlaying:!1}));return}D.current=setInterval(()=>{b.isPlaying||(M(e=>({...e,isTestPlaying:!1})),D.current&&clearInterval(D.current))},100)},[k,N,b,j.isTestPlaying,v]),H=()=>{m(`/settings/voice`)};(0,w.useEffect)(()=>{let e=E.current,t=D.current,n=O.current;return()=>{e&&clearTimeout(e),t&&clearInterval(t),n&&clearTimeout(n),j.isTestPlaying&&b.stop()}},[j.isTestPlaying,b]);let U=r(`toolbar-bg`),W=r(`toolbar-border`),G=r(`toolbar-shadow`),K=r(`text-primary`),q=r(`border-default`),J=r(`border-subtle`),Y=r(`hover-bg`),X=r(`bg-paper`),Z=r(`bg-default`),Q=r(`primary`);return(0,T.jsxs)(o,{sx:{width:`100vw`,overflow:`hidden`,backgroundColor:Z},children:[(0,T.jsx)(s,{position:`static`,elevation:0,sx:{backgroundColor:U,color:K,borderBottom:`1px solid ${W}`,boxShadow:`0 18px 40px -24px ${G}`,backdropFilter:`blur(18px)`,WebkitBackdropFilter:`blur(18px)`,transition:`background-color 0.3s ease, box-shadow 0.3s ease, border-color 0.3s ease`},children:(0,T.jsxs)(n,{sx:{minHeight:{xs:56,sm:64},px:{xs:1.5,sm:2.5,md:4},gap:{xs:1,sm:1.5}},children:[(0,T.jsx)(t,{edge:`start`,onClick:H,"aria-label":v(`settings.voice.back`),size:`large`,sx:{color:Q,mr:{xs:1,sm:2},borderRadius:2,border:`1px solid ${J}`,transition:`all 0.2s ease`,"&:hover":{backgroundColor:Y,transform:`translateY(-1px)`},"&:focus-visible":{outline:`2px solid ${Q}`,outlineOffset:`2px`}},children:(0,T.jsx)(y,{size:20})}),(0,T.jsx)(_,{variant:`h6`,component:`div`,sx:{flexGrow:1,fontWeight:700,letterSpacing:`0.03em`,textTransform:`uppercase`},children:v(`settings.voice.openai.title`)}),(0,T.jsx)(l,{onClick:z,variant:`contained`,sx:{borderRadius:2,px:{xs:2.5,sm:3},py:{xs:.9,sm:1},fontWeight:700},children:v(`settings.voice.common.save`)})]})}),(0,T.jsx)(u,{sx:{flex:1,overflow:`auto`,pt:2,pb:`var(--content-bottom-padding)`,px:{xs:1.5,sm:2.5,md:4},"&::-webkit-scrollbar":{width:`6px`},"&::-webkit-scrollbar-thumb":{backgroundColor:G,borderRadius:3,border:`1px solid ${J}`}},children:(0,T.jsxs)(u,{sx:{maxWidth:960,mx:`auto`,width:`100%`},children:[j.isSaved&&(0,T.jsx)(i,{severity:`success`,sx:{mb:{xs:1.5,sm:2},borderRadius:{xs:1,sm:2}},children:v(`settings.voice.common.saveSuccess`)}),j.saveError&&(0,T.jsx)(i,{severity:`error`,sx:{mb:{xs:1.5,sm:2},borderRadius:{xs:1,sm:2}},children:j.saveError}),(0,T.jsxs)(e,{elevation:0,sx:{p:{xs:2.5,sm:3},mb:{xs:2,sm:3},borderRadius:{xs:2,sm:2.5},border:`1px solid ${q}`,bgcolor:X,boxShadow:`0 18px 40px -28px ${G}`},children:[(0,T.jsx)(_,{variant:`h6`,sx:{mb:3,fontWeight:600},children:v(`settings.voice.common.apiConfig`)}),(0,T.jsxs)(u,{sx:{mb:3},children:[(0,T.jsx)(a,{control:(0,T.jsx)(h,{checked:L,onChange:e=>B(e.target.checked)}),label:v(`settings.voice.common.enableService`,{name:v(`settings.voice.services.openai.name`)})}),(0,T.jsx)(_,{variant:`body2`,color:`text.secondary`,sx:{mt:1,ml:4},children:v(`settings.voice.openai.enableDesc`)})]}),(0,T.jsx)(g,{sx:{mb:3}}),(0,T.jsx)(S,{settings:k,onSettingsChange:A})]}),(0,T.jsx)(C,{testText:N,setTestText:P,handleTestTTS:V,isTestPlaying:j.isTestPlaying,enableTTS:F,selectedTTSService:`openai`,openaiApiKey:k.apiKey,azureApiKey:``,siliconFlowApiKey:``})]})})]})};export{E as default};