const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["static/js/avatarUtils-CrjhHhMO.js","static/js/avatarUtils-DxBCqGdq.js","static/js/index-hvLbsAjx.js","static/css/index-iKlUzaLt.css","static/js/providerIcons-C3i_yWyD.js"])))=>i.map(i=>d[i]);
import{t as e}from"./InputAdornment-DO0tC8Wv.js";import{t}from"./image-7oImefSY.js";import{t as n}from"./plus-DCrdXXDc.js";import{t as r}from"./zap-Dl5cJHmZ.js";import{$r as i,$t as a,Ad as o,Al as s,Au as c,B as l,Cd as u,Du as d,Ed as f,Ef as p,Eu as m,Gi as h,H as g,Iu as _,Jr as v,Ju as y,Nu as b,Od as x,Pl as S,Qt as ee,Qu as C,Rl as w,Sd as T,U as te,Ud as E,V as ne,Vu as re,Wu as ie,Xl as D,Xu as O,Yr as ae,Zr as oe,Zu as k,_ as se,_u as ce,ad as A,bd as le,cd as ue,ci as j,dd as M,dr as de,fd as N,fu as fe,i as pe,id as P,jp as me,kd as he,kf as ge,ku as F,li as _e,md as ve,mp as ye,nd as I,nu as be,pp as xe,qd as L,qp as Se,s as R,td as Ce,ti as we,tu as Te,vd as z,wd as B,xd as V,xp as Ee,xu as De,zp as Oe,zu as ke}from"./index-hvLbsAjx.js";import{C as Ae,E as je,S as Me,T as Ne,_ as H,a as U,b as Pe,c as W,f as G,g as Fe,i as Ie,k as Le,l as Re,t as ze,u as Be,v as Ve,x as He,y as K}from"./web-DV3rYUP8.js";import{t as Ue}from"./SolidBridge-4JuNrAWl.js";import{n as We,t as q}from"./providerIcons-C3i_yWyD.js";import{t as Ge}from"./AvatarUploader-AJu4Dy7o.js";import{a as Ke,i as qe,n as Je,o as Ye,r as Xe,t as Ze}from"./constants-DDDt18vz.js";var J=Se(Oe(),1),Qe=G(`<svg width=18 height=18 viewBox="0 0 24 24"fill=none stroke=currentColor stroke-width=2><line x1=12 y1=5 x2=12 y2=19></line><line x1=5 y1=12 x2=19 y2=12>`),$e=G(`<svg width=18 height=18 viewBox="0 0 24 24"fill=none stroke=currentColor stroke-width=2><line x1=5 y1=12 x2=19 y2=12>`),et=G(`<img class=model-icon style=border-radius:6px;object-fit:contain>`),tt=G(`<div class=tactile-button>`),nt=G(`<div class=model-groups-list>`),rt=G(`<div class=model-drawer-backdrop><div class=model-drawer><div class=model-drawer-handle><div class=model-drawer-handle-bar></div></div><div class=model-drawer-search><div class=model-search-input-wrapper><svg class=model-search-icon width=20 height=20 viewBox="0 0 24 24"fill=none stroke=currentColor stroke-width=2><circle cx=11 cy=11 r=8></circle><path d="m21 21-4.35-4.35"></path></svg><input type=text class=model-search-input placeholder=搜索模型... autocomplete=off></div></div><div class=model-drawer-content>`),it=G(`<div class=model-drawer-loading><div class=loading-spinner></div><p>加载模型列表中...`),at=G(`<div class=model-drawer-empty><p>`),ot=G(`<div class=model-group-content>`),st=G(`<div class=model-group><div class=model-group-header><div class=model-group-title><svg class=model-group-arrow width=20 height=20 viewBox="0 0 24 24"fill=none stroke=currentColor stroke-width=2><polyline points="9 18 15 12 9 6"></polyline></svg><span></span><span class=model-group-count>(<!>)</span></div><button type=button class=model-group-action-btn>`),ct=G(`<div class=model-item-id>`),lt=G(`<div class=model-item><div class=model-item-info><div class=model-item-name></div></div><button type=button class=model-item-action-btn>`),ut=()=>Qe(),dt=()=>$e();function ft(e){let t=Ne({size:28},e),n=()=>{let e=`${t.modelId}:${t.providerId||``}`;return t.iconCache.get(e)||q(t.modelId,t.providerId||``,t.isDark)};return(()=>{var e=et();return e.addEventListener(`error`,e=>{let n=e.currentTarget;n.src=t.isDark?`/images/providerIcons/dark/custom.png`:`/images/providerIcons/light/custom.png`}),Me(r=>{var i=n(),a=t.modelId,o=`${t.size}px`,s=`${t.size}px`;return i!==r.e&&W(e,`src`,r.e=i),a!==r.t&&W(e,`alt`,r.t=a),o!==r.a&&Re(e,`width`,r.a=o),s!==r.o&&Re(e,`height`,r.o=s),r},{e:void 0,t:void 0,a:void 0,o:void 0}),e})()}function pt(e){let[t,n]=Le(e,[`children`,`class`]),[r,i]=Ae(!1);return(()=>{var e=tt();return e.addEventListener(`mouseleave`,()=>i(!1)),e.$$mouseup=()=>i(!1),e.$$mousedown=()=>i(!0),Be(e,Ne({get classList(){return{pressed:r(),[t.class||``]:!!t.class}}},n),!1,!0),U(e,()=>t.children),e})()}function mt(e){let[t,n]=Le(e,[`open`,`provider`,`models`,`loading`,`existingModels`,`themeMode`]),[r,a]=Ae(``),[o,s]=Ae(new Set),[c,l]=Ae(new Set),u=He(()=>{let e=new Set;return t.existingModels.forEach(n=>{we(n,{id:n.id,provider:t.provider?.id},t.provider?.id)&&e.add(n.id)}),o().forEach(t=>e.add(t)),e}),d=e=>u().has(e),f=He(()=>{let e=t.themeMode===`dark`,n=new Map;return t.models.forEach(r=>{let i=`${r.id}:${t.provider?.id||``}`;n.has(i)||n.set(i,q(r.id,t.provider?.id||``,e))}),n}),p=()=>t.themeMode===`dark`,m=He(()=>{let e=r().toLowerCase(),n={};return t.models.forEach(r=>{let a=r.name||r.id;if(!e||a.toLowerCase().includes(e)||r.id.toLowerCase().includes(e)){let e=r.group||i(r.id,t.provider?.id);n[e]||(n[e]=[]),n[e].push(r)}}),n}),h=He(()=>Object.keys(m()).sort((e,t)=>e===`Embeddings`?-1:t===`Embeddings`||e===`其他模型`?1:t===`其他模型`?-1:e.localeCompare(t))),g=e=>{let t=e.id;d(t)||Ve(()=>{s(e=>{let n=new Set(e);return n.add(t),n}),n.onAddModel(e)})},_=e=>{Ve(()=>{s(t=>{let n=new Set(t);return n.delete(e),n}),n.onRemoveModel(e)})},v=e=>{let t=(m()[e]||[]).filter(e=>!d(e.id));t.length>0&&Ve(()=>{s(e=>new Set([...e,...t.map(e=>e.id)])),n.onAddModels?n.onAddModels(t.map(e=>({...e}))):t.forEach(e=>n.onAddModel({...e}))})},y=e=>{let t=(m()[e]||[]).filter(e=>d(e.id));t.length>0&&Ve(()=>{s(e=>{let n=new Set(e);return t.forEach(e=>n.delete(e.id)),n}),n.onRemoveModels?n.onRemoveModels(t.map(e=>e.id)):t.forEach(e=>n.onRemoveModel(e.id))})},b=e=>{l(t=>{let n=new Set(t);return n.has(e)?n.delete(e):n.add(e),n})},x=e=>{let t=m()[e]||[];return t.length>0&&t.every(e=>d(e.id))};Pe(je(()=>t.open,e=>{e||(a(``),s(new Set))}));let S=e=>{e.target.classList.contains(`model-drawer-backdrop`)&&n.onClose()},ee=(e,t)=>{t.stopPropagation(),t.preventDefault(),d(e.id)?_(e.id):g(e)},C=(e,t)=>{t.stopPropagation(),t.preventDefault(),x(e)?y(e):v(e)},w=(e,t)=>{t.stopPropagation(),b(e)};return K(H,{get when(){return t.open},get children(){return K(ze,{get children(){var e=rt(),n=e.firstChild.firstChild.nextSibling,i=n.firstChild.firstChild.nextSibling,o=n.nextSibling;return e.$$click=S,i.$$input=e=>a(e.currentTarget.value),W(i,`spellcheck`,!1),U(o,K(H,{get when(){return!t.loading},get fallback(){return it()},get children(){return K(H,{get when(){return h().length>0},get fallback(){return(()=>{var e=at(),t=e.firstChild;return U(t,()=>r()?`未找到匹配的模型`:`暂无可用模型`),e})()},get children(){var e=nt();return U(e,K(Fe,{get each(){return h()},children:e=>{let n=m()[e]||[],r=()=>c().has(e),i=()=>x(e);return(()=>{var a=st(),o=a.firstChild,s=o.firstChild,c=s.firstChild,l=c.nextSibling,u=l.nextSibling,m=u.firstChild.nextSibling;m.nextSibling;var h=s.nextSibling;return o.$$click=w,o.$$clickData=e,U(l,e),U(u,()=>n.length,m),h.$$click=C,h.$$clickData=e,U(h,K(H,{get when(){return i()},get fallback(){return K(ut,{})},get children(){return K(dt,{})}})),U(a,K(H,{get when(){return r()},get children(){var e=ot();return U(e,K(Fe,{each:n,children:e=>{let n=()=>d(e.id);return K(pt,{class:`model-item-wrapper`,get children(){var r=lt(),i=r.firstChild,a=i.firstChild,o=i.nextSibling;return U(r,K(ft,{get modelId(){return e.id},get providerId(){return t.provider?.id},get isDark(){return p()},size:28,get iconCache(){return f()}}),i),U(a,()=>e.name||e.id),U(i,K(H,{get when(){return e.id!==e.name},get children(){var t=ct();return U(t,()=>e.id),t}}),null),o.$$click=ee,o.$$clickData=e,U(o,K(H,{get when(){return n()},get fallback(){return K(ut,{})},get children(){return K(dt,{})}})),Me(e=>{var t=!!n(),r=!n();return t!==e.e&&o.classList.toggle(`action-remove`,e.e=t),r!==e.t&&o.classList.toggle(`action-add`,e.t=r),e},{e:void 0,t:void 0}),r}})}})),e}}),null),Me(e=>{var t=!!r(),n=!!i(),a=!i(),o=i()?`移除整组`:`添加整组`;return t!==e.e&&c.classList.toggle(`expanded`,e.e=t),n!==e.t&&h.classList.toggle(`action-remove`,e.t=n),a!==e.a&&h.classList.toggle(`action-add`,e.a=a),o!==e.o&&W(h,`title`,e.o=o),e},{e:void 0,t:void 0,a:void 0,o:void 0}),a})()}})),e}})}})),Me(()=>i.value=r()),e}})}})}Ie([`mousedown`,`mouseup`,`click`,`input`]);var Y=Se(Ee(),1),ht=({open:e,onClose:t,provider:n,onAddModel:r,onAddModels:i,onRemoveModel:a,onRemoveModels:o,existingModels:s})=>{let c=E(),[l,u]=(0,J.useState)(!1),[d,f]=(0,J.useState)([]),p=(0,J.useRef)(null),m=async()=>{try{u(!0),f(await ne(p.current||n))}catch(e){console.error(`加载模型失败:`,e),f([])}finally{u(!1)}};(0,J.useEffect)(()=>{e&&n&&(!p.current||p.current.id!==n.id)&&(p.current=n,m())},[e,n]);let h=(0,J.useMemo)(()=>c.palette.mode,[c.palette.mode]);return(0,J.useEffect)(()=>{if(e){let e=document.documentElement;e.style.setProperty(`--theme-bg-paper`,c.palette.background.paper),e.style.setProperty(`--theme-bg-default`,c.palette.background.default),e.style.setProperty(`--theme-text-primary`,c.palette.text.primary),e.style.setProperty(`--theme-text-secondary`,c.palette.text.secondary),e.style.setProperty(`--theme-primary`,c.palette.primary.main),e.style.setProperty(`--theme-success`,c.palette.success.main),e.style.setProperty(`--theme-error`,c.palette.error.main),e.style.setProperty(`--theme-border-default`,L(c.palette.text.primary,.12)),e.style.setProperty(`--theme-hover-bg`,L(c.palette.text.primary,.04)),e.style.setProperty(`--theme-active-bg`,L(c.palette.text.primary,.08)),e.style.setProperty(`--theme-success-bg`,L(c.palette.success.main,.12)),e.style.setProperty(`--theme-error-bg`,L(c.palette.error.main,.12)),e.style.setProperty(`--theme-success-hover`,L(c.palette.success.main,.2)),e.style.setProperty(`--theme-error-hover`,L(c.palette.error.main,.2))}},[e,c]),(0,Y.jsx)(Ue,{component:mt,props:{open:e,onClose:t,provider:n,models:d,loading:l,existingModels:s,onAddModel:r,onAddModels:i,onRemoveModel:a,onRemoveModels:o,themeMode:h},debugName:`ModelManagementDrawer`,debug:!1,onError:e=>{console.error(`[ModelManagementDialog] SolidJS 组件错误:`,e)}})};const gt=[{pattern:`VL|vision|visual|image`,types:[g.Vision,g.Chat]},{pattern:`gpt-4-vision|gpt-4v`,types:[g.Vision,g.Chat],provider:`openai`},{pattern:`gpt-4o`,types:[g.Vision,g.Chat,g.FunctionCalling,g.WebSearch],provider:`openai`},{pattern:`gemini-(pro|ultra)-vision`,types:[g.Vision,g.Chat],provider:`google`},{pattern:`claude-3-(opus|sonnet|haiku)`,types:[g.Vision,g.Chat,g.FunctionCalling],provider:`anthropic`},{pattern:`qwen.*vl`,types:[g.Vision,g.Chat],provider:`siliconflow`},{pattern:`FLUX|flux|black-forest|stable-diffusion|sd|dalle|midjourney`,types:[g.ImageGen]},{pattern:`image|img|picture|generate`,types:[g.ImageGen]},{pattern:`HunyuanVideo|Wan.*T2V|Wan.*I2V|video.*gen|video.*generation`,types:[g.VideoGen]},{pattern:`video|movie|film|motion`,types:[g.VideoGen]},{pattern:`embedding|text-embedding|embeddings`,types:[g.Embedding]},{pattern:`text-embedding-.*|embedding-.*`,types:[g.Embedding],provider:`openai`},{pattern:`.*-embedding-.*`,types:[g.Embedding],provider:`google`},{pattern:`tts|whisper|audio|speech`,types:[g.Audio,g.Transcription]},{pattern:`tool|function|plugin`,types:[g.Tool,g.Chat,g.FunctionCalling]},{pattern:`function.*calling|function-calling`,types:[g.FunctionCalling,g.Chat]},{pattern:`gpt-4-turbo|gpt-3.5-turbo`,types:[g.Chat,g.FunctionCalling],provider:`openai`},{pattern:`web.*search|search|browse`,types:[g.WebSearch,g.Chat]},{pattern:`gpt-4-turbo-search|gpt-4o-search`,types:[g.WebSearch,g.Chat],provider:`openai`},{pattern:`rerank|rank`,types:[g.Rerank]},{pattern:`code|codex|coder|copilot|starcoder|codellama`,types:[g.CodeGen,g.Chat]},{pattern:`translate|translation`,types:[g.Translation,g.Chat]},{pattern:`reasoning|think|coder|math`,types:[g.Reasoning,g.Chat]},{pattern:`.*-thinking-.*`,types:[g.Reasoning,g.Chat]},{pattern:`deepseek-reasoner|deepseek-r1`,types:[g.Reasoning,g.Chat],provider:`deepseek`},{pattern:`.*`,types:[g.Chat]}];function _t(e,t,n=gt){for(let r of n)if(!(r.provider&&r.provider!==t))try{if(new RegExp(r.pattern,`i`).test(e))return r.types}catch{if(e.toLowerCase().includes(r.pattern.toLowerCase()))return r.types}return[g.Chat]}function vt(e){return{[g.Chat]:`聊天`,[g.Vision]:`视觉`,[g.Audio]:`语音`,[g.Embedding]:`嵌入向量`,[g.Tool]:`工具使用`,[g.Reasoning]:`推理`,[g.ImageGen]:`图像生成`,[g.VideoGen]:`视频生成`,[g.FunctionCalling]:`函数调用`,[g.WebSearch]:`网络搜索`,[g.Rerank]:`重排序`,[g.CodeGen]:`代码生成`,[g.Translation]:`翻译`,[g.Transcription]:`转录`}[e]||e}var yt=({open:e,onClose:t,rules:r,onSave:i,modelId:a,provider:o})=>{let[c,l]=(0,J.useState)([]),[d,f]=(0,J.useState)({pattern:``,types:[g.Chat]}),[p,_]=(0,J.useState)([]),[v,y]=(0,J.useState)(!1);(0,J.useEffect)(()=>{e&&(l(r||[]),y(!1))},[e,r]);let b=(e,t,n)=>{let r=[...c];t===`types`?r[e]={...r[e],types:n}:r[e]={...r[e],[t]:n},l(r)},x=(e,t)=>{f(e===`types`?{...d,types:t}:{...d,[e]:t})},S=()=>{if(d.pattern.trim()!==``){if(d.types.length===0){f({...d,types:[g.Chat]});return}l([...c,d]),f({pattern:``,types:[g.Chat]})}},ee=e=>{let t=[...c];t.splice(e,1),l(t)},C=()=>{a&&o&&_(_t(a,o,c))},w=(e,t,n)=>{let r=[...c[e].types];n?r.includes(t)||r.push(t):(r=r.filter(e=>e!==t),r.length===0&&(r=[g.Chat])),b(e,`types`,r)},te=(e,t)=>{let n=[...d.types];t?n.includes(e)||n.push(e):(n=n.filter(t=>t!==e),n.length===0&&(n=[g.Chat])),x(`types`,n)};return(0,Y.jsxs)(h,{open:e,onClose:t,maxWidth:`md`,fullWidth:!0,children:[(0,Y.jsx)(I,{children:(0,Y.jsxs)(N,{display:`flex`,justifyContent:`space-between`,alignItems:`center`,children:[(0,Y.jsx)(V,{variant:`h6`,children:`模型类型管理`}),(0,Y.jsx)(M,{color:v?`primary`:`secondary`,onClick:()=>{y(!v)},children:v?`完成编辑`:`编辑规则`})]})}),(0,Y.jsx)(P,{children:v?(0,Y.jsxs)(N,{children:[(0,Y.jsx)(V,{variant:`subtitle1`,gutterBottom:!0,children:`编辑模型类型匹配规则`}),(0,Y.jsx)(V,{variant:`body2`,color:`textSecondary`,sx:{mb:2},children:`规则按顺序匹配，第一条匹配成功的规则将被应用。`}),(0,Y.jsx)(N,{sx:{mb:3},children:c.map((e,t)=>(0,Y.jsxs)(N,{sx:{p:2,mb:2,border:`1px solid #e0e0e0`,borderRadius:1,backgroundColor:`#f9f9f9`},children:[(0,Y.jsxs)(N,{display:`flex`,justifyContent:`space-between`,alignItems:`center`,children:[(0,Y.jsx)(N,{children:(0,Y.jsx)(m,{fullWidth:!0,label:`匹配模式`,value:e.pattern,onChange:e=>b(t,`pattern`,e.target.value),helperText:`支持正则表达式或简单字符串`,size:`small`})}),(0,Y.jsx)(u,{color:`error`,onClick:()=>ee(t),children:(0,Y.jsx)(s,{})})]}),(0,Y.jsxs)(N,{display:`flex`,justifyContent:`space-between`,alignItems:`center`,sx:{mt:1},children:[(0,Y.jsx)(N,{children:(0,Y.jsx)(m,{fullWidth:!0,label:`提供商限制（可选）`,value:e.provider||``,onChange:e=>b(t,`provider`,e.target.value||void 0),placeholder:`例如: openai, google`,size:`small`})}),(0,Y.jsx)(N,{sx:{display:`flex`,flexWrap:`wrap`,gap:1},children:Object.values(g).map(n=>(0,Y.jsx)(k,{control:(0,Y.jsx)(ue,{checked:e.types.includes(n),onChange:e=>w(t,n,e.target.checked),size:`small`}),label:vt(n)},n))})]})]},t))}),(0,Y.jsxs)(N,{sx:{p:2,mb:2,border:`1px dashed #a0a0a0`,borderRadius:1},children:[(0,Y.jsx)(V,{variant:`subtitle2`,gutterBottom:!0,children:`添加新规则`}),(0,Y.jsxs)(N,{display:`flex`,justifyContent:`space-between`,alignItems:`center`,children:[(0,Y.jsx)(N,{children:(0,Y.jsx)(m,{fullWidth:!0,label:`匹配模式`,value:d.pattern,onChange:e=>x(`pattern`,e.target.value),helperText:`支持正则表达式或简单字符串`,size:`small`})}),(0,Y.jsx)(u,{color:`primary`,onClick:S,children:(0,Y.jsx)(n,{})})]}),(0,Y.jsxs)(N,{display:`flex`,justifyContent:`space-between`,alignItems:`center`,sx:{mt:1},children:[(0,Y.jsx)(N,{children:(0,Y.jsx)(m,{fullWidth:!0,label:`提供商限制（可选）`,value:d.provider||``,onChange:e=>x(`provider`,e.target.value||void 0),placeholder:`例如: openai, google`,size:`small`})}),(0,Y.jsx)(N,{sx:{display:`flex`,flexWrap:`wrap`,gap:1},children:Object.values(g).map(e=>(0,Y.jsx)(k,{control:(0,Y.jsx)(ue,{checked:d.types.includes(e),onChange:t=>te(e,t.target.checked),size:`small`}),label:vt(e)},e))})]})]})]}):(0,Y.jsxs)(N,{children:[(0,Y.jsx)(V,{variant:`subtitle1`,gutterBottom:!0,children:`当前模型类型匹配规则`}),c.length>0?c.map((e,t)=>(0,Y.jsxs)(N,{sx:{p:2,mb:2,border:`1px solid #e0e0e0`,borderRadius:1,backgroundColor:`#f9f9f9`},children:[(0,Y.jsxs)(N,{display:`flex`,justifyContent:`space-between`,alignItems:`center`,children:[(0,Y.jsxs)(N,{children:[(0,Y.jsxs)(V,{variant:`body2`,children:[(0,Y.jsx)(`strong`,{children:`匹配模式:`}),` `,e.pattern]}),e.provider&&(0,Y.jsxs)(V,{variant:`body2`,children:[(0,Y.jsx)(`strong`,{children:`提供商:`}),` `,e.provider]})]}),(0,Y.jsx)(u,{color:`error`,onClick:()=>ee(t),children:(0,Y.jsx)(s,{})})]}),(0,Y.jsxs)(N,{display:`flex`,justifyContent:`space-between`,alignItems:`center`,sx:{mt:1},children:[(0,Y.jsx)(N,{children:(0,Y.jsx)(V,{variant:`body2`,sx:{mb:1},children:(0,Y.jsx)(`strong`,{children:`适用类型:`})})}),(0,Y.jsx)(N,{sx:{display:`flex`,flexWrap:`wrap`,gap:.5},children:e.types.map(e=>(0,Y.jsx)(z,{label:vt(e),size:`small`,sx:{mr:.5,mb:.5}},e))})]})]},t)):(0,Y.jsx)(T,{severity:`info`,sx:{mt:2},children:`尚未配置任何类型匹配规则，将使用默认规则。`}),a&&o&&(0,Y.jsxs)(N,{sx:{mt:4,p:2,border:`1px solid #e0e0e0`,borderRadius:1},children:[(0,Y.jsx)(V,{variant:`subtitle2`,gutterBottom:!0,children:`测试模型类型匹配`}),(0,Y.jsxs)(N,{display:`flex`,justifyContent:`space-between`,alignItems:`center`,mb:2,children:[(0,Y.jsxs)(V,{variant:`body2`,sx:{mr:1},children:[(0,Y.jsx)(`strong`,{children:`模型ID:`}),` `,a]}),(0,Y.jsxs)(V,{variant:`body2`,children:[(0,Y.jsx)(`strong`,{children:`提供商:`}),` `,o]})]}),(0,Y.jsx)(M,{variant:`outlined`,color:`primary`,onClick:C,size:`small`,children:`测试匹配`}),p.length>0&&(0,Y.jsxs)(N,{sx:{mt:2},children:[(0,Y.jsx)(V,{variant:`body2`,children:`匹配结果:`}),(0,Y.jsx)(N,{display:`flex`,flexWrap:`wrap`,gap:.5,sx:{mt:1},children:p.map(e=>(0,Y.jsx)(z,{label:vt(e),color:`primary`,size:`small`,sx:{mr:.5,mb:.5}},e))})]})]})]})}),(0,Y.jsxs)(A,{children:[(0,Y.jsx)(M,{onClick:t,children:`取消`}),(0,Y.jsx)(M,{onClick:()=>{i(c),t()},variant:`contained`,color:`primary`,children:`保存`})]})]})},bt={basic:[`chat`],input:[`vision`,`audio`],output:[`image_gen`,`video_gen`,`transcription`,`translation`],advanced:[`reasoning`,`function_calling`,`web_search`,`tool`,`code_gen`],data:[`embedding`,`rerank`]},xt={chat:{description:`基础聊天功能，支持文本对话`,color:`#4285F4`},vision:{description:`支持图像理解和分析`,color:`#EA4335`},audio:{description:`支持音频处理和理解`,color:`#FBBC05`},embedding:{description:`生成文本的向量表示，用于相似度搜索`,color:`#34A853`},tool:{description:`支持使用外部工具和API`,color:`#8E44AD`},reasoning:{description:`增强的推理能力，适合复杂问题解决`,color:`#1ABC9C`},image_gen:{description:`生成图像的能力`,color:`#E74C3C`},function_calling:{description:`支持函数调用，可与代码交互`,color:`#3498DB`},web_search:{description:`支持网络搜索，获取实时信息`,color:`#F39C12`},rerank:{description:`重新排序搜索结果或文档`,color:`#16A085`},code_gen:{description:`代码生成和编程辅助`,color:`#2C3E50`},translation:{description:`文本翻译功能`,color:`#27AE60`},transcription:{description:`语音转文字功能`,color:`#D35400`},video_gen:{description:`视频生成功能`,color:`#8E44AD`}},St=({modelTypes:e,onChange:t,autoDetect:n,onAutoDetectChange:r,modelId:i,provider:a})=>{let s=E(),[c,l]=(0,J.useState)(!1),[d,f]=(0,J.useState)([]);(0,J.useEffect)(()=>{(async()=>{try{f(await p.getSetting(`modelTypeRules`)||gt)}catch(e){console.error(`[EnhancedModelTypeSelector] 加载模型类型规则失败:`,e),f(gt)}})()},[]);let m=r=>{if(!n){let n=[...e],i=n.indexOf(r);i===-1?n.push(r):n.splice(i,1),n.length===0&&n.push(g.Chat),t(n)}},h=()=>{l(!0)},_=async e=>{f(e);try{await p.saveSetting(`modelTypeRules`,e),console.log(`[EnhancedModelTypeSelector] 模型类型规则已保存`)}catch(e){console.error(`[EnhancedModelTypeSelector] 保存模型类型规则失败:`,e)}},v=()=>Object.entries(bt).map(([t,r])=>(0,Y.jsxs)(N,{sx:{mb:2},children:[(0,Y.jsx)(V,{variant:`subtitle2`,sx:{mb:1,color:`text.secondary`,fontSize:`0.8rem`,textTransform:`uppercase`},children:y(t)}),(0,Y.jsx)(N,{sx:{display:`flex`,flexWrap:`wrap`,gap:1},children:r.map(t=>{let r=t,i=xt[r]||{description:``,color:s.palette.primary.main};return(0,Y.jsx)(F,{title:i.description,arrow:!0,placement:`top`,children:(0,Y.jsx)(z,{label:vt(r),color:e.includes(r)?`primary`:`default`,onClick:()=>!n&&m(r),sx:{mr:.5,mb:.5,bgcolor:e.includes(r)?L(i.color,.2):`default`,color:e.includes(r)?i.color:`text.secondary`,borderColor:e.includes(r)?i.color:`divider`,"&:hover":{bgcolor:e.includes(r)?L(i.color,.3):L(s.palette.action.hover,.1)}},disabled:n,variant:e.includes(r)?`filled`:`outlined`})},r)})})]},t)),y=e=>({basic:`基础功能`,input:`输入能力`,output:`输出能力`,advanced:`高级功能`,data:`数据处理`})[e]||e;return(0,Y.jsxs)(N,{sx:{mt:3},children:[(0,Y.jsxs)(N,{sx:{display:`flex`,alignItems:`center`,justifyContent:`space-between`,mb:1},children:[(0,Y.jsxs)(N,{sx:{display:`flex`,alignItems:`center`},children:[(0,Y.jsx)(V,{variant:`subtitle2`,children:`模型类型`}),(0,Y.jsx)(F,{title:`模型类型决定了模型的能力和适用场景。您可以根据需要选择多种类型。`,children:(0,Y.jsx)(u,{size:`small`,sx:{ml:.5},children:(0,Y.jsx)(D,{fontSize:`small`})})})]}),(0,Y.jsxs)(N,{sx:{display:`flex`,alignItems:`center`},children:[(0,Y.jsx)(k,{control:(0,Y.jsx)(R,{checked:n,onChange:e=>r(e.target.checked)}),label:`自动检测`}),(0,Y.jsx)(F,{title:`管理模型类型规则`,children:(0,Y.jsx)(u,{size:`small`,onClick:h,sx:{ml:1},children:(0,Y.jsx)(w,{fontSize:`small`})})})]})]}),(0,Y.jsx)(o,{elevation:0,sx:{p:2,borderRadius:2,border:`1px solid`,borderColor:`divider`,bgcolor:s.palette.mode===`dark`?L(s.palette.background.paper,.6):L(s.palette.background.paper,.8)},children:v()}),(0,Y.jsx)(O,{children:n?`根据模型ID和提供商自动检测模型类型`:`点击类型标签来添加或移除`}),(0,Y.jsx)(yt,{open:c,onClose:()=>l(!1),rules:d,onSave:_,modelId:i,provider:a})]})},Ct=({open:e,onClose:n,onSave:r,editModel:i})=>{let[a,o]=(0,J.useState)({id:``,name:``,provider:`openai`,enabled:!0,isDefault:!1}),[s,c]=(0,J.useState)({}),[l,d]=(0,J.useState)([g.Chat]),[f,v]=(0,J.useState)(!0),[x,S]=(0,J.useState)(``),[ee,w]=(0,J.useState)(!1);(0,J.useEffect)(()=>{i&&(o(i),i.modelTypes?(d(i.modelTypes),v(!1)):(d(_t(i.id,i.provider)),v(!0)),(async()=>{try{let e=await p.getModel(i.id);e?.avatar&&S(e.avatar)}catch(e){console.error(`[SimpleModelDialog] 加载模型头像失败:`,e)}})())},[i,e]);let T=(e,t)=>{if(o({...a,[e]:t}),(e===`id`||e===`provider`)&&f){let n={...a,[e]:t};d(_t(n.id,n.provider))}s[e]&&c({...s,[e]:``})},te=()=>{let e=!f;v(e),e&&d(_t(a.id,a.provider))},E=()=>{w(!0)},ne=()=>{w(!1)},re=async e=>{if(S(e),a.id)try{let{saveModelAvatar:t}=await me(async()=>{let{saveModelAvatar:e}=await import(`./avatarUtils-CrjhHhMO.js`);return{saveModelAvatar:e}},__vite__mapDeps([0,1,2,3,4]));await t(a.id,e),console.log(`[SimpleModelDialog] 模型头像已保存: ${a.id}`)}catch(e){console.error(`[SimpleModelDialog] 保存模型头像失败:`,e)}},ie=()=>{let e={};return a.name.trim()||(e.name=`请输入模型名称`),c(e),Object.keys(e).length===0},D=async()=>{if(ie()){let e={...a,modelTypes:f?void 0:l,capabilities:{...a.capabilities,multimodal:l.includes(g.Vision)}};if(i&&i.id!==a.id&&x)try{await p.saveModel(a.id,{id:a.id,avatar:x,updatedAt:new Date().toISOString()})}catch(e){console.error(`[SimpleModelDialog] 保存模型头像到数据库失败:`,e)}try{let t={...e,avatar:x,updatedAt:new Date().toISOString()};await p.saveModel(e.id,t),console.log(`[SimpleModelDialog] 模型配置已保存到数据库: ${e.id}`)}catch(e){console.error(`[SimpleModelDialog] 保存模型配置到数据库失败:`,e)}r(e),n()}};return(0,Y.jsxs)(h,{open:e,onClose:n,maxWidth:`sm`,fullWidth:!0,children:[(0,Y.jsx)(I,{children:i?`编辑模型`:`添加模型`}),(0,Y.jsxs)(P,{children:[(0,Y.jsxs)(N,{sx:{mb:3,mt:1},children:[(0,Y.jsxs)(N,{sx:{display:`flex`,alignItems:`center`,justifyContent:`space-between`,mb:2,p:2,bgcolor:`rgba(25, 118, 210, 0.08)`,borderRadius:1,border:`1px solid rgba(25, 118, 210, 0.2)`},children:[(0,Y.jsxs)(N,{sx:{display:`flex`,alignItems:`center`},children:[(0,Y.jsx)(ve,{src:x,sx:{width:48,height:48,mr:2,bgcolor:`#1677ff`},children:!x&&a.name.charAt(0)}),(0,Y.jsxs)(N,{children:[(0,Y.jsx)(V,{variant:`body2`,fontWeight:`medium`,children:`模型头像`}),(0,Y.jsx)(V,{variant:`caption`,color:`text.secondary`,children:`为此模型设置自定义头像`})]})]}),(0,Y.jsx)(F,{title:`设置头像`,children:(0,Y.jsx)(u,{color:`primary`,onClick:E,size:`small`,sx:{bgcolor:`rgba(25, 118, 210, 0.12)`,"&:hover":{bgcolor:`rgba(25, 118, 210, 0.2)`}},children:(0,Y.jsx)(t,{})})})]}),(0,Y.jsx)(m,{fullWidth:!0,label:`模型名称`,value:a.name,onChange:e=>T(`name`,e.target.value),margin:`normal`,error:!!s.name,helperText:s.name,required:!0}),(0,Y.jsxs)(C,{fullWidth:!0,margin:`normal`,children:[(0,Y.jsx)(y,{id:`provider-label`,children:`提供商`}),(0,Y.jsxs)(b,{labelId:`provider-label`,value:a.provider,onChange:e=>T(`provider`,e.target.value),label:`提供商`,children:[oe().filter(e=>!e.isSystem).map(e=>(0,Y.jsx)(_,{value:e.id,children:e.name},e.id)),(0,Y.jsx)(_,{value:`custom`,children:`自定义`})]}),(0,Y.jsx)(O,{children:`选择API提供商，可以与模型ID自由组合`})]}),(0,Y.jsx)(m,{fullWidth:!0,label:`模型ID`,value:a.id,onChange:e=>T(`id`,e.target.value),margin:`normal`,helperText:`模型的唯一标识符，例如：gpt-4、claude-3-opus`}),(0,Y.jsx)(St,{modelTypes:l,onChange:d,autoDetect:f,onAutoDetectChange:te,modelId:a.id,provider:a.provider})]}),(0,Y.jsx)(Ge,{open:ee,onClose:ne,onSave:re,currentAvatar:x,title:`设置模型头像`})]}),(0,Y.jsxs)(A,{children:[(0,Y.jsx)(M,{onClick:n,children:`取消`}),(0,Y.jsx)(M,{onClick:D,variant:`contained`,color:`primary`,children:`保存`})]})]})},wt=(0,J.memo)(({model:e})=>{let t=E();return(0,Y.jsx)(N,{sx:{display:`flex`,alignItems:`center`,justifyContent:`space-between`,width:`100%`,py:1,px:1.5,borderRadius:1,"&:hover":{bgcolor:L(t.palette.primary.main,.05)}},children:(0,Y.jsx)(N,{sx:{display:`flex`,alignItems:`center`,flex:1,gap:1.5},children:(0,Y.jsx)(V,{variant:`body2`,sx:{fontWeight:500},children:e.name||e.id})})})});wt.displayName=`DefaultModelItem`;function Tt({modelGroups:e,showEmptyState:t=!0,emptyStateKey:n=`models.no_models`,renderModelItem:r=(e,t)=>(0,Y.jsx)(wt,{model:e,index:t}),renderGroupButton:i,defaultExpanded:a=[],onExpansionChange:o}){let s=E(),[c,l]=J.useState(new Set(a)),u=J.useCallback(e=>{l(t=>{let n=new Set(t),r=t.has(e);return r?n.delete(e):n.add(e),o?.(e,!r),n})},[o]);return t&&e.length===0?(0,Y.jsx)(N,{sx:{display:`flex`,justifyContent:`center`,alignItems:`center`,py:4,minHeight:80},children:(0,Y.jsx)(V,{variant:`body2`,color:`text.secondary`,children:n})}):(0,Y.jsx)(N,{sx:{width:`100%`,px:0},children:e.map(([e,t])=>(0,Y.jsxs)(he,{expanded:c.has(e),onChange:()=>u(e),disableGutters:!0,TransitionProps:{timeout:200,unmountOnExit:!0},sx:{mb:{xs:2.5,sm:2},boxShadow:`none`,border:`1px solid`,borderColor:`divider`,borderRadius:2,bgcolor:`background.paper`,"&:before":{display:`none`},"&.Mui-expanded":{margin:{xs:`0 0 20px 0`,sm:`0 0 16px 0`}}},children:[(0,Y.jsxs)(N,{sx:{position:`relative`},children:[(0,Y.jsx)(f,{expandIcon:(0,Y.jsx)(ce,{size:20}),sx:{minHeight:{xs:56,sm:48},px:{xs:2.5,sm:2},py:{xs:1.5,sm:1},pr:i?{xs:6,sm:5}:{xs:2.5,sm:2},"& .MuiAccordionSummary-content":{margin:0,display:`flex`,alignItems:`center`,flex:1},"& .MuiAccordionSummary-expandIconWrapper":{transition:`transform 0.2s ease`},"& .MuiAccordionSummary-expandIconWrapper.Mui-expanded":{transform:`rotate(180deg)`}},children:(0,Y.jsxs)(N,{sx:{display:`flex`,alignItems:`center`,gap:{xs:2,sm:1.5},flex:1},children:[(0,Y.jsx)(V,{variant:`subtitle2`,sx:{fontWeight:600,fontSize:{xs:`0.95rem`,sm:`0.875rem`}},children:e}),(0,Y.jsx)(z,{label:t.length,size:`small`,sx:{height:{xs:24,sm:20},fontSize:{xs:`0.75rem`,sm:`0.7rem`},fontWeight:600,bgcolor:L(s.palette.success.main,.12),color:`success.main`,"& .MuiChip-label":{px:{xs:1.5,sm:1}}}})]})}),i&&(0,Y.jsx)(N,{onClick:e=>e.stopPropagation(),sx:{position:`absolute`,right:{xs:2.5,sm:2},top:`50%`,transform:`translateY(-50%)`,zIndex:1},children:i(e,t)})]}),(0,Y.jsx)(x,{sx:{px:0,pt:{xs:1,sm:.75},pb:{xs:1.5,sm:1.25},display:`flex`,flexDirection:`column`,gap:{xs:1.25,sm:.75},willChange:`height, opacity`,transform:`translateZ(0)`},children:t.map((e,t)=>(0,Y.jsx)(J.Fragment,{children:r(e,t)},e.id||t))})]},e))})}const Et=({open:e,onClose:t,newModelName:n,newModelValue:r,onModelNameChange:i,onModelValueChange:a,onAddModel:o})=>{let{t:s}=j();return(0,Y.jsxs)(h,{open:e,onClose:t,children:[(0,Y.jsx)(I,{sx:{fontWeight:600},children:s(`modelSettings.dialogs.addModel.title`)}),(0,Y.jsxs)(P,{children:[(0,Y.jsx)(m,{autoFocus:!0,margin:`dense`,label:s(`modelSettings.dialogs.addModel.modelName`),placeholder:s(`modelSettings.dialogs.addModel.modelNamePlaceholder`),type:`text`,fullWidth:!0,variant:`outlined`,value:n,onChange:e=>i(e.target.value),sx:{mb:2,mt:2}}),(0,Y.jsx)(m,{margin:`dense`,label:s(`modelSettings.dialogs.addModel.modelId`),placeholder:s(`modelSettings.dialogs.addModel.modelIdPlaceholder`),type:`text`,fullWidth:!0,variant:`outlined`,value:r,onChange:e=>a(e.target.value)})]}),(0,Y.jsxs)(A,{sx:{p:2},children:[(0,Y.jsx)(M,{onClick:t,children:s(`common.cancel`)}),(0,Y.jsx)(M,{onClick:o,disabled:!n||!r,sx:{bgcolor:e=>L(e.palette.primary.main,.1),color:`primary.main`,"&:hover":{bgcolor:e=>L(e.palette.primary.main,.2)},borderRadius:2},children:s(`modelSettings.dialogs.addModel.add`)})]})]})},Dt=({open:e,onClose:t,providerName:n,onDelete:r})=>{let{t:i}=j();return(0,Y.jsxs)(h,{open:e,onClose:t,children:[(0,Y.jsx)(I,{fontWeight:600,children:i(`modelSettings.dialogs.deleteProvider.title`)}),(0,Y.jsx)(P,{children:(0,Y.jsx)(V,{children:i(`modelSettings.dialogs.deleteProvider.message`,{name:n}).split(`<bold>`).map((e,t)=>{if(t===0)return e;let[n,...r]=e.split(`</bold>`);return(0,Y.jsxs)(J.Fragment,{children:[(0,Y.jsx)(`b`,{children:n}),r.join(`</bold>`)]},t)})})}),(0,Y.jsxs)(A,{sx:{p:2},children:[(0,Y.jsx)(M,{onClick:t,children:i(`common.cancel`)}),(0,Y.jsx)(M,{onClick:r,color:`error`,sx:{bgcolor:e=>L(e.palette.error.main,.1),"&:hover":{bgcolor:e=>L(e.palette.error.main,.2)},borderRadius:2},children:i(`common.delete`)})]})]})},Ot=({open:e,onClose:t,providerName:n,providerType:r,onProviderNameChange:i,onProviderTypeChange:a,onSave:o})=>{let{t:s}=j();return(0,Y.jsxs)(h,{open:e,onClose:t,children:[(0,Y.jsx)(I,{sx:{fontWeight:600},children:s(`modelSettings.dialogs.editProvider.title`)}),(0,Y.jsxs)(P,{sx:{pt:2},children:[(0,Y.jsx)(m,{autoFocus:!0,margin:`dense`,label:s(`modelSettings.dialogs.editProvider.providerName`),placeholder:s(`modelSettings.dialogs.editProvider.providerNamePlaceholder`),type:`text`,fullWidth:!0,variant:`outlined`,value:n,onChange:e=>i(e.target.value),sx:{mb:2}}),(0,Y.jsxs)(C,{fullWidth:!0,variant:`outlined`,children:[(0,Y.jsx)(y,{children:s(`modelSettings.dialogs.editProvider.providerType`)}),(0,Y.jsx)(b,{value:r,onChange:e=>a(e.target.value),label:s(`modelSettings.dialogs.editProvider.providerType`),children:Ke.map(e=>(0,Y.jsx)(_,{value:e.value,children:e.label},e.value))})]})]}),(0,Y.jsxs)(A,{sx:{p:2},children:[(0,Y.jsx)(M,{onClick:t,children:s(`common.cancel`)}),(0,Y.jsx)(M,{onClick:o,disabled:!n.trim(),sx:{bgcolor:e=>L(e.palette.primary.main,.1),color:`primary.main`,"&:hover":{bgcolor:e=>L(e.palette.primary.main,.2)},borderRadius:2},children:s(`common.save`)})]})]})},kt=({open:e,onClose:t,customEndpoint:n,customEndpointError:r,onCustomEndpointChange:i,onSave:a})=>{let{t:o}=j();return(0,Y.jsxs)(h,{open:e,onClose:t,maxWidth:`sm`,fullWidth:!0,children:[(0,Y.jsx)(I,{sx:{fontWeight:600},children:o(`modelSettings.dialogs.customEndpoint.title`)}),(0,Y.jsxs)(P,{children:[(0,Y.jsx)(V,{variant:`body2`,color:`text.secondary`,sx:{mb:2},children:o(`modelSettings.dialogs.customEndpoint.description`)}),(0,Y.jsx)(V,{variant:`body2`,color:`text.secondary`,sx:{mb:2,fontWeight:500},children:o(`modelSettings.dialogs.customEndpoint.example`)}),(0,Y.jsx)(m,{autoFocus:!0,margin:`dense`,label:o(`modelSettings.dialogs.customEndpoint.endpointLabel`),placeholder:o(`modelSettings.dialogs.customEndpoint.endpointPlaceholder`),type:`url`,fullWidth:!0,variant:`outlined`,value:n,onChange:e=>i(e.target.value),error:!!r,helperText:r||o(`modelSettings.dialogs.customEndpoint.helperText`),sx:{mt:2}})]}),(0,Y.jsxs)(A,{sx:{p:2},children:[(0,Y.jsx)(M,{onClick:t,children:o(`common.cancel`)}),(0,Y.jsx)(M,{onClick:a,disabled:!n.trim(),sx:{bgcolor:e=>L(e.palette.primary.main,.1),color:`primary.main`,"&:hover":{bgcolor:e=>L(e.palette.primary.main,.2)},borderRadius:2},children:o(`common.ok`)})]})]})},At=({testResult:e,testResultDialogOpen:t,onClose:n,onOpenDialog:r})=>{let{t:i}=j();return(0,Y.jsx)(c,{open:e!==null&&!t,autoHideDuration:6e3,onClose:n,anchorOrigin:{vertical:`bottom`,horizontal:`center`},action:(0,Y.jsx)(M,{color:`inherit`,size:`small`,onClick:r,children:i(`modelSettings.provider.viewDetails`)}),children:(0,Y.jsx)(T,{onClose:n,severity:e?.success?`success`:`error`,variant:`filled`,sx:{width:`100%`},children:e?.success?i(`modelSettings.provider.testSuccess`):i(`modelSettings.provider.testFailed`)})})},jt=({open:e,onClose:t,testResult:n})=>{let{t:r}=j();return(0,Y.jsxs)(h,{open:e,onClose:t,maxWidth:`md`,slotProps:{paper:{sx:{width:`100%`,maxWidth:500,borderRadius:2}}},children:[(0,Y.jsxs)(I,{sx:{fontWeight:600,color:n?.success?`success.main`:`error.main`,display:`flex`,alignItems:`center`},children:[n?.success?(0,Y.jsx)(fe,{size:20,style:{marginRight:8},color:`#2e7d32`}):null,r(`modelSettings.dialogs.testResult.title`)]}),(0,Y.jsx)(P,{children:(0,Y.jsx)(V,{sx:{whiteSpace:`pre-wrap`},children:n?.message||``})}),(0,Y.jsx)(A,{sx:{p:2},children:(0,Y.jsx)(M,{onClick:t,variant:`contained`,color:n?.success?`success`:`primary`,sx:{borderRadius:2},children:r(`common.ok`)})})]})};var Mt=Symbol.for(`preact-signals`);function Nt(){if(It>1)It--;else{for(var e,t=!1;Ft!==void 0;){var n=Ft;for(Ft=void 0,Lt++;n!==void 0;){var r=n.o;if(n.o=void 0,n.f&=-3,!(8&n.f)&&Bt(n))try{n.c()}catch(n){t||=(e=n,!0)}n=r}}if(Lt=0,It--,t)throw e}}var X=void 0;function Pt(e){var t=X;X=void 0;try{return e()}finally{X=t}}var Ft=void 0,It=0,Lt=0,Rt=0;function zt(e){if(X!==void 0){var t=e.n;if(t===void 0||t.t!==X)return t={i:0,S:e,p:X.s,n:void 0,t:X,e:void 0,x:void 0,r:t},X.s!==void 0&&(X.s.n=t),X.s=t,e.n=t,32&X.f&&e.S(t),t;if(t.i===-1)return t.i=0,t.n!==void 0&&(t.n.p=t.p,t.p!==void 0&&(t.p.n=t.n),t.p=X.s,t.n=void 0,X.s.n=t,X.s=t),t}}function Z(e,t){this.v=e,this.i=0,this.n=void 0,this.t=void 0,this.W=t?.watched,this.Z=t?.unwatched,this.name=t?.name}Z.prototype.brand=Mt,Z.prototype.h=function(){return!0},Z.prototype.S=function(e){var t=this,n=this.t;n!==e&&e.e===void 0&&(e.x=n,this.t=e,n===void 0?Pt(function(){var e;(e=t.W)==null||e.call(t)}):n.e=e)},Z.prototype.U=function(e){var t=this;if(this.t!==void 0){var n=e.e,r=e.x;n!==void 0&&(n.x=r,e.e=void 0),r!==void 0&&(r.e=n,e.x=void 0),e===this.t&&(this.t=r,r===void 0&&Pt(function(){var e;(e=t.Z)==null||e.call(t)}))}},Z.prototype.subscribe=function(e){var t=this;return Yt(function(){var n=t.value,r=X;X=void 0;try{e(n)}finally{X=r}},{name:`sub`})},Z.prototype.valueOf=function(){return this.value},Z.prototype.toString=function(){return this.value+``},Z.prototype.toJSON=function(){return this.value},Z.prototype.peek=function(){var e=X;X=void 0;try{return this.value}finally{X=e}},Object.defineProperty(Z.prototype,`value`,{get:function(){var e=zt(this);return e!==void 0&&(e.i=this.i),this.v},set:function(e){if(e!==this.v){if(Lt>100)throw Error(`Cycle detected`);this.v=e,this.i++,Rt++,It++;try{for(var t=this.t;t!==void 0;t=t.x)t.t.N()}finally{Nt()}}}});function Q(e,t){return new Z(e,t)}function Bt(e){for(var t=e.s;t!==void 0;t=t.n)if(t.S.i!==t.i||!t.S.h()||t.S.i!==t.i)return!0;return!1}function Vt(e){for(var t=e.s;t!==void 0;t=t.n){var n=t.S.n;if(n!==void 0&&(t.r=n),t.S.n=t,t.i=-1,t.n===void 0){e.s=t;break}}}function Ht(e){for(var t=e.s,n=void 0;t!==void 0;){var r=t.p;t.i===-1?(t.S.U(t),r!==void 0&&(r.n=t.n),t.n!==void 0&&(t.n.p=r)):n=t,t.S.n=t.r,t.r!==void 0&&(t.r=void 0),t=r}e.s=n}function Ut(e,t){Z.call(this,void 0),this.x=e,this.s=void 0,this.g=Rt-1,this.f=4,this.W=t?.watched,this.Z=t?.unwatched,this.name=t?.name}Ut.prototype=new Z,Ut.prototype.h=function(){if(this.f&=-3,1&this.f)return!1;if((36&this.f)==32||(this.f&=-5,this.g===Rt))return!0;if(this.g=Rt,this.f|=1,this.i>0&&!Bt(this))return this.f&=-2,!0;var e=X;try{Vt(this),X=this;var t=this.x();(16&this.f||this.v!==t||this.i===0)&&(this.v=t,this.f&=-17,this.i++)}catch(e){this.v=e,this.f|=16,this.i++}return X=e,Ht(this),this.f&=-2,!0},Ut.prototype.S=function(e){if(this.t===void 0){this.f|=36;for(var t=this.s;t!==void 0;t=t.n)t.S.S(t)}Z.prototype.S.call(this,e)},Ut.prototype.U=function(e){if(this.t!==void 0&&(Z.prototype.U.call(this,e),this.t===void 0)){this.f&=-33;for(var t=this.s;t!==void 0;t=t.n)t.S.U(t)}},Ut.prototype.N=function(){if(!(2&this.f)){this.f|=6;for(var e=this.t;e!==void 0;e=e.x)e.t.N()}},Object.defineProperty(Ut.prototype,`value`,{get:function(){if(1&this.f)throw Error(`Cycle detected`);var e=zt(this);if(this.h(),e!==void 0&&(e.i=this.i),16&this.f)throw this.v;return this.v}});function Wt(e,t){return new Ut(e,t)}function Gt(e){var t=e.u;if(e.u=void 0,typeof t==`function`){It++;var n=X;X=void 0;try{t()}catch(t){throw e.f&=-2,e.f|=8,Kt(e),t}finally{X=n,Nt()}}}function Kt(e){for(var t=e.s;t!==void 0;t=t.n)t.S.U(t);e.x=void 0,e.s=void 0,Gt(e)}function qt(e){if(X!==this)throw Error(`Out-of-order effect`);Ht(this),X=e,this.f&=-2,8&this.f&&Kt(this),Nt()}function Jt(e,t){this.x=e,this.u=void 0,this.s=void 0,this.o=void 0,this.f=32,this.name=t?.name}Jt.prototype.c=function(){var e=this.S();try{if(8&this.f||this.x===void 0)return;var t=this.x();typeof t==`function`&&(this.u=t)}finally{e()}},Jt.prototype.S=function(){if(1&this.f)throw Error(`Cycle detected`);this.f|=1,this.f&=-9,Gt(this),Vt(this),It++;var e=X;return X=this,qt.bind(this,e)},Jt.prototype.N=function(){2&this.f||(this.f|=2,this.o=Ft,Ft=this)},Jt.prototype.d=function(){this.f|=8,1&this.f||Kt(this)},Jt.prototype.dispose=function(){this.d()};function Yt(e,t){var n=new Jt(e,t);try{n.c()}catch(e){throw n.d(),e}var r=n.d.bind(n);return r[Symbol.dispose]=r,r}var Xt=_e(),Zt=J.version.split(`.`).map(Number)[0],Qt=Symbol.for(Zt>=19?`react.transitional.element`:`react.element`),$t,en=Symbol.dispose||Symbol.for(`Symbol.dispose`);function tn(e,t){var n=t.effect.S();return $t=t,nn.bind(t,e,n)}function nn(e,t){t(),$t=e}var rn,an,on=function(){},sn=((rn={o:0,effect:{s:void 0,c:function(){},S:function(){return on},d:function(){}},subscribe:function(){return on},getSnapshot:function(){return 0},S:function(){},f:function(){}})[en]=function(){},rn),cn=Promise.prototype.then.bind(Promise.resolve());function ln(){an||=cn(un)}function un(){var e;an=void 0,(e=$t)==null||e.f()}var dn=typeof window<`u`?J.useLayoutEffect:J.useEffect;function fn(e){e===void 0&&(e=0),ln();var t=(0,J.useRef)();t.current??(typeof window>`u`?t.current=sn:t.current=function(e){var t,n,r,i,a=0,o=Yt(function(){n=this});return n.c=function(){a=a+1|0,i&&i()},(t={o:e,effect:n,subscribe:function(e){return i=e,function(){a=a+1|0,i=void 0,o()}},getSnapshot:function(){return a},S:function(){if($t!=null){var e=$t.o,t=this.o;e==0&&t==0||e==0&&t==1?($t.f(),r=tn(void 0,this)):e==1&&t==0||e==2&&t==0||(r=tn($t,this))}else r=tn(void 0,this)},f:function(){var e=r;r=void 0,e?.()}})[en]=function(){this.f()},t}(e));var n=t.current;return(0,Xt.useSyncExternalStore)(n.subscribe,n.getSnapshot,n.getSnapshot),n.S(),e===0&&dn(un),n}Object.defineProperties(Z.prototype,{$$typeof:{configurable:!0,value:Qt},type:{configurable:!0,value:function(e){var t=e.data,n=fn(1);try{return t.value}finally{n.f()}}},props:{configurable:!0,get:function(){return{data:this}}},ref:{configurable:!0,value:null}});function pn(e){return fn(e)}const mn=Q(null),$=Q(!1),hn=Q(null);Wt(()=>$.value);const gn=Q(!1),_n={addModel:Q(!1),editModel:Q(!1),deleteProvider:Q(!1),editProvider:Q(!1),customEndpoint:Q(!1),modelManagement:Q(!1),testResultDialog:Q(!1)};function vn(e){mn.value=e,hn.value=null}function yn(e,t){mn.value=null,hn.value={success:e,message:t}}function bn(){mn.value=null,$.value=!1,hn.value=null,gn.value=!1,Object.values(_n).forEach(e=>{e.value=!1})}const xn=e=>{let t=xe(),n=ee(),r=(0,J.useRef)(null),[i,a]=(0,J.useState)(``),[o,s]=(0,J.useState)(``),[c,u]=(0,J.useState)(!0),[d,f]=(0,J.useState)(!1),[p,m]=(0,J.useState)(!1),[h,g]=(0,J.useState)(!1),[_,y]=(0,J.useState)(void 0),[b,x]=(0,J.useState)(``),[S,C]=(0,J.useState)(``),[w,T]=(0,J.useState)(``),[E,ne]=(0,J.useState)(!1),[re,ie]=(0,J.useState)(!1),[D,O]=(0,J.useState)(null),[ae,oe]=(0,J.useState)(!1),[k,se]=(0,J.useState)(!1),[ce,A]=(0,J.useState)(``),[le,ue]=(0,J.useState)(``),[j,M]=(0,J.useState)({}),[N,fe]=(0,J.useState)(``),[pe,P]=(0,J.useState)(``),[me,he]=(0,J.useState)({}),[F,_e]=(0,J.useState)(``),[ve,ye]=(0,J.useState)(``),[I,be]=(0,J.useState)(!1),[L,Se]=(0,J.useState)(``),[R,Ce]=(0,J.useState)(!1),[Te,z]=(0,J.useState)(``),[B,V]=(0,J.useState)(!1),Ee=te.getInstance(),[De,Oe]=(0,J.useState)(!1),ke=Ye(o,Ze.DEBOUNCE_DELAY),Ae=(0,J.useMemo)(()=>({primary:Je.primaryButton,error:Je.errorButton}),[]);(0,J.useEffect)(()=>{e&&(a(e.apiKey||``),s(e.baseUrl||``),u(e.isEnabled),M(e.extraHeaders||{}),he(e.extraBody||{}),V(!!(e.apiKeys&&e.apiKeys.length>0)),Oe(!!e.useResponsesAPI))},[e]),(0,J.useEffect)(()=>()=>{r.current&&r.current.abort(),bn()},[]),(0,J.useEffect)(()=>{ke&&!ge(ke)?T(`请输入有效的URL`):T(``)},[ke]);let je=(0,J.useMemo)(()=>D&&D.message&&D.message.length>Ze.MESSAGE_LENGTH_THRESHOLD,[D]);(0,J.useEffect)(()=>{je&&oe(!0)},[je]);let Me=t=>{e&&n(v({id:e.id,updates:{apiKeys:t,apiKey:t.find(e=>e.isEnabled)?.key||t[0]?.key||``}}))},Ne=t=>{e&&n(v({id:e.id,updates:{keyManagement:{strategy:t,maxFailuresBeforeDisable:e.keyManagement?.maxFailuresBeforeDisable||3,failureRecoveryTime:e.keyManagement?.failureRecoveryTime||5,enableAutoRecovery:e.keyManagement?.enableAutoRecovery||!0}}}))},H=t=>{if(V(t),e)if(t){let t=e.apiKey;if(t){let r=[Ee.createApiKeyConfig(t,`主要密钥`,1)];n(v({id:e.id,updates:{apiKeys:r,keyManagement:{strategy:`round_robin`,maxFailuresBeforeDisable:3,failureRecoveryTime:5,enableAutoRecovery:!0}}}))}}else{let t=e.apiKeys?.[0];n(v({id:e.id,updates:{apiKey:t?.key||``,apiKeys:void 0,keyManagement:void 0}}))}},U=()=>{gn.value=!gn.value},Pe=(0,J.useCallback)(()=>{t(`/settings/default-model`,{replace:!0})},[t]),W=(0,J.useCallback)(t=>{if(!e)return!1;if(o&&!ge(o))return T(`请输入有效的URL`),!1;try{return n(v({id:e.id,updates:{apiKey:i,baseUrl:o.trim(),isEnabled:c,extraHeaders:j,extraBody:me,useResponsesAPI:De,...t}})),!0}catch(e){return console.error(`保存配置失败:`,e),T(`保存配置失败，请重试`),!1}},[e,o,i,c,j,me,De,n]),G=(0,J.useCallback)(()=>{W({})&&setTimeout(()=>{t(`/settings/default-model`,{replace:!0})},0)},[W,t]),Fe=()=>{e&&n(de(e.id)),m(!1),t(`/settings/default-model`,{replace:!0})},Ie=()=>{e&&(A(e.name),ue(e.providerType||``),se(!0))},Le=()=>{e&&ce.trim()&&(n(v({id:e.id,updates:{name:ce.trim(),providerType:le}})),se(!1),A(``),ue(``))},Re=()=>{N.trim()&&pe.trim()&&(M(e=>({...e,[N.trim()]:pe.trim()})),fe(``),P(``))},ze=e=>{M(t=>{let n={...t};return delete n[e],n})},Be=(e,t,n)=>{M(r=>{let i={...r};return e!==t&&delete i[e],i[t]=n,i})},Ve=()=>{if(F.trim()&&ve.trim())try{let e=ve.trim();try{e=JSON.parse(e)}catch{e===`true`?e=!0:e===`false`?e=!1:e===`null`?e=null:/^-?\d+$/.test(e)?e=parseInt(e,10):/^-?\d*\.\d+$/.test(e)&&(e=parseFloat(e))}he(t=>({...t,[F.trim()]:e})),_e(``),ye(``)}catch(e){console.error(`解析body值失败:`,e)}},He=e=>{he(t=>{let n={...t};return delete n[e],n})},K=(e,t,n)=>{try{let r=n.trim();try{r=JSON.parse(r)}catch{r===`true`?r=!0:r===`false`?r=!1:r===`null`?r=null:/^-?\d+$/.test(r)?r=parseInt(r,10):/^-?\d*\.\d+$/.test(r)&&(r=parseFloat(r))}he(n=>{let i={...n};return e!==t&&delete i[e],i[t]=r,i})}catch(e){console.error(`更新body值失败:`,e)}},Ue=()=>{Se(``),z(``),Ce(!0)},We=()=>{let t=L.trim();if(!t){z(`请输入端点URL`);return}if(!ge(t)){z(`请输入有效的完整URL`);return}e&&(n(v({id:e.id,updates:{customModelEndpoint:t}})),Ce(!1),ne(!0))},q=()=>{if(e&&b&&S){if(e.id,e.models.some(t=>we(t,{id:S,provider:e.id},e.id))){O({success:!1,message:`模型已存在，请勿重复添加`});return}let t={id:S,name:b,provider:e.id,providerType:e.providerType,enabled:!0,isDefault:!1},n=[...e.models,t];W({models:n})&&(t.id,n.length,x(``),C(``),f(!1),O({success:!0,message:`模型添加成功`}))}},Ge=t=>{e&&t&&_&&(_.id,t.id,t.name,W({models:e.models.map(n=>we(n,_,e.id)?t:n)})&&(t.id,y(void 0),g(!1)))},Ke=t=>{if(e){e.id;let n=e.models.length,r=e.models.filter(n=>!we(n,{id:t,provider:e.id},e.id));r.length,n-r.length,W({models:r})}},qe=e=>{y(e),x(e.name),C(e.id),g(!0)},Xe=(0,J.useCallback)(t=>{if(e){let n={...t,provider:e.id,providerType:e.providerType,enabled:!0};if(e.models.some(n=>we(n,{id:t.id,provider:e.id},e.id)))return;W({models:[...e.models,n]})}},[e,W]),Qe=(0,J.useCallback)(t=>{if(e&&t.length>0){t.length;let n=t.filter(t=>!e.models.some(n=>we(n,{id:t.id,provider:e.id},e.id))).map(t=>({...t,provider:e.id,providerType:e.providerType,enabled:!0}));if(n.length===0)return;n.length,W({models:[...e.models,...n]})}},[e,W]),$e=(0,J.useCallback)(t=>{if(e&&t.length>0){t.length;let n=new Set(t),r=e.models.length,i=e.models.filter(t=>!n.has(t.id)||t.provider!==e.id);i.length,r-i.length,W({models:i})}},[e,W]),et=()=>{if(o&&!ge(o)){T(`请输入有效的URL`),alert(`请输入有效的基础URL`);return}e&&n(v({id:e.id,updates:{apiKey:i,baseUrl:o.trim(),isEnabled:c,extraHeaders:j,extraBody:me}})),ne(!0)},tt=(0,J.useCallback)(async()=>{if(e){if(o&&!ge(o)){T(`请输入有效的URL`),O({success:!1,message:`请输入有效的基础URL`});return}r.current&&r.current.abort(),r.current=new AbortController,ie(!0),O(null);try{let t=i;if(B&&e.apiKeys&&e.apiKeys.length>0){let n=Ee.selectApiKey(e.apiKeys,e.keyManagement?.strategy||`round_robin`);if(n.key)t=n.key.key,console.log(`[handleTestConnection] 多 Key 模式: 使用 ${n.key.name||n.key.id}`);else throw Error(`没有可用的 API Key。请检查多 Key 配置。`)}let n=await l({id:e.models.length>0?e.models[0].id:`gpt-3.5-turbo`,name:e.name,provider:e.id,providerType:e.providerType,apiKey:t,baseUrl:o,enabled:!0});if(r.current?.signal.aborted)return;O(n?{success:!0,message:`连接成功！API配置有效。`}:{success:!1,message:`连接失败，请检查API密钥和基础URL是否正确。`})}catch(e){if(e instanceof Error&&e.name===`AbortError`)return;console.error(`测试API连接时出错:`,e),O({success:!1,message:`连接错误: ${e instanceof Error?e.message:String(e)}`})}finally{ie(!1),r.current=null}}},[e,o,i,B,Ee]);return{apiKey:i,setApiKey:a,baseUrl:o,setBaseUrl:s,isEnabled:c,setIsEnabled:u,openAddModelDialog:d,setOpenAddModelDialog:f,openDeleteDialog:p,setOpenDeleteDialog:m,openEditModelDialog:h,setOpenEditModelDialog:g,modelToEdit:_,setModelToEdit:y,newModelName:b,setNewModelName:x,newModelValue:S,setNewModelValue:C,baseUrlError:w,setBaseUrlError:T,openModelManagementDialog:E,setOpenModelManagementDialog:ne,isTesting:re,testResult:D,setTestResult:O,testingModelId:mn.value,testResultDialogOpen:ae,setTestResultDialogOpen:oe,openEditProviderDialog:k,setOpenEditProviderDialog:se,editProviderName:ce,setEditProviderName:A,editProviderType:le,setEditProviderType:ue,extraHeaders:j,setExtraHeaders:M,newHeaderKey:N,setNewHeaderKey:fe,newHeaderValue:pe,setNewHeaderValue:P,extraBody:me,setExtraBody:he,newBodyKey:F,setNewBodyKey:_e,newBodyValue:ve,setNewBodyValue:ye,openAdvancedConfigDialog:I,setOpenAdvancedConfigDialog:be,customModelEndpoint:L,setCustomModelEndpoint:Se,openCustomEndpointDialog:R,setOpenCustomEndpointDialog:Ce,customEndpointError:Te,setCustomEndpointError:z,multiKeyEnabled:B,setMultiKeyEnabled:V,useResponsesAPI:De,setUseResponsesAPI:Oe,keyManager:Ee,buttonStyles:Ae,handleApiKeysChange:Me,handleStrategyChange:Ne,handleToggleMultiKey:H,toggleShowApiKey:U,handleBack:Pe,handleSave:G,handleDelete:Fe,handleEditProviderName:Ie,handleSaveProviderName:Le,handleAddHeader:Re,handleRemoveHeader:ze,handleUpdateHeader:Be,handleAddBody:Ve,handleRemoveBody:He,handleUpdateBody:K,handleOpenCustomEndpointDialog:Ue,handleSaveCustomEndpoint:We,handleAddModel:q,handleEditModel:Ge,handleDeleteModel:Ke,openModelEditDialog:qe,handleAddModelFromApi:Xe,handleBatchAddModels:Qe,handleBatchRemoveModels:$e,handleOpenModelManagement:et,handleTestConnection:tt,handleTestModelConnection:async t=>{if(e){vn(t.id),O(null);try{let n=i;if(B&&e.apiKeys&&e.apiKeys.length>0){let t=Ee.selectApiKey(e.apiKeys,e.keyManagement?.strategy||`round_robin`);if(t.key)n=t.key.key,console.log(`[handleTestModelConnection] 多 Key 模式: 使用 ${t.key.name||t.key.id}`);else throw Error(`没有可用的 API Key。请检查多 Key 配置。`)}await l({...t,provider:e.id,providerType:e.providerType,apiKey:n,baseUrl:o,enabled:!0})?(yn(!0,`模型 ${t.name} 连接成功！`),O({success:!0,message:`模型 ${t.name} 连接成功！`})):(yn(!1,`模型 ${t.name} 连接失败，请检查API密钥和基础URL是否正确。`),O({success:!1,message:`模型 ${t.name} 连接失败，请检查API密钥和基础URL是否正确。`}))}catch(e){console.error(`测试模型连接时出错:`,e);let t=`连接错误: ${e instanceof Error?e.message:String(e)}`;yn(!1,t),O({success:!1,message:t})}}}}};function Sn({model:e,alwaysShowTestButton:t,onEdit:n,onDelete:r,onTest:i}){pn();let{t:a}=j();return(0,Y.jsxs)(N,{sx:{position:`relative`,display:`flex`,alignItems:`center`,py:{xs:1.5,sm:1},pl:{xs:2.5,sm:2},pr:{xs:$.value||t?15:11,sm:$.value||t?13:9.5},transition:`all 0.2s ease`,"&:hover":{bgcolor:e=>L(e.palette.primary.main,.05)}},children:[(0,Y.jsx)(V,{variant:`subtitle2`,sx:{fontWeight:600,fontSize:{xs:`0.95rem`,sm:`0.875rem`},flex:1,mr:1},children:e.name}),e.isDefault&&(0,Y.jsx)(N,{sx:{px:{xs:1.25,sm:1},py:{xs:.5,sm:.25},borderRadius:1,fontSize:{xs:`0.75rem`,sm:`0.7rem`},fontWeight:600,bgcolor:e=>L(e.palette.success.main,.12),color:`success.main`,mr:1},children:a(`modelSettings.provider.defaultBadge`)}),(0,Y.jsxs)(N,{sx:{position:`absolute`,right:{xs:2.5,sm:2},top:`50%`,transform:`translateY(-50%)`,display:`flex`,alignItems:`center`,gap:{xs:1,sm:.75}},children:[($.value||t)&&(0,Y.jsx)(u,{"aria-label":`test`,onClick:()=>i(e),disabled:mn.value!==null,sx:{width:{xs:40,sm:36},height:{xs:40,sm:36},minWidth:{xs:40,sm:36},borderRadius:1.5,p:0,bgcolor:e=>L(e.palette.success.main,.12),color:`success.main`,"&:hover":{bgcolor:e=>L(e.palette.success.main,.2)},transition:`all 0.2s ease`},children:mn.value===e.id?(0,Y.jsx)(B,{size:16,color:`success`}):(0,Y.jsx)(fe,{size:18})}),(0,Y.jsx)(u,{"aria-label":`edit`,onClick:()=>n(e),sx:{width:{xs:40,sm:36},height:{xs:40,sm:36},minWidth:{xs:40,sm:36},borderRadius:1.5,p:0,bgcolor:e=>L(e.palette.info.main,.12),color:`info.main`,"&:hover":{bgcolor:e=>L(e.palette.info.main,.2)},transition:`all 0.2s ease`},children:(0,Y.jsx)(S,{size:18})}),(0,Y.jsx)(u,{"aria-label":`delete`,onClick:()=>r(e.id),sx:{width:{xs:40,sm:36},height:{xs:40,sm:36},minWidth:{xs:40,sm:36},borderRadius:1.5,p:0,bgcolor:e=>L(e.palette.error.main,.12),color:`error.main`,"&:hover":{bgcolor:e=>L(e.palette.error.main,.2)},transition:`all 0.2s ease`},children:(0,Y.jsx)(s,{size:18})})]})]})}var Cn=Sn,wn=()=>{pn();let{t}=j(),[c,l]=(0,J.useState)(null),{providerId:f}=ye(),p=xe(),h=ee(),g=E(),{containerRef:_,handleScroll:y}=pe(`settings-model-provider-${f}`,{autoRestore:!0,restoreDelay:0}),b=a(e=>e.settings.providers.find(e=>e.id===f)),x=a(e=>e.settings.alwaysShowModelTestButton),C=g.palette.mode===`dark`,T=(0,J.useMemo)(()=>b?We(b.providerType||b.id,C):``,[b,C]),{apiKey:te,setApiKey:ne,baseUrl:O,setBaseUrl:oe,isEnabled:ce,setIsEnabled:A,openAddModelDialog:ue,setOpenAddModelDialog:de,openDeleteDialog:P,setOpenDeleteDialog:me,openEditModelDialog:he,setOpenEditModelDialog:ge,modelToEdit:_e,newModelName:I,setNewModelName:Se,newModelValue:we,setNewModelValue:z,baseUrlError:B,setBaseUrlError:Ee,openModelManagementDialog:Oe,setOpenModelManagementDialog:Ae,testResult:je,setTestResult:Me,testResultDialogOpen:Ne,setTestResultDialogOpen:H,openEditProviderDialog:U,setOpenEditProviderDialog:Pe,editProviderName:W,editProviderType:G,setEditProviderName:Fe,setEditProviderType:Ie,extraHeaders:Le,extraBody:Re,customModelEndpoint:ze,setCustomModelEndpoint:Be,openCustomEndpointDialog:Ve,setOpenCustomEndpointDialog:He,customEndpointError:K,setCustomEndpointError:Ue,multiKeyEnabled:q,useResponsesAPI:Ge,setUseResponsesAPI:Ke,buttonStyles:Je,handleToggleMultiKey:Ye,toggleShowApiKey:Ze,handleBack:Qe,handleSave:$e,handleDelete:et,handleEditProviderName:tt,handleSaveProviderName:nt,handleOpenCustomEndpointDialog:rt,handleSaveCustomEndpoint:it,handleAddModel:at,handleEditModel:ot,handleDeleteModel:st,openModelEditDialog:ct,handleAddModelFromApi:lt,handleBatchAddModels:ut,handleBatchRemoveModels:dt,handleOpenModelManagement:ft,handleTestModelConnection:pt}=xn(b),mt=(0,J.useMemo)(()=>{if(!b||b.isSystem)return[];let e={};return b.models.forEach(t=>{let n=t.group||i(t.id,b.id);e[n]||(e[n]=[]),e[n].push(t)}),Object.keys(e).sort((e,t)=>e.localeCompare(t)).map(t=>[t,e[t]])},[b]),gt=e=>{let t=mt.find(([t])=>t===e);t&&dt(t[1].map(e=>e.id))};return b?(0,Y.jsxs)(se,{children:[(0,Y.jsx)(le,{position:`static`,elevation:0,sx:{bgcolor:`background.paper`,color:`text.primary`,borderBottom:1,borderColor:`divider`,backdropFilter:`blur(8px)`},children:(0,Y.jsxs)(d,{children:[(0,Y.jsx)(u,{edge:`start`,onClick:Qe,"aria-label":`back`,sx:{color:e=>e.palette.primary.main},children:(0,Y.jsx)(De,{size:20})}),(0,Y.jsx)(V,{variant:`h6`,component:`div`,sx:{flexGrow:1,fontWeight:600},children:b.name}),!b.isSystem&&(0,Y.jsx)(k,{control:(0,Y.jsx)(R,{checked:ce,onChange:e=>A(e.target.checked)}),label:t(ce?`modelSettings.provider.enabled`:`modelSettings.provider.disabled`),sx:{mr:2}}),(0,Y.jsx)(M,{onClick:$e,sx:Je.primary,children:t(`common.save`)})]})}),(0,Y.jsxs)(N,{ref:_,onScroll:y,sx:{flexGrow:1,overflowY:`auto`,p:2,pb:`var(--content-bottom-padding)`,"&::-webkit-scrollbar":{width:`6px`},"&::-webkit-scrollbar-thumb":{backgroundColor:`rgba(0,0,0,0.1)`,borderRadius:`3px`}},children:[(0,Y.jsxs)(o,{elevation:0,sx:{p:3,borderRadius:2,border:`1px solid`,borderColor:`divider`,bgcolor:`background.paper`,boxShadow:`0 4px 12px rgba(0,0,0,0.05)`,mb:3},children:[(0,Y.jsxs)(N,{sx:{display:`flex`,alignItems:`center`,mb:3},children:[(0,Y.jsx)(ve,{src:T,alt:b.name,sx:{width:56,height:56,bgcolor:`transparent`,fontSize:`1.5rem`,mr:2,boxShadow:`0 4px 8px rgba(0,0,0,0.1)`},children:b.name.charAt(0).toUpperCase()}),(0,Y.jsxs)(N,{children:[(0,Y.jsx)(V,{variant:`h6`,sx:{fontWeight:600},children:b.name}),(0,Y.jsx)(V,{variant:`body2`,color:`text.secondary`,children:b.isSystem?t(`modelSettings.provider.systemProvider`):`${b.providerType||`Custom`} API`})]}),(0,Y.jsx)(N,{sx:{ml:`auto`,display:`flex`,gap:1,alignItems:`center`},children:!b.isSystem&&(0,Y.jsxs)(Y.Fragment,{children:[(0,Y.jsx)(u,{onClick:tt,sx:{bgcolor:e=>L(e.palette.info.main,.1),"&:hover":{bgcolor:e=>L(e.palette.info.main,.2)}},children:(0,Y.jsx)(S,{size:20,color:`#0288d1`})}),(0,Y.jsx)(u,{color:`error`,onClick:()=>me(!0),sx:Je.error,children:(0,Y.jsx)(s,{size:20})})]})})]}),b.isSystem?(0,Y.jsxs)(N,{sx:{p:2,bgcolor:e=>L(e.palette.info.main,.1),borderRadius:2,border:`1px solid`,borderColor:e=>L(e.palette.info.main,.3)},children:[(0,Y.jsx)(V,{variant:`body2`,color:`info.main`,sx:{fontWeight:500},children:t(`modelSettings.provider.systemProviderTitle`)}),(0,Y.jsx)(V,{variant:`body2`,color:`text.secondary`,sx:{mt:1},children:t(`modelSettings.provider.systemProviderDesc`)})]}):(0,Y.jsxs)(Y.Fragment,{children:[(0,Y.jsx)(Ce,{sx:{my:3}}),(0,Y.jsx)(V,{variant:`subtitle1`,sx:{mb:2,fontWeight:600,color:`text.primary`},children:t(`modelSettings.provider.apiConfig`)}),(0,Y.jsxs)(N,{sx:{mb:3,display:`flex`,alignItems:`center`,justifyContent:`space-between`},children:[(0,Y.jsxs)(N,{sx:{display:`flex`,alignItems:`center`,gap:1},children:[(0,Y.jsx)(V,{variant:`subtitle2`,sx:{fontWeight:600},children:t(`modelSettings.provider.apiKeyMode`)}),(0,Y.jsx)(F,{title:t(q?`modelSettings.provider.multiKeyDesc`:`modelSettings.provider.singleKeyDesc`),arrow:!0,placement:`top`,children:(0,Y.jsx)(u,{size:`small`,sx:{p:.5,color:`text.secondary`,"&:hover":{color:`primary.main`,bgcolor:e=>L(e.palette.primary.main,.1)}},children:(0,Y.jsx)(D,{size:16})})})]}),(0,Y.jsx)(k,{control:(0,Y.jsx)(R,{checked:q,onChange:e=>Ye(e.target.checked)}),label:t(q?`modelSettings.provider.multiKeyMode`:`modelSettings.provider.singleKeyMode`),labelPlacement:`start`,sx:{ml:2,mr:0}})]}),(0,Y.jsx)(N,{sx:{mb:3},children:q?(0,Y.jsxs)(N,{children:[(0,Y.jsx)(V,{variant:`subtitle2`,gutterBottom:!0,color:`text.secondary`,children:t(`modelSettings.provider.multiKeyManagement`)}),(0,Y.jsxs)(M,{variant:`outlined`,fullWidth:!0,onClick:()=>p(`/settings/model-provider/${b.id}/multi-key`),sx:{py:1.5,borderRadius:2,borderColor:e=>L(e.palette.primary.main,.5),color:`primary.main`,"&:hover":{borderColor:`primary.main`,bgcolor:e=>L(e.palette.primary.main,.1)}},children:[t(`modelSettings.provider.manageMultiKey`),` (`,b.apiKeys?.length||0,` 个密钥)`]})]}):(0,Y.jsxs)(N,{children:[(0,Y.jsx)(V,{variant:`subtitle2`,gutterBottom:!0,color:`text.secondary`,children:t(`modelSettings.provider.apiKeyLabel`)}),(0,Y.jsx)(m,{fullWidth:!0,placeholder:t(`modelSettings.provider.apiKeyPlaceholder`),value:te,onChange:e=>ne(e.target.value),variant:`outlined`,type:gn.value?`text`:`password`,size:`small`,sx:{"& .MuiOutlinedInput-root":{borderRadius:2}},slotProps:{input:{"aria-invalid":!1,"aria-describedby":`provider-settings-api-key-helper-text`,endAdornment:(0,Y.jsx)(e,{position:`end`,children:(0,Y.jsx)(u,{"aria-label":t(`modelSettings.provider.toggleApiKey`),onClick:Ze,edge:`end`,size:`small`,sx:{"&:hover":{bgcolor:`action.hover`,transform:`scale(1.1)`},transition:`all 0.2s ease-in-out`},children:gn.value?(0,Y.jsx)(be,{size:16}):(0,Y.jsx)(Te,{size:16})})})},formHelperText:{id:`provider-settings-api-key-helper-text`}}})]})}),(0,Y.jsxs)(N,{sx:{mb:3},children:[(0,Y.jsx)(V,{variant:`subtitle2`,gutterBottom:!0,color:`text.secondary`,children:t(`modelSettings.provider.baseUrlLabel`)}),(0,Y.jsx)(m,{fullWidth:!0,placeholder:t(`modelSettings.provider.baseUrlPlaceholder`),value:O,onChange:e=>{oe(e.target.value),Ee(``)},error:!!B,helperText:(0,Y.jsxs)(`span`,{children:[B&&(0,Y.jsx)(`span`,{style:{display:`block`,color:`error.main`,marginBottom:`4px`,fontSize:`0.75rem`},children:B}),(0,Y.jsx)(`span`,{style:{display:`block`,color:`text.secondary`,marginBottom:`4px`,fontSize:`0.75rem`},children:t(`modelSettings.provider.baseUrlHint`)}),O&&qe(b?.providerType)&&(0,Y.jsxs)(`span`,{style:{display:`inline-block`,color:O.endsWith(`#`)||O.endsWith(`/`)?`#ed6c02`:`#666`,fontFamily:`monospace`,fontSize:`0.7rem`,backgroundColor:`rgba(0, 0, 0, 0.04)`,padding:`2px 6px`,borderRadius:`4px`,marginTop:`4px`},children:[O.endsWith(`#`)?t(`modelSettings.provider.baseUrlForce`):O.endsWith(`/`)?t(`modelSettings.provider.baseUrlKeep`):t(`modelSettings.provider.baseUrlComplete`),Xe(O,b?.providerType,Ge)]})]}),variant:`outlined`,size:`small`,sx:{"& .MuiOutlinedInput-root":{borderRadius:2}}})]}),qe(b?.providerType)&&(0,Y.jsxs)(N,{sx:{mb:3},children:[(0,Y.jsxs)(N,{sx:{display:`flex`,alignItems:`center`,justifyContent:`space-between`},children:[(0,Y.jsxs)(N,{sx:{display:`flex`,alignItems:`center`,gap:1},children:[(0,Y.jsx)(V,{variant:`subtitle2`,sx:{fontWeight:600},children:t(`modelSettings.provider.responsesAPI`,`Responses API`)}),(0,Y.jsx)(F,{title:t(`modelSettings.provider.responsesAPIDesc`,`OpenAI 新版 Responses API，支持更多高级功能。仅在使用官方 OpenAI API 时建议启用。`),arrow:!0,placement:`top`,children:(0,Y.jsx)(u,{size:`small`,sx:{p:.5,color:`text.secondary`,"&:hover":{color:`primary.main`,bgcolor:e=>L(e.palette.primary.main,.1)}},children:(0,Y.jsx)(D,{size:16})})})]}),(0,Y.jsx)(k,{control:(0,Y.jsx)(R,{checked:Ge,onChange:e=>Ke(e.target.checked)}),label:t(Ge?`modelSettings.provider.enabled`:`modelSettings.provider.disabled`),labelPlacement:`start`,sx:{ml:2,mr:0}})]}),(0,Y.jsx)(V,{variant:`caption`,color:`text.secondary`,sx:{display:`block`,mt:.5},children:t(`modelSettings.provider.responsesAPIHint`,`注意：大多数 OpenAI 兼容 API（如硅基流动、DeepSeek）不支持 Responses API，请保持关闭。`)})]}),(0,Y.jsxs)(N,{sx:{mb:3},children:[(0,Y.jsx)(V,{variant:`subtitle2`,gutterBottom:!0,color:`text.secondary`,children:t(`modelSettings.provider.advancedAPIConfig`)}),(0,Y.jsxs)(N,{sx:{display:`flex`,alignItems:`center`,gap:2},children:[(0,Y.jsx)(M,{variant:`outlined`,startIcon:(0,Y.jsx)(w,{size:16}),onClick:()=>p(`/settings/model-provider/${b.id}/advanced-api`),sx:{borderRadius:2,borderColor:e=>L(e.palette.secondary.main,.5),color:`secondary.main`,"&:hover":{borderColor:`secondary.main`,bgcolor:e=>L(e.palette.secondary.main,.1)}},children:t(`modelSettings.provider.configureAdvanced`)}),(Object.keys(Le).length>0||Object.keys(Re).length>0)&&(0,Y.jsx)(V,{variant:`caption`,color:`text.secondary`,children:t(`modelSettings.provider.advancedConfigured`,{headersCount:Object.keys(Le).length,bodyCount:Object.keys(Re).length})})]})]}),(0,Y.jsxs)(N,{children:[(0,Y.jsx)(V,{variant:`subtitle2`,gutterBottom:!0,color:`text.secondary`,children:t(`modelSettings.provider.testMode`)}),(0,Y.jsx)(V,{variant:`caption`,color:`text.secondary`,sx:{display:`block`,mb:1},children:t(`modelSettings.provider.testModeDesc`)}),(0,Y.jsxs)(N,{sx:{display:`flex`,alignItems:`center`,gap:2,flexWrap:`wrap`},children:[(0,Y.jsx)(M,{variant:$.value?`contained`:`outlined`,startIcon:(0,Y.jsx)(fe,{size:16}),onClick:()=>{$.value=!$.value},sx:{borderRadius:2,borderColor:e=>L(e.palette.success.main,.5),color:$.value?`white`:`success.main`,bgcolor:$.value?`success.main`:`transparent`,"&:hover":{borderColor:`success.main`,bgcolor:$.value?e=>L(e.palette.success.main,.8):e=>L(e.palette.success.main,.1)}},children:$.value?t(`modelSettings.provider.exitTestMode`):t(`modelSettings.provider.testMode`)}),(0,Y.jsx)(k,{control:(0,Y.jsx)(R,{checked:x||!1,onChange:e=>h(ae({alwaysShowModelTestButton:e.target.checked}))}),label:(0,Y.jsxs)(N,{children:[(0,Y.jsx)(V,{variant:`body2`,children:t(`modelSettings.provider.alwaysShowTestButton`,`长期显示测试按钮`)}),(0,Y.jsx)(V,{variant:`caption`,color:`text.secondary`,children:t(`modelSettings.provider.alwaysShowTestButtonDesc`,`启用后，测试按钮将一直显示在模型列表中`)})]}),sx:{ml:1,"& .MuiFormControlLabel-label":{ml:1}}})]}),(0,Y.jsxs)(N,{sx:{mt:3,p:2,bgcolor:e=>L(e.palette.warning.main,.08),borderRadius:2,border:`1px solid`,borderColor:e=>L(e.palette.warning.main,.2)},children:[(0,Y.jsxs)(V,{variant:`subtitle2`,sx:{fontWeight:600,mb:1,display:`flex`,alignItems:`center`,gap:1},children:[(0,Y.jsx)(D,{size:16}),t(`modelSettings.provider.corsCompatibilityMode`)]}),(0,Y.jsx)(V,{variant:`caption`,color:`text.secondary`,sx:{display:`block`,mb:2},children:t(`modelSettings.provider.corsCompatibilityDesc`)}),(0,Y.jsx)(k,{control:(0,Y.jsx)(R,{checked:b.useCorsPlugin||!1,onChange:e=>{h(v({id:b.id,updates:{useCorsPlugin:e.target.checked}}))}}),label:(0,Y.jsxs)(N,{children:[(0,Y.jsx)(V,{variant:`body2`,children:t(`modelSettings.provider.enableCorsPlugin`)}),(0,Y.jsx)(V,{variant:`caption`,color:`text.secondary`,children:t(`modelSettings.provider.corsPluginNote`)})]}),sx:{ml:0,"& .MuiFormControlLabel-label":{ml:1}}})]})]})]})]}),(0,Y.jsxs)(o,{elevation:0,sx:{p:1,borderRadius:2,border:`1px solid`,borderColor:`divider`,bgcolor:`background.paper`,boxShadow:`0 4px 12px rgba(0,0,0,0.05)`},children:[(0,Y.jsxs)(N,{sx:{display:`flex`,alignItems:`center`,mb:3},children:[(0,Y.jsx)(V,{variant:`subtitle1`,sx:{fontWeight:600,flex:1,color:`text.primary`},children:b.isSystem?t(`modelSettings.provider.modelCombos`):t(`modelSettings.provider.availableModels`)}),b.isSystem?(0,Y.jsx)(M,{variant:`outlined`,startIcon:(0,Y.jsx)(w,{size:16}),onClick:()=>p(`/settings/model-combo`),sx:{borderRadius:2,borderColor:e=>L(e.palette.primary.main,.5),color:`primary.main`,"&:hover":{borderColor:`primary.main`,bgcolor:e=>L(e.palette.primary.main,.1)}},children:t(`modelSettings.provider.manageCombos`)}):(0,Y.jsxs)(N,{sx:{display:`flex`,alignItems:`center`,gap:1},children:[(0,Y.jsx)(M,{variant:`outlined`,startIcon:(0,Y.jsx)(r,{size:16}),onClick:ft,sx:{borderRadius:2,borderColor:e=>L(e.palette.info.main,.5),color:`info.main`,"&:hover":{borderColor:`info.main`,bgcolor:e=>L(e.palette.info.main,.1)}},children:t(`modelSettings.provider.autoFetch`)}),(0,Y.jsx)(u,{size:`small`,onClick:rt,sx:{color:`info.main`,"&:hover":{bgcolor:e=>L(e.palette.info.main,.1)}},title:t(`modelSettings.provider.configureEndpoint`),children:(0,Y.jsx)(w,{size:16})}),(0,Y.jsx)(M,{startIcon:(0,Y.jsx)(n,{size:16}),onClick:()=>de(!0),sx:{bgcolor:e=>L(e.palette.primary.main,.1),color:`primary.main`,"&:hover":{bgcolor:e=>L(e.palette.primary.main,.2)},borderRadius:2},children:t(`modelSettings.provider.manualAdd`)})]})]}),b.isSystem?(0,Y.jsxs)(ie,{sx:{width:`100%`},children:[b.models.map(e=>(0,Y.jsx)(o,{elevation:0,sx:{mb:2,borderRadius:2,border:`1px solid`,borderColor:`divider`,overflow:`hidden`,transition:`all 0.2s`,"&:hover":{boxShadow:`0 4px 8px rgba(0,0,0,0.05)`,borderColor:e=>L(e.palette.primary.main,.3)}},children:(0,Y.jsx)(re,{secondaryAction:(0,Y.jsx)(N,{children:(0,Y.jsx)(u,{"aria-label":`edit-combo`,onClick:()=>p(`/settings/model-combo`),sx:Je.primary,children:(0,Y.jsx)(w,{size:20,color:`#1976d2`})})}),children:(0,Y.jsx)(ke,{primary:(0,Y.jsxs)(N,{sx:{display:`flex`,alignItems:`center`},children:[(0,Y.jsx)(V,{variant:`subtitle2`,fontWeight:600,children:e.name}),e.isDefault&&(0,Y.jsx)(N,{sx:{ml:1,px:1,py:.2,borderRadius:1,fontSize:`0.7rem`,fontWeight:600,bgcolor:e=>L(e.palette.success.main,.1),color:`success.main`},children:t(`modelSettings.provider.defaultBadge`)})]})})})},e.id)),b.models.length===0&&(0,Y.jsxs)(N,{sx:{textAlign:`center`,py:3},children:[(0,Y.jsx)(V,{color:`text.secondary`,children:t(`modelSettings.provider.noCombos`)}),(0,Y.jsx)(M,{variant:`outlined`,startIcon:(0,Y.jsx)(n,{size:16}),onClick:()=>p(`/settings/model-combo`),sx:{mt:2},children:t(`modelSettings.provider.createCombo`)})]})]}):(0,Y.jsx)(N,{sx:{width:`100%`},children:(0,Y.jsx)(Tt,{modelGroups:mt,showEmptyState:!0,emptyStateKey:t(`modelSettings.provider.noModels`),defaultExpanded:[],renderModelItem:e=>(0,Y.jsx)(Cn,{model:e,alwaysShowTestButton:x||!1,onEdit:ct,onDelete:st,onTest:pt},e.id),renderGroupButton:(e,t)=>{let n=c===e;return(0,Y.jsx)(u,{onClick:t=>{t.stopPropagation(),n?(gt(e),l(null)):(l(e),setTimeout(()=>{l(t=>t===e?null:t)},3e3))},onBlur:()=>{n&&setTimeout(()=>l(null),150)},sx:{width:{xs:40,sm:36},height:{xs:40,sm:36},minWidth:{xs:40,sm:36},borderRadius:1.5,p:0,bgcolor:e=>n?e.palette.error.main:L(e.palette.error.main,.12),color:n?`white`:`error.main`,"&:hover":{bgcolor:e=>n?e.palette.error.dark:L(e.palette.error.main,.2)},transition:`all 0.2s ease`,...n&&{animation:`pulse 1s ease-in-out infinite`,"@keyframes pulse":{"0%, 100%":{transform:`scale(1)`},"50%":{transform:`scale(1.05)`}}}},title:n?`再次点击确认删除 ${t.length} 个模型`:`删除 ${e} 组`,children:(0,Y.jsx)(s,{size:18})})}})})]}),(0,Y.jsx)(At,{testResult:je,testResultDialogOpen:Ne,onClose:()=>Me(null),onOpenDialog:()=>H(!0)}),(0,Y.jsx)(jt,{open:Ne,onClose:()=>H(!1),testResult:je})]}),(0,Y.jsx)(Et,{open:ue,onClose:()=>de(!1),newModelName:I,newModelValue:we,onModelNameChange:Se,onModelValueChange:z,onAddModel:at}),(0,Y.jsx)(Ct,{open:he,onClose:()=>ge(!1),onSave:ot,editModel:_e}),(0,Y.jsx)(Dt,{open:P,onClose:()=>me(!1),providerName:b.name,onDelete:et}),(0,Y.jsx)(Ot,{open:U,onClose:()=>Pe(!1),providerName:W,providerType:G,onProviderNameChange:Fe,onProviderTypeChange:Ie,onSave:nt}),(0,Y.jsx)(kt,{open:Ve,onClose:()=>He(!1),customEndpoint:ze,customEndpointError:K,onCustomEndpointChange:e=>{Be(e),Ue(``)},onSave:it}),b&&(0,Y.jsx)(ht,{open:Oe,onClose:()=>Ae(!1),provider:b,onAddModel:lt,onAddModels:ut,onRemoveModel:st,onRemoveModels:dt,existingModels:b.models||[]})]}):(0,Y.jsxs)(N,{sx:{p:3},children:[(0,Y.jsx)(V,{children:t(`modelSettings.provider.notFound`)}),(0,Y.jsx)(M,{onClick:Qe,children:t(`common.back`)})]})};export{wn as default};