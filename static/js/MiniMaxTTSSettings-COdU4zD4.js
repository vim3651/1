import{t as e}from"./InputAdornment-DO0tC8Wv.js";import{Ad as t,Cd as n,Du as r,Eu as i,Iu as a,Ju as o,Nu as s,Ot as c,Qu as l,Sd as u,Zu as d,_ as f,bd as ee,ci as p,dd as m,fd as h,hu as g,ip as _,ju as v,np as y,nu as te,pp as b,qp as x,s as S,td as C,tu as w,xd as T,xp as E,xu as D,zp as O}from"./index-hvLbsAjx.js";import"./SolidBridge-4JuNrAWl.js";import{c as k,l as A,o as j,s as M,t as N}from"./tts-v2-DDBlG3xK.js";import{t as P}from"./FullScreenSelectorSolid-D7sSYiET.js";import{t as F}from"./TTSTestSection-BqHpnV2B.js";var I=x(O(),1),L=x(E(),1),R=()=>{let x=b(),{t:E}=p(),O=(0,I.useMemo)(()=>N.getInstance(),[]),R=(0,I.useRef)(null),z=(0,I.useRef)(null),[B,V]=(0,I.useState)({apiKey:``,showApiKey:!1,groupId:``,model:`speech-02-hd`,voiceId:`female-tianmei`,emotion:`neutral`,speed:1,pitch:0,languageBoost:``,useStream:!1}),[H,U]=(0,I.useState)({isSaved:!1,saveError:``,isTestPlaying:!1}),[W,G]=(0,I.useState)(``),[K,q]=(0,I.useState)(!0),[J,Y]=(0,I.useState)(!1),[X,Z]=(0,I.useState)(!1),[ne,Q]=(0,I.useState)(!1),re=(0,I.useMemo)(()=>[{name:`可用音色`,items:A.map(e=>({key:e.id,label:e.name,subLabel:e.description}))}],[]),ie=(0,I.useMemo)(()=>[{name:`情感风格`,items:j.map(e=>({key:e.id,label:e.name,subLabel:e.description}))}],[]),ae=(0,I.useMemo)(()=>A.find(e=>e.id===B.voiceId)?.name||B.voiceId,[B.voiceId]),oe=(0,I.useMemo)(()=>j.find(e=>e.id===B.emotion)?.name||B.emotion,[B.emotion]);(0,I.useEffect)(()=>{(async()=>{try{let e=await y(`minimax_tts_api_key`)||``,t=await y(`minimax_tts_group_id`)||``,n=await y(`minimax_tts_model`)||`speech-02-hd`,r=await y(`minimax_tts_voice`)||`female-tianmei`,i=await y(`minimax_tts_emotion`)||`neutral`,a=Number(await y(`minimax_tts_speed`)||`1.0`),o=Number(await y(`minimax_tts_pitch`)||`0`),s=await y(`minimax_tts_language_boost`)||``,c=await y(`minimax_tts_stream`)===`true`,l=await y(`enable_tts`)!==`false`,u=await y(`selected_tts_service`)||`siliconflow`;V({apiKey:e,showApiKey:!1,groupId:t,model:n,voiceId:r,emotion:i,speed:a,pitch:o,languageBoost:s,useStream:c}),q(l),Y(u===`minimax`),O.configureEngine(`minimax`,{enabled:!0,apiKey:e,groupId:t,model:n,voiceId:r,emotion:i,speed:a,pitch:o,languageBoost:s,useStream:c}),G(E(`settings.voice.minimax.testText`)||`你好，这是 MiniMax 语音合成的测试。`)}catch(e){console.error(`加载 MiniMax TTS 设置失败:`,e)}})()},[O,E]);let se=(0,I.useCallback)(async()=>{try{await _(`minimax_tts_api_key`,B.apiKey),await _(`minimax_tts_group_id`,B.groupId),await _(`minimax_tts_model`,B.model),await _(`minimax_tts_voice`,B.voiceId),await _(`minimax_tts_emotion`,B.emotion),await _(`minimax_tts_speed`,B.speed.toString()),await _(`minimax_tts_pitch`,B.pitch.toString()),await _(`minimax_tts_language_boost`,B.languageBoost),await _(`minimax_tts_stream`,B.useStream.toString()),await _(`enable_tts`,K.toString()),O.configureEngine(`minimax`,{enabled:!0,apiKey:B.apiKey,groupId:B.groupId,model:B.model,voiceId:B.voiceId,emotion:B.emotion,speed:B.speed,pitch:B.pitch,languageBoost:B.languageBoost,useStream:B.useStream}),J?(await _(`selected_tts_service`,`minimax`),O.setActiveEngine(`minimax`)):O.configureEngine(`minimax`,{enabled:!1}),setTimeout(()=>{x(`/settings/voice`)},0)}catch(e){console.error(`保存 MiniMax TTS 设置失败:`,e),U(e=>({...e,saveError:E(`settings.voice.common.saveError`)}))}},[B,K,J,O,x,E]),ce=(0,I.useCallback)(e=>{Y(e)},[]),le=(0,I.useCallback)(async()=>{if(H.isTestPlaying){O.stop(),z.current&&clearInterval(z.current),U(e=>({...e,isTestPlaying:!1}));return}if(!B.apiKey||!B.groupId){U(e=>({...e,saveError:E(`settings.voice.common.apiKeyRequired`)}));return}if(U(e=>({...e,isTestPlaying:!0})),O.configureEngine(`minimax`,{enabled:!0,apiKey:B.apiKey,groupId:B.groupId,model:B.model,voiceId:B.voiceId,emotion:B.emotion,speed:B.speed,pitch:B.pitch,languageBoost:B.languageBoost,useStream:B.useStream}),O.setActiveEngine(`minimax`),!await O.speak(W)){U(e=>({...e,isTestPlaying:!1}));return}z.current=setInterval(()=>{O.isPlaying||(U(e=>({...e,isTestPlaying:!1})),z.current&&clearInterval(z.current))},100)},[B,W,O,H.isTestPlaying,E]),ue=()=>{x(`/settings/voice`)};(0,I.useEffect)(()=>{let e=R.current,t=z.current;return()=>{e&&clearTimeout(e),t&&clearInterval(t),H.isTestPlaying&&O.stop()}},[H.isTestPlaying,O]);let de=c(`toolbar-bg`),fe=c(`toolbar-border`),$=c(`toolbar-shadow`),pe=c(`text-primary`),me=c(`border-default`),he=c(`border-subtle`),ge=c(`hover-bg`),_e=c(`bg-paper`),ve=c(`bg-default`),ye=c(`primary`);return(0,L.jsxs)(f,{sx:{width:`100vw`,overflow:`hidden`,backgroundColor:ve},children:[(0,L.jsx)(ee,{position:`static`,elevation:0,sx:{backgroundColor:de,color:pe,borderBottom:`1px solid ${fe}`,boxShadow:`0 18px 40px -24px ${$}`,backdropFilter:`blur(18px)`,WebkitBackdropFilter:`blur(18px)`},children:(0,L.jsxs)(r,{sx:{minHeight:{xs:56,sm:64},px:{xs:1.5,sm:2.5,md:4},gap:{xs:1,sm:1.5}},children:[(0,L.jsx)(n,{edge:`start`,onClick:ue,"aria-label":E(`settings.voice.back`),size:`large`,sx:{color:ye,mr:{xs:1,sm:2},borderRadius:2,border:`1px solid ${he}`,"&:hover":{backgroundColor:ge}},children:(0,L.jsx)(D,{size:20})}),(0,L.jsx)(T,{variant:`h6`,component:`div`,sx:{flexGrow:1,fontWeight:700,letterSpacing:`0.03em`,textTransform:`uppercase`},children:`MiniMax TTS`}),(0,L.jsx)(m,{onClick:se,variant:`contained`,sx:{borderRadius:2,px:{xs:2.5,sm:3},py:{xs:.9,sm:1},fontWeight:700},children:E(`settings.voice.common.save`)})]})}),(0,L.jsx)(h,{sx:{flex:1,overflow:`auto`,pt:2,pb:`var(--content-bottom-padding)`,px:{xs:1.5,sm:2.5,md:4}},children:(0,L.jsxs)(h,{sx:{maxWidth:960,mx:`auto`,width:`100%`},children:[H.isSaved&&(0,L.jsx)(u,{severity:`success`,sx:{mb:2,borderRadius:2},children:E(`settings.voice.common.saveSuccess`)}),H.saveError&&(0,L.jsx)(u,{severity:`error`,sx:{mb:2,borderRadius:2},children:H.saveError}),(0,L.jsxs)(t,{elevation:0,sx:{p:{xs:2.5,sm:3},mb:{xs:2,sm:3},borderRadius:{xs:2,sm:2.5},border:`1px solid ${me}`,bgcolor:_e,boxShadow:`0 18px 40px -28px ${$}`},children:[(0,L.jsx)(T,{variant:`h6`,sx:{mb:3,fontWeight:600},children:E(`settings.voice.common.apiConfig`)}),(0,L.jsxs)(h,{sx:{mb:3},children:[(0,L.jsx)(d,{control:(0,L.jsx)(S,{checked:J,onChange:e=>ce(e.target.checked)}),label:E(`settings.voice.common.enableService`,{name:`MiniMax TTS`})}),(0,L.jsx)(T,{variant:`body2`,color:`text.secondary`,sx:{mt:1,ml:4},children:E(`settings.voice.minimax.enableDesc`)||`启用后将使用 MiniMax 进行语音合成，支持高质量中文和粤语`})]}),(0,L.jsx)(C,{sx:{mb:3}}),(0,L.jsx)(i,{fullWidth:!0,label:`API Key`,type:B.showApiKey?`text`:`password`,value:B.apiKey,onChange:e=>V(t=>({...t,apiKey:e.target.value})),sx:{mb:2},InputProps:{endAdornment:(0,L.jsx)(e,{position:`end`,children:(0,L.jsx)(n,{onClick:()=>V(e=>({...e,showApiKey:!e.showApiKey})),edge:`end`,children:B.showApiKey?(0,L.jsx)(te,{size:20}):(0,L.jsx)(w,{size:20})})})},helperText:E(`settings.voice.minimax.apiKeyHelper`)||`从 MiniMax 控制台获取 API Key`}),(0,L.jsx)(i,{fullWidth:!0,label:`Group ID`,value:B.groupId,onChange:e=>V(t=>({...t,groupId:e.target.value})),sx:{mb:3},helperText:E(`settings.voice.minimax.groupIdHelper`)||`从 MiniMax 控制台获取 Group ID`}),(0,L.jsxs)(h,{sx:{display:`flex`,flexWrap:`wrap`,gap:2},children:[(0,L.jsx)(h,{sx:{width:{xs:`100%`,sm:`calc(50% - 8px)`}},children:(0,L.jsxs)(l,{fullWidth:!0,children:[(0,L.jsx)(o,{children:`模型`}),(0,L.jsx)(s,{value:B.model,label:`模型`,onChange:e=>V(t=>({...t,model:e.target.value})),children:k.map(e=>(0,L.jsxs)(a,{value:e.id,children:[e.name,` - `,e.description]},e.id))})]})}),(0,L.jsx)(h,{sx:{width:{xs:`100%`,sm:`calc(50% - 8px)`}},children:(0,L.jsx)(i,{fullWidth:!0,label:`语音`,value:ae,onClick:()=>Z(!0),InputProps:{readOnly:!0,endAdornment:(0,L.jsx)(e,{position:`end`,children:(0,L.jsx)(g,{size:18})}),sx:{cursor:`pointer`}},sx:{cursor:`pointer`}})}),(0,L.jsx)(h,{sx:{width:{xs:`100%`,sm:`calc(50% - 8px)`}},children:(0,L.jsx)(i,{fullWidth:!0,label:`情感`,value:oe,onClick:()=>Q(!0),InputProps:{readOnly:!0,endAdornment:(0,L.jsx)(e,{position:`end`,children:(0,L.jsx)(g,{size:18})}),sx:{cursor:`pointer`}},sx:{cursor:`pointer`}})}),(0,L.jsx)(h,{sx:{width:{xs:`100%`,sm:`calc(50% - 8px)`}},children:(0,L.jsxs)(l,{fullWidth:!0,children:[(0,L.jsx)(o,{children:`语言增强`}),(0,L.jsx)(s,{value:B.languageBoost,label:`语言增强`,onChange:e=>V(t=>({...t,languageBoost:e.target.value})),children:M.map(e=>(0,L.jsxs)(a,{value:e.id,children:[e.name,` - `,e.description]},e.id))})]})}),(0,L.jsxs)(h,{sx:{width:{xs:`100%`,sm:`calc(50% - 8px)`}},children:[(0,L.jsxs)(T,{gutterBottom:!0,children:[`语速: `,B.speed.toFixed(2)]}),(0,L.jsx)(v,{value:B.speed,min:.5,max:2,step:.05,onChange:(e,t)=>V(e=>({...e,speed:t}))})]}),(0,L.jsxs)(h,{sx:{width:{xs:`100%`,sm:`calc(50% - 8px)`}},children:[(0,L.jsxs)(T,{gutterBottom:!0,children:[`音调: `,B.pitch]}),(0,L.jsx)(v,{value:B.pitch,min:-12,max:12,step:1,onChange:(e,t)=>V(e=>({...e,pitch:t}))})]}),(0,L.jsx)(h,{sx:{width:{xs:`100%`,sm:`calc(50% - 8px)`}},children:(0,L.jsx)(d,{control:(0,L.jsx)(S,{checked:B.useStream,onChange:e=>V(t=>({...t,useStream:e.target.checked}))}),label:`流式传输`})})]})]}),(0,L.jsx)(F,{testText:W,setTestText:G,handleTestTTS:le,isTestPlaying:H.isTestPlaying,enableTTS:K,selectedTTSService:`minimax`})]})}),(0,L.jsx)(P,{open:X,onClose:()=>Z(!1),title:`选择语音`,groups:re,selectedKey:B.voiceId,onSelect:e=>V(t=>({...t,voiceId:e}))}),(0,L.jsx)(P,{open:ne,onClose:()=>Q(!1),title:`选择情感`,groups:ie,selectedKey:B.emotion,onSelect:e=>V(t=>({...t,emotion:e}))})]})};export{R as default};