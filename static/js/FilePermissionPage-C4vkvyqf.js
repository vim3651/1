const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["static/js/esm-BzUfsNfe.js","static/js/index-hvLbsAjx.js","static/css/index-iKlUzaLt.css"])))=>i.map(i=>d[i]);
import{t as e}from"./Card-CgnXHdbl.js";import{t}from"./CardContent-f2tPkMYB.js";import{t as n}from"./circle-x-CT1DTRz7.js";import{t as r}from"./file-text-BSjgZddV.js";import{t as i}from"./image-7oImefSY.js";import{t as a}from"./shield-DNkeYoa0.js";import{$l as o,Bu as s,Cd as c,Du as l,Mp as u,Ol as d,Rl as f,Sd as p,Vu as m,Wu as h,_ as g,at as _,bd as v,dd as y,fd as b,fu as x,jp as S,o as C,pp as w,qp as T,td as E,vd as D,wd as O,xd as k,xp as A,xu as j,zp as M,zu as N}from"./index-hvLbsAjx.js";var P=T(M(),1),F=T(A(),1);const I=()=>{let[c,l]=(0,P.useState)({granted:!1,message:``,loading:!0}),[g,v]=(0,P.useState)(!1),w=async()=>{try{l(e=>({...e,loading:!0}));let e=await _.checkPermissions();l({granted:e.granted,message:e.message,loading:!1})}catch(e){l({granted:!1,message:`检查权限失败: `+(e instanceof Error?e.message:String(e)),loading:!1})}};return(0,P.useEffect)(()=>{w()},[]),(0,F.jsx)(e,{children:(0,F.jsxs)(t,{children:[(0,F.jsxs)(b,{sx:{display:`flex`,alignItems:`center`,gap:2,mb:2},children:[(0,F.jsx)(a,{size:24}),(0,F.jsx)(k,{variant:`h6`,children:`文件访问权限`}),(0,F.jsx)(D,{icon:(()=>c.loading?(0,F.jsx)(O,{size:24}):c.granted?(0,F.jsx)(x,{color:`success`}):(0,F.jsx)(n,{color:`error`}))(),label:c.granted?`已授权`:`未授权`,color:(()=>c.loading?`info`:c.granted?`success`:`error`)(),variant:`outlined`})]}),(0,F.jsx)(k,{variant:`body2`,color:`text.secondary`,sx:{mb:2},children:`为了使用文件管理功能，应用需要访问设备存储的权限。`}),(0,F.jsxs)(b,{sx:{mb:2},children:[(0,F.jsx)(k,{variant:`subtitle2`,sx:{mb:1},children:`权限用途：`}),(0,F.jsxs)(h,{dense:!0,children:[(0,F.jsxs)(m,{children:[(0,F.jsx)(s,{children:(0,F.jsx)(o,{size:20})}),(0,F.jsx)(N,{primary:`浏览文件和文件夹`,secondary:`查看设备上的文件结构`})]}),(0,F.jsxs)(m,{children:[(0,F.jsx)(s,{children:(0,F.jsx)(r,{size:20})}),(0,F.jsx)(N,{primary:`编辑文本文件`,secondary:`查看和编辑代码、文档等文件`})]}),(0,F.jsxs)(m,{children:[(0,F.jsx)(s,{children:(0,F.jsx)(i,{size:20})}),(0,F.jsx)(N,{primary:`访问媒体文件`,secondary:`查看图片、视频、音频文件`})]})]})]}),(0,F.jsx)(E,{sx:{my:2}}),c.message&&(0,F.jsx)(p,{severity:c.granted?`success`:`warning`,sx:{mb:2},icon:c.granted?(0,F.jsx)(x,{}):(0,F.jsx)(d,{}),children:c.message}),(0,F.jsxs)(b,{sx:{display:`flex`,gap:1,flexWrap:`wrap`},children:[!c.granted&&(0,F.jsx)(y,{variant:`contained`,onClick:async()=>{try{v(!0);let e=await _.requestPermissions();l({granted:e.granted,message:e.message,loading:!1}),e.granted||l(e=>({...e,message:`权限被拒绝。请在系统设置中手动授予"所有文件访问权限"。`}))}catch(e){l({granted:!1,message:`请求权限失败: `+(e instanceof Error?e.message:String(e)),loading:!1})}finally{v(!1)}},disabled:g||c.loading,startIcon:g?(0,F.jsx)(O,{size:16}):(0,F.jsx)(a,{}),children:g?`请求中...`:`授权文件访问`}),(0,F.jsx)(y,{variant:`outlined`,onClick:w,disabled:c.loading,startIcon:(0,F.jsx)(a,{}),children:`检查权限状态`}),!c.granted&&(0,F.jsx)(y,{variant:`outlined`,onClick:async()=>{try{if(u.isNativePlatform()){let{Browser:e}=await S(async()=>{let{Browser:e}=await import(`./esm-BzUfsNfe.js`);return{Browser:e}},__vite__mapDeps([0,1,2]));await e.open({url:`app-settings:`})}else C.info(`请前往：设置 > 应用 > AetherLink > 权限 > 文件和媒体 > 允许管理所有文件`,`权限设置指导`)}catch{C.info(`请手动前往：设置 > 应用 > AetherLink > 权限 > 文件和媒体 > 允许管理所有文件`,`权限设置指导`)}},startIcon:(0,F.jsx)(f,{}),children:`手动设置`})]}),!c.granted&&(0,F.jsx)(p,{severity:`info`,sx:{mt:2},children:(0,F.jsxs)(k,{variant:`body2`,children:[(0,F.jsx)(`strong`,{children:`如果自动授权失败：`}),(0,F.jsx)(`br`,{}),`1. 点击"手动设置"按钮`,(0,F.jsx)(`br`,{}),`2. 在系统设置中找到"文件和媒体"权限`,(0,F.jsx)(`br`,{}),`3. 开启"允许管理所有文件"选项`]})})]})})};var L=()=>{let e=w();return(0,F.jsxs)(g,{children:[(0,F.jsx)(v,{position:`static`,color:`default`,elevation:1,children:(0,F.jsxs)(l,{children:[(0,F.jsx)(c,{edge:`start`,onClick:()=>{e(`/settings/workspace`)},sx:{mr:2},children:(0,F.jsx)(j,{})}),(0,F.jsx)(k,{variant:`h6`,component:`div`,sx:{flexGrow:1},children:`文件访问权限`})]})}),(0,F.jsx)(b,{sx:{flex:1,overflow:`auto`,p:2},children:(0,F.jsx)(I,{})})]})};export{L as default};