import{t as e}from"./key-BYdhPxO4.js";import{Ad as t,Cd as n,Du as r,Eu as i,Ku as a,Sd as o,Yr as s,Zu as c,_ as l,au as u,bd as d,bp as f,ci as p,dd as m,fd as h,fu as g,i as _,pp as v,qp as y,ru as b,s as x,td as S,wd as C,xd as w,xp as T,xu as E,yp as D,zp as O}from"./index-hvLbsAjx.js";import"./esm-DlPY44W4.js";import{n as k,t as A}from"./notionApiUtils-DbZ6-stV.js";var j=y(O(),1),M=y(T(),1),N=()=>{let y=v(),T=D(),{t:O}=p(),N=f(e=>e.settings.notion),P=(0,j.useMemo)(()=>N||{enabled:!1,apiKey:``,databaseId:``,pageTitleField:`Name`,dateField:``},[N]),{containerRef:F,handleScroll:I}=_(`settings-notion`,{autoRestore:!0,restoreDelay:0}),[L,R]=(0,j.useState)(!1),[z,B]=(0,j.useState)(null),[V,H]=(0,j.useState)(P);(0,j.useEffect)(()=>{H(P)},[P]);let U=()=>{y(`/settings`)},W=(e,t)=>{let n={...V,[e]:t};H(n),T(s({notion:n})),z&&B(null)},G=async()=>{if(!V.apiKey||!V.databaseId){B({success:!1,message:O(`settings.notion.testConnection.errorMissingFields`)});return}R(!0),B(null);try{let e=await k(`/v1/databases/${V.databaseId}`,{method:`GET`,apiKey:V.apiKey}),t=e.properties||{};if(!Object.keys(t).some(e=>e===V.pageTitleField&&t[e].type===`title`))B({success:!1,message:O(`settings.notion.testConnection.errorTitleFieldNotFound`,{field:V.pageTitleField})});else{let t=e.title?.[0]?.plain_text||``;B({success:!0,message:t?O(`settings.notion.testConnection.success`,{name:t}):O(`settings.notion.testConnection.successUnknown`)})}}catch(e){console.error(`测试Notion连接失败:`,e),B({success:!1,message:O(`settings.notion.testConnection.error`,{message:e instanceof A?e.getUserFriendlyMessage():e instanceof Error?e.message:O(`errors.unknownError`)})})}finally{R(!1)}};return(0,M.jsxs)(l,{children:[(0,M.jsx)(d,{position:`static`,elevation:0,sx:{bgcolor:`background.paper`,color:`text.primary`,borderBottom:1,borderColor:`divider`,backdropFilter:`blur(8px)`},children:(0,M.jsxs)(r,{children:[(0,M.jsx)(n,{edge:`start`,color:`inherit`,onClick:U,"aria-label":`back`,sx:{color:e=>e.palette.primary.main},children:(0,M.jsx)(E,{size:20})}),(0,M.jsx)(w,{variant:`h6`,component:`div`,sx:{flexGrow:1,fontWeight:600},children:O(`settings.notion.pageTitle`)})]})}),(0,M.jsx)(h,{ref:F,onScroll:I,sx:{flexGrow:1,overflowY:`auto`,p:{xs:1,sm:2},pb:`var(--content-bottom-padding)`,"&::-webkit-scrollbar":{width:{xs:`4px`,sm:`6px`}},"&::-webkit-scrollbar-thumb":{backgroundColor:`rgba(0,0,0,0.1)`,borderRadius:`3px`}},children:(0,M.jsxs)(t,{elevation:0,sx:{p:3,mb:3,border:`1px solid`,borderColor:`divider`,borderRadius:2},children:[(0,M.jsxs)(h,{sx:{display:`flex`,alignItems:`center`,mb:2},children:[(0,M.jsx)(u,{size:20,style:{marginRight:8}}),(0,M.jsx)(w,{variant:`h6`,component:`h3`,children:O(`settings.notion.configTitle`)})]}),(0,M.jsxs)(w,{variant:`body2`,color:`text.secondary`,sx:{mb:3},children:[O(`settings.notion.description`),(0,M.jsxs)(a,{href:`https://docs.cherry-ai.com/data-settings/notion`,target:`_blank`,sx:{ml:1,display:`inline-flex`,alignItems:`center`},children:[O(`settings.notion.viewTutorial`),(0,M.jsx)(b,{size:14,style:{marginLeft:4}})]})]}),(0,M.jsx)(c,{control:(0,M.jsx)(x,{checked:V.enabled,onChange:e=>W(`enabled`,e.target.checked)}),label:O(`settings.notion.enableExport`),sx:{mb:3}}),(0,M.jsxs)(h,{sx:{display:`flex`,flexDirection:`column`,gap:2,opacity:V.enabled?1:.5},children:[(0,M.jsx)(i,{label:O(`settings.notion.fields.apiKey.label`),type:`password`,value:V.apiKey,onChange:e=>W(`apiKey`,e.target.value),disabled:!V.enabled,placeholder:O(`settings.notion.fields.apiKey.placeholder`),helperText:O(`settings.notion.fields.apiKey.helperText`),InputProps:{startAdornment:(0,M.jsx)(e,{size:16,style:{marginRight:8,color:`#666`}})},fullWidth:!0}),(0,M.jsx)(i,{label:O(`settings.notion.fields.databaseId.label`),value:V.databaseId,onChange:e=>W(`databaseId`,e.target.value),disabled:!V.enabled,placeholder:O(`settings.notion.fields.databaseId.placeholder`),helperText:O(`settings.notion.fields.databaseId.helperText`),fullWidth:!0}),(0,M.jsx)(i,{label:O(`settings.notion.fields.pageTitleField.label`),value:V.pageTitleField,onChange:e=>W(`pageTitleField`,e.target.value),disabled:!V.enabled,placeholder:O(`settings.notion.fields.pageTitleField.placeholder`),helperText:O(`settings.notion.fields.pageTitleField.helperText`),fullWidth:!0}),(0,M.jsx)(i,{label:O(`settings.notion.fields.dateField.label`),value:V.dateField||``,onChange:e=>W(`dateField`,e.target.value),disabled:!V.enabled,placeholder:O(`settings.notion.fields.dateField.placeholder`),helperText:O(`settings.notion.fields.dateField.helperText`),fullWidth:!0}),(0,M.jsx)(m,{variant:`outlined`,onClick:G,disabled:!V.enabled||L||!V.apiKey||!V.databaseId,startIcon:L?(0,M.jsx)(C,{size:16}):(0,M.jsx)(g,{size:16}),sx:{alignSelf:`flex-start`,mt:1},children:O(L?`settings.notion.testConnection.testing`:`settings.notion.testConnection.button`)}),z&&(0,M.jsx)(o,{severity:z.success?`success`:`error`,sx:{mt:1},children:z.message}),(0,M.jsx)(o,{severity:`info`,sx:{mt:2},children:(0,M.jsxs)(w,{variant:`body2`,children:[(0,M.jsx)(`strong`,{children:O(`settings.notion.corsInfo.title`)}),(0,M.jsx)(`br`,{}),O(`settings.notion.corsInfo.webDev`),(0,M.jsx)(`br`,{}),O(`settings.notion.corsInfo.production`),(0,M.jsx)(`br`,{}),`1. `,O(`settings.notion.corsInfo.suggestion1`),(0,M.jsx)(`br`,{}),`2. `,O(`settings.notion.corsInfo.suggestion2`),(0,M.jsx)(`br`,{}),`3. `,O(`settings.notion.corsInfo.suggestion3`),(0,M.jsx)(`br`,{}),(0,M.jsx)(`strong`,{children:O(`settings.notion.corsInfo.note`)})]})})]}),(0,M.jsx)(S,{sx:{my:3}}),(0,M.jsxs)(h,{children:[(0,M.jsx)(w,{variant:`subtitle2`,gutterBottom:!0,children:O(`settings.notion.setupSteps.title`)}),(0,M.jsxs)(h,{component:`ol`,sx:{pl:2,"& li":{mb:1}},children:[(0,M.jsx)(`li`,{children:(0,M.jsxs)(w,{variant:`body2`,children:[O(`settings.notion.setupSteps.step1`),` `,(0,M.jsx)(a,{href:`https://www.notion.so/my-integrations`,target:`_blank`,children:O(`settings.notion.setupSteps.step1Link`)}),` `,O(`settings.notion.setupSteps.step1Suffix`)]})}),(0,M.jsx)(`li`,{children:(0,M.jsx)(w,{variant:`body2`,children:O(`settings.notion.setupSteps.step2`)})}),(0,M.jsx)(`li`,{children:(0,M.jsx)(w,{variant:`body2`,children:O(`settings.notion.setupSteps.step3`)})}),(0,M.jsx)(`li`,{children:(0,M.jsx)(w,{variant:`body2`,children:O(`settings.notion.setupSteps.step4`)})}),(0,M.jsx)(`li`,{children:(0,M.jsx)(w,{variant:`body2`,children:O(`settings.notion.setupSteps.step5`)})}),(0,M.jsx)(`li`,{children:(0,M.jsx)(w,{variant:`body2`,children:O(`settings.notion.setupSteps.step6`)})}),(0,M.jsx)(`li`,{children:(0,M.jsx)(w,{variant:`body2`,children:O(`settings.notion.setupSteps.step7`)})})]})]})]})})]})};export{N as default};