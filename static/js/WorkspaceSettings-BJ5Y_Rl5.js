import{t as e}from"./ListSubheader-K3IOJnRV.js";import{t}from"./Card-CgnXHdbl.js";import{t as n}from"./CardActionArea-HKezVk9G.js";import{t as r}from"./CardContent-f2tPkMYB.js";import{t as i}from"./ListItemAvatar-vt2ONwqY.js";import{t as a}from"./Switch-C_ekiChs.js";import{t as o}from"./clock-Dks_woIj.js";import{t as s}from"./plus-DCrdXXDc.js";import{t as c}from"./shield-DNkeYoa0.js";import{$l as l,Ad as u,Al as d,Bp as f,Cd as p,Du as m,Eu as h,Gi as g,Jc as _,Sd as v,Uu as y,Vu as b,Wu as x,Zu as S,ad as C,at as w,bd as T,dd as E,eu as D,fd as O,i as k,id as A,it as j,md as M,nd as N,o as P,oi as F,pp as I,qd as L,qp as R,rt as ee,td as z,vd as te,wd as B,xd as V,xp as H,xu as ne,yp as re,zp as U,zu as W}from"./index-hvLbsAjx.js";var G=R(U(),1),K=R(H(),1);const ie=({open:e,onClose:i,onSuccess:a})=>{let[o,s]=(0,G.useState)(``),[c,u]=(0,G.useState)(``),[d,f]=(0,G.useState)(``),[p,m]=(0,G.useState)(``),[_,y]=(0,G.useState)(!1),[b,x]=(0,G.useState)(null),[S,T]=(0,G.useState)(!1),k=()=>{s(``),u(``),f(``),m(``),x(null),y(!1),T(!1)},M=()=>{!_&&!S&&(k(),i())},P=async()=>{try{if(T(!0),x(null),!(await w.checkPermissions()).granted){console.log(`权限未授予，尝试请求权限...`);let e=await w.requestPermissions();if(!e.granted){x(e.message||`需要文件访问权限才能选择文件夹`),T(!1);return}}let e=await w.openSystemFilePicker({type:`directory`,multiple:!1,title:`选择工作区文件夹`});if(!e.cancelled&&e.directories.length>0){let t=e.directories[0];console.log(`选择的目录信息:`,t);let n=t.displayPath||t.path||t.uri||(typeof t==`string`?t:``);s(n),u(n),d||f(t.name||`新工作区`)}}catch(e){console.error(`选择文件夹失败:`,e),x(`选择文件夹失败，请手动输入路径`)}finally{T(!1)}},F=async()=>{if(!o.trim()||!d.trim()){x(`请填写完整信息`);return}y(!0),x(null);try{let e={name:d.trim(),path:o.trim(),description:p.trim()||void 0},t=await j.createWorkspace(e);t.success?(k(),a()):x(t.error||`创建工作区失败`)}catch(e){x(`创建工作区失败，请重试`),console.error(`创建工作区失败:`,e)}finally{y(!1)}},I=o.trim()&&d.trim();return(0,K.jsxs)(g,{open:e,onClose:M,maxWidth:`sm`,fullWidth:!0,children:[(0,K.jsx)(N,{children:(0,K.jsx)(V,{variant:`h6`,children:`创建新工作区`})}),(0,K.jsxs)(A,{children:[b&&(0,K.jsx)(v,{severity:`error`,sx:{mb:2},onClose:()=>x(null),children:b}),(0,K.jsxs)(O,{sx:{mb:3},children:[(0,K.jsx)(V,{variant:`body1`,gutterBottom:!0,children:`选择工作区文件夹：`}),(0,K.jsx)(t,{variant:`outlined`,sx:{mb:2},children:(0,K.jsx)(n,{onClick:P,disabled:S,children:(0,K.jsxs)(r,{sx:{textAlign:`center`,py:3},children:[S?(0,K.jsx)(B,{size:40}):(0,K.jsx)(D,{size:40,style:{color:`#1976d2`,marginBottom:8}}),(0,K.jsx)(V,{variant:`body1`,color:S?`text.secondary`:`primary`,children:S?`选择中...`:`点击选择文件夹`}),(0,K.jsx)(V,{variant:`body2`,color:`text.secondary`,children:`使用系统文件管理器选择`})]})})}),(0,K.jsx)(h,{fullWidth:!0,label:`文件夹路径`,placeholder:`例如: /storage/emulated/0/Download`,value:c||o,onChange:e=>{let t=e.target.value;s(t),u(t),!d&&t&&typeof t==`string`&&f(t.split(`/`).pop()||`新工作区`)},helperText:`请输入完整的文件夹路径`})]}),(0,K.jsxs)(O,{children:[(0,K.jsx)(V,{variant:`body1`,gutterBottom:!0,children:`工作区信息：`}),(0,K.jsx)(h,{fullWidth:!0,label:`工作区名称`,value:d,onChange:e=>f(e.target.value),sx:{mb:2},required:!0}),(0,K.jsx)(h,{fullWidth:!0,label:`描述（可选）`,value:p,onChange:e=>m(e.target.value),multiline:!0,rows:3,placeholder:`描述这个工作区的用途...`})]}),(c||o)&&(0,K.jsx)(v,{severity:`info`,sx:{mt:2},children:(0,K.jsxs)(V,{variant:`body2`,children:[(0,K.jsx)(`strong`,{children:`文件夹路径：`}),` `,c||o]})})]}),(0,K.jsxs)(C,{children:[(0,K.jsx)(E,{onClick:M,disabled:_,children:`取消`}),(0,K.jsx)(E,{onClick:F,variant:`contained`,disabled:!I||_,startIcon:_?(0,K.jsx)(B,{size:16}):(0,K.jsx)(l,{}),children:_?`创建中...`:`创建工作区`})]})]})};var q=f(((e,t)=>{(function(n,r){typeof e==`object`&&t!==void 0?t.exports=r():typeof define==`function`&&define.amd?define(r):(n=typeof globalThis<`u`?globalThis:n||self).dayjs_plugin_relativeTime=r()})(e,(function(){return function(e,t,n){e||={};var r=t.prototype,i={future:`in %s`,past:`%s ago`,s:`a few seconds`,m:`a minute`,mm:`%d minutes`,h:`an hour`,hh:`%d hours`,d:`a day`,dd:`%d days`,M:`a month`,MM:`%d months`,y:`a year`,yy:`%d years`};function a(e,t,n,i){return r.fromToBase(e,t,n,i)}n.en.relativeTime=i,r.fromToBase=function(t,r,a,o,s){for(var c,l,u,d=a.$locale().relativeTime||i,f=e.thresholds||[{l:`s`,r:44,d:`second`},{l:`m`,r:89},{l:`mm`,r:44,d:`minute`},{l:`h`,r:89},{l:`hh`,r:21,d:`hour`},{l:`d`,r:35},{l:`dd`,r:25,d:`day`},{l:`M`,r:45},{l:`MM`,r:10,d:`month`},{l:`y`,r:17},{l:`yy`,d:`year`}],p=f.length,m=0;m<p;m+=1){var h=f[m];h.d&&(c=o?n(t).diff(a,h.d,!0):a.diff(t,h.d,!0));var g=(e.rounding||Math.round)(Math.abs(c));if(u=c>0,g<=h.r||!h.r){g<=1&&m>0&&(h=f[m-1]);var _=d[h.l];s&&(g=s(``+g)),l=typeof _==`string`?_.replace(`%d`,g):_(g,r,h.l,u);break}}if(r)return l;var v=u?d.future:d.past;return typeof v==`function`?v(l):v.replace(`%s`,l)},r.to=function(e,t){return a(e,t,this,!0)},r.from=function(e,t){return a(e,t,this)};var o=function(e){return e.$u?n.utc():n()};r.toNow=function(e){return this.to(o(this),e)},r.fromNow=function(e){return this.from(o(this),e)}}}))})),J=f(((e,t)=>{(function(n,r){typeof e==`object`&&t!==void 0?t.exports=r(_()):typeof define==`function`&&define.amd?define([`dayjs`],r):(n=typeof globalThis<`u`?globalThis:n||self).dayjs_locale_zh_cn=r(n.dayjs)})(e,(function(e){function t(e){return e&&typeof e==`object`&&`default`in e?e:{default:e}}var n=t(e),r={name:`zh-cn`,weekdays:`星期日_星期一_星期二_星期三_星期四_星期五_星期六`.split(`_`),weekdaysShort:`周日_周一_周二_周三_周四_周五_周六`.split(`_`),weekdaysMin:`日_一_二_三_四_五_六`.split(`_`),months:`一月_二月_三月_四月_五月_六月_七月_八月_九月_十月_十一月_十二月`.split(`_`),monthsShort:`1月_2月_3月_4月_5月_6月_7月_8月_9月_10月_11月_12月`.split(`_`),ordinal:function(e,t){return t===`W`?e+`周`:e+`日`},weekStart:1,yearStart:4,formats:{LT:`HH:mm`,LTS:`HH:mm:ss`,L:`YYYY/MM/DD`,LL:`YYYY年M月D日`,LLL:`YYYY年M月D日Ah点mm分`,LLLL:`YYYY年M月D日ddddAh点mm分`,l:`YYYY/M/D`,ll:`YYYY年M月D日`,lll:`YYYY年M月D日 HH:mm`,llll:`YYYY年M月D日dddd HH:mm`},relativeTime:{future:`%s内`,past:`%s前`,s:`几秒`,m:`1 分钟`,mm:`%d 分钟`,h:`1 小时`,hh:`%d 小时`,d:`1 天`,dd:`%d 天`,M:`1 个月`,MM:`%d 个月`,y:`1 年`,yy:`%d 年`},meridiem:function(e,t){var n=100*e+t;return n<600?`凌晨`:n<900?`早上`:n<1100?`上午`:n<1300?`中午`:n<1800?`下午`:`晚上`}};return n.default.locale(r,null,!0),r}))})),Y=R(_(),1),X=R(q(),1);J(),Y.default.extend(X.default),Y.default.locale(`zh-cn`);var Z=()=>{let t=I(),n=re(),[r,f]=(0,G.useState)([]),[h,_]=(0,G.useState)(!0),[w,R]=(0,G.useState)(null),[B,H]=(0,G.useState)(!1),[U,q]=(0,G.useState)(!1),[J,X]=(0,G.useState)(null),[Z,Q]=(0,G.useState)(!1),{containerRef:ae,handleScroll:oe}=k(`settings-workspace`,{autoRestore:!0,restoreDelay:0}),$=async()=>{try{_(!0),R(null),f((await j.getWorkspaces()).workspaces),Q(await j.isSidebarEnabled())}catch(e){R(`加载工作区列表失败`),console.error(`加载工作区失败:`,e)}finally{_(!1)}};(0,G.useEffect)(()=>{$()},[]);let se=async e=>{let t=e.target.checked;await j.setSidebarEnabled(t),n(F({[ee]:t})),Q(t),P.success(`侧边栏入口已${t?`启用`:`禁用`}`,`设置成功`)},ce=()=>{t(`/settings`)},le=()=>{H(!1),$()},ue=async()=>{if(J)try{let e=await j.deleteWorkspace(J.id);e.success?(q(!1),X(null),$()):R(e.error||`删除工作区失败`)}catch(e){R(`删除工作区失败`),console.error(`删除工作区失败:`,e)}},de=e=>{X(e),q(!0)},fe=e=>{t(`/settings/workspace/${e.id}`)},pe=()=>{t(`/settings/file-permission`)},me=e=>e.length>30?`...${e.slice(-27)}`:e;return(0,K.jsxs)(O,{sx:{flexGrow:1,display:`flex`,flexDirection:`column`,height:`100vh`,bgcolor:e=>e.palette.mode===`light`?L(e.palette.primary.main,.02):L(e.palette.background.default,.9)},children:[(0,K.jsx)(T,{position:`static`,elevation:0,sx:{bgcolor:`background.paper`,color:`text.primary`,borderBottom:1,borderColor:`divider`,backdropFilter:`blur(8px)`},children:(0,K.jsxs)(m,{children:[(0,K.jsx)(p,{edge:`start`,color:`inherit`,onClick:ce,"aria-label":`back`,sx:{color:e=>e.palette.primary.main},children:(0,K.jsx)(ne,{})}),(0,K.jsx)(V,{variant:`h6`,component:`div`,sx:{flexGrow:1,fontWeight:600},children:`工作区管理`}),(0,K.jsx)(E,{startIcon:(0,K.jsx)(c,{}),onClick:pe,sx:{bgcolor:e=>L(e.palette.primary.main,.1),color:`primary.main`,"&:hover":{bgcolor:e=>L(e.palette.primary.main,.2)},borderRadius:2,mr:1},children:`权限管理`}),(0,K.jsx)(E,{startIcon:(0,K.jsx)(s,{}),onClick:()=>H(!0),sx:{bgcolor:e=>L(e.palette.primary.main,.1),color:`primary.main`,"&:hover":{bgcolor:e=>L(e.palette.primary.main,.2)},borderRadius:2},children:`添加`})]})}),(0,K.jsxs)(O,{ref:ae,onScroll:oe,sx:{flexGrow:1,overflowY:`auto`,p:2,"&::-webkit-scrollbar":{width:`6px`},"&::-webkit-scrollbar-thumb":{backgroundColor:`rgba(0,0,0,0.1)`,borderRadius:`3px`}},children:[w&&(0,K.jsx)(v,{severity:`error`,sx:{mb:2},onClose:()=>R(null),children:w}),(0,K.jsx)(u,{elevation:0,sx:{mb:2,borderRadius:2,border:`1px solid`,borderColor:`divider`,overflow:`hidden`,bgcolor:`background.paper`,boxShadow:`0 4px 12px rgba(0,0,0,0.05)`},children:(0,K.jsxs)(O,{sx:{p:2,display:`flex`,alignItems:`center`,justifyContent:`space-between`},children:[(0,K.jsxs)(O,{children:[(0,K.jsx)(V,{variant:`subtitle1`,sx:{fontWeight:600},children:`侧边栏快捷入口`}),(0,K.jsx)(V,{variant:`body2`,color:`text.secondary`,children:`在聊天侧边栏显示工作区标签页，方便快速访问`})]}),(0,K.jsx)(S,{control:(0,K.jsx)(a,{checked:Z,onChange:se,color:`primary`}),label:``})]})}),h?(0,K.jsx)(O,{sx:{display:`flex`,justifyContent:`center`,mt:4},children:(0,K.jsx)(V,{children:`加载中...`})}):r.length===0?(0,K.jsxs)(u,{elevation:0,sx:{mb:2,borderRadius:2,border:`1px solid`,borderColor:`divider`,overflow:`hidden`,bgcolor:`background.paper`,boxShadow:`0 4px 12px rgba(0,0,0,0.05)`,textAlign:`center`,p:6},children:[(0,K.jsx)(D,{size:64,style:{color:`#666`,marginBottom:16}}),(0,K.jsx)(V,{variant:`h6`,color:`text.secondary`,gutterBottom:!0,children:`还没有工作区`}),(0,K.jsx)(V,{variant:`body2`,color:`text.secondary`,sx:{mb:3},children:`创建工作区来管理您的文件和文档`}),(0,K.jsx)(E,{variant:`contained`,startIcon:(0,K.jsx)(s,{}),onClick:()=>H(!0),sx:{bgcolor:`primary.main`,color:`white`,fontWeight:600,borderRadius:2,boxShadow:`0 4px 12px rgba(79, 70, 229, 0.3)`,"&:hover":{bgcolor:`primary.dark`,boxShadow:`0 6px 16px rgba(79, 70, 229, 0.4)`}},children:`创建第一个工作区`})]}):(0,K.jsxs)(u,{elevation:0,sx:{mb:2,borderRadius:2,border:`1px solid`,borderColor:`divider`,overflow:`hidden`,bgcolor:`background.paper`,boxShadow:`0 4px 12px rgba(0,0,0,0.05)`},children:[(0,K.jsxs)(O,{sx:{p:2,bgcolor:`rgba(0,0,0,0.01)`},children:[(0,K.jsx)(V,{variant:`subtitle1`,sx:{fontWeight:600},children:`工作区列表`}),(0,K.jsx)(V,{variant:`body2`,color:`text.secondary`,children:`管理您的工作区，点击对应的工作区进行访问和管理`})]}),(0,K.jsx)(z,{}),(0,K.jsx)(x,{disablePadding:!0,children:r.map((e,t)=>(0,K.jsxs)(G.Fragment,{children:[(0,K.jsxs)(y,{onClick:()=>fe(e),sx:{transition:`all 0.2s`,"&:hover":{bgcolor:e=>L(e.palette.primary.main,.05)},py:2},children:[(0,K.jsx)(i,{children:(0,K.jsx)(M,{sx:{bgcolor:`#1976d2`,boxShadow:`0 2px 6px rgba(0,0,0,0.05)`},children:(0,K.jsx)(l,{})})}),(0,K.jsx)(W,{primary:(0,K.jsx)(V,{sx:{fontWeight:600,color:`text.primary`},children:e.name}),secondary:(0,K.jsxs)(O,{children:[e.description&&(0,K.jsx)(V,{variant:`body2`,color:`text.secondary`,sx:{mb:.5},children:e.description}),(0,K.jsx)(O,{sx:{display:`flex`,alignItems:`center`,gap:1,mb:.5},children:(0,K.jsx)(te,{label:me(e.path),size:`small`,sx:{backgroundColor:`#333333`,color:`#cccccc`,height:`20px`,"& .MuiChip-label":{fontSize:`0.65rem`,px:.5}}})}),(0,K.jsxs)(O,{sx:{display:`flex`,alignItems:`center`},children:[(0,K.jsx)(o,{size:14,style:{marginRight:4,color:`#666`}}),(0,K.jsx)(V,{variant:`caption`,color:`text.secondary`,children:e.lastAccessedAt?`最后访问 ${(0,Y.default)(e.lastAccessedAt).fromNow()}`:`创建于 ${(0,Y.default)(e.createdAt).fromNow()}`})]})]}),primaryTypographyProps:{component:`div`},secondaryTypographyProps:{component:`div`}}),(0,K.jsx)(p,{size:`small`,onClick:t=>{t.stopPropagation(),de(e)},sx:{mr:1,color:`text.secondary`,"&:hover":{color:`error.main`,bgcolor:e=>L(e.palette.error.main,.1)}},children:(0,K.jsx)(d,{size:16})})]}),t<r.length-1&&(0,K.jsx)(z,{variant:`inset`,component:`li`,sx:{ml:0}})]},e.id))})]}),(0,K.jsx)(u,{elevation:0,sx:{mb:2,borderRadius:2,border:`1px solid`,borderColor:`divider`,overflow:`hidden`,bgcolor:`background.paper`,boxShadow:`0 4px 12px rgba(0,0,0,0.05)`},children:(0,K.jsxs)(x,{subheader:(0,K.jsx)(e,{component:`div`,sx:{bgcolor:`rgba(0,0,0,0.01)`,py:1,fontWeight:600,color:`text.primary`},children:`推荐操作`}),children:[(0,K.jsx)(b,{disablePadding:!0,children:(0,K.jsxs)(y,{onClick:()=>H(!0),sx:{transition:`all 0.2s`,"&:hover":{bgcolor:e=>L(e.palette.primary.main,.05)}},children:[(0,K.jsx)(i,{children:(0,K.jsx)(M,{sx:{bgcolor:L(`#4f46e5`,.12),color:`#4f46e5`,boxShadow:`0 2px 6px rgba(0,0,0,0.05)`},children:(0,K.jsx)(s,{})})}),(0,K.jsx)(W,{primary:(0,K.jsx)(V,{sx:{fontWeight:600,color:`text.primary`},children:`创建新工作区`}),secondary:`添加新的工作区来管理您的文件和文档`,primaryTypographyProps:{component:`div`}})]})}),(0,K.jsx)(z,{variant:`inset`,component:`li`,sx:{ml:0}}),(0,K.jsx)(b,{disablePadding:!0,children:(0,K.jsxs)(y,{onClick:pe,sx:{transition:`all 0.2s`,"&:hover":{bgcolor:e=>L(e.palette.primary.main,.05)}},children:[(0,K.jsx)(i,{children:(0,K.jsx)(M,{sx:{bgcolor:L(`#06b6d4`,.12),color:`#06b6d4`,boxShadow:`0 2px 6px rgba(0,0,0,0.05)`},children:(0,K.jsx)(c,{})})}),(0,K.jsx)(W,{primary:(0,K.jsx)(V,{sx:{fontWeight:600,color:`text.primary`},children:`文件权限管理`}),secondary:`管理文件访问权限和安全设置`,primaryTypographyProps:{component:`div`}})]})})]})})]}),(0,K.jsx)(ie,{open:B,onClose:()=>H(!1),onSuccess:le}),(0,K.jsxs)(g,{open:U,onClose:()=>q(!1),maxWidth:`sm`,fullWidth:!0,PaperProps:{sx:{borderRadius:2}},children:[(0,K.jsx)(N,{sx:{fontWeight:600},children:`删除工作区`}),(0,K.jsxs)(A,{sx:{pt:2},children:[(0,K.jsxs)(V,{children:[`确定要删除工作区 "`,J?.name,`" 吗？`]}),(0,K.jsx)(V,{variant:`body2`,color:`text.secondary`,sx:{mt:1},children:`这只会删除工作区配置，不会删除实际的文件。`})]}),(0,K.jsxs)(C,{sx:{p:2},children:[(0,K.jsx)(E,{onClick:()=>q(!1),children:`取消`}),(0,K.jsx)(E,{onClick:ue,color:`error`,variant:`contained`,sx:{borderRadius:2},children:`删除`})]})]})]})};export{Z as default};