import{Ef as e}from"./index-hvLbsAjx.js";import{t}from"./providerIcons-C3i_yWyD.js";var n=200,r=new Map,i=new Map,a=(e,t)=>{e.size>t&&Array.from(e.keys()).slice(0,e.size-t).forEach(t=>e.delete(t))};const o=()=>localStorage.getItem(`user_avatar`),s=e=>{localStorage.setItem(`user_avatar`,e)},c=async t=>{let i=r.get(t);if(i)return i;let o=(async()=>(await e.getAssistant(t))?.avatar||null)();return r.set(t,o),a(r,n),o};var l=()=>window.matchMedia?.(`(prefers-color-scheme: dark)`).matches??!1;const u=async(r,o,s)=>{if(o)return o;let c=l(),u=`${r}:${s||``}:${c?`dark`:`light`}`,d=i.get(u);if(d)return d;let f=(async()=>{let n=await e.getModel(r);return n?.avatar?n.avatar:s?t(r,s,c):null})();return i.set(u,f),a(i,n),f},d=e=>{if(e)for(let t of i.keys())t.startsWith(`${e}:`)&&i.delete(t);else i.clear()},f=async(t,n)=>{let r=await e.getModel(t);await e.saveModel(t,{...r||{},id:t,avatar:n,updatedAt:new Date().toISOString()}),d(t)};typeof window<`u`&&window.matchMedia&&window.matchMedia(`(prefers-color-scheme: dark)`).addEventListener(`change`,()=>{d()});export{f as a,o as i,c as n,s as o,u as r,d as t};