const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["static/js/RichEditor-Dj7Dd46u.js","static/js/RichEditor-CcHeP50K.js","static/js/index-hvLbsAjx.js","static/css/index-iKlUzaLt.css","static/js/file-code-B0j5RiLs.js","static/js/image-7oImefSY.js","static/js/list-xtcNycqC.js","static/js/quote-CbtT0pf9.js","static/css/RichEditor-CrFr9Jcf.css"])))=>i.map(i=>d[i]);
import{n as e}from"./RichEditor-CcHeP50K.js";import{t}from"./file-text-BSjgZddV.js";import{Bl as n,Cd as r,Cl as i,Du as a,Ji as o,Oi as s,Sl as c,Su as l,Yi as u,_ as d,bd as f,dd as p,fa as m,fd as h,hp as g,jp as _,o as v,pp as y,qp as b,tu as x,ud as S,wd as C,xd as w,xp as T,xu as E,zl as D,zp as O}from"./index-hvLbsAjx.js";import{r as k}from"./SimpleNoteService-DYyyUaKJ.js";import{t as A}from"./usePinchZoom-DAZzvAlA.js";var j=l(`code-xml`,[[`path`,{d:`m18 16 4-4-4-4`,key:`1inbqp`}],[`path`,{d:`m6 8-4 4 4 4`,key:`15zrgr`}],[`path`,{d:`m14.5 4-5 16`,key:`e7oirm`}]]),M=b(O(),1),N=b(T(),1),P=(0,M.lazy)(()=>_(()=>import(`./RichEditor-Dj7Dd46u.js`),__vite__mapDeps([0,1,2,3,4,5,6,7,8]))),F=({content:a,onContentChange:l,fileName:d=`未命名笔记`,readOnly:f=!1})=>{let g=(0,M.useRef)(null),[_,v]=(0,M.useState)(`source`),[y,b]=(0,M.useState)(0),[T,E]=(0,M.useState)(!1),{scale:D,zoomIn:O,zoomOut:k,resetZoom:F,bindGestures:I,canZoomIn:L,canZoomOut:R}=A({minScale:.5,maxScale:3,initialScale:1,scaleStep:.1}),z=I(),B=m.theme({"&":{height:`100%`,fontSize:`${14*D}px`},".cm-scroller":{overflow:`auto`,fontFamily:`ui-monospace, SFMono-Regular, "SF Mono", Menlo, Consolas, monospace`},".cm-content":{padding:`16px`},".cm-gutters":{backgroundColor:`transparent`,border:`none`}});(0,M.useEffect)(()=>{b(e(a))},[a]);let V=(0,M.useCallback)(t=>{l(t),b(e(t))},[l]);return(0,N.jsxs)(h,{sx:{display:`flex`,flexDirection:`column`,height:`100%`,backgroundColor:`background.default`},children:[(0,N.jsx)(h,{sx:{display:`flex`,alignItems:`center`,justifyContent:`flex-end`,p:1,borderBottom:`1px solid`,borderColor:`divider`,backgroundColor:`background.paper`},children:(0,N.jsxs)(h,{sx:{display:`flex`,alignItems:`center`,gap:2},children:[(0,N.jsxs)(w,{variant:`caption`,color:`text.secondary`,children:[y,` 字符`]}),(0,N.jsxs)(h,{sx:{display:`flex`,alignItems:`center`,gap:.5},children:[(0,N.jsx)(r,{size:`small`,onClick:k,disabled:!R,title:`缩小`,sx:{p:.5},children:(0,N.jsx)(c,{size:16})}),(0,N.jsxs)(w,{variant:`caption`,color:`text.secondary`,sx:{minWidth:40,textAlign:`center`},children:[Math.round(D*100),`%`]}),(0,N.jsx)(r,{size:`small`,onClick:O,disabled:!L,title:`放大`,sx:{p:.5},children:(0,N.jsx)(i,{size:16})}),(0,N.jsx)(r,{size:`small`,onClick:F,title:`重置缩放`,sx:{p:.5},children:(0,N.jsx)(n,{size:16})})]}),(0,N.jsxs)(S,{size:`small`,variant:`outlined`,children:[(0,N.jsx)(p,{onClick:()=>v(`source`),variant:_===`source`?`contained`:`outlined`,startIcon:(0,N.jsx)(j,{size:14}),children:`源码`}),(0,N.jsx)(p,{onClick:()=>{v(`preview`),E(!0)},variant:_===`preview`?`contained`:`outlined`,startIcon:(0,N.jsx)(x,{size:14}),disabled:f,children:`预览`}),(0,N.jsx)(p,{onClick:()=>{v(`read`),E(!0)},variant:_===`read`?`contained`:`outlined`,startIcon:(0,N.jsx)(t,{size:14}),children:`只读`})]})]})}),(0,N.jsx)(h,{...z,sx:{flex:1,overflow:`hidden`,display:`flex`,flexDirection:`column`,touchAction:`none`},children:_===`source`?(0,N.jsx)(h,{sx:{flex:1,overflow:`hidden`,"& .cm-editor":{height:`100%`,fontSize:`${14*D}px`},"& .cm-scroller":{overflow:`auto`}},children:(0,N.jsx)(o,{value:a,onChange:e=>V(e),extensions:[s(),B],theme:u,readOnly:f,basicSetup:{lineNumbers:!0,foldGutter:!0,highlightActiveLine:!0,highlightSelectionMatches:!0,bracketMatching:!0},style:{height:`100%`}})}):(0,N.jsx)(M.Suspense,{fallback:(0,N.jsxs)(h,{sx:{display:`flex`,justifyContent:`center`,alignItems:`center`,flex:1},children:[(0,N.jsx)(C,{size:24}),(0,N.jsx)(w,{sx:{ml:2},color:`text.secondary`,children:`加载编辑器...`})]}),children:T&&(0,N.jsx)(P,{ref:g,initialContent:a,onMarkdownChange:V,showToolbar:_===`preview`&&!f,editable:_===`preview`&&!f,isFullWidth:!0,fontSize:16*D,fontFamily:`system-ui, -apple-system, sans-serif`})})})]})},I=()=>{let e=y(),[t]=g(),n=t.get(`path`),i=t.get(`name`),o=t.get(`from`),[s,c]=(0,M.useState)(``),[l,u]=(0,M.useState)(!0),[p,m]=(0,M.useState)(!1),[_,b]=(0,M.useState)(!1),x=(0,M.useRef)(``),S=(0,M.useCallback)(()=>o===`chat`?`/chat`:`/settings/notes`,[o]);(0,M.useEffect)(()=>{if(!n){v.error(`未指定文件路径`,`错误`),e(S());return}T()},[n,S]);let T=async()=>{if(n){u(!0);try{let e=await k.readNote(n);c(e),x.current=e,b(!1)}catch(t){console.error(`读取文件失败:`,t),v.error(`读取文件失败`,`错误`),e(S())}finally{u(!1)}}},O=(0,M.useCallback)(async()=>{if(!(!n||p)){m(!0);try{await k.saveNote(n,s),x.current=s,b(!1),v.success(`保存成功`,`成功`)}catch(e){console.error(`保存失败:`,e),v.error(`保存失败`,`错误`)}finally{m(!1)}}},[n,s,p]),A=(0,M.useCallback)(e=>{c(e),b(e!==x.current)},[]),j=(0,M.useCallback)(()=>{let t=S();_?window.confirm(`有未保存的更改，确定要离开吗？`)&&e(t):e(t)},[_,e,S]);return(0,M.useEffect)(()=>{if(!_||!n)return;let e=setTimeout(()=>{O()},2e3);return()=>clearTimeout(e)},[s,_,n,O]),l?(0,N.jsxs)(d,{sx:{display:`flex`,justifyContent:`center`,alignItems:`center`,flexDirection:`column`,gap:2},children:[(0,N.jsx)(C,{}),(0,N.jsx)(w,{color:`text.secondary`,children:`加载中...`})]}):(0,N.jsxs)(d,{children:[(0,N.jsx)(f,{position:`static`,elevation:0,sx:{bgcolor:`background.paper`,color:`text.primary`,borderBottom:1,borderColor:`divider`,backdropFilter:`blur(8px)`},children:(0,N.jsxs)(a,{children:[(0,N.jsx)(r,{edge:`start`,onClick:j,"aria-label":`back`,sx:{color:`primary.main`,mr:2},children:(0,N.jsx)(E,{})}),(0,N.jsx)(w,{variant:`h6`,sx:{flexGrow:1,fontWeight:600},children:i||`编辑笔记`}),(0,N.jsxs)(h,{sx:{display:`flex`,alignItems:`center`,gap:1},children:[_&&(0,N.jsx)(w,{variant:`caption`,color:`warning.main`,sx:{mr:1},children:`未保存`}),(0,N.jsx)(r,{color:`primary`,onClick:O,disabled:p||!_,sx:{bgcolor:`primary.main`,color:`white`,"&:hover":{bgcolor:`primary.dark`},"&.Mui-disabled":{bgcolor:`action.disabledBackground`,color:`action.disabled`}},children:(0,N.jsx)(D,{size:20})})]})]})}),(0,N.jsx)(h,{sx:{flexGrow:1,overflow:`hidden`},children:(0,N.jsx)(F,{content:s,onContentChange:A,fileName:i||`未命名笔记`,readOnly:!1})})]})};export{I as default};