import{t as e}from"./camera-DPY5JI0W.js";import{n as t,t as n}from"./ImageUploadService-Kd9CWXwm.js";import{a as ee,c as r,d as i,f as a,i as o,l as s,n as c,o as l,p as te,r as u,s as ne,t as re,u as d}from"./translate-M06VZQ7d.js";import{t as ie}from"./image-7oImefSY.js";import{t as ae}from"./send-BodRSmN3.js";import{t as oe}from"./star-CH3UH8HS.js";import{$u as f,Ad as p,Al as m,Cd as h,Cu as g,Eu as se,Hu as ce,Iu as _,Nu as v,Qu as y,Su as b,Ud as le,Vu as ue,Wu as de,bp as fe,ed as pe,fd as x,ku as S,ou as me,pp as he,qp as C,td as w,wd as T,wl as E,xd as D,xp as O,xu as ge,zp as k,zu as _e}from"./index-hvLbsAjx.js";import{t as ve}from"./SolidBridge-4JuNrAWl.js";import{t as ye}from"./settingsSelectors-BdPnPOZr.js";import{t as be}from"./providerIcons-C3i_yWyD.js";import{t as xe}from"./DialogModelSelector.solid-B0UTW3Od.js";var Se=b(`arrow-right-left`,[[`path`,{d:`m16 3 4 4-4 4`,key:`1x1c3m`}],[`path`,{d:`M20 7H4`,key:`zbl0bi`}],[`path`,{d:`m8 21-4-4 4-4`,key:`h9nckh`}],[`path`,{d:`M4 17h16`,key:`g4d7ey`}]]),Ce=b(`star-off`,[[`path`,{d:`M8.34 8.34 2 9.27l5 4.87L5.82 21 12 17.77 18.18 21l-.59-3.43`,key:`16m0ql`}],[`path`,{d:`M18.42 12.76 22 9.27l-6.91-1L12 2l-1.44 2.91`,key:`1vt8nq`}],[`line`,{x1:`2`,x2:`22`,y1:`2`,y2:`22`,key:`a6p6uj`}]]),A=C(k(),1),j=C(O(),1),M=A.memo(({value:e,onChange:t,showAuto:n=!1})=>(0,j.jsx)(y,{size:`small`,sx:{minWidth:120},children:(0,j.jsxs)(v,{value:e,onChange:e=>t(e.target.value),sx:{"& .MuiSelect-select":{display:`flex`,alignItems:`center`,gap:1}},children:[n&&(0,j.jsxs)(_,{value:`auto`,children:[(0,j.jsx)(`span`,{children:`ğŸ”`}),(0,j.jsx)(`span`,{style:{marginLeft:8},children:`è‡ªåŠ¨æ£€æµ‹`})]}),d.map(e=>(0,j.jsxs)(_,{value:e.langCode,children:[(0,j.jsx)(`span`,{children:e.emoji}),(0,j.jsx)(`span`,{style:{marginLeft:8},children:e.label})]},e.langCode))]})}));M.displayName=`LanguageSelector`;var N=()=>{let d=he(),_=le(),v=g(_.breakpoints.down(`md`)),y=g(_.breakpoints.down(`sm`)),b=_.palette.mode,C=fe(ye),O=(0,A.useMemo)(()=>{let e=[];return C.forEach(t=>{t.models&&Array.isArray(t.models)&&t.models.forEach(n=>{e.push({...n,provider:t.id})})}),e},[C]),[k,N]=(0,A.useState)(``),[P,F]=(0,A.useState)(``),[I,L]=(0,A.useState)(`auto`),[R,z]=(0,A.useState)(s.enUS.langCode),[B,V]=(0,A.useState)(!1),[H,U]=(0,A.useState)(!1),[W,G]=(0,A.useState)(!1),[K,q]=(0,A.useState)([]),[we,J]=(0,A.useState)(!1),[Y,X]=(0,A.useState)(!1),[Z,Te]=(0,A.useState)(()=>{try{let e=localStorage.getItem(`translate_selected_model`);if(e)return JSON.parse(e)}catch(e){console.error(`[TranslatePage] è¯»å–ä¿å­˜çš„æ¨¡å‹å¤±è´¥:`,e)}return o()}),Q=(0,A.useRef)(null),Ee=(0,A.useCallback)(e=>{Te(e),J(!1);try{localStorage.setItem(`translate_selected_model`,JSON.stringify(e))}catch(e){console.error(`[TranslatePage] ä¿å­˜æ¨¡å‹å¤±è´¥:`,e)}},[]);(0,A.useEffect)(()=>{u().then(q)},[]);let $=(0,A.useCallback)(async()=>{if(!k.trim()||B)return;let e=Z||o();if(!e){alert(`è¯·å…ˆé€‰æ‹©ç¿»è¯‘æ¨¡å‹`);return}V(!0),F(``),Q.current=new AbortController;let t=i(R);try{await l(k,await r(k,t,(e,t)=>{F(e)},Q.current.signal,e),I===`auto`?`auto`:I,R),q(await u())}catch(e){e.name!==`AbortError`&&(console.error(`Translation failed:`,e),F(`ç¿»è¯‘å¤±è´¥: ${e.message}`))}finally{V(!1),Q.current=null}},[k,R,I,B]),De=(0,A.useCallback)(()=>{Q.current&&Q.current.abort()},[]),Oe=(0,A.useCallback)(async e=>{if(!Y)try{X(!0);let t=await n.selectImages(e);if(!t||t.length===0){X(!1);return}let a=t[0];if(!a.base64Data){X(!1);return}let s=Z||o(),c=await ee(a.base64Data,(e,t)=>{N(e)},void 0,s);if(c&&c!==`æœªè¯†åˆ«åˆ°æ–‡å­—`){let e=c.trim();N(e),X(!1),V(!0),F(``);let t=i(R);try{await l(e,await r(e,t,(e,t)=>{F(e)},void 0,s),I===`auto`?`auto`:I,R),q(await u())}catch(e){console.error(`Translation failed:`,e),F(`ç¿»è¯‘å¤±è´¥: ${e.message}`)}finally{V(!1)}}else alert(`æœªèƒ½è¯†åˆ«åˆ°å›¾ç‰‡ä¸­çš„æ–‡å­—`),X(!1)}catch(e){console.error(`OCR failed:`,e),alert(`å›¾ç‰‡è¯†åˆ«å¤±è´¥: ${e.message}`),X(!1)}},[Y,Z,R,I]),ke=(0,A.useCallback)(async()=>{if(P)try{await navigator.clipboard.writeText(P),U(!0),setTimeout(()=>U(!1),2e3)}catch(e){console.error(`Copy failed:`,e)}},[P]),Ae=(0,A.useCallback)(()=>{if(I===`auto`)return;let e=I;L(R),z(e),N(P),F(k)},[I,R,k,P]),je=(0,A.useCallback)(e=>{N(e.sourceText),F(e.targetText),L(e.sourceLanguage),z(e.targetLanguage),G(!1)},[]),Me=(0,A.useCallback)(async(e,t)=>{t.stopPropagation(),await c(e),q(await u())},[]),Ne=(0,A.useCallback)(async(e,t)=>{t.stopPropagation(),await ne(e),q(await u())},[]),Pe=(0,A.useCallback)(async()=>{confirm(`ç¡®å®šè¦æ¸…ç©ºæ‰€æœ‰ç¿»è¯‘å†å²å—ï¼Ÿ`)&&(await re(),q([]))},[]),Fe=(0,A.useCallback)(e=>{e.key===`Enter`&&!e.shiftKey&&!e.nativeEvent.isComposing&&(e.preventDefault(),$())},[$]),Ie=(0,A.useCallback)(()=>G(!1),[]),Le=(0,A.useMemo)(()=>({selectedModel:Z,availableModels:O,handleModelSelect:Ee,handleMenuClose:()=>J(!1),menuOpen:we,providers:C,themeMode:b,fullScreen:y}),[Z,O,Ee,we,C,b,y]),Re=(0,A.useMemo)(()=>(0,j.jsxs)(pe,{anchor:v?`bottom`:`right`,open:W,onClose:Ie,PaperProps:{sx:{width:v?`100%`:360,height:v?`70vh`:`100%`,borderRadius:v?`16px 16px 0 0`:0}},children:[(0,j.jsxs)(x,{sx:{p:2,display:`flex`,justifyContent:`space-between`,alignItems:`center`},children:[(0,j.jsx)(D,{variant:`h6`,children:`ç¿»è¯‘å†å²`}),(0,j.jsxs)(x,{children:[K.length>0&&(0,j.jsx)(h,{size:`small`,onClick:Pe,color:`error`,children:(0,j.jsx)(m,{size:18})}),(0,j.jsx)(h,{size:`small`,onClick:()=>G(!1),children:(0,j.jsx)(E,{size:18})})]})]}),(0,j.jsx)(w,{}),(0,j.jsx)(de,{sx:{flex:1,overflow:`auto`},children:K.length===0?(0,j.jsx)(x,{sx:{p:4,textAlign:`center`,color:`text.secondary`},children:`æš‚æ— ç¿»è¯‘å†å²`}):K.map(e=>(0,j.jsxs)(ue,{onClick:()=>je(e),sx:{cursor:`pointer`,"&:hover":{bgcolor:`action.hover`},flexDirection:`column`,alignItems:`flex-start`},children:[(0,j.jsxs)(x,{sx:{display:`flex`,width:`100%`,justifyContent:`space-between`,mb:.5},children:[(0,j.jsxs)(D,{variant:`caption`,color:`text.secondary`,children:[i(e.sourceLanguage).label,` â†’ `,i(e.targetLanguage).label]}),(0,j.jsx)(D,{variant:`caption`,color:`text.secondary`,children:new Date(e.createdAt).toLocaleDateString()})]}),(0,j.jsx)(_e,{primary:(0,j.jsx)(D,{variant:`body2`,sx:{overflow:`hidden`,textOverflow:`ellipsis`,display:`-webkit-box`,WebkitLineClamp:2,WebkitBoxOrient:`vertical`},children:e.sourceText}),secondary:(0,j.jsx)(D,{variant:`body2`,color:`text.secondary`,sx:{overflow:`hidden`,textOverflow:`ellipsis`,display:`-webkit-box`,WebkitLineClamp:2,WebkitBoxOrient:`vertical`},children:e.targetText})}),(0,j.jsxs)(ce,{children:[(0,j.jsx)(h,{size:`small`,onClick:t=>Ne(e.id,t),children:e.star?(0,j.jsx)(oe,{size:16,color:`#f59e0b`,fill:`#f59e0b`}):(0,j.jsx)(Ce,{size:16})}),(0,j.jsx)(h,{size:`small`,onClick:t=>Me(e.id,t),children:(0,j.jsx)(m,{size:16})})]})]},e.id))})]}),[v,W,Ie,K,Pe,je,Ne,Me]);return(0,j.jsxs)(x,{sx:{display:`flex`,flexDirection:`column`,height:`100%`,bgcolor:`background.default`},children:[(0,j.jsxs)(x,{sx:{display:`flex`,alignItems:`center`,justifyContent:`space-between`,px:2,py:1,pt:`calc(var(--safe-area-top, 0px) + 8px)`,borderBottom:`1px solid`,borderColor:`divider`,bgcolor:`background.paper`},children:[(0,j.jsxs)(x,{sx:{display:`flex`,alignItems:`center`,gap:1},children:[(0,j.jsx)(h,{onClick:()=>d(-1),size:`small`,children:(0,j.jsx)(ge,{size:20})}),(0,j.jsx)(a,{size:24}),(0,j.jsx)(D,{variant:`h6`,fontWeight:`medium`,children:`ç¿»è¯‘`})]}),(0,j.jsxs)(x,{sx:{display:`flex`,alignItems:`center`,gap:.5},children:[(0,j.jsx)(S,{title:Z?.name||Z?.id||`é€‰æ‹©æ¨¡å‹`,children:(0,j.jsx)(h,{onClick:()=>J(!0),sx:{width:36,height:36,borderRadius:`8px`,bgcolor:`action.hover`,"&:hover":{bgcolor:`action.selected`}},children:(0,j.jsx)(x,{component:`img`,src:Z?be(Z.id,Z.provider||``,b===`dark`):`/images/providerIcons/dark/custom.png`,alt:`model`,sx:{width:22,height:22,borderRadius:`4px`,objectFit:`contain`}})})}),(0,j.jsx)(h,{onClick:()=>G(!0),children:(0,j.jsx)(te,{size:20})})]})]}),(0,j.jsx)(ve,{component:xe,props:Le,debugName:`TranslateModelSelector`}),(0,j.jsxs)(x,{sx:{display:`flex`,alignItems:`center`,justifyContent:`center`,gap:1,px:2,py:1.5,borderBottom:`1px solid`,borderColor:`divider`,bgcolor:`background.paper`},children:[(0,j.jsx)(M,{value:I,onChange:L,showAuto:!0}),(0,j.jsx)(h,{size:`small`,onClick:Ae,disabled:I===`auto`,sx:{mx:1},children:(0,j.jsx)(Se,{size:18})}),(0,j.jsx)(M,{value:R,onChange:z})]}),(0,j.jsxs)(x,{sx:{flex:1,display:`flex`,flexDirection:v?`column`:`row`,overflow:`hidden`,gap:v?0:2,p:v?0:2},children:[(0,j.jsxs)(p,{elevation:v?0:1,sx:{flex:1,display:`flex`,flexDirection:`column`,overflow:`hidden`,borderRadius:v?0:2},children:[(0,j.jsx)(se,{multiline:!0,fullWidth:!0,placeholder:`è¾“å…¥è¦ç¿»è¯‘çš„æ–‡æœ¬...`,value:k,onChange:e=>N(e.target.value),onKeyDown:Fe,sx:{flex:1,"& .MuiOutlinedInput-root":{height:`100%`,alignItems:`flex-start`,"& fieldset":{border:`none`}},"& .MuiInputBase-input":{height:`100% !important`,overflow:`auto !important`}},slotProps:{input:{sx:{p:2,height:`100%`}}}}),(0,j.jsxs)(x,{sx:{display:`flex`,justifyContent:`space-between`,alignItems:`center`,px:2,py:1,minHeight:52,borderTop:`1px solid`,borderColor:`divider`},children:[(0,j.jsxs)(x,{sx:{display:`flex`,alignItems:`center`,gap:1},children:[(0,j.jsxs)(D,{variant:`caption`,color:`text.secondary`,children:[k.length,` å­—ç¬¦`]}),(0,j.jsx)(S,{title:`æ‹ç…§è¯†åˆ«æ–‡å­—`,children:(0,j.jsx)(h,{size:`small`,onClick:()=>Oe(`camera`),disabled:Y,sx:{color:`primary.main`},children:Y?(0,j.jsx)(T,{size:16}):(0,j.jsx)(e,{size:18})})}),(0,j.jsx)(S,{title:`ä»ç›¸å†Œé€‰æ‹©å›¾ç‰‡è¯†åˆ«`,children:(0,j.jsx)(h,{size:`small`,onClick:()=>Oe(`photos`),disabled:Y,sx:{color:`secondary.main`},children:(0,j.jsx)(ie,{size:18})})})]}),(0,j.jsxs)(x,{sx:{display:`flex`,gap:1},children:[k&&(0,j.jsx)(h,{size:`small`,onClick:()=>{N(``),F(``)},children:(0,j.jsx)(E,{size:18})}),(0,j.jsx)(S,{title:B?`åœæ­¢ç¿»è¯‘`:`ç¿»è¯‘ (Enter)`,children:(0,j.jsx)(`span`,{children:(0,j.jsx)(f,{size:`small`,color:`primary`,onClick:B?De:$,disabled:!k.trim()&&!B,children:B?(0,j.jsx)(T,{size:20,color:`inherit`}):(0,j.jsx)(ae,{size:18})})})})]})]})]}),v&&(0,j.jsx)(w,{}),(0,j.jsxs)(p,{elevation:v?0:1,sx:{flex:1,display:`flex`,flexDirection:`column`,overflow:`hidden`,borderRadius:v?0:2,bgcolor:v?`background.default`:`background.paper`},children:[(0,j.jsx)(x,{sx:{flex:1,p:2,overflow:`auto`,whiteSpace:`pre-wrap`,wordBreak:`break-word`},children:P?(0,j.jsx)(D,{variant:`body1`,children:P}):(0,j.jsx)(D,{variant:`body1`,color:`text.secondary`,children:`ç¿»è¯‘ç»“æœå°†æ˜¾ç¤ºåœ¨è¿™é‡Œ...`})}),(0,j.jsx)(x,{sx:{display:`flex`,justifyContent:`flex-end`,alignItems:`center`,px:2,py:1,pb:`calc(var(--safe-area-bottom, 0px) + 8px)`,minHeight:52,borderTop:`1px solid`,borderColor:`divider`},children:(0,j.jsx)(S,{title:H?`å·²å¤åˆ¶`:`å¤åˆ¶`,children:(0,j.jsx)(`span`,{children:(0,j.jsx)(f,{size:`small`,onClick:ke,disabled:!P,color:H?`success`:`default`,sx:{boxShadow:`none`},children:H?(0,j.jsx)(t,{size:18}):(0,j.jsx)(me,{size:18})})})})})]})]}),Re]})};export{N as default};