import{t as e}from"./mic-DOR2hOIQ.js";import{Ad as t,Cd as n,Du as r,Iu as i,Ju as a,Nl as o,Nu as s,Qu as c,Sd as l,Xu as u,Zu as d,_ as f,bd as p,ci as m,dd as h,fd as g,ip as _,np as v,pp as y,qd as b,qp as x,s as S,xd as C,xp as w,xu as T,zp as E}from"./index-hvLbsAjx.js";import{t as D}from"./useVoiceRecognition-BsXW9Pyd.js";var O=x(E(),1),k=x(w(),1),A=()=>{let x=y(),{t:w}=m(),[E,A]=(0,O.useState)({enabled:!0,language:`zh-CN`,autoStart:!1,silenceTimeout:2e3,maxResults:5,partialResults:!0,permissionStatus:`unknown`,provider:`capacitor`}),[j,M]=(0,O.useState)({saveError:``}),[N]=(0,O.useState)(!1),{recognitionText:P,permissionStatus:F,error:I,startRecognition:L,stopRecognition:R}=D();(0,O.useEffect)(()=>{(async()=>{try{A({enabled:await v(`speech_recognition_enabled`)!==`false`,language:await v(`speech_recognition_language`)||`zh-CN`,autoStart:await v(`speech_recognition_auto_start`)===`true`,silenceTimeout:Number(await v(`speech_recognition_silence_timeout`)||`2000`),maxResults:Number(await v(`speech_recognition_max_results`)||`5`),partialResults:await v(`speech_recognition_partial_results`)!==`false`,permissionStatus:`unknown`,provider:`capacitor`})}catch(e){console.error(w(`settings.voice.common.loadingError`,{service:`Capacitor ASR`}),e)}})()},[w]);let z=(0,O.useCallback)(async()=>{try{await _(`speech_recognition_enabled`,E.enabled.toString()),await _(`speech_recognition_language`,E.language),await _(`speech_recognition_auto_start`,E.autoStart.toString()),await _(`speech_recognition_silence_timeout`,E.silenceTimeout.toString()),await _(`speech_recognition_max_results`,E.maxResults.toString()),await _(`speech_recognition_partial_results`,E.partialResults.toString()),await _(`speech_recognition_provider`,`capacitor`),setTimeout(()=>{x(`/settings/voice`)},0)}catch(e){console.error(w(`settings.voice.common.saveErrorText`,{service:`Capacitor ASR`}),e),M(e=>({...e,saveError:w(`settings.voice.common.saveError`)}))}},[E,x,w]),B=()=>{x(`/settings/voice`)},V=(e,t)=>{A(n=>({...n,[e]:t}))};return(0,k.jsxs)(f,{sx:{width:`100vw`,overflow:`hidden`,bgcolor:`background.default`},children:[(0,k.jsx)(p,{position:`static`,elevation:0,sx:{bgcolor:`background.paper`,color:`text.primary`,borderBottom:1,borderColor:`divider`,backdropFilter:`blur(20px)`,WebkitBackdropFilter:`blur(20px)`,background:`rgba(255, 255, 255, 0.8)`,"@media (prefers-color-scheme: dark)":{background:`rgba(18, 18, 18, 0.8)`}},children:(0,k.jsxs)(r,{sx:{minHeight:{xs:56,sm:64},px:{xs:1,sm:2,md:3}},children:[(0,k.jsx)(n,{edge:`start`,onClick:B,"aria-label":w(`settings.voice.back`),size:`large`,sx:{color:`primary.main`,mr:{xs:1,sm:2},"&:hover":{bgcolor:`primary.main`,color:`primary.contrastText`,transform:`scale(1.05)`},transition:`all 0.2s ease-in-out`},children:(0,k.jsx)(T,{size:20})}),(0,k.jsx)(C,{variant:`h6`,component:`div`,sx:{flexGrow:1,fontWeight:600},children:w(`settings.voice.capacitor.title`)}),(0,k.jsx)(h,{onClick:z,variant:`contained`,sx:{bgcolor:`primary.main`,color:`primary.contrastText`,"&:hover":{bgcolor:`primary.dark`},borderRadius:2,px:3},children:w(`settings.voice.common.save`)})]})}),(0,k.jsx)(g,{sx:{flexGrow:1,overflowY:`auto`,p:2,bgcolor:e=>e.palette.mode===`light`?b(e.palette.primary.main,.02):b(e.palette.background.default,.9),"&::-webkit-scrollbar":{width:`6px`},"&::-webkit-scrollbar-thumb":{backgroundColor:`rgba(0,0,0,0.1)`,borderRadius:`3px`}},children:(0,k.jsxs)(g,{sx:{width:`100%`},children:[j.saveError&&(0,k.jsx)(l,{severity:`error`,sx:{mb:{xs:1.5,sm:2},borderRadius:{xs:1,sm:2}},children:j.saveError}),(0,k.jsxs)(t,{elevation:0,sx:{p:3,mb:3,borderRadius:2,border:`1px solid`,borderColor:`divider`,background:`background.paper`,boxShadow:`0 4px 12px rgba(0,0,0,0.05)`},children:[(0,k.jsx)(C,{variant:`h6`,sx:{mb:3,fontWeight:600},children:w(`settings.voice.capacitor.config`)}),(0,k.jsx)(g,{sx:{mb:3},children:(0,k.jsx)(d,{control:(0,k.jsx)(S,{checked:E.enabled,onChange:e=>V(`enabled`,e.target.checked)}),label:w(`settings.voice.capacitor.enable`)})}),(0,k.jsxs)(c,{fullWidth:!0,sx:{mb:3},children:[(0,k.jsx)(a,{children:w(`settings.voice.capacitor.language.label`)}),(0,k.jsxs)(s,{value:E.language,onChange:e=>V(`language`,e.target.value),label:w(`settings.voice.capacitor.language.label`),MenuProps:{disableAutoFocus:!0,disableRestoreFocus:!0},children:[(0,k.jsx)(i,{value:`zh-CN`,children:w(`settings.voice.capacitor.language.zhCN`)}),(0,k.jsx)(i,{value:`en-US`,children:w(`settings.voice.capacitor.language.enUS`)}),(0,k.jsx)(i,{value:`ja-JP`,children:w(`settings.voice.capacitor.language.jaJP`)}),(0,k.jsx)(i,{value:`ko-KR`,children:w(`settings.voice.capacitor.language.koKR`)}),(0,k.jsx)(i,{value:`fr-FR`,children:w(`settings.voice.capacitor.language.frFR`)}),(0,k.jsx)(i,{value:`de-DE`,children:w(`settings.voice.capacitor.language.deDE`)}),(0,k.jsx)(i,{value:`es-ES`,children:w(`settings.voice.capacitor.language.esES`)})]}),(0,k.jsx)(u,{children:w(`settings.voice.capacitor.language.helper`)})]}),(0,k.jsxs)(g,{sx:{mb:3},children:[(0,k.jsx)(d,{control:(0,k.jsx)(S,{checked:E.autoStart,onChange:e=>V(`autoStart`,e.target.checked)}),label:w(`settings.voice.capacitor.autoStart.label`)}),(0,k.jsx)(u,{children:w(`settings.voice.capacitor.autoStart.helper`)})]}),(0,k.jsxs)(g,{sx:{mb:3},children:[(0,k.jsx)(d,{control:(0,k.jsx)(S,{checked:E.partialResults,onChange:e=>V(`partialResults`,e.target.checked)}),label:w(`settings.voice.capacitor.partialResults.label`)}),(0,k.jsx)(u,{children:w(`settings.voice.capacitor.partialResults.helper`)})]}),(0,k.jsx)(C,{variant:`body2`,color:`text.secondary`,sx:{mb:3},children:w(`settings.voice.capacitor.permission.status`,{status:F})}),(0,k.jsx)(h,{variant:`contained`,startIcon:(0,k.jsx)(e,{size:16}),onClick:()=>L(),disabled:N,color:`primary`,sx:{mb:2},children:w(`settings.voice.capacitor.permission.checkAndRequest`)})]}),(0,k.jsxs)(t,{elevation:0,sx:{p:3,mb:3,borderRadius:2,border:`1px solid`,borderColor:`divider`,background:`background.paper`,boxShadow:`0 4px 12px rgba(0,0,0,0.05)`},children:[(0,k.jsx)(C,{variant:`h6`,sx:{mb:3,fontWeight:600},children:w(`settings.voice.capacitor.test.title`)}),(0,k.jsx)(g,{sx:{display:`flex`,gap:2,mb:3},children:(0,k.jsx)(h,{variant:N?`outlined`:`contained`,startIcon:N?(0,k.jsx)(o,{size:16}):(0,k.jsx)(e,{size:16}),onClick:()=>N?R():L(),disabled:!E.enabled,color:N?`error`:`primary`,children:w(N?`settings.voice.capacitor.test.stop`:`settings.voice.capacitor.test.start`)})}),P&&(0,k.jsx)(l,{severity:`info`,sx:{mb:3},children:w(`settings.voice.capacitor.test.result`,{text:P})}),I&&(0,k.jsx)(l,{severity:`error`,sx:{mb:3},children:w(`settings.voice.capacitor.test.error`,{message:I.message||w(`common.unknownError`)||`Unknown error`})}),(0,k.jsx)(C,{variant:`body2`,color:`text.secondary`,children:w(`settings.voice.capacitor.test.hint`)})]})]})})]})};export{A as default};