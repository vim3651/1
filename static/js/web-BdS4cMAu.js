import{Fp as e}from"./index-hvLbsAjx.js";var t=function(e){if(!Symbol.asyncIterator)throw TypeError(`Symbol.asyncIterator is not defined.`);var t=e[Symbol.asyncIterator],n;return t?t.call(e):(e=typeof __values==`function`?__values(e):e[Symbol.iterator](),n={},r(`next`),r(`throw`),r(`return`),n[Symbol.asyncIterator]=function(){return this},n);function r(t){n[t]=e[t]&&function(n){return new Promise(function(r,a){n=e[t](n),i(r,a,n.done,n.value)})}}function i(e,t,n,r){Promise.resolve(r).then(function(t){e({value:t,done:n})},t)}},n=class extends e{isFileSystemAccessSupported(){return`showDirectoryPicker`in window}async requestPermissions(){return this.isFileSystemAccessSupported()?{granted:!0,message:`File System Access API is supported`}:{granted:!1,message:`File System Access API is not supported in this browser`}}async checkPermissions(){return this.requestPermissions()}async listDirectory(e){var n,r,i,a;if(!this.isFileSystemAccessSupported())throw Error(`File System Access API is not supported in this browser`);try{let l=await window.showDirectoryPicker(),u=[];try{for(var o=!0,s=t(l.entries()),c;c=await s.next(),n=c.done,!n;o=!0){a=c.value,o=!1;let[t,n]=a,r=await this.getFileInfoFromHandle(n,t,e.path);(e.showHidden||!r.isHidden)&&u.push(r)}}catch(e){r={error:e}}finally{try{!o&&!n&&(i=s.return)&&await i.call(s)}finally{if(r)throw r.error}}return e.sortBy&&u.sort((t,n)=>{let r=0;switch(e.sortBy){case`name`:r=t.name.localeCompare(n.name);break;case`size`:r=t.size-n.size;break;case`mtime`:r=t.mtime-n.mtime;break;case`type`:r=t.type.localeCompare(n.type);break}return e.sortOrder===`desc`?-r:r}),{files:u,totalCount:u.length}}catch(e){throw Error(`Failed to list directory: ${e}`)}}async getFileInfoFromHandle(e,t,n){let r=e.kind===`directory`,i=0,a=0,o=0;if(!r)try{let t=await e.getFile();i=t.size,a=t.lastModified,o=t.lastModified}catch(e){console.warn(`Failed to get file info:`,e)}return{name:t,path:`${n}/${t}`,size:i,type:r?`directory`:`file`,mtime:a,ctime:o,isHidden:t.startsWith(`.`)}}async createDirectory(e){throw Error(`Creating directories is not supported in web browsers for security reasons`)}async deleteDirectory(e){throw Error(`Deleting directories is not supported in web browsers for security reasons`)}async createFile(e){if(!this.isFileSystemAccessSupported())throw Error(`File System Access API is not supported in this browser`);try{let t=await(await window.showSaveFilePicker({suggestedName:e.path.split(`/`).pop()||`new-file.txt`})).createWritable(),n=e.content||``;if(e.encoding===`base64`){let e=atob(n),r=new Uint8Array(e.length);for(let t=0;t<e.length;t++)r[t]=e.charCodeAt(t);await t.write(r)}else await t.write(n);await t.close()}catch(e){throw Error(`Failed to create file: ${e}`)}}async readFile(e){if(!this.isFileSystemAccessSupported())throw Error(`File System Access API is not supported in this browser`);try{let[t]=await window.showOpenFilePicker(),n=await t.getFile(),r,i=e.encoding||`utf8`;if(i===`base64`){let e=await n.arrayBuffer(),t=new Uint8Array(e);r=btoa(String.fromCharCode(...t))}else r=await n.text();return{content:r,encoding:i}}catch(e){throw Error(`Failed to read file: ${e}`)}}async writeFile(e){return this.createFile({path:e.path,content:e.content,encoding:e.encoding})}async deleteFile(e){throw Error(`Deleting files is not supported in web browsers for security reasons`)}async moveFile(e){throw Error(`Moving files is not supported in web browsers for security reasons`)}async copyFile(e){throw Error(`Copying files is not supported in web browsers for security reasons`)}async renameFile(e){throw Error(`Renaming files is not supported in web browsers for security reasons`)}async getFileInfo(e){throw Error(`Getting file info for specific paths is not supported in web browsers`)}async exists(e){throw Error(`Checking file existence is not supported in web browsers for security reasons`)}async searchFiles(e){throw Error(`File search is not supported in web browsers for security reasons`)}async searchContent(e){return console.warn(`searchContent is not fully supported in web browsers`),{results:[],totalFiles:0,totalMatches:0,duration:0,skippedFiles:0}}async openSystemFilePicker(e){if(!this.isFileSystemAccessSupported())throw Error(`File System Access API is not supported in this browser`);try{let t=[],n=[];if(e.type===`directory`||e.type===`both`){let e=await window.showDirectoryPicker(),t={name:e.name,path:`/${e.name}`,uri:e.name,size:0,type:`directory`,mimeType:`inode/directory`,mtime:Date.now(),ctime:Date.now()};n.push(t)}if(e.type===`file`||e.type===`both`){let n=await window.showOpenFilePicker({multiple:e.multiple||!1,types:e.accept?[{description:`Selected files`,accept:e.accept.reduce((e,t)=>{let n=this.getMimeTypeFromExtension(t);return e[n]||(e[n]=[]),e[n].push(`.${t}`),e},{})}]:void 0});for(let e of n)try{let n=await e.getFile(),r={name:n.name,path:`/${n.name}`,uri:n.name,size:n.size,type:`file`,mimeType:n.type||`application/octet-stream`,mtime:n.lastModified,ctime:n.lastModified};t.push(r)}catch(e){console.warn(`Failed to get file info:`,e)}}return{files:t,directories:n,cancelled:!1}}catch(e){if(e instanceof Error&&e.name===`AbortError`)return{files:[],directories:[],cancelled:!0};throw Error(`File picker failed: ${e}`)}}async openSystemFileManager(e){if(this.isFileSystemAccessSupported())try{await window.showDirectoryPicker()}catch(e){if(!(e instanceof Error)||e.name!==`AbortError`)throw Error(`Cannot open system file manager in web browsers`)}else throw Error(`File system access not supported in this browser`)}async openFileWithSystemApp(e,t){throw Error(`Opening files with system apps is not supported in web browsers`)}async readFileRange(e){throw Error(`Reading file ranges is not supported in web browsers for security reasons`)}async insertContent(e){throw Error(`Inserting content is not supported in web browsers for security reasons`)}async replaceInFile(e){throw Error(`Replacing in file is not supported in web browsers for security reasons`)}async applyDiff(e){throw Error(`Applying diff is not supported in web browsers for security reasons`)}async getFileHash(e){throw Error(`Getting file hash is not supported in web browsers for security reasons`)}async getLineCount(e){throw Error(`Getting line count is not supported in web browsers for security reasons`)}getMimeTypeFromExtension(e){return{txt:`text/plain`,pdf:`application/pdf`,jpg:`image/jpeg`,jpeg:`image/jpeg`,png:`image/png`,gif:`image/gif`,mp4:`video/mp4`,mp3:`audio/mpeg`,zip:`application/zip`,json:`application/json`,xml:`application/xml`,html:`text/html`,css:`text/css`,js:`application/javascript`}[e.toLowerCase()]||`application/octet-stream`}async echo(e){return console.log(`ECHO`,e),e}};export{n as AdvancedFileManagerWeb};