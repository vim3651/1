import{t as e}from"./Card-CgnXHdbl.js";import{t}from"./CardContent-f2tPkMYB.js";import{t as n}from"./arrow-right-CUpdoBf6.js";import{t as r}from"./plus-DCrdXXDc.js";import{Al as i,Cd as a,Du as o,Eu as s,Fl as c,Iu as l,Ju as u,K as d,Nu as ee,Qu as f,Sd as p,Su as m,Zu as h,_ as g,bd as _,bp as v,ci as y,dd as b,ei as x,fd as S,mp as C,ni as w,pp as T,qd as E,qp as D,r as O,s as k,td as A,ti as j,xd as M,xp as N,xu as P,yu as F,zl as I,zp as L}from"./index-hvLbsAjx.js";import{n as R}from"./DropdownModelSelector-D62zD9hR.js";var z=m(`git-compare`,[[`circle`,{cx:`18`,cy:`18`,r:`3`,key:`1xkwt0`}],[`circle`,{cx:`6`,cy:`6`,r:`3`,key:`1lh9wr`}],[`path`,{d:`M13 6h3a2 2 0 0 1 2 2v7`,key:`1yeb86`}],[`path`,{d:`M11 18H8a2 2 0 0 1-2-2V9`,key:`19pyzm`}]]),B=D(L(),1),V=D(N(),1),H=()=>{let{t:m}=y(),D=T(),{comboId:N}=C(),L=N&&N!==`new`,{syncModelCombos:H}=O(),[U,W]=(0,B.useState)({name:``,description:``,strategy:`sequential`,enabled:!0,models:[{modelId:``,role:`thinking`,weight:1,priority:1},{modelId:``,role:`generating`,weight:1,priority:2}]}),[G,K]=(0,B.useState)(!1),q=v(e=>e.settings.providers),J=(0,B.useMemo)(()=>q.filter(e=>e.id!==`model-combo`&&e.isEnabled).flatMap(e=>e.models.filter(e=>e.enabled).map(t=>({...t,provider:t.provider||e.id,providerId:e.id,identityKey:x({id:t.id,provider:t.provider||e.id})}))),[q]);(0,B.useEffect)(()=>{(async()=>{if(L)try{let e=(await d.getAllCombos()).find(e=>e.id===N);if(e){let t=e.models.map(e=>{let t=w(e.modelId);if(t)return{modelId:x(t),role:e.role,weight:e.weight,priority:e.priority};let n=J.find(t=>t.id===e.modelId||t.identityKey===e.modelId);return{modelId:x(n?{id:n.id,provider:n.provider||n.providerId}:{id:e.modelId,provider:``}),role:e.role,weight:e.weight,priority:e.priority}});W({name:e.name,description:e.description||``,strategy:e.strategy,enabled:e.enabled,models:t})}}catch(e){console.error(`加载模型组合失败:`,e)}})()},[N,L,J]);let Y=()=>{D(`/settings/model-combo`)},X=async()=>{K(!0);try{let e={...U,models:U.models.map((e,t)=>({...e,id:`model_${Date.now()}_${t}`,role:e.role}))};L&&N?await d.updateCombo(N,e):await d.createCombo(e),await H(),D(`/settings/model-combo`)}catch(e){console.error(`保存模型组合失败:`,e)}finally{K(!1)}},Z=()=>{let e=U.models.length+1;W(t=>({...t,models:[...t.models,{modelId:``,role:`primary`,weight:1,priority:e}]}))},Q=e=>{U.strategy===`sequential`&&U.models.length<=2||W(t=>({...t,models:t.models.filter((t,n)=>n!==e)}))},$=(e,t,n)=>{let r=n;if(t===`modelId`&&typeof n==`string`){let e=w(n);if(e)r=x(e);else{let e=J.find(e=>e.id===n||e.identityKey===n);r=e?x({id:e.id,provider:e.provider||e.providerId}):n}}W(n=>({...n,models:n.models.map((n,i)=>i===e?{...n,[t]:r}:n)}))},te=e=>{let t=U.models;e===`sequential`?t=[{modelId:U.models[0]?.modelId||``,role:`thinking`,weight:1,priority:1},{modelId:U.models[1]?.modelId||``,role:`generating`,weight:1,priority:2}]:e===`comparison`&&U.models.length<2&&(t=[{modelId:``,role:`primary`,weight:1,priority:1},{modelId:``,role:`primary`,weight:1,priority:2}]),W(n=>({...n,strategy:e,models:t}))},ne=e=>{switch(e){case`sequential`:return m(`modelSettings.combo.strategyDesc.sequential`,`先用推理模型深度思考，再用生成模型输出答案（类似 DeepClaude）`);case`comparison`:return m(`modelSettings.combo.strategyDesc.comparison`,`同时使用多个模型，展示对比结果供用户选择`);default:return``}},re=e=>U.strategy===`sequential`?e===0?{icon:(0,V.jsx)(F,{size:20}),label:m(`modelSettings.combo.thinkingModel`,`推理模型`),color:`#9c27b0`,desc:`负责深度思考和推理`}:{icon:(0,V.jsx)(c,{size:20}),label:m(`modelSettings.combo.generatingModel`,`生成模型`),color:`#2196f3`,desc:`基于推理结果生成最终答案`}:{icon:(0,V.jsx)(z,{size:20}),label:`${m(`modelSettings.combo.model`,`模型`)} ${e+1}`,color:`#757575`,desc:``};return(0,V.jsxs)(g,{children:[(0,V.jsx)(_,{position:`static`,elevation:0,sx:{bgcolor:`background.paper`,color:`text.primary`,borderBottom:1,borderColor:`divider`},children:(0,V.jsxs)(o,{children:[(0,V.jsx)(a,{edge:`start`,onClick:Y,sx:{color:`primary.main`},children:(0,V.jsx)(P,{size:24})}),(0,V.jsx)(M,{variant:`h6`,sx:{flexGrow:1,fontWeight:600},children:L?m(`modelSettings.combo.editCombo`,`编辑模型组合`):m(`modelSettings.combo.createCombo`,`创建模型组合`)}),(0,V.jsx)(b,{variant:`contained`,startIcon:(0,V.jsx)(I,{size:18}),onClick:X,disabled:!(()=>U.name.trim()!==``&&U.models.length>=2&&U.models.every(e=>e.modelId.trim()!==``))()||G,children:m(`common.save`,`保存`)})]})}),(0,V.jsx)(S,{sx:{flexGrow:1,overflow:`auto`,p:2,pb:`var(--content-bottom-padding)`},children:(0,V.jsxs)(S,{sx:{maxWidth:600,mx:`auto`,display:`flex`,flexDirection:`column`,gap:3},children:[(0,V.jsx)(e,{variant:`outlined`,children:(0,V.jsxs)(t,{children:[(0,V.jsx)(M,{variant:`subtitle1`,fontWeight:600,gutterBottom:!0,children:m(`modelSettings.combo.basicInfo`,`基本信息`)}),(0,V.jsxs)(S,{sx:{display:`flex`,flexDirection:`column`,gap:2,mt:2},children:[(0,V.jsx)(s,{fullWidth:!0,label:m(`modelSettings.combo.comboName`,`组合名称`),value:U.name,onChange:e=>W(t=>({...t,name:e.target.value})),required:!0,placeholder:`例如：DeepClaude 组合`}),(0,V.jsx)(s,{fullWidth:!0,label:m(`modelSettings.combo.description`,`描述`),value:U.description,onChange:e=>W(t=>({...t,description:e.target.value})),multiline:!0,rows:2,placeholder:`描述这个模型组合的用途`}),(0,V.jsx)(h,{control:(0,V.jsx)(k,{checked:U.enabled,onChange:e=>W(t=>({...t,enabled:e.target.checked}))}),label:m(`modelSettings.combo.enableCombo`,`启用此组合`)})]})]})}),(0,V.jsx)(e,{variant:`outlined`,children:(0,V.jsxs)(t,{children:[(0,V.jsx)(M,{variant:`subtitle1`,fontWeight:600,gutterBottom:!0,children:m(`modelSettings.combo.strategy.label`,`组合策略`)}),(0,V.jsxs)(S,{sx:{mt:2},children:[(0,V.jsxs)(f,{fullWidth:!0,children:[(0,V.jsx)(u,{children:m(`modelSettings.combo.strategy.label`,`组合策略`)}),(0,V.jsxs)(ee,{value:U.strategy,onChange:e=>te(e.target.value),label:m(`modelSettings.combo.strategy.label`,`组合策略`),children:[(0,V.jsx)(l,{value:`sequential`,children:(0,V.jsxs)(S,{sx:{display:`flex`,alignItems:`center`,gap:1},children:[(0,V.jsx)(n,{size:18}),m(`modelSettings.combo.strategy.sequential`,`顺序执行`)]})}),(0,V.jsx)(l,{value:`comparison`,children:(0,V.jsxs)(S,{sx:{display:`flex`,alignItems:`center`,gap:1},children:[(0,V.jsx)(z,{size:18}),m(`modelSettings.combo.strategy.comparison`,`对比分析`)]})})]})]}),(0,V.jsx)(p,{severity:`info`,sx:{mt:2},children:ne(U.strategy)})]})]})}),(0,V.jsx)(e,{variant:`outlined`,children:(0,V.jsxs)(t,{children:[(0,V.jsxs)(S,{sx:{display:`flex`,justifyContent:`space-between`,alignItems:`center`,mb:2},children:[(0,V.jsx)(M,{variant:`subtitle1`,fontWeight:600,children:m(`modelSettings.combo.configModels`,`配置模型`)}),U.strategy===`comparison`&&(0,V.jsx)(b,{startIcon:(0,V.jsx)(r,{size:18}),onClick:Z,size:`small`,children:m(`modelSettings.combo.addModel`,`添加模型`)})]}),U.strategy===`sequential`&&(0,V.jsxs)(S,{sx:{display:`flex`,flexDirection:`column`,gap:2},children:[U.models.map((n,r)=>{let i=re(r);return(0,V.jsx)(e,{variant:`outlined`,sx:{borderColor:E(i.color,.5),bgcolor:E(i.color,.03)},children:(0,V.jsxs)(t,{children:[(0,V.jsxs)(S,{sx:{display:`flex`,alignItems:`center`,gap:1,mb:1,color:i.color},children:[i.icon,(0,V.jsx)(M,{variant:`subtitle2`,fontWeight:600,color:`inherit`,children:i.label})]}),i.desc&&(0,V.jsx)(M,{variant:`caption`,color:`text.secondary`,sx:{display:`block`,mb:1.5},children:i.desc}),(0,V.jsx)(R,{selectedModel:n.modelId&&J.find(e=>j(e,w(n.modelId),e.provider))||null,availableModels:J,handleModelSelect:e=>{$(r,`modelId`,e?x({id:e.id,provider:e.provider||e.providerId}):``)}})]})},r)}),(0,V.jsx)(A,{sx:{my:1},children:(0,V.jsxs)(S,{sx:{display:`flex`,alignItems:`center`,gap:1,color:`text.secondary`,px:2},children:[(0,V.jsx)(F,{size:16,color:`#9c27b0`}),(0,V.jsx)(n,{size:16}),(0,V.jsx)(c,{size:16,color:`#2196f3`}),(0,V.jsx)(M,{variant:`caption`,sx:{ml:1},children:m(`modelSettings.combo.sequentialFlow`,`推理 → 生成`)})]})})]}),U.strategy===`comparison`&&(0,V.jsx)(S,{sx:{display:`flex`,flexDirection:`column`,gap:2},children:U.models.map((n,r)=>(0,V.jsx)(e,{variant:`outlined`,children:(0,V.jsxs)(t,{children:[(0,V.jsxs)(S,{sx:{display:`flex`,justifyContent:`space-between`,alignItems:`center`,mb:1.5},children:[(0,V.jsxs)(M,{variant:`subtitle2`,fontWeight:500,children:[m(`modelSettings.combo.model`,`模型`),` `,r+1]}),U.models.length>2&&(0,V.jsx)(a,{size:`small`,onClick:()=>Q(r),color:`error`,children:(0,V.jsx)(i,{size:18})})]}),(0,V.jsx)(R,{selectedModel:n.modelId&&J.find(e=>j(e,w(n.modelId),e.provider))||null,availableModels:J,handleModelSelect:e=>{$(r,`modelId`,e?x({id:e.id,provider:e.provider||e.providerId}):``)}})]})},r))})]})})]})})]})};export{H as default};