import{Lp as e,Mp as t}from"./index-hvLbsAjx.js";var n=e(`AdvancedFileManager`);const r=new class{permissionsGranted=!1;isSupportedPlatform(){return t.isNativePlatform()}async requestPermissions(){if(!this.isSupportedPlatform())return{granted:!1,message:`文件管理功能仅在移动端应用中可用`};try{let e=await n.requestPermissions();return this.permissionsGranted=e.granted,e}catch(e){return console.error(`请求权限失败:`,e),{granted:!1,message:`请求权限失败: `+(e instanceof Error?e.message:String(e))}}}async checkPermissions(){if(!this.isSupportedPlatform())return{granted:!1,message:`文件管理功能仅在移动端应用中可用`};try{let e=await n.checkPermissions();return this.permissionsGranted=e.granted,e}catch(e){return console.error(`检查权限失败:`,e),{granted:!1,message:`检查权限失败: `+(e instanceof Error?e.message:String(e))}}}async ensurePermissions(){if(!this.isSupportedPlatform())throw Error(`文件管理功能仅在移动端应用中可用。在浏览器中，请使用浏览器的文件选择功能。`);if(!this.permissionsGranted&&!(await this.checkPermissions()).granted)throw Error(`需要文件访问权限才能使用此功能。请在工作区设置中授权文件访问权限。`);return!0}async openSystemFilePicker(e){if(!await this.ensurePermissions())throw Error(`没有文件访问权限`);try{let t=await n.openSystemFilePicker(e);return t.directories&&t.directories.length>0&&(t.directories=t.directories.map(e=>{let t={...e};return(!t.name||t.name===`unknown`||t.name.length===0)&&(t.name=this.extractFriendlyNameFromUri(t.path||t.uri)),t.path&&t.path.startsWith(`content://`)&&(t.displayPath=this.convertContentUriToDisplayPath(t.path)),t})),t}catch(e){throw console.error(`打开系统文件选择器失败:`,e),Error(`打开系统文件选择器失败: `+(e instanceof Error?e.message:String(e)))}}extractFriendlyNameFromUri(e){try{if(!e)return`新工作区`;let t=decodeURIComponent(e);if(t.includes(`primary:`)){let e=t.split(`primary:`),n=e.length>1?e[1]:``;if(n){let e=(n||``).split(`/`).filter(e=>e.length>0);return e.length>0?e[e.length-1]:n||`Documents`}}if(t.includes(`downloads`))return`Downloads`;if(t.includes(`Documents`))return`Documents`;if(t.includes(`Pictures`))return`Pictures`;if(t.includes(`Music`))return`Music`;if(t.includes(`Movies`))return`Movies`;let n=(e||``).split(`/`).filter(e=>e.length>0);return n.length>0?n[n.length-1]:`选择的文件夹`}catch(e){return console.error(`提取友好名称失败:`,e),`新工作区`}}convertContentUriToDisplayPath(e){try{let t=decodeURIComponent(e);if(t.includes(`primary:`)){let e=t.split(`primary:`)[1];if(e)return`/storage/emulated/0/${e}`}return t.includes(`downloads`)?`/storage/emulated/0/Download`:e}catch(t){return console.error(`转换显示路径失败:`,t),e}}async openSystemFileManager(e){if(!await this.ensurePermissions())throw Error(`没有文件访问权限`);try{await n.openSystemFileManager(e)}catch(e){throw console.error(`打开系统文件管理器失败:`,e),Error(`打开系统文件管理器失败: `+(e instanceof Error?e.message:String(e)))}}async openFileWithSystemApp(e,t){if(!await this.ensurePermissions())throw Error(`没有文件访问权限`);try{await n.openFileWithSystemApp(e,t)}catch(e){throw console.error(`用系统应用打开文件失败:`,e),Error(`用系统应用打开文件失败: `+(e instanceof Error?e.message:String(e)))}}async listDirectory(e){if(!await this.ensurePermissions())throw Error(`没有文件访问权限`);try{return await n.listDirectory(e)}catch(e){throw console.error(`列出目录失败:`,e),Error(`列出目录失败: `+(e instanceof Error?e.message:String(e)))}}async createDirectory(e){if(!await this.ensurePermissions())throw Error(`没有文件访问权限`);try{await n.createDirectory(e)}catch(e){throw console.error(`创建目录失败:`,e),Error(`创建目录失败: `+(e instanceof Error?e.message:String(e)))}}async deleteDirectory(e){if(!await this.ensurePermissions())throw Error(`没有文件访问权限`);try{await n.deleteDirectory(e)}catch(e){throw console.error(`删除目录失败:`,e),Error(`删除目录失败: `+(e instanceof Error?e.message:String(e)))}}async createFile(e){if(!await this.ensurePermissions())throw Error(`没有文件访问权限`);try{await n.createFile(e)}catch(e){throw console.error(`创建文件失败:`,e),Error(`创建文件失败: `+(e instanceof Error?e.message:String(e)))}}async createEmptyFile(e,t){let n=`${e}/${t}`;try{await this.createFile({path:n,content:``,encoding:`utf8`})}catch(e){throw console.error(`创建空文件失败:`,e),Error(`创建空文件失败: `+(e instanceof Error?e.message:String(e)))}}async createTextFile(e,t,n=``){let r=`${e}/${t}`;try{await this.createFile({path:r,content:n,encoding:`utf8`})}catch(e){throw console.error(`创建文本文件失败:`,e),Error(`创建文本文件失败: `+(e instanceof Error?e.message:String(e)))}}async readFile(e){if(!await this.ensurePermissions())throw Error(`没有文件访问权限`);try{return await n.readFile(e)}catch(e){throw console.error(`读取文件失败:`,e),Error(`读取文件失败: `+(e instanceof Error?e.message:String(e)))}}async writeFile(e){if(!await this.ensurePermissions())throw Error(`没有文件访问权限`);try{await n.writeFile(e)}catch(e){throw console.error(`写入文件失败:`,e),Error(`写入文件失败: `+(e instanceof Error?e.message:String(e)))}}async deleteFile(e){if(!await this.ensurePermissions())throw Error(`没有文件访问权限`);try{await n.deleteFile(e)}catch(e){throw console.error(`删除文件失败:`,e),Error(`删除文件失败: `+(e instanceof Error?e.message:String(e)))}}async moveFile(e){if(!await this.ensurePermissions())throw Error(`没有文件访问权限`);try{await n.moveFile(e)}catch(e){throw console.error(`移动文件失败:`,e),Error(`移动文件失败: `+(e instanceof Error?e.message:String(e)))}}async copyFile(e){if(!await this.ensurePermissions())throw Error(`没有文件访问权限`);try{await n.copyFile(e)}catch(e){throw console.error(`复制文件失败:`,e),Error(`复制文件失败: `+(e instanceof Error?e.message:String(e)))}}async renameFile(e){if(!await this.ensurePermissions())throw Error(`没有文件访问权限`);try{await n.renameFile(e)}catch(e){throw console.error(`重命名文件失败:`,e),Error(`重命名文件失败: `+(e instanceof Error?e.message:String(e)))}}async getFileInfo(e){if(!await this.ensurePermissions())throw Error(`没有文件访问权限`);try{return await n.getFileInfo(e)}catch(e){throw console.error(`获取文件信息失败:`,e),Error(`获取文件信息失败: `+(e instanceof Error?e.message:String(e)))}}async exists(e){if(!await this.ensurePermissions())throw Error(`没有文件访问权限`);try{return(await n.exists(e)).exists}catch(e){return console.error(`检查文件存在性失败:`,e),!1}}async searchFiles(e){if(!await this.ensurePermissions())throw Error(`没有文件访问权限`);try{return await n.searchFiles(e)}catch(e){throw console.error(`搜索文件失败:`,e),Error(`搜索文件失败: `+(e instanceof Error?e.message:String(e)))}}async readFileRange(e){if(!this.isSupportedPlatform())throw Error(`文件管理功能仅在移动端应用中可用`);if(!await this.ensurePermissions())throw Error(`没有文件访问权限`);try{return await n.readFileRange(e)}catch(e){throw console.error(`读取文件范围失败:`,e),Error(`读取文件范围失败: `+(e instanceof Error?e.message:String(e)))}}async insertContent(e){if(!this.isSupportedPlatform())throw Error(`文件管理功能仅在移动端应用中可用`);if(!await this.ensurePermissions())throw Error(`没有文件访问权限`);try{return await n.insertContent(e)}catch(e){throw console.error(`插入内容失败:`,e),Error(`插入内容失败: `+(e instanceof Error?e.message:String(e)))}}async replaceInFile(e){if(!this.isSupportedPlatform())throw Error(`文件管理功能仅在移动端应用中可用`);if(!await this.ensurePermissions())throw Error(`没有文件访问权限`);try{return await n.replaceInFile(e)}catch(e){throw console.error(`替换内容失败:`,e),Error(`替换内容失败: `+(e instanceof Error?e.message:String(e)))}}async applyDiff(e){if(!this.isSupportedPlatform())throw Error(`文件管理功能仅在移动端应用中可用`);if(!await this.ensurePermissions())throw Error(`没有文件访问权限`);try{return await n.applyDiff(e)}catch(e){throw console.error(`应用 diff 失败:`,e),Error(`应用 diff 失败: `+(e instanceof Error?e.message:String(e)))}}async getFileHash(e){if(!this.isSupportedPlatform())throw Error(`文件管理功能仅在移动端应用中可用`);if(!await this.ensurePermissions())throw Error(`没有文件访问权限`);try{return await n.getFileHash(e)}catch(e){throw console.error(`获取文件哈希失败:`,e),Error(`获取文件哈希失败: `+(e instanceof Error?e.message:String(e)))}}async getLineCount(e){if(!this.isSupportedPlatform())throw Error(`文件管理功能仅在移动端应用中可用`);if(!await this.ensurePermissions())throw Error(`没有文件访问权限`);try{return await n.getLineCount(e)}catch(e){throw console.error(`获取文件行数失败:`,e),Error(`获取文件行数失败: `+(e instanceof Error?e.message:String(e)))}}async testConnection(){if(!this.isSupportedPlatform())return!1;try{return(await n.echo({value:`test`})).value===`test`}catch(e){return console.error(`测试插件连接失败:`,e),!1}}};export{r as advancedFileManagerService};