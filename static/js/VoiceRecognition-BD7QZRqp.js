import{t as e}from"./InputAdornment-DO0tC8Wv.js";import{t}from"./mic-DOR2hOIQ.js";import{Ad as n,Bl as r,Cd as i,Eu as a,Iu as o,Ju as s,Nl as c,Nu as l,Qu as u,Sd as d,Su as f,Xu as p,ci as m,dd as h,fd as g,ju as _,ku as v,nu as y,qp as b,tu as x,vd as S,wd as C,xd as w,xp as T,xu as E,zp as D}from"./index-hvLbsAjx.js";import{n as O,t as k}from"./useVoiceRecognition-BsXW9Pyd.js";var A=f(`mic-off`,[[`path`,{d:`M12 19v3`,key:`npa21l`}],[`path`,{d:`M15 9.34V5a3 3 0 0 0-5.68-1.33`,key:`1gzdoj`}],[`path`,{d:`M16.95 16.95A7 7 0 0 1 5 12v-2`,key:`cqa7eg`}],[`path`,{d:`M18.89 13.23A7 7 0 0 0 19 12v-2`,key:`16hl24`}],[`path`,{d:`m2 2 20 20`,key:`1ooewy`}],[`path`,{d:`M9 9v3a3 3 0 0 0 5.12 2.12`,key:`r2i35w`}]]),j=f(`volume-x`,[[`path`,{d:`M11 4.702a.705.705 0 0 0-1.203-.498L6.413 7.587A1.4 1.4 0 0 1 5.416 8H3a1 1 0 0 0-1 1v6a1 1 0 0 0 1 1h2.416a1.4 1.4 0 0 1 .997.413l3.383 3.384A.705.705 0 0 0 11 19.298z`,key:`uqj9uw`}],[`line`,{x1:`22`,x2:`16`,y1:`9`,y2:`15`,key:`1ewh16`}],[`line`,{x1:`16`,x2:`22`,y1:`9`,y2:`15`,key:`5ykzw1`}]]),M=b(D(),1),N=b(T(),1),P=`
  @keyframes shake {
    0%, 100% { transform: rotate(0); }
    25% { transform: rotate(-10deg); }
    75% { transform: rotate(10deg); }
  }
`,F=({isVoiceMode:e,isDisabled:n=!1,onToggleVoiceMode:r,size:a=`medium`,color:o=`default`,tooltip:s,className:c})=>{let l=()=>{switch(a){case`small`:return 20;case`large`:return 28;default:return 24}},u=(0,N.jsxs)(i,{onClick:r,disabled:n,className:c,color:e?`error`:o,size:a,sx:{position:`relative`,transition:`all 0.25s ease-in-out`,backgroundColor:e?`rgba(211, 47, 47, 0.15)`:`transparent`,"&:hover":{transform:n?`none`:`scale(1.08)`,backgroundColor:e?`rgba(211, 47, 47, 0.25)`:`rgba(0, 0, 0, 0.08)`},"&.Mui-disabled":{opacity:.5},"&:active":{backgroundColor:e?`rgba(211, 47, 47, 0.3)`:`rgba(0, 0, 0, 0.15)`,transform:`scale(0.95)`}},"aria-label":e?`退出语音输入模式`:`切换到语音输入模式`,children:[e&&(0,N.jsx)(g,{sx:{position:`absolute`,top:`50%`,left:`50%`,width:`85%`,height:`85%`,borderRadius:`50%`,transform:`translate(-50%, -50%)`,backgroundColor:`rgba(211, 47, 47, 0.15)`,animation:`pulse 2s infinite`,"@keyframes pulse":{"0%":{transform:`translate(-50%, -50%) scale(0.9)`,opacity:.7},"50%":{transform:`translate(-50%, -50%) scale(1.2)`,opacity:.3},"100%":{transform:`translate(-50%, -50%) scale(0.9)`,opacity:.7}}}}),(0,N.jsx)(`style`,{children:P}),e?(0,N.jsx)(A,{size:l(),color:`#f44336`,style:{transition:`color 0.2s ease-in-out, transform 0.2s ease-in-out`,animation:`shake 1s ease-in-out`}}):(0,N.jsx)(t,{size:l(),style:{transition:`color 0.2s ease-in-out`}})]});return(0,N.jsx)(v,{title:s||(e?`点击退出语音输入模式`:`点击启用语音输入`),arrow:!0,placement:`top`,children:u})},I=({settings:t,onSettingsChange:n})=>{let{t:r}=m(),c=(e,r)=>{n({...t,[e]:r})},f=()=>{c(`showApiKey`,!t.showApiKey)};return(0,N.jsxs)(g,{sx:{py:1},children:[(0,N.jsx)(w,{variant:`h6`,sx:{mb:2},children:r(`settings.voice.tabSettings.whisper.title`)}),(0,N.jsx)(d,{severity:`info`,sx:{mb:3},children:r(`settings.voice.tabSettings.whisper.info`)}),(0,N.jsx)(a,{fullWidth:!0,label:r(`settings.voice.tabSettings.whisper.apiKey`),value:t.apiKey,onChange:e=>c(`apiKey`,e.target.value),type:t.showApiKey?`text`:`password`,margin:`normal`,sx:{mb:3},helperText:r(`settings.voice.tabSettings.whisper.apiKeyHelper`),InputProps:{endAdornment:(0,N.jsx)(e,{position:`end`,children:(0,N.jsx)(i,{"aria-label":r(`settings.voice.tabSettings.whisper.toggleApiKeyVisibility`),onClick:f,edge:`end`,children:t.showApiKey?(0,N.jsx)(y,{}):(0,N.jsx)(x,{})})})}}),(0,N.jsxs)(u,{fullWidth:!0,margin:`normal`,sx:{mb:3},children:[(0,N.jsx)(s,{children:r(`settings.voice.tabSettings.whisper.model`)}),(0,N.jsx)(l,{value:t.model,onChange:e=>c(`model`,e.target.value),label:r(`settings.voice.tabSettings.whisper.model`),children:O.getAvailableModels().map(e=>(0,N.jsx)(o,{value:e,children:e},e))}),(0,N.jsx)(p,{children:r(`settings.voice.tabSettings.whisper.modelHelper`)})]}),(0,N.jsxs)(u,{fullWidth:!0,margin:`normal`,sx:{mb:3},children:[(0,N.jsx)(s,{children:r(`settings.voice.tabSettings.whisper.language`)}),(0,N.jsxs)(l,{value:t.language||``,onChange:e=>c(`language`,e.target.value||void 0),label:r(`settings.voice.tabSettings.whisper.language`),children:[(0,N.jsx)(o,{value:``,children:r(`settings.voice.tabSettings.whisper.languageAuto`)}),(0,N.jsx)(o,{value:`zh`,children:r(`settings.voice.tabSettings.whisper.languageZh`)}),(0,N.jsx)(o,{value:`en`,children:r(`settings.voice.tabSettings.whisper.languageEn`)}),(0,N.jsx)(o,{value:`ja`,children:r(`settings.voice.tabSettings.whisper.languageJa`)}),(0,N.jsx)(o,{value:`ko`,children:r(`settings.voice.tabSettings.whisper.languageKo`)}),(0,N.jsx)(o,{value:`fr`,children:r(`settings.voice.tabSettings.whisper.languageFr`)}),(0,N.jsx)(o,{value:`de`,children:r(`settings.voice.tabSettings.whisper.languageDe`)}),(0,N.jsx)(o,{value:`es`,children:r(`settings.voice.tabSettings.whisper.languageEs`)}),(0,N.jsx)(o,{value:`ru`,children:r(`settings.voice.tabSettings.whisper.languageRu`)})]}),(0,N.jsx)(p,{children:r(`settings.voice.tabSettings.whisper.languageHelper`)})]}),(0,N.jsxs)(g,{sx:{mb:3},children:[(0,N.jsxs)(w,{id:`temperature-slider`,gutterBottom:!0,children:[r(`settings.voice.tabSettings.whisper.temperature`),`: `,t.temperature]}),(0,N.jsx)(_,{"aria-labelledby":`temperature-slider`,value:t.temperature||0,onChange:(e,t)=>c(`temperature`,t),step:.1,marks:!0,min:0,max:1,valueLabelDisplay:`auto`}),(0,N.jsx)(p,{children:r(`settings.voice.tabSettings.whisper.temperatureHelper`)})]}),(0,N.jsxs)(u,{fullWidth:!0,margin:`normal`,sx:{mb:3},children:[(0,N.jsx)(s,{children:r(`settings.voice.tabSettings.whisper.responseFormat`)}),(0,N.jsxs)(l,{value:t.responseFormat||`json`,onChange:e=>c(`responseFormat`,e.target.value),label:r(`settings.voice.tabSettings.whisper.responseFormat`),children:[(0,N.jsx)(o,{value:`json`,children:`JSON`}),(0,N.jsx)(o,{value:`text`,children:`Plain Text`}),(0,N.jsx)(o,{value:`srt`,children:`SRT`}),(0,N.jsx)(o,{value:`verbose_json`,children:`Verbose JSON`}),(0,N.jsx)(o,{value:`vtt`,children:`VTT`})]}),(0,N.jsx)(p,{children:r(`settings.voice.tabSettings.whisper.responseFormatHelper`)})]})]})},L=({settings:e,enabled:i})=>{let{t:a}=m(),[o,s]=(0,M.useState)(!1),[l,u]=(0,M.useState)(!1),[f,p]=(0,M.useState)(null),[_,v]=(0,M.useState)(null),y=(0,M.useRef)(null),b=(0,M.useRef)([]),x=(0,M.useRef)(null);return(0,N.jsxs)(g,{sx:{mt:4,mb:2},children:[(0,N.jsx)(w,{variant:`h6`,gutterBottom:!0,children:a(`settings.voice.test.whisper.title`)}),!i&&(0,N.jsx)(d,{severity:`warning`,sx:{mb:3},children:a(`settings.voice.test.whisper.enableWarning`)}),_&&(0,N.jsx)(d,{severity:`error`,sx:{mb:3},children:_}),(0,N.jsxs)(g,{sx:{display:`flex`,gap:2,mb:3,flexWrap:`wrap`},children:[(0,N.jsx)(h,{variant:`contained`,color:o?`error`:`primary`,startIcon:o?(0,N.jsx)(c,{}):(0,N.jsx)(t,{}),onClick:o?()=>{y.current&&y.current.state!==`inactive`&&y.current.stop()}:async()=>{try{if(v(null),p(null),!e.apiKey){v(a(`settings.voice.test.whisper.apiKeyError`));return}O.setApiKey(e.apiKey),O.setModel(e.model),e.language&&O.setLanguage(e.language),O.setTemperature(e.temperature||0),O.setResponseFormat(e.responseFormat||`json`);let t=await navigator.mediaDevices.getUserMedia({audio:!0});x.current=t;let n=new MediaRecorder(t);y.current=n,b.current=[],n.addEventListener(`dataavailable`,e=>{b.current.push(e.data)}),n.addEventListener(`stop`,async()=>{try{s(!1),u(!0);let e=new Blob(b.current,{type:`audio/webm`});p(await O.transcribeAudio(e))}catch(e){v(e.message||a(`settings.voice.test.whisper.transcribeError`))}finally{u(!1),x.current&&=(x.current.getTracks().forEach(e=>e.stop()),null)}}),n.start(),s(!0),setTimeout(()=>{y.current&&y.current.state!==`inactive`&&y.current.stop()},5e3)}catch(e){v(e.message||a(`settings.voice.test.whisper.micError`)),s(!1)}},disabled:!i||l||!e.apiKey,children:a(o?`settings.voice.test.whisper.stopRecording`:`settings.voice.test.whisper.startRecording`)}),(0,N.jsx)(h,{variant:`outlined`,startIcon:(0,N.jsx)(r,{}),onClick:()=>{p(null),v(null)},disabled:o||l||!f&&!_,children:a(`settings.voice.test.whisper.clearResults`)})]}),l&&(0,N.jsxs)(g,{sx:{display:`flex`,alignItems:`center`,gap:2,my:3},children:[(0,N.jsx)(C,{size:24}),(0,N.jsx)(w,{children:a(`settings.voice.test.whisper.processing`)})]}),f&&(0,N.jsxs)(n,{elevation:1,sx:{p:3,mb:3,bgcolor:`background.paper`,border:`1px solid`,borderColor:`divider`,borderRadius:2},children:[(0,N.jsx)(w,{variant:`subtitle1`,gutterBottom:!0,fontWeight:500,children:a(`settings.voice.test.whisper.result`)}),(0,N.jsx)(w,{variant:`body1`,sx:{whiteSpace:`pre-wrap`},children:f.text}),f.language&&(0,N.jsx)(S,{label:a(`settings.voice.test.whisper.detectedLanguage`,{language:f.language}),color:`primary`,size:`small`,sx:{mt:2,mr:1}}),f.duration&&(0,N.jsx)(S,{label:a(`settings.voice.test.whisper.audioDuration`,{duration:f.duration.toFixed(2)}),color:`secondary`,size:`small`,sx:{mt:2}})]}),(0,N.jsx)(d,{severity:`info`,sx:{mb:2},children:a(`settings.voice.test.whisper.hint`)})]})},R=({isDarkMode:e=!1,onInsertText:t,onClose:r,startRecognition:a,currentMessage:o})=>{let{isListening:s,recognitionText:c,error:l,stopRecognition:u,permissionStatus:d}=k(),[f,p]=(0,M.useState)(!1),[m,h]=(0,M.useState)(0),[_,y]=(0,M.useState)(!1),[b,x]=(0,M.useState)(null),[S,C]=(0,M.useState)(!1),[T,D]=(0,M.useState)(0),[O,A]=(0,M.useState)(``);(0,M.useEffect)(()=>{c&&s&&t(O+(O&&c?` `:``)+c)},[c,s,t,O]),(0,M.useEffect)(()=>()=>{b&&clearTimeout(b),s&&u()},[s,u,b]);let P=(0,M.useCallback)(()=>{b&&(clearTimeout(b),x(null)),D(0)},[b]),F=(0,M.useCallback)(async()=>{if(!S)try{A(o),C(!0),await a({language:`zh-CN`,partialResults:!0})}catch(e){console.error(`启动录音失败:`,e),C(!1)}},[S,a,o]),I=(0,M.useCallback)(e=>{e.preventDefault();let t=e.touches[0];p(!0),h(t.clientY),y(!1),P(),x(setTimeout(()=>{F()},300));let n=setInterval(()=>{D(e=>e>=100?(clearInterval(n),100):e+100/30)},10);setTimeout(()=>{clearInterval(n)},300)},[P,F]),L=(0,M.useCallback)(e=>{f&&(e.preventDefault(),y(m-e.touches[0].clientY>100))},[f,m]),R=(0,M.useCallback)(async e=>{if(e.preventDefault(),f){if(p(!1),P(),!S){r();return}if(_)try{await u(),r()}catch(e){console.error(`取消录音失败:`,e),r()}else try{await u(),r()}catch(e){console.error(`发送录音失败:`,e),r()}y(!1),h(0),C(!1),D(0)}},[f,_,u,r,P,S]),z=(0,M.useCallback)(e=>{e.preventDefault(),p(!0),h(e.clientY),y(!1),P(),x(setTimeout(()=>{F()},300));let t=setInterval(()=>{D(e=>e>=100?(clearInterval(t),100):e+100/30)},10);setTimeout(()=>{clearInterval(t)},300)},[P,F]),B=(0,M.useCallback)(e=>{f&&(e.preventDefault(),y(m-e.clientY>100))},[f,m]),V=(0,M.useCallback)(async e=>{if(e.preventDefault(),f){if(p(!1),P(),!S){r();return}if(_)try{await u(),r()}catch(e){console.error(`取消录音失败:`,e),r()}else try{await u(),r()}catch(e){console.error(`发送录音失败:`,e),r()}y(!1),h(0),C(!1),D(0)}},[f,_,u,r,P,S]);return d===`denied`?(0,N.jsxs)(n,{elevation:1,sx:{height:80,display:`flex`,flexDirection:`column`,alignItems:`center`,justifyContent:`center`,backgroundColor:e?`#2a2a2a`:`#fff`,borderRadius:2,p:2,border:`1px solid ${e?`#444`:`#e0e0e0`}`},children:[(0,N.jsx)(j,{size:24,color:`#f44336`,style:{marginBottom:8}}),(0,N.jsx)(w,{variant:`caption`,color:`text.secondary`,textAlign:`center`,children:`需要麦克风权限`})]}):(0,N.jsxs)(g,{sx:{width:`100%`,userSelect:`none`,WebkitUserSelect:`none`,MozUserSelect:`none`,msUserSelect:`none`,WebkitTouchCallout:`none`,WebkitTapHighlightColor:`transparent`},children:[(0,N.jsx)(g,{sx:{display:`flex`,justifyContent:`flex-start`,mb:1},children:(0,N.jsx)(v,{title:`返回文字输入`,children:(0,N.jsx)(i,{onClick:r,size:`small`,sx:{color:e?`rgba(255,255,255,0.7)`:`rgba(0,0,0,0.7)`,"&:hover":{backgroundColor:e?`rgba(255,255,255,0.1)`:`rgba(0,0,0,0.1)`}},children:(0,N.jsx)(E,{size:20})})})}),l&&(0,N.jsx)(g,{sx:{mb:1},children:(0,N.jsxs)(w,{variant:`caption`,color:`error`,sx:{fontSize:`0.75rem`,userSelect:`none`},children:[`错误: `,l.message]})}),(0,N.jsx)(g,{sx:{display:`flex`,justifyContent:`center`,mb:1,transform:_?`translateY(-10px)`:`translateY(0)`,transition:`transform 0.2s ease`},children:(0,N.jsx)(g,{sx:{backgroundColor:_?`#f44336`:S?`#4caf50`:e?`rgba(255,255,255,0.1)`:`rgba(0,0,0,0.1)`,borderRadius:`20px`,px:2,py:.5,transition:`background-color 0.2s ease`,userSelect:`none`,WebkitUserSelect:`none`,MozUserSelect:`none`,msUserSelect:`none`},children:(0,N.jsx)(w,{variant:`body2`,fontWeight:500,color:_||S?`#ffffff`:e?`rgba(255,255,255,0.8)`:`rgba(0,0,0,0.6)`,sx:{fontSize:`0.8rem`,textAlign:`center`,transition:`color 0.2s ease`,userSelect:`none`,WebkitUserSelect:`none`,MozUserSelect:`none`,msUserSelect:`none`},children:_?`松开取消录音`:S?`正在录音...`:`长按开始录音`})})}),(0,N.jsxs)(n,{elevation:3,onTouchStart:I,onTouchMove:L,onTouchEnd:R,onMouseDown:z,onMouseMove:B,onMouseUp:V,onMouseLeave:V,sx:{height:80,display:`flex`,alignItems:`center`,justifyContent:`center`,backgroundColor:e?`#2a2a2a`:`#fff`,borderRadius:2,border:_?`2px solid #f44336`:S?`2px solid #4caf50`:`2px solid #6366f1`,position:`relative`,overflow:`hidden`,transition:`all 0.2s ease`,px:2,cursor:`pointer`,transform:_?`scale(0.95)`:`scale(1)`,userSelect:`none`,WebkitUserSelect:`none`,MozUserSelect:`none`,msUserSelect:`none`,WebkitTouchCallout:`none`,WebkitTapHighlightColor:`transparent`},children:[!S&&T>0&&(0,N.jsx)(g,{sx:{position:`absolute`,top:0,left:0,height:`100%`,width:`100%`,backgroundColor:`rgba(99, 102, 241, 0.3)`,borderRadius:2,transformOrigin:`left center`,transform:`scaleX(${T/100})`,transition:`transform 0.1s ease`,willChange:`transform`,zIndex:1}}),S&&(0,N.jsx)(g,{sx:{position:`absolute`,top:0,left:0,right:0,bottom:0,background:`linear-gradient(135deg, #4caf50 0%, #66bb6a 50%, #81c784 100%)`,borderRadius:2,display:`flex`,alignItems:`center`,justifyContent:`center`,overflow:`hidden`,zIndex:2},children:(0,N.jsx)(g,{sx:{display:`flex`,alignItems:`center`,gap:`2px`,height:`40%`},children:Array.from({length:20},(e,t)=>(0,N.jsx)(g,{sx:{width:`3px`,backgroundColor:`rgba(255, 255, 255, 0.8)`,borderRadius:`2px`,animation:`wave-${t%4} 1.2s ease-in-out infinite`,animationDelay:`${t*.1}s`,height:`100%`,"@keyframes wave-0":{"0%, 100%":{transform:`scaleY(0.3)`},"50%":{transform:`scaleY(1)`}},"@keyframes wave-1":{"0%, 100%":{transform:`scaleY(0.5)`},"50%":{transform:`scaleY(0.8)`}},"@keyframes wave-2":{"0%, 100%":{transform:`scaleY(0.7)`},"50%":{transform:`scaleY(1.2)`}},"@keyframes wave-3":{"0%, 100%":{transform:`scaleY(0.4)`},"50%":{transform:`scaleY(0.9)`}}}},t))})}),!S&&(0,N.jsx)(g,{sx:{display:`flex`,alignItems:`center`,justifyContent:`center`,height:`100%`,zIndex:2},children:(0,N.jsx)(w,{variant:`body2`,color:e?`rgba(255,255,255,0.6)`:`rgba(0,0,0,0.6)`,sx:{fontSize:`0.9rem`,fontWeight:500,userSelect:`none`},children:`长按开始录音`})})]})]})};export{j as a,F as i,L as n,I as r,R as t};